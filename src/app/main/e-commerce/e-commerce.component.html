

<!--


	This is the page for the products. A user creates a new project in the marketplace 
	when they want to play with a particular design. There are four tabs on the page.

	Tab 1 : Project List - A list of projects that the user has created. The user selects 
			one and then the remaining tabs are populated with the data for those projects.
			There are links to open the project in the design studio and to open the quote.

	Tab 2 : Project Data - A place for the user to edit data about the project. This 
			includes the name of the project and the description.

	Tab 3 : Version Data - This is where the user creates and edits versions of this 
			project. Versions are different iterations with different design parameters.
			On this tab, the user can create a new version, open a version in the design
			parameter, see the quote, edit the name and description of the version and 
			see the different design parameters.

	Tab 4 : Design and Purchase data : This tab shows the status of the project. Once the 
			user decides to purchase the project, this tab will show the status.
			It is still a work in progress.

-->


<div id="projects" style="background-color:#FFF" class="page-layout simple inner-scroll">

	<!-- HEADER -->
	<div class="header accent" fxLayout="row"></div>
	<!-- / HEADER -->

	<!-- CONTENT -->
	<div class="content">


		<!-- CENTER -->
		<div class="center p-24" fusePerfectScrollbar>

			<!-- CONTENT -->
			<div class="content p-24" style="box-shadow:0px 0px 0px rgba(0,0,0,0) !important;">

				<mat-tab-group fxFlex="80%"
							   style="margin:0px 10%">
					
					<mat-tab id="projectSelectionTab" label="Project Selection">


						<div fxFlex="80%" 
							 fxLayout="column"
							 style="margin:0px 10%"
							 *ngIf="versionList && projectList">

							<h1 class="mt-32 mb-20">Select a Project 

								<mat-icon style="cursor:pointer"
										  class="ml-20" 
										  matTooltip="Display as list"
										  (click)="displayType='list'">
									dehaze
								</mat-icon>

								<mat-icon style="cursor:pointer" 
										  class="ml-20" 
										  matTooltip="Display as cards"
										  (click)="displayType='cards'">
									apps
								</mat-icon>


							</h1>

							<mat-divider></mat-divider>


							<div *ngIf="projectList.length==0">
								You currently have no designs. Go to the marketplace and select a design to add to your list of projects.
							</div>


								<div class="cards"
									 *ngIf="displayType=='cards'">

						           <!-- CARD 2 -->
						            <div class="card"
						            	 *ngFor="let project of projectList"
						            	 [ngClass]="{'currentItem' : project==currentProject}"
						            	 (click)="setCurrentProject( project )">

						                <!-- PREVIEW -->
						                <div class="card-preview">

						                    <div class="fuse-card">

						                        <div class="p-16">
						                            <div class="h1">{{project.name}}</div>
						                            <div class="h5 secondary-text">{{ project.dateCreated | date:'short' }}</div>
						                        </div>

						                        <div class="p-16 pt-0 line-height-1.75">
						                        	<span style="font-weight:bold; margin-right:10px;">Type : {{project.designType}}</span>
						                            {{ project.description }}
						                        </div>

						                        <div class="p-8 pt-0" fxLayout="row" fxLayoutAlign="start center">
													
													<mat-icon style="cursor:pointer" 
															  matTooltip="Open in design studio"
															  [routerLink]="['/designStudio/project/'+project.uid]">
														color_lens
													</mat-icon>
													<mat-icon style="cursor:pointer" 
															  matTooltip="View Quotes for this project"
															  [routerLink]="['/invoice/'+versionList[versionList.length-1]['uid']]">
														attach_money
													</mat-icon>

						                        </div>

						                    </div>

						                </div>
						                <!-- / PREVIEW -->

						            </div>
						            <!-- / CARD 2 -->

								</div>
							

							<table class="displayTable" *ngIf="displayType=='list'">

								<tr	(click)="setCurrentProject( project ) "
								   target="_blank"
								   class="projectRow"
								   [ngClass]="{'currentItem' : project==currentProject}"
								   *ngFor="let project of projectList">

									<td class="mat-subheading-2 w-100">
										<mat-icon style="cursor:pointer" 
												  matTooltip="Open in design studio"
												  [routerLink]="['/designStudio/project/'+project.uid]">
											color_lens
										</mat-icon>

										<mat-icon style="cursor:pointer" 
												  matTooltip="View Quotes for this project"
												  [routerLink]="['/invoice/'+versionList[versionList.length-1]['uid']]">
											attach_money
										</mat-icon>
									</td>

									<td class="mat-subheading-2 w-200" >
											{{ project.name }} 
									</td>


									<td class="mat-subheading-2 w-200">
											{{ project.dateCreated | date:'short' }} 
									</td>


									<td class="mat-body-1" > 
										
										<span style="font-weight:bold; margin-right:10px;">Type : {{project.designType}}</span> 
										<span style="font-weight:bold; margin-right:10px;">Versions : {{project.versions.length}}</span>
										{{ project.description }}
									</td>

								</tr>


							</table>

						</div>

					</mat-tab>


					<mat-tab id="projectDataTab" label="Project Data" flex="100%">

						<div flex="100%" 
							 layout="column" 
							 style="width:100%"
							 *ngIf="projectDataFlag">

							<h2 class="mt-32 mb-20">
								Project Data -					 
									<mat-icon style="cursor:pointer" 
											  matTooltip="Open in design studio"
											  [routerLink]="['/designStudio/project/'+currentProject.uid]">
										color_lens
									</mat-icon>

							</h2>
					  

							<!-- TOP ROW OF PROJECT DATA -->
							<div fxLayout="row" fxLayoutAlign="center" flex="100%">

								<div fxFlex="50%"fxLayout="column" class="text-center">
									<mat-form-field appearance="outline" floatLabel="always" class="w-100-p">
										<mat-label>Project Name</mat-label>
										<input matInput
											   id="projectName"
											   class="form-control" 
											   placeholder="Product Name"
											   name="projectNameForm"
											   #projectNameForm="ngModel"
											   [(ngModel)]="currentProject['name']"
											   (blur)="saveProject()"
											   minlength="5"
											   maxlength="150"
											   required>
									</mat-form-field>

									<div [hidden]="projectNameForm.valid || projectNameForm.pristine || !projectNameForm.errors?.minlength"
										 class="alert alert-danger">
										Project name is required with at least 5 characters
									</div>
											

									<mat-form-field style="min-height:190px" appearance="outline" floatLabel="always" class="w-100-p">
										<mat-label>Project Description</mat-label>
										<textarea style="min-height:190px"
												  matInput 
												  id="projectDescription"
												  placeholder="Product Description"
												  name="description"
												  #projectDescription="ngModel"
												  [(ngModel)]="currentProject['description']"
												  (blur)="saveProject()"
												  rows="5"
												  required
												  minlength="25">
										</textarea>
									</mat-form-field>

									<div [hidden]="projectDescription.valid || projectDescription.pristine || !projectDescription.errors?.minlength"
										 class="alert alert-danger">
										Project description is required with at least 25 characters
									</div>


								</div>


								<div fxFlex="50" fxLayout="column" fxLayoutAlign="center center">

									<div fxFlex="80" style="margin:0px 10%">
										<img [src]="(designImageUrl | async)">
									</div>


									<div fxLayout="row" 
										 fxLayoutAlign="center" 
										 class="w-80-p">
										<button mat-raised-button 
												color="primary"
												*ngIf="changesExist"
												(click)="saveProject(); changesExist=false;"
												style="margin:10px 25%; width:50%">
											Save Project Changes
										</button>
									</div>
								
								</div>

							</div>

						</div>
						<!-- / TOP ROW OF PROJECT DATA -->
					  	
					</mat-tab>









					<mat-tab id="versionDataTab" label="Version Data">


						<div layout="column" 
							 flex="100%" 
							 style="width:100%"
							 *ngIf="currentProject !== undefined">

							<h2 class="mt-32 mb-20">Version Data</h2>



							<!-- Row showing button to create default version -->
							<div fxLayout="row" 
								 fxLayoutAlign="center center" 
								 flex="100%">

								<div fxFlex="20" style="margin:20px 5%">
									<button mat-stroked-button 
											color="accent"
											(click)="createNewVersion('default')">
										New version (default)
									</button>
								</div>

							</div>


							<!-- Row showing the version list -->
							<div fxLayout="row" fxLayoutAlign="center" flex="100%">

								<table class="displayTable"
									   fxFlex="60" style="margin:0px 5%">
									<thead>
										<tr>
											<th>VERSION NUMBER AND NAME</th>
											<th></th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let version of versionList; index as j"
											class="projectRow"
										    [ngClass]="{'currentItem' : version==currentVersion}"
											(click)="onVersionSelected( j )">
											<td>{{j+1}} - {{version.name}}</td>
											<td>
												<mat-icon style="cursor:pointer" 
														  matTooltip="View Quotes for this version"
														  [routerLink]="['/invoice/'+version['uid']]">
													attach_money
												</mat-icon>
												<mat-icon style="cursor:pointer" 
														  matTooltip="Make copy as latest version"
														  (click)="createNewVersion( j )">
													add_circle
												</mat-icon>
											</td>
										</tr>
									</tbody>
								</table>



							</div>


							<div fxLayout="row" 
								 fxLayoutAlign="center" 
								 flex="100%"
								 *ngIf="versionDataFlag">

								<!-- VERSIONS DATA -->
								<div fxLayout="column" 
									 class="mt-32"
									 flex="45%"
									 style="width:40%; margin:0px 5%">

									<h3>Data</h3>

									<div fxLayout="row"
										 class="mt-20 mb-32">
										<div fxFlex="50">
											Estimated price - {{currentVersion.price}}
										</div>
										<div fxFlex="50">
											Date Created - {{currentVersion.dateCreated | date:'short'}}
										</div>
									</div>


									<mat-form-field appearance="outline" 
													floatLabel="always" 
													class="w-100-p">
										<mat-label>Version Name</mat-label>
										<input matInput 
											   class="form-control"
											   placeholder="Version Name"
											   name="vName"
											   #versionName="ngModel"
											   (blur)="versionChangesExist=true"
											   [(ngModel)]="currentVersion.name"
											   required
											   minlength="5"
											   maxlength="150">
									</mat-form-field>

									<div [hidden]="versionName.valid || versionName.pristine || !versionName.errors?.minlength"
										 class="alert alert-danger">
										Version name is required with at least 5 characters
									</div>


									<mat-form-field appearance="outline" 
													floatLabel="always" 
													class="w-100-p">
										<mat-label>Version Description</mat-label>
										<textarea matInput 
												  placeholder="Version Description"
												  class="form-control"
												  name="versionDescription"
												  #versionDescription="ngModel"
												  (blur)="versionChangesExist=true"
												  [(ngModel)]="currentVersion.description"
												  rows="5"
												  required>
										</textarea>
									</mat-form-field>

									<div [hidden]="versionDescription.valid || versionDescription.pristine || !versionDescription.errors?.minlength"
										 class="alert alert-danger">
										Version description is required with at least 25 characters
									</div>

								</div>
								<!--/  VERSION DATA -->



								<!-- MEASUREMENT LIST -->
								<div fxLayout="column" 
									 class="mt-32"
									 flex="45%"
									 style="width:40%; margin:0px 5%">

									<div fxLayout="row" fxLayoutAlign="center" flex="100%">
										<button mat-raised-button 
												color="primary"
												*ngIf="versionChangesExist"
												(click)="saveVersion(); versionChangesExist=false;"
												style="margin:10px 15%; width:70%">
											Save Version
										</button>
									</div>

									 <h3>Measurements</h3>

									<table mat-table [dataSource]="currentVersion.measurements" 
										   class="mat-elevation-z8"
										   style="box-shadow:none;">

									  <ng-container matColumnDef="name">
										<th mat-header-cell *matHeaderCellDef> Name </th>
										<td mat-cell *matCellDef="let meas"> {{meas.name}} </td>
									  </ng-container>

									  <ng-container matColumnDef="value">
										<th mat-header-cell *matHeaderCellDef> Value </th>
										<td mat-cell *matCellDef="let meas"> {{meas.value}} </td>
									  </ng-container>

									  <tr mat-header-row *matHeaderRowDef="columnsToDisplayMeas"></tr>
									  <tr mat-row *matRowDef="let row; columns: columnsToDisplayMeas;"></tr>
									</table>

								</div>
								<!--/  MEASUREMENT LIST -->

							</div>

						</div>
					
					</mat-tab>







					<mat-tab id="designAndPurchaseTab" label="Design and Purchase Status">  


						<div flex="100%" 
							 layout="column"
							 style="width:100%"
							 *ngIf="currentProject !== undefined">


							<h2 class="mt-32 mb-20">Design and Purchase Status</h2>


							<div fxLayout="row"
								 fxLayoutAlign="center center">
								<div *ngFor="let stage of projectStages; index as j;"
									 fxLayoutAlign="center center"
									 [class]="projectStatus[j] ? 'arrow_box_green' : 'arrow_box_red' "
									 [ngStyle]="{'z-index':1000-j}" 
									 (click)="setSelected( j )">
									<span>{{stage}}</span>
								</div>
							</div>

							<div fxLayout="row"
								 fxLayoutAlign="center center">
								<div *ngFor="let stage of projectStages; index as j;"
									 fxLayoutAlign="center center">

									<div [class]="projectStatus[j] ? 'green_right' : '' "
										 *ngIf="selectedStatus[j]"></div>

									<div [class]="!projectStatus[j] ? 'red_right' : '' "
										 *ngIf="selectedStatus[j]"></div>

									<div *ngIf="!selectedStatus[j]"
										 class="filler"></div>

									<div class="filler"></div>

								</div>

							</div>



							<div fxLayout="row"
								 fxLayoutAlign="center center">
								
								<div *ngFor="let text of stageTexts; index as j;"
									 fxLayoutAlign="center center">

									<div fxFlex="50"
										 *ngIf="selectedStatus[j] && projectStatus[j]">{{text.done}}</div>

									<div fxFlex="50"
										 *ngIf="selectedStatus[j] && !projectStatus[j]">{{text.notdone}}</div>

								</div>

							</div>


						</div>

					</mat-tab>
					  





				</mat-tab-group>


			</div>
			<!-- / CONTENT -->

		</div>
		<!-- / CENTER -->

	</div>
	<!-- / CONTENT -->

</div>
