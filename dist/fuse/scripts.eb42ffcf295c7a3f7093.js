!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THREE={})}(this,(function(e){function t(){}function n(e,t){this.x=e||0,this.y=t||0}function r(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function o(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}function a(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}function i(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function s(e,t,r,o,a,l,u,c,d,p){Object.defineProperty(this,"id",{value:Jo++}),this.uuid=Xo.generateUUID(),this.name="",this.image=void 0!==e?e:s.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:s.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:1001,this.wrapT=void 0!==o?o:1001,this.magFilter=void 0!==a?a:1006,this.minFilter=void 0!==l?l:1008,this.anisotropy=void 0!==d?d:1,this.format=void 0!==u?u:1023,this.type=void 0!==c?c:1009,this.offset=new n(0,0),this.repeat=new n(1,1),this.center=new n(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new i,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==p?p:3e3,this.version=0,this.onUpdate=null}function l(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function u(e,t,n){this.width=e,this.height=t,this.scissor=new l(0,0,e,t),this.scissorTest=!1,this.viewport=new l(0,0,e,t),void 0===(n=n||{}).minFilter&&(n.minFilter=1006),this.texture=new s(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.generateMipmaps=void 0===n.generateMipmaps||n.generateMipmaps,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function c(e,t,n){u.call(this,e,t,n),this.activeMipMapLevel=this.activeCubeFace=0}function d(e,t,n,r,o,a,i,l,u,c,d,p){s.call(this,null,a,i,l,u,c,r,o,d,p),this.image={data:e,width:t,height:n},this.magFilter=void 0!==u?u:1003,this.minFilter=void 0!==c?c:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1}function p(e,t){this.min=void 0!==e?e:new a(1/0,1/0,1/0),this.max=void 0!==t?t:new a(-1/0,-1/0,-1/0)}function h(e,t){this.center=void 0!==e?e:new a,this.radius=void 0!==t?t:0}function m(e,t){this.normal=void 0!==e?e:new a(1,0,0),this.constant=void 0!==t?t:0}function f(e,t,n,r,o,a){this.planes=[void 0!==e?e:new m,void 0!==t?t:new m,void 0!==n?n:new m,void 0!==r?r:new m,void 0!==o?o:new m,void 0!==a?a:new m]}function g(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function $(){function e(o,a){!1!==n&&(r(o,a),t.requestAnimationFrame(e))}var t=null,n=!1,r=null;return{start:function(){!0!==n&&null!==r&&(t.requestAnimationFrame(e),n=!0)},stop:function(){n=!1},setAnimationLoop:function(e){r=e},setContext:function(e){t=e}}}function v(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){n.isInterleavedBufferAttribute&&(n=n.data);var o=t.get(n);if(void 0===o)t.set(n,function(t,n){var r=t.array,o=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,a=e.createBuffer();return e.bindBuffer(n,a),e.bufferData(n,r,o),t.onUploadCallback(),n=e.FLOAT,r instanceof Float32Array?n=e.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?n=e.UNSIGNED_SHORT:r instanceof Int16Array?n=e.SHORT:r instanceof Uint32Array?n=e.UNSIGNED_INT:r instanceof Int32Array?n=e.INT:r instanceof Int8Array?n=e.BYTE:r instanceof Uint8Array&&(n=e.UNSIGNED_BYTE),{buffer:a,type:n,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(n,r));else if(o.version<n.version){var a=n,i=a.array,s=a.updateRange;e.bindBuffer(r,o.buffer),!1===a.dynamic?e.bufferData(r,i,e.STATIC_DRAW):-1===s.count?e.bufferSubData(r,0,i):0===s.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,s.offset*i.BYTES_PER_ELEMENT,i.subarray(s.offset,s.offset+s.count)),s.count=-1),o.version=n.version}}}}function y(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||y.DefaultOrder}function _(){this.mask=1}function b(){Object.defineProperty(this,"id",{value:ra++}),this.uuid=Xo.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=b.DefaultUp.clone();var e=new a,t=new y,n=new o,s=new a(1,1,1);t.onChange((function(){n.setFromEuler(t,!1)})),n.onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:s},modelViewMatrix:{value:new r},normalMatrix:{value:new i}}),this.matrix=new r,this.matrixWorld=new r,this.matrixAutoUpdate=b.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new _,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function x(){b.call(this),this.type="Camera",this.matrixWorldInverse=new r,this.projectionMatrix=new r}function w(e,t,n,r,o,a){x.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==o?o:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function S(e,t,n,r,o,i){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new a,this.vertexNormals=Array.isArray(r)?r:[],this.color=o&&o.isColor?o:new g,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=void 0!==i?i:0}function M(){Object.defineProperty(this,"id",{value:oa+=2}),this.uuid=Xo.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function E(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function T(e,t,n){E.call(this,new Int8Array(e),t,n)}function C(e,t,n){E.call(this,new Uint8Array(e),t,n)}function P(e,t,n){E.call(this,new Uint8ClampedArray(e),t,n)}function A(e,t,n){E.call(this,new Int16Array(e),t,n)}function L(e,t,n){E.call(this,new Uint16Array(e),t,n)}function R(e,t,n){E.call(this,new Int32Array(e),t,n)}function D(e,t,n){E.call(this,new Uint32Array(e),t,n)}function I(e,t,n){E.call(this,new Float32Array(e),t,n)}function O(e,t,n){E.call(this,new Float64Array(e),t,n)}function N(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function U(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}function k(){Object.defineProperty(this,"id",{value:aa+=2}),this.uuid=Xo.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function H(e,t,n,r,o,a){M.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:o,depthSegments:a},this.fromBufferGeometry(new G(e,t,n,r,o,a)),this.mergeVertices()}function G(e,t,n,r,o,i){function s(e,t,n,r,o,i,s,f,g,$,v){var y=i/g,_=s/$,b=i/2,x=s/2,w=f/2;s=g+1;var S,M,E=$+1,T=i=0,C=new a;for(M=0;M<E;M++){var P=M*_-x;for(S=0;S<s;S++)C[e]=(S*y-b)*r,C[t]=P*o,C[n]=w,c.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=0<f?1:-1,d.push(C.x,C.y,C.z),p.push(S/g),p.push(1-M/$),i+=1}for(M=0;M<$;M++)for(S=0;S<g;S++)t=h+(S+1)+s*(M+1),u.push(h+S+s*M,e=h+S+s*(M+1),n=h+(S+1)+s*M),u.push(e,t,n),T+=6;l.addGroup(m,T,v),m+=T,h+=i}k.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:o,depthSegments:i};var l=this;e=e||1,t=t||1,n=n||1,r=Math.floor(r)||1,o=Math.floor(o)||1,i=Math.floor(i)||1;var u=[],c=[],d=[],p=[],h=0,m=0;s("z","y","x",-1,-1,n,t,e,i,o,0),s("z","y","x",1,-1,n,t,-e,i,o,1),s("x","z","y",1,1,e,n,t,r,i,2),s("x","z","y",1,-1,e,n,-t,r,i,3),s("x","y","z",1,-1,e,t,n,r,o,4),s("x","y","z",-1,-1,e,t,-n,r,o,5),this.setIndex(u),this.addAttribute("position",new I(c,3)),this.addAttribute("normal",new I(d,3)),this.addAttribute("uv",new I(p,2))}function V(e,t,n,r){M.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new j(e,t,n,r)),this.mergeVertices()}function j(e,t,n,r){k.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var o=(e=e||1)/2,a=(t=t||1)/2,i=(n=Math.floor(n)||1)+1,s=(r=Math.floor(r)||1)+1,l=e/n,u=t/r,c=[],d=[],p=[],h=[];for(e=0;e<s;e++){var m=e*u-a;for(t=0;t<i;t++)d.push(t*l-o,-m,0),p.push(0,0,1),h.push(t/n),h.push(1-e/r)}for(e=0;e<r;e++)for(t=0;t<n;t++)a=t+1+i*(e+1),c.push(t+i*e,o=t+i*(e+1),s=t+1+i*e),c.push(o,a,s);this.setIndex(c),this.addAttribute("position",new I(d,3)),this.addAttribute("normal",new I(p,3)),this.addAttribute("uv",new I(h,2))}function F(){Object.defineProperty(this,"id",{value:ia++}),this.uuid=Xo.generateUUID(),this.name="",this.type="Material",this.lights=this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0,this.attributes=null}function z(e){F.call(this),this.type="MeshBasicMaterial",this.color=new g(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.lights=this.morphTargets=this.skinning=!1,this.setValues(e)}function B(e){F.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.attributes=null,void 0!==e&&this.setValues(e)}function W(e,t){this.origin=void 0!==e?e:new a,this.direction=void 0!==t?t:new a}function Y(e,t,n){this.a=void 0!==e?e:new a,this.b=void 0!==t?t:new a,this.c=void 0!==n?n:new a}function q(e,t){b.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new k,this.material=void 0!==t?t:new z({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function X(e,t,n,r){function o(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}var a,i,s,l=new g(0),u=0;return{getClearColor:function(){return l},setClearColor:function(e,t){l.set(e),o(l,u=void 0!==t?t:1)},getClearAlpha:function(){return u},setClearAlpha:function(e){o(l,u=e)},render:function(t,r,c,d){null===(r=r.background)?o(l,u):r&&r.isColor&&(o(r,1),d=!0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),r&&r.isCubeTexture?(void 0===s&&((s=new q(new G(1,1,1),new B({uniforms:na.cube.uniforms,vertexShader:na.cube.vertexShader,fragmentShader:na.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},n.update(s)),s.material.uniforms.tCube.value=r,t.push(s,s.geometry,s.material,0,null)):r&&r.isTexture&&(void 0===a&&(a=new w(-1,1,1,-1,0,1),i=new q(new j(2,2),new z({depthTest:!1,depthWrite:!1,fog:!1})),n.update(i)),i.material.map=r,e.renderBufferDirect(a,null,i.geometry,i.material,i,null))}}}function Z(e,t,n,r){var o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o)},this.renderInstances=function(a,i,s){if(r.isWebGL2)var l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[r.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](o,i,s,a.maxInstancedCount),n.update(s,o,a.maxInstancedCount)}}function J(e,t,n){function r(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}var o,a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,i=void 0!==n.precision?n.precision:"highp",s=r(i);s!==i&&(console.warn("THREE.WebGLRenderer:",i,"not supported, using",s,"instead."),i=s),n=!0===n.logarithmicDepthBuffer,s=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);var l=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_TEXTURE_SIZE),c=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),d=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),h=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),f=0<l,g=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==o)return o;var n=t.get("EXT_texture_filter_anisotropic");return o=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:i,logarithmicDepthBuffer:n,maxTextures:s,maxVertexTextures:l,maxTextureSize:u,maxCubemapSize:c,maxAttributes:d,maxVertexUniforms:p,maxVaryings:h,maxFragmentUniforms:m,vertexTextures:f,floatFragmentTextures:g,floatVertexTextures:f&&g}}function K(){function e(){c.value!==r&&(c.value=r,c.needsUpdate=0<o),n.numPlanes=o,n.numIntersection=0}function t(e,t,r,o){var a=null!==e?e.length:0,i=null;if(0!==a){if(i=c.value,!0!==o||null===i)for(o=r+4*a,u.getNormalMatrix(t=t.matrixWorldInverse),(null===i||i.length<o)&&(i=new Float32Array(o)),o=0;o!==a;++o,r+=4)l.copy(e[o]).applyMatrix4(t,u),l.normal.toArray(i,r),i[r+3]=l.constant;c.value=i,c.needsUpdate=!0}return n.numPlanes=a,i}var n=this,r=null,o=0,a=!1,s=!1,l=new m,u=new i,c={value:null,needsUpdate:!1};this.uniform=c,this.numIntersection=this.numPlanes=0,this.init=function(e,n,i){var s=0!==e.length||n||0!==o||a;return a=n,r=t(e,i,0),o=e.length,s},this.beginShadows=function(){s=!0,t(null)},this.endShadows=function(){s=!1,e()},this.setState=function(n,i,l,u,d,p){if(!a||null===n||0===n.length||s&&!l)s?t(null):e();else{var h=4*(l=s?0:o),m=d.clippingState||null;for(c.value=m,m=t(n,u,h,p),n=0;n!==h;++n)m[n]=r[n];d.clippingState=m,this.numIntersection=i?this.numPlanes:0,this.numPlanes+=l}}}function Q(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];switch(n){case"WEBGL_depth_texture":var r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r}}}function ee(e,t,n){function r(e){var i=e.target;for(var s in null!==(e=o[i.id]).index&&t.remove(e.index),e.attributes)t.remove(e.attributes[s]);i.removeEventListener("dispose",r),delete o[i.id],(s=a[e.id])&&(t.remove(s),delete a[e.id]),n.memory.geometries--}var o={},a={};return{get:function(e,t){var a=o[t.id];return a||(t.addEventListener("dispose",r),t.isBufferGeometry?a=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new k).setFromObject(e)),a=t._bufferGeometry),o[t.id]=a,n.memory.geometries++,a)},update:function(n){var r=n.index,o=n.attributes;for(var a in null!==r&&t.update(r,e.ELEMENT_ARRAY_BUFFER),o)t.update(o[a],e.ARRAY_BUFFER);for(a in n=n.morphAttributes){o=0;for(var i=(r=n[a]).length;o<i;o++)t.update(r[o],e.ARRAY_BUFFER)}},getWireframeAttribute:function(n){var r=a[n.id];if(r)return r;r=[];var o=n.index,i=n.attributes;if(null!==o){i=0;for(var s=(o=o.array).length;i<s;i+=3){var l=o[i+0],u=o[i+1],c=o[i+2];r.push(l,u,u,c,c,l)}}else for(o=i.position.array,i=0,s=o.length/3-1;i<s;i+=3)r.push(l=i+0,u=i+1,u,c=i+2,c,l);return r=new(65535<U(r)?D:L)(r,1),t.update(r,e.ELEMENT_ARRAY_BUFFER),a[n.id]=r}}}function te(e,t,n,r){var o,a,i;this.setMode=function(e){o=e},this.setIndex=function(e){a=e.type,i=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,a,t*i),n.update(r,o)},this.renderInstances=function(s,l,u){if(r.isWebGL2)var c=e;else if(null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[r.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](o,u,a,l*i,s.maxInstancedCount),n.update(u,o,s.maxInstancedCount)}}function ne(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,o){switch(o=o||1,t.calls++,r){case e.TRIANGLES:t.triangles+=n/3*o;break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=o*(n-2);break;case e.LINES:t.lines+=n/2*o;break;case e.LINE_STRIP:t.lines+=o*(n-1);break;case e.LINE_LOOP:t.lines+=o*n;break;case e.POINTS:t.points+=o*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function re(e,t){return Math.abs(t[1])-Math.abs(e[1])}function oe(e){var t={},n=new Float32Array(8);return{update:function(r,o,a,i){var s=r.morphTargetInfluences,l=s.length;if(void 0===(r=t[o.id])){r=[];for(var u=0;u<l;u++)r[u]=[u,0];t[o.id]=r}var c=a.morphTargets&&o.morphAttributes.position;for(a=a.morphNormals&&o.morphAttributes.normal,u=0;u<l;u++){var d=r[u];0!==d[1]&&(c&&o.removeAttribute("morphTarget"+u),a&&o.removeAttribute("morphNormal"+u))}for(u=0;u<l;u++)(d=r[u])[0]=u,d[1]=s[u];for(r.sort(re),u=0;8>u;u++)(d=r[u])&&(s=d[0],l=d[1])?(c&&o.addAttribute("morphTarget"+u,c[s]),a&&o.addAttribute("morphNormal"+u,a[s]),n[u]=l):n[u]=0;i.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function ae(e,t){var n={};return{update:function(r){var o=t.render.frame,a=r.geometry,i=e.get(r,a);return n[i.id]!==o&&(a.isGeometry&&i.updateFromObject(r),e.update(i),n[i.id]=o),i},dispose:function(){n={}}}}function ie(e,t,n,r,o,a,i,l,u,c){s.call(this,e=void 0!==e?e:[],void 0!==t?t:301,n,r,o,a,i,l,u,c),this.flipY=!1}function se(e,t,n){var r=e[0];if(0>=r||0<r)return e;var o=t*n,a=ma[o];if(void 0===a&&(a=new Float32Array(o),ma[o]=a),0!==t)for(r.toArray(a,0),r=1,o=0;r!==t;++r)e[r].toArray(a,o+=n);return a}function le(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function ue(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function ce(e,t){var n=fa[t];void 0===n&&(n=new Int32Array(t),fa[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocTextureUnit();return n}function de(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function pe(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function he(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y):le(n,t)||(e.uniform2fv(this.addr,t),ue(n,t))}function me(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z):void 0!==t.r?n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b):le(n,t)||(e.uniform3fv(this.addr,t),ue(n,t))}function fe(e,t){var n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w):le(n,t)||(e.uniform4fv(this.addr,t),ue(n,t))}function ge(e,t){var n=this.cache,r=t.elements;void 0===r?le(n,t)||(e.uniformMatrix2fv(this.addr,!1,t),ue(n,t)):le(n,r)||(va.set(r),e.uniformMatrix2fv(this.addr,!1,va),ue(n,r))}function $e(e,t){var n=this.cache,r=t.elements;void 0===r?le(n,t)||(e.uniformMatrix3fv(this.addr,!1,t),ue(n,t)):le(n,r)||($a.set(r),e.uniformMatrix3fv(this.addr,!1,$a),ue(n,r))}function ve(e,t){var n=this.cache,r=t.elements;void 0===r?le(n,t)||(e.uniformMatrix4fv(this.addr,!1,t),ue(n,t)):le(n,r)||(ga.set(r),e.uniformMatrix4fv(this.addr,!1,ga),ue(n,r))}function ye(e,t,n){var r=this.cache,o=n.allocTextureUnit();r[0]!==o&&(e.uniform1i(this.addr,o),r[0]=o),n.setTexture2D(t||pa,o)}function _e(e,t,n){var r=this.cache,o=n.allocTextureUnit();r[0]!==o&&(e.uniform1i(this.addr,o),r[0]=o),n.setTextureCube(t||ha,o)}function be(e,t){var n=this.cache;le(n,t)||(e.uniform2iv(this.addr,t),ue(n,t))}function xe(e,t){var n=this.cache;le(n,t)||(e.uniform3iv(this.addr,t),ue(n,t))}function we(e,t){var n=this.cache;le(n,t)||(e.uniform4iv(this.addr,t),ue(n,t))}function Se(e,t){var n=this.cache;le(n,t)||(e.uniform1fv(this.addr,t),ue(n,t))}function Me(e,t){var n=this.cache;le(n,t)||(e.uniform1iv(this.addr,t),ue(n,t))}function Ee(e,t){le(this.cache,t=se(t,this.size,2))||(e.uniform2fv(this.addr,t),this.updateCache(t))}function Te(e,t){le(this.cache,t=se(t,this.size,3))||(e.uniform3fv(this.addr,t),this.updateCache(t))}function Ce(e,t){le(this.cache,t=se(t,this.size,4))||(e.uniform4fv(this.addr,t),this.updateCache(t))}function Pe(e,t){le(this.cache,t=se(t,this.size,4))||(e.uniformMatrix2fv(this.addr,!1,t),this.updateCache(t))}function Ae(e,t){le(this.cache,t=se(t,this.size,9))||(e.uniformMatrix3fv(this.addr,!1,t),this.updateCache(t))}function Le(e,t){le(this.cache,t=se(t,this.size,16))||(e.uniformMatrix4fv(this.addr,!1,t),this.updateCache(t))}function Re(e,t,n){var r=this.cache,o=t.length,a=ce(n,o);for(!1===le(r,a)&&(e.uniform1iv(this.addr,a),ue(r,a)),e=0;e!==o;++e)n.setTexture2D(t[e]||pa,a[e])}function De(e,t,n){var r=this.cache,o=t.length,a=ce(n,o);for(!1===le(r,a)&&(e.uniform1iv(this.addr,a),ue(r,a)),e=0;e!==o;++e)n.setTextureCube(t[e]||ha,a[e])}function Ie(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return de;case 35664:return he;case 35665:return me;case 35666:return fe;case 35674:return ge;case 35675:return $e;case 35676:return ve;case 35678:case 36198:return ye;case 35680:return _e;case 5124:case 35670:return pe;case 35667:case 35671:return be;case 35668:case 35672:return xe;case 35669:case 35673:return we}}(t.type)}function Oe(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Se;case 35664:return Ee;case 35665:return Te;case 35666:return Ce;case 35674:return Pe;case 35675:return Ae;case 35676:return Le;case 35678:return Re;case 35680:return De;case 5124:case 35670:return Me;case 35667:case 35671:return be;case 35668:case 35672:return xe;case 35669:case 35673:return we}}(t.type)}function Ne(e){this.id=e,this.seq=[],this.map={}}function Ue(e,t,n,r){for(this.seq=[],this.map={},this.renderer=n,n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<n;++r){var o=e.getActiveUniform(t,r),a=e.getUniformLocation(t,o.name),i=this,s=o.name,l=s.length;for(ya.lastIndex=0;;){var u=ya.exec(s),c=u[1],d=u[3];if("]"===u[2]&&(c|=0),void 0===d||"["===d&&ya.lastIndex+2===l){s=i,o=void 0===d?new Ie(c,o,a):new Oe(c,o,a),s.seq.push(o),s.map[o.id]=o;break}void 0===(d=i.map[c])&&(d=new Ne(c),(c=i).seq.push(i=d),c.map[i.id]=i),i=d}}}function ke(e,t,n){var r=ca.Settings.resolve(),o=e.createShader(t);return e.shaderSource(o,n),e.compileShader(o),r.debug()&&_a.logShaderCompilationInformation(e,o,t,n),o}function He(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+e)}}function Ge(e,t){return"vec4 "+e+"( vec4 value ) { return "+(t=He(t))[0]+"ToLinear"+t[1]+"; }"}function Ve(e,t){return"vec4 "+e+"( vec4 value ) { return LinearTo"+(t=He(t))[0]+t[1]+"; }"}function je(e,t){switch(t){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="Uncharted2";break;case 4:t="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Fe(e){return""!==e}function ze(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Be(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function We(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){if(void 0===(e=Ko[t]))throw Error("Can not resolve #include <"+t+">");return We(e)}))}function Ye(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,(function(e,t,n,r){for(e="",t=parseInt(t);t<parseInt(n);t++)e+=r.replace(/\[ i \]/g,"[ "+t+" ]");return e}))}function qe(e,t,n,r,o,a,i){var s=ca.Settings.resolve(),l=e.context,u=r.defines,c=o.vertexShader,d=o.fragmentShader,p="SHADOWMAP_TYPE_BASIC";1===a.shadowMapType?p="SHADOWMAP_TYPE_PCF":2===a.shadowMapType&&(p="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(r.envMap.mapping){case 301:case 302:h="ENVMAP_TYPE_CUBE";break;case 306:case 307:h="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:h="ENVMAP_TYPE_EQUIREC";break;case 305:h="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case 302:case 304:m="ENVMAP_MODE_REFRACTION"}switch(r.combine){case 0:f="ENVMAP_BLENDING_MULTIPLY";break;case 1:f="ENVMAP_BLENDING_MIX";break;case 2:f="ENVMAP_BLENDING_ADD"}}var g,$,v=0<e.gammaFactor?e.gammaFactor:1,y=i.isWebGL2?"":function(e,t,n){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fe).join("\n")}(r.extensions,a,t),_=function(e){var t,n=[];for(t in e){var r=e[t];!1!==r&&n.push("#define "+t+" "+r)}return n.join("\n")}(u),b=l.createProgram();return r.isRawShaderMaterial?(0<(u=[_].filter(Fe).join("\n")).length&&(u+="\n"),0<(t=[y,_].filter(Fe).join("\n")).length&&(t+="\n")):(u=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+o.name,_,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(i.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Fe).join("\n"),t=[y,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+o.name,_,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+h:"",a.envMap?"#define "+m:"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(i.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(i.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?Ko.tonemapping_pars_fragment:"",0!==a.toneMapping?je("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Ko.encodings_pars_fragment:"",a.mapEncoding?Ge("mapTexelToLinear",a.mapEncoding):"",a.envMapEncoding?Ge("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Ge("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?Ve("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Fe).join("\n")),c=Be(c=ze(c=We(c),a),a),d=Be(d=ze(d=We(d),a),a),c=Ye(c),d=Ye(d),i.isWebGL2&&!r.isRawShaderMaterial&&(i=!1,p=/^\s*#version\s+300\s+es\s*\n/,r.isShaderMaterial&&null!==c.match(p)&&null!==d.match(p)&&(i=!0,c=c.replace(p,""),d=d.replace(p,"")),u="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+u,t=["#version 300 es\n\n#define varying in",i?"":"out highp vec4 pc_fragColor;",i?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+t),d=t+d,c=ke(l,l.VERTEX_SHADER,u+c),d=ke(l,l.FRAGMENT_SHADER,d),l.attachShader(b,c),l.attachShader(b,d),void 0!==r.index0AttributeName?l.bindAttribLocation(b,0,r.index0AttributeName):!0===a.morphTargets&&l.bindAttribLocation(b,0,"position"),l.linkProgram(b),s.debug()&&(a=da.getWebGLProgramDiagnostics(l,b,c,d,u,t,r))&&(this.diagnostics=a),l.deleteShader(c),l.deleteShader(d),this.getUniforms=function(){return void 0===g&&(g=new Ue(l,b,e,r)),g},this.getAttributes=function(){return void 0===$&&($=function(e,t,n){var r={},o=!1;if(n.attributes&&0<n.attributes.length?n.attributes.forEach((function(a){r[a]=e.getAttribLocation(t,a),-1===r[a]&&(xa.warn("Attribute "+a+" not defined in material shader. Material: "+n.type+". Check shader attributes or material.attributes definition."),o=!0)})):o=!0,o){r={};for(var a=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<a;i++){var s=e.getActiveAttrib(t,i).name;xa.warn("Fallback to getProgramParameter webgl method. Try to avoid it by settings attributes to material or attributes to ShaderMaterial constructor parameters. Material: "+n.type+" Attribute: "+s),r[s]=e.getAttribLocation(t,s)}}return r}(l,b,r)),$},this.destroy=function(){l.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=o.name,this.id=ba++,this.code=n,this.usedTimes=1,this.program=b,this.vertexShader=c,this.fragmentShader=d,this}function Xe(e,t,n){function r(e,t){if(e)e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding);else var n=3e3;return 3e3===n&&t&&(n=3007),n}var o=[],a={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},i="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering".split(" ");this.getParameters=function(t,o,i,s,l,u,c){var d=a[t.type];if(c.isSkinnedMesh){var p=c.skeleton.bones;if(n.floatVertexTextures)p=1024;else{var h=Math.min(Math.floor((n.maxVertexUniforms-20)/4),p.length);h<p.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+p.length+" bones. This GPU supports "+h+"."),p=0):p=h}}else p=0;h=n.precision,null!==t.precision&&(h=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",h,"instead.");var m=e.getRenderTarget();return{shaderID:d,precision:h,supportsVertexTextures:n.vertexTextures,outputEncoding:r(m?m.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:r(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:r(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(306===t.envMap.mapping||307===t.envMap.mapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:r(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:n.logarithmicDepthBuffer,skinning:t.skinning&&0<p,maxBones:p,useVertexTexture:n.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numClippingPlanes:l,numClipIntersection:u,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&0<i.length,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,n){var r=[];if(n.shaderID?r.push(n.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var o in t.defines)r.push(o),r.push(t.defines[o]);for(o=0;o<i.length;o++)r.push(n[i[o]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.join()},this.acquireProgram=function(r,a,i,s){for(var l,u=0,c=o.length;u<c;u++){var d=o[u];if(d.code===s){++(l=d).usedTimes;break}}return void 0===l&&(l=new qe(e,t,s,r,a,i,n),o.push(l)),l},this.releaseProgram=function(e){if(!(o.length<ca.Settings.resolve().allowedCachedPrograms())&&0==--e.usedTimes){var t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},this.disposeCached=function(){for(;0<o.length;)o.pop().destroy()},this.programs=o}function Ze(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&e.set(t,n={}),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Je(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ke(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Qe(){var e=[],t=0,n=[],r=[];return{opaque:n,transparent:r,init:function(){t=0,n.length=0,r.length=0},push:function(o,a,i,s,l){var u=e[t];void 0===u?e[t]=u={id:o.id,object:o,geometry:a,material:i,program:i.program,renderOrder:o.renderOrder,z:s,group:l}:(u.id=o.id,u.object=o,u.geometry=a,u.material=i,u.program=i.program,u.renderOrder=o.renderOrder,u.z=s,u.group=l),(!0===i.transparent?r:n).push(u),t++},sort:function(){1<n.length&&n.sort(Je),1<r.length&&r.sort(Ke)}}}function et(){var e={};return{get:function(t,n){return void 0===(n=e[t=t.id+","+n.id])&&(n=new Qe,e[t]=n),n},dispose:function(){e={}}}}function tt(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":var r={direction:new a,color:new g,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"SpotLight":r={position:new a,direction:new a,color:new g,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case"PointLight":r={position:new a,color:new g,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new a,skyColor:new g,groundColor:new g};break;case"RectAreaLight":r={color:new g,position:new a,halfWidth:new a,halfHeight:new a}}return e[t.id]=r}}}function nt(){var e=new tt,t={id:Sa++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=new a,o=new r,i=new r;return{setup:function(r,a,s){var l=0,u=0,c=0,d=0,p=0,h=0,m=0,f=0;s=s.matrixWorldInverse;for(var g=0,$=r.length;g<$;g++){var v=r[g],y=v.color,_=v.intensity,b=v.distance,x=v.shadow&&v.shadow.map?v.shadow.map.texture:null;if(v.isAmbientLight)l+=y.r*_,u+=y.g*_,c+=y.b*_;else if(v.isDirectionalLight){var w=e.get(v);w.color.copy(v.color).multiplyScalar(v.intensity),w.direction.setFromMatrixPosition(v.matrixWorld),n.setFromMatrixPosition(v.target.matrixWorld),w.direction.sub(n),w.direction.transformDirection(s),(w.shadow=v.castShadow)&&(w.shadowBias=(y=v.shadow).bias,w.shadowRadius=y.radius,w.shadowMapSize=y.mapSize),t.directionalShadowMap[d]=x,t.directionalShadowMatrix[d]=v.shadow.matrix,t.directional[d]=w,d++}else v.isSpotLight?((w=e.get(v)).position.setFromMatrixPosition(v.matrixWorld),w.position.applyMatrix4(s),w.color.copy(y).multiplyScalar(_),w.distance=b,w.direction.setFromMatrixPosition(v.matrixWorld),n.setFromMatrixPosition(v.target.matrixWorld),w.direction.sub(n),w.direction.transformDirection(s),w.coneCos=Math.cos(v.angle),w.penumbraCos=Math.cos(v.angle*(1-v.penumbra)),w.decay=0===v.distance?0:v.decay,(w.shadow=v.castShadow)&&(w.shadowBias=(y=v.shadow).bias,w.shadowRadius=y.radius,w.shadowMapSize=y.mapSize),t.spotShadowMap[h]=x,t.spotShadowMatrix[h]=v.shadow.matrix,t.spot[h]=w,h++):v.isRectAreaLight?((w=e.get(v)).color.copy(y).multiplyScalar(_),w.position.setFromMatrixPosition(v.matrixWorld),w.position.applyMatrix4(s),i.identity(),o.copy(v.matrixWorld),o.premultiply(s),i.extractRotation(o),w.halfWidth.set(.5*v.width,0,0),w.halfHeight.set(0,.5*v.height,0),w.halfWidth.applyMatrix4(i),w.halfHeight.applyMatrix4(i),t.rectArea[m]=w,m++):v.isPointLight?((w=e.get(v)).position.setFromMatrixPosition(v.matrixWorld),w.position.applyMatrix4(s),w.color.copy(v.color).multiplyScalar(v.intensity),w.distance=v.distance,w.decay=0===v.distance?0:v.decay,(w.shadow=v.castShadow)&&(w.shadowBias=(y=v.shadow).bias,w.shadowRadius=y.radius,w.shadowMapSize=y.mapSize,w.shadowCameraNear=y.camera.near,w.shadowCameraFar=y.camera.far),t.pointShadowMap[p]=x,t.pointShadowMatrix[p]=v.shadow.matrix,t.point[p]=w,p++):v.isHemisphereLight&&((w=e.get(v)).direction.setFromMatrixPosition(v.matrixWorld),w.direction.transformDirection(s),w.direction.normalize(),w.skyColor.copy(v.color).multiplyScalar(_),w.groundColor.copy(v.groundColor).multiplyScalar(_),t.hemi[f]=w,f++)}t.ambient[0]=l,t.ambient[1]=u,t.ambient[2]=c,t.directional.length=d,t.spot.length=h,t.rectArea.length=m,t.point.length=p,t.hemi.length=f,t.hash.stateID=t.id,t.hash.directionalLength=d,t.hash.pointLength=p,t.hash.spotLength=h,t.hash.rectAreaLength=m,t.hash.hemiLength=f,t.hash.shadowsLength=a.length},state:t}}function rt(){var e=new nt,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(r){e.setup(t,n,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function ot(){var e={};return{get:function(t,n){if(void 0===e[t.id]){var r=new rt;e[t.id]={},e[t.id][n.id]=r}else void 0===e[t.id][n.id]?(r=new rt,e[t.id][n.id]=r):r=e[t.id][n.id];return r},dispose:function(){e={}}}}function at(e){F.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.setValues(e),this.attributes=["position"]}function it(e){F.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new a,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.lights=this.fog=!1,this.setValues(e)}function st(e,t,o){function i(t,n,r,o,a,i){var s=t.geometry,l=$,u=t.customDepthMaterial;return r&&(l=v,u=t.customDistanceMaterial),u?l=u:(u=!1,n.morphTargets&&(s&&s.isBufferGeometry?u=s.morphAttributes&&s.morphAttributes.position&&0<s.morphAttributes.position.length:s&&s.isGeometry&&(u=s.morphTargets&&0<s.morphTargets.length)),t.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t),s=0,u&&(s|=1),(t=t.isSkinnedMesh&&n.skinning)&&(s|=2),l=l[s]),e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length&&(u=n.uuid,void 0===(t=y[s=l.uuid])&&(y[s]=t={}),void 0===(s=t[u])&&(s=l.clone(),t[u]=s),l=s),l.visible=n.visible,l.wireframe=n.wireframe,l.side=null!=n.shadowSide?n.shadowSide:_[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,r&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(o),l.nearDistance=a,l.farDistance=i),l}function s(n,r,o,a){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow&&(!n.frustumCulled||c.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var d=l.groups,p=0,h=d.length;p<h;p++){var m=d[p],f=u[m.materialIndex];f&&f.visible&&(f=i(n,f,a,g,o.near,o.far),e.renderBufferDirect(o,null,l,f,n,m))}else u.visible&&(f=i(n,u,a,g,o.near,o.far),e.renderBufferDirect(o,null,l,f,n,null))}for(l=0,u=(n=n.children).length;l<u;l++)s(n[l],r,o,a)}}var c=new f,d=new r,p=new n,h=new n(o,o),m=new a,g=new a,$=Array(4),v=Array(4),y={},_={0:1,1:0,2:2},b=[new a(1,0,0),new a(-1,0,0),new a(0,0,1),new a(0,0,-1),new a(0,1,0),new a(0,-1,0)],x=[new a(0,1,0),new a(0,1,0),new a(0,1,0),new a(0,1,0),new a(0,0,1),new a(0,0,-1)],w=[new l,new l,new l,new l,new l,new l];for(o=0;4!==o;++o){var S=0!=(1&o),M=0!=(2&o),E=new at({depthPacking:3201,morphTargets:S,skinning:M});$[o]=E,S=new it({morphTargets:S,skinning:M}),v[o]=S}var T=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,r){if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)&&0!==t.length){var o=e.state;o.disable(e.context.BLEND),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1);for(var a,i=0,l=t.length;i<l;i++){var f=t[i],$=f&&f.isPointLight;if(void 0===(a=f.shadow))console.warn("THREE.WebGLShadowMap:",f,"has no shadow.");else{var v=a.camera;if(p.copy(a.mapSize),p.min(h),$){var y=p.x,_=p.y;w[0].set(2*y,_,y,_),w[1].set(0,_,y,_),w[2].set(3*y,_,y,_),w[3].set(y,_,y,_),w[4].set(3*y,0,y,_),w[5].set(y,0,y,_),p.x*=4,p.y*=2}for(null===a.map&&(a.map=new u(p.x,p.y,{minFilter:1003,magFilter:1003,format:1023}),a.map.texture.name=f.name+".shadowMap",v.updateProjectionMatrix()),a.isSpotLightShadow&&a.update(f),y=a.map,_=a.matrix,g.setFromMatrixPosition(f.matrixWorld),v.position.copy(g),$?(a=6,_.makeTranslation(-g.x,-g.y,-g.z)):(a=1,m.setFromMatrixPosition(f.target.matrixWorld),v.lookAt(m),v.updateMatrixWorld(),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(v.projectionMatrix),_.multiply(v.matrixWorldInverse)),e.setRenderTarget(y),e.clear(),f=0;f<a;f++)$&&(m.copy(v.position),m.add(b[f]),v.up.copy(x[f]),v.lookAt(m),v.updateMatrixWorld(),o.viewport(w[f])),d.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse),c.setFromMatrix(d),s(n,r,v,$)}}T.needsUpdate=!1}}}function lt(e,t,n,r){function o(t,n,r){var o=new Uint8Array(4),a=e.createTexture();for(e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST),t=0;t<r;t++)e.texImage2D(n+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);return a}function a(n,o){v[n]=1,0===y[n]&&(e.enableVertexAttribArray(n),y[n]=1),_[n]!==o&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,o),_[n]=o)}function i(t){!0!==b[t]&&(e.enable(t),b[t]=!0)}function s(t){!1!==b[t]&&(e.disable(t),b[t]=!1)}function u(t,r,o,a,l,u,c,d){if(0!==t?i(e.BLEND):s(e.BLEND),5!==t){if(t!==S||d!==L)switch(t){case 2:d?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE));break;case 3:d?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR));break;case 4:d?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR));break;default:d?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))}A=P=C=T=E=M=null}else l=l||r,u=u||o,c=c||a,r===M&&l===C||(e.blendEquationSeparate(n.convert(r),n.convert(l)),M=r,C=l),o===E&&a===T&&u===P&&c===A||(e.blendFuncSeparate(n.convert(o),n.convert(a),n.convert(u),n.convert(c)),E=o,T=a,P=u,A=c);S=t,L=d}function c(t){R!==t&&(e.frontFace(t?e.CW:e.CCW),R=t)}function d(t){0!==t?(i(e.CULL_FACE),t!==D&&e.cullFace(1===t?e.BACK:2===t?e.FRONT:e.FRONT_AND_BACK)):s(e.CULL_FACE),D=t}function p(t,n,r){t?(i(e.POLYGON_OFFSET_FILL),(O!==n||N!==r)&&(e.polygonOffset(n,r),O=n,N=r)):s(e.POLYGON_OFFSET_FILL)}function h(t){void 0===t&&(t=e.TEXTURE0+U-1),H!==t&&(e.activeTexture(t),H=t)}var m=new function(){var t=!1,n=new l,r=null,o=new l(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,i,s){!0===s&&(t*=i,r*=i,a*=i),n.set(t,r,a,i),!1===o.equals(n)&&(e.clearColor(t,r,a,i),o.copy(n))},reset:function(){t=!1,r=null,o.set(-1,0,0,0)}}},f=new function(){var t=!1,n=null,r=null,o=null;return{setTest:function(t){t?i(e.DEPTH_TEST):s(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){o!==t&&(e.clearDepth(t),o=t)},reset:function(){t=!1,o=r=n=null}}},g=new function(){var t=!1,n=null,r=null,o=null,a=null,l=null,u=null,c=null,d=null;return{setTest:function(t){t?i(e.STENCIL_TEST):s(e.STENCIL_TEST)},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,i){r===t&&o===n&&a===i||(e.stencilFunc(t,n,i),r=t,o=n,a=i)},setOp:function(t,n,r){l===t&&u===n&&c===r||(e.stencilOp(t,n,r),l=t,u=n,c=r)},setLocked:function(e){t=e},setClear:function(t){d!==t&&(e.clearStencil(t),d=t)},reset:function(){t=!1,d=c=u=l=a=o=r=n=null}}},$=e.getParameter(e.MAX_VERTEX_ATTRIBS),v=new Uint8Array($),y=new Uint8Array($),_=new Uint8Array($),b={},x=null,w=null,S=null,M=null,E=null,T=null,C=null,P=null,A=null,L=!1,R=null,D=null,I=null,O=null,N=null,U=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),k=!1;$=0,-1!==($=e.getParameter(e.VERSION)).indexOf("WebGL")?($=parseFloat(/^WebGL ([0-9])/.exec($)[1]),k=1<=$):-1!==$.indexOf("OpenGL ES")&&($=parseFloat(/^OpenGL ES ([0-9])/.exec($)[1]),k=2<=$);var H=null,G={},V=new l,j=new l,F={};return F[e.TEXTURE_2D]=o(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=o(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),m.setClear(0,0,0,1),f.setClear(1),g.setClear(0),i(e.DEPTH_TEST),f.setFunc(3),c(!1),d(1),i(e.CULL_FACE),i(e.BLEND),u(1),{buffers:{color:m,depth:f,stencil:g},initAttributes:function(){for(var e=0,t=v.length;e<t;e++)v[e]=0},enableAttribute:function(e){a(e,0)},enableAttributeAndDivisor:a,disableUnusedAttributes:function(){for(var t=0,n=y.length;t!==n;++t)y[t]!==v[t]&&(e.disableVertexAttribArray(t),y[t]=0)},enable:i,disable:s,getCompressedTextureFormats:function(){if(null===x&&(x=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var n=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<n.length;r++)x.push(n[r]);return x},useProgram:function(t){return w!==t&&(e.useProgram(t),w=t,!0)},setBlending:u,setMaterial:function(t,n){2===t.side?s(e.CULL_FACE):i(e.CULL_FACE);var r=1===t.side;n&&(r=!r),c(r),1===t.blending&&!1===t.transparent?u(0):u(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),f.setFunc(t.depthFunc),f.setTest(t.depthTest),f.setMask(t.depthWrite),m.setMask(t.colorWrite),p(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:c,setCullFace:d,setLineWidth:function(t){t!==I&&(k&&e.lineWidth(t),I=t)},setPolygonOffset:p,setScissorTest:function(t){t?i(e.SCISSOR_TEST):s(e.SCISSOR_TEST)},activeTexture:h,bindTexture:function(t,n){null===H&&h();var r=G[H];void 0===r&&(G[H]=r={type:void 0,texture:void 0}),r.type===t&&r.texture===n||(e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===V.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),V.copy(t))},viewport:function(t){!1===j.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),j.copy(t))},reset:function(){for(var t=0;t<y.length;t++)1===y[t]&&(e.disableVertexAttribArray(t),y[t]=0);b={},H=x=null,G={},D=R=S=w=null,m.reset(),f.reset(),g.reset()}}}function ut(e,t,n,r,o,a,i){function s(e,t){if(e.width>t||e.height>t){if("data"in e)return void b.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");t/=Math.max(e.width,e.height);var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(e.width*t),n.height=Math.floor(e.height*t),n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),b.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height),n}return e}function l(e){return Xo.isPowerOfTwo(e.width)&&Xo.isPowerOfTwo(e.height)}function u(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function c(t,n,o,a){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(o,a))*Math.LOG2E}function d(t,n){if(!o.isWebGL2)return t;if(t===e.RGB){if(n===e.FLOAT)return e.RGB32F;if(n===e.HALF_FLOAT)return e.RGB16F;if(n===e.UNSIGNED_BYTE)return e.RGB8}if(t===e.RGBA){if(n===e.FLOAT)return e.RGBA32F;if(n===e.HALF_FLOAT)return e.RGBA16F;if(n===e.UNSIGNED_BYTE)return e.RGBA8}return t}function p(t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function h(t){(t=t.target).removeEventListener("dispose",h);e:{var n=r.get(t);if(t.image&&n.__image__webglTextureCube)e.deleteTexture(n.__image__webglTextureCube);else{if(void 0===n.__webglInit)break e;e.deleteTexture(n.__webglTexture)}r.remove(t)}t.isVideoTexture&&delete _[t.id],i.memory.textures--}function m(t){(t=t.target).removeEventListener("dispose",m);var n=r.get(t),o=r.get(t.texture);if(t){if(void 0!==o.__webglTexture&&e.deleteTexture(o.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(o=0;6>o;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}i.memory.textures--}function f(t,p){var m=r.get(t);if(t.isVideoTexture){var f=t.id,$=i.render.frame;_[f]!==$&&(_[f]=$,t.update())}if(0<t.version&&m.__version!==t.version)if(void 0===(f=t.image))b.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==f.complete){void 0===m.__webglInit&&(m.__webglInit=!0,t.addEventListener("dispose",h),m.__webglTexture=e.createTexture(),i.memory.textures++),n.activeTexture(e.TEXTURE0+p),n.bindTexture(e.TEXTURE_2D,m.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,t.unpackAlignment),p=s(t.image,o.maxTextureSize),!o.isWebGL2&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)&&!1===l(p)&&(p instanceof HTMLImageElement||p instanceof HTMLCanvasElement||p instanceof ImageBitmap)&&(void 0===y&&(y=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),y.width=Xo.floorPowerOfTwo(p.width),y.height=Xo.floorPowerOfTwo(p.height),y.getContext("2d").drawImage(p,0,0,y.width,y.height),b.warn("THREE.WebGLRenderer: image is not power of two ("+p.width+"x"+p.height+"). Resized to "+y.width+"x"+y.height),p=y),f=l(p),$=a.convert(t.format);var v=a.convert(t.type),x=d($,v);g(e.TEXTURE_2D,t,f);var w=t.mipmaps;if(t.isDepthTexture){if(x=e.DEPTH_COMPONENT,1015===t.type){if(!o.isWebGL2)throw Error("Float Depth Texture only supported in WebGL2.0");x=e.DEPTH_COMPONENT32F}else o.isWebGL2&&(x=e.DEPTH_COMPONENT16);1026===t.format&&x===e.DEPTH_COMPONENT&&1012!==t.type&&1014!==t.type&&(b.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),t.type=1012,v=a.convert(t.type)),1027===t.format&&(x=e.DEPTH_STENCIL,1020!==t.type&&(b.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),t.type=1020,v=a.convert(t.type))),n.texImage2D(e.TEXTURE_2D,0,x,p.width,p.height,0,$,v,null)}else if(t.isDataTexture)if(0<w.length&&f){for(var S=0,M=w.length;S<M;S++){var E=w[S];n.texImage2D(e.TEXTURE_2D,S,x,E.width,E.height,0,$,v,E.data)}t.generateMipmaps=!1,m.__maxMipLevel=w.length-1}else n.texImage2D(e.TEXTURE_2D,0,x,p.width,p.height,0,$,v,p.data),m.__maxMipLevel=0;else if(t.isCompressedTexture){for(S=0,M=w.length;S<M;S++)E=w[S],1023!==t.format&&1022!==t.format?-1<n.getCompressedTextureFormats().indexOf($)?n.compressedTexImage2D(e.TEXTURE_2D,S,x,E.width,E.height,0,E.data):b.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,S,x,E.width,E.height,0,$,v,E.data);m.__maxMipLevel=w.length-1}else if(0<w.length&&f){for(S=0,M=w.length;S<M;S++)n.texImage2D(e.TEXTURE_2D,S,x,$,v,E=w[S]);t.generateMipmaps=!1,m.__maxMipLevel=w.length-1}else n.texImage2D(e.TEXTURE_2D,0,x,$,v,p),m.__maxMipLevel=0;return u(t,f)&&c(e.TEXTURE_2D,t,p.width,p.height),m.__version=t.version,void(t.onUpdate&&t.onUpdate(t))}b.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}n.activeTexture(e.TEXTURE0+p),n.bindTexture(e.TEXTURE_2D,m.__webglTexture)}function g(n,i,s){s?(e.texParameteri(n,e.TEXTURE_WRAP_S,a.convert(i.wrapS)),e.texParameteri(n,e.TEXTURE_WRAP_T,a.convert(i.wrapT)),e.texParameteri(n,e.TEXTURE_MAG_FILTER,a.convert(i.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,a.convert(i.minFilter))):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),1001===i.wrapS&&1001===i.wrapT||b.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,p(i.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,p(i.minFilter)),1003!==i.minFilter&&1006!==i.minFilter&&b.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!(s=t.get("EXT_texture_filter_anisotropic"))||1015===i.type&&null===t.get("OES_texture_float_linear")||1016===i.type&&null===(o.isWebGL2||t.get("OES_texture_half_float_linear"))||!(1<i.anisotropy||r.get(i).__currentAnisotropy)||(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,o.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy)}function $(t,o,i,s){var l=a.convert(o.texture.format),u=a.convert(o.texture.type),c=d(l,u);n.texImage2D(s,0,c,o.width,o.height,0,l,u,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,i,s,r.get(o.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function v(t,n){e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):n.depthBuffer&&n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,n.width,n.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}var y,_={},b=ca.Logger.resolve();this.setTexture2D=f,this.setTextureCube=function(t,p){var m=r.get(t);if(6===t.image.length)if(0<t.version&&m.__version!==t.version){m.__image__webglTextureCube||(t.addEventListener("dispose",h),m.__image__webglTextureCube=e.createTexture(),i.memory.textures++),n.activeTexture(e.TEXTURE0+p),n.bindTexture(e.TEXTURE_CUBE_MAP,m.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),p=t&&t.isCompressedTexture;for(var f=t.image[0]&&t.image[0].isDataTexture,$=[],v=0;6>v;v++)$[v]=p||f?f?t.image[v].image:t.image[v]:s(t.image[v],o.maxCubemapSize);var y=$[0],_=l(y),x=a.convert(t.format),w=a.convert(t.type),S=d(x,w);for(g(e.TEXTURE_CUBE_MAP,t,_),v=0;6>v;v++)if(p)for(var M,E=$[v].mipmaps,T=0,C=E.length;T<C;T++)M=E[T],1023!==t.format&&1022!==t.format?-1<n.getCompressedTextureFormats().indexOf(x)?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,T,S,M.width,M.height,0,M.data):b.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,T,S,M.width,M.height,0,x,w,M.data);else f?n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,S,$[v].width,$[v].height,0,x,w,$[v].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,S,x,w,$[v]);m.__maxMipLevel=p?E.length-1:0,u(t,_)&&c(e.TEXTURE_CUBE_MAP,t,y.width,y.height),m.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(e.TEXTURE0+p),n.bindTexture(e.TEXTURE_CUBE_MAP,m.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,o){n.activeTexture(e.TEXTURE0+o),n.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)},this.setupRenderTarget=function(t){var o=r.get(t),a=r.get(t.texture);t.addEventListener("dispose",m),a.__webglTexture=e.createTexture(),i.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,d=l(t);if(s){o.__webglFramebuffer=[];for(var p=0;6>p;p++)o.__webglFramebuffer[p]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(s){for(n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture),g(e.TEXTURE_CUBE_MAP,t.texture,d),p=0;6>p;p++)$(o.__webglFramebuffer[p],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+p);u(t.texture,d)&&c(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else n.bindTexture(e.TEXTURE_2D,a.__webglTexture),g(e.TEXTURE_2D,t.texture,d),$(o.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),u(t.texture,d)&&c(e.TEXTURE_2D,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_2D,null);if(t.depthBuffer){if(o=r.get(t),a=!0===t.isWebGLRenderTargetCube,t.depthTexture){if(a)throw Error("target.depthTexture not supported in Cube render targets");if(t&&t.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,o.__webglFramebuffer),!t.depthTexture||!t.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(r.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),f(t.depthTexture,0),o=r.get(t.depthTexture).__webglTexture,1026===t.depthTexture.format)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(1027!==t.depthTexture.format)throw Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}else if(a)for(o.__webglDepthbuffer=[],a=0;6>a;a++)e.bindFramebuffer(e.FRAMEBUFFER,o.__webglFramebuffer[a]),o.__webglDepthbuffer[a]=e.createRenderbuffer(),v(o.__webglDepthbuffer[a],t);else e.bindFramebuffer(e.FRAMEBUFFER,o.__webglFramebuffer),o.__webglDepthbuffer=e.createRenderbuffer(),v(o.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}},this.updateRenderTargetMipmap=function(t){var o=t.texture,a=l(t);if(u(o,a)){a=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D;var i=r.get(o).__webglTexture;n.bindTexture(a,i),c(a,o,t.width,t.height),n.bindTexture(a,null)}}}function ct(e,t,n){return{convert:function(r){if(1e3===r)return e.REPEAT;if(1001===r)return e.CLAMP_TO_EDGE;if(1002===r)return e.MIRRORED_REPEAT;if(1003===r)return e.NEAREST;if(1004===r)return e.NEAREST_MIPMAP_NEAREST;if(1005===r)return e.NEAREST_MIPMAP_LINEAR;if(1006===r)return e.LINEAR;if(1007===r)return e.LINEAR_MIPMAP_NEAREST;if(1008===r)return e.LINEAR_MIPMAP_LINEAR;if(1009===r)return e.UNSIGNED_BYTE;if(1017===r)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===r)return e.UNSIGNED_SHORT_5_5_5_1;if(1019===r)return e.UNSIGNED_SHORT_5_6_5;if(1010===r)return e.BYTE;if(1011===r)return e.SHORT;if(1012===r)return e.UNSIGNED_SHORT;if(1013===r)return e.INT;if(1014===r)return e.UNSIGNED_INT;if(1015===r)return e.FLOAT;if(1016===r){if(n.isWebGL2)return e.HALF_FLOAT;var o=t.get("OES_texture_half_float");if(null!==o)return o.HALF_FLOAT_OES}if(1021===r)return e.ALPHA;if(1022===r)return e.RGB;if(1023===r)return e.RGBA;if(1024===r)return e.LUMINANCE;if(1025===r)return e.LUMINANCE_ALPHA;if(1026===r)return e.DEPTH_COMPONENT;if(1027===r)return e.DEPTH_STENCIL;if(100===r)return e.FUNC_ADD;if(101===r)return e.FUNC_SUBTRACT;if(102===r)return e.FUNC_REVERSE_SUBTRACT;if(200===r)return e.ZERO;if(201===r)return e.ONE;if(202===r)return e.SRC_COLOR;if(203===r)return e.ONE_MINUS_SRC_COLOR;if(204===r)return e.SRC_ALPHA;if(205===r)return e.ONE_MINUS_SRC_ALPHA;if(206===r)return e.DST_ALPHA;if(207===r)return e.ONE_MINUS_DST_ALPHA;if(208===r)return e.DST_COLOR;if(209===r)return e.ONE_MINUS_DST_COLOR;if(210===r)return e.SRC_ALPHA_SATURATE;if((33776===r||33777===r||33778===r||33779===r)&&null!==(o=t.get("WEBGL_compressed_texture_s3tc"))){if(33776===r)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===r||35841===r||35842===r||35843===r)&&null!==(o=t.get("WEBGL_compressed_texture_pvrtc"))){if(35840===r)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r&&null!==(o=t.get("WEBGL_compressed_texture_etc1")))return o.COMPRESSED_RGB_ETC1_WEBGL;if((37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r)&&null!==(o=t.get("WEBGL_compressed_texture_astc")))return r;if(103===r||104===r){if(n.isWebGL2){if(103===r)return e.MIN;if(104===r)return e.MAX}if(null!==(o=t.get("EXT_blend_minmax"))){if(103===r)return o.MIN_EXT;if(104===r)return o.MAX_EXT}}if(1020===r){if(n.isWebGL2)return e.UNSIGNED_INT_24_8;if(null!==(o=t.get("WEBGL_depth_texture")))return o.UNSIGNED_INT_24_8_WEBGL}return 0}}}function dt(){b.call(this),this.type="Group"}function pt(e,t,n,r){x.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function ht(e){pt.call(this),this.cameras=e||[]}function mt(e){function t(){return null!==s&&!0===s.isPresenting}function n(){if(t()){var n=s.getEyeParameters("left"),r=n.renderWidth;n=n.renderHeight,x=e.getPixelRatio(),b=e.getSize(),e.setDrawingBufferSize(2*r,n,1),S.start()}else i.enabled&&(e.setDrawingBufferSize(b.width,b.height,x),S.stop())}var i=this,s=null,u=null,c=null,d=[],p=new r,h=new r;"undefined"!=typeof window&&"VRFrameData"in window&&(u=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",n,!1));var m=new r,f=new o,g=new a,v=new pt;v.bounds=new l(0,0,.5,1),v.layers.enable(1);var y=new pt;y.bounds=new l(.5,0,.5,1),y.layers.enable(2);var _=new ht([v,y]);_.layers.enable(1),_.layers.enable(2);var b,x,w=[];this.enabled=!1,this.userHeight=1.6,this.getController=function(e){var t=d[e];return void 0===t&&((t=new dt).matrixAutoUpdate=!1,t.visible=!1,d[e]=t),t},this.getDevice=function(){return s},this.setDevice=function(e){void 0!==e&&(s=e),S.setContext(e)},this.setPoseTarget=function(e){void 0!==e&&(c=e)},this.getCamera=function(e){if(null===s)return e.position.set(0,i.userHeight,0),e;s.depthNear=e.near,s.depthFar=e.far,s.getFrameData(u);var t=s.stageParameters;t?p.fromArray(t.sittingToStandingTransform):p.makeTranslation(0,i.userHeight,0),t=u.pose;var n=null!==c?c:e;if(n.matrix.copy(p),n.matrix.decompose(n.position,n.quaternion,n.scale),null!==t.orientation&&(f.fromArray(t.orientation),n.quaternion.multiply(f)),null!==t.position&&(f.setFromRotationMatrix(p),g.fromArray(t.position),g.applyQuaternion(f),n.position.add(g)),n.updateMatrixWorld(),!1===s.isPresenting)return e;v.near=e.near,y.near=e.near,v.far=e.far,y.far=e.far,_.matrixWorld.copy(e.matrixWorld),_.matrixWorldInverse.copy(e.matrixWorldInverse),v.matrixWorldInverse.fromArray(u.leftViewMatrix),y.matrixWorldInverse.fromArray(u.rightViewMatrix),h.getInverse(p),v.matrixWorldInverse.multiply(h),y.matrixWorldInverse.multiply(h),null!==(e=n.parent)&&(m.getInverse(e.matrixWorld),v.matrixWorldInverse.multiply(m),y.matrixWorldInverse.multiply(m)),v.matrixWorld.getInverse(v.matrixWorldInverse),y.matrixWorld.getInverse(y.matrixWorldInverse),v.projectionMatrix.fromArray(u.leftProjectionMatrix),y.projectionMatrix.fromArray(u.rightProjectionMatrix),_.projectionMatrix.copy(v.projectionMatrix),(e=s.getLayers()).length&&(null!==(e=e[0]).leftBounds&&4===e.leftBounds.length&&v.bounds.fromArray(e.leftBounds),null!==e.rightBounds&&4===e.rightBounds.length&&y.bounds.fromArray(e.rightBounds));e:for(e=0;e<d.length;e++){t=d[e];t:{n=e;for(var r=navigator.getGamepads&&navigator.getGamepads(),o=0,a=0,l=r.length;o<l;o++){var $=r[o];if($&&("Daydream Controller"===$.id||"Gear VR Controller"===$.id||"Oculus Go Controller"===$.id||"OpenVR Gamepad"===$.id||$.id.startsWith("Oculus Touch")||$.id.startsWith("Spatial Controller"))){if(a===n){n=$;break t}a++}}n=void 0}if(void 0!==n&&void 0!==n.pose){if(null===n.pose)break e;!1===(r=n.pose).hasPosition&&t.position.set(.2,-.6,-.05),null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(p),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0,w[e]!==n.buttons[r="Daydream Controller"===n.id?0:1].pressed&&(w[e]=n.buttons[r].pressed,!0===w[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}return _},this.getStandingMatrix=function(){return p},this.isPresenting=t;var S=new $;this.setAnimationLoop=function(e){S.setAnimationLoop(e)},this.submitFrame=function(){t()&&s.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",n)}}function ft(e){function t(){return null!==s&&null!==u}function n(e){var t=d[p.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function r(){e.setFramebuffer(null),v.stop()}function o(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}var a=e.context,i=null,s=null,u=null,c=null,d=[],p=[],h=new pt;h.layers.enable(1),h.viewport=new l;var m=new pt;m.layers.enable(2),m.viewport=new l;var f=new ht([h,m]);f.layers.enable(1),f.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=d[e];return void 0===t&&((t=new dt).matrixAutoUpdate=!1,t.visible=!1,d[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),e instanceof XRDevice&&a.setCompatibleXRDevice(e)},this.setSession=function(t,o){null!==(s=t)&&(s.addEventListener("select",n),s.addEventListener("selectstart",n),s.addEventListener("selectend",n),s.addEventListener("end",r),s.baseLayer=new XRWebGLLayer(s,a),s.requestFrameOfReference(o.frameOfReferenceType).then((function(t){u=t,e.setFramebuffer(s.baseLayer.framebuffer),v.setContext(s),v.start()})),p=s.getInputSources(),s.addEventListener("inputsourceschange",(function(){p=s.getInputSources(),console.log(p)})))},this.getCamera=function(e){if(t()){var n=e.parent,r=f.cameras;o(f,n);for(var a=0;a<r.length;a++)o(r[a],n);for(e.matrixWorld.copy(f.matrixWorld),a=0,n=(e=e.children).length;a<n;a++)e[a].updateMatrixWorld(!0);return f}return e},this.isPresenting=t;var g=null,v=new $;v.setAnimationLoop((function(e,t){if(null!==(c=t.getDevicePose(u)))for(var n=s.baseLayer,r=t.views,o=0;o<r.length;o++){var a=r[o],i=n.getViewport(a),l=c.getViewMatrix(a),h=f.cameras[o];h.matrix.fromArray(l).getInverse(h.matrix),h.projectionMatrix.fromArray(a.projectionMatrix),h.viewport.set(i.x,i.y,i.width,i.height),0===o&&(f.matrix.copy(h.matrix),f.projectionMatrix.copy(h.projectionMatrix))}for(o=0;o<d.length;o++)n=d[o],(r=p[o])&&null!==(r=t.getInputPose(r,u))?(n.matrix.elements=r.pointerMatrix,n.matrix.decompose(n.position,n.rotation,n.scale),n.visible=!0):n.visible=!1;g&&g(e)})),this.setAnimationLoop=function(e){g=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}function gt(e){var t;function n(){R=new Q(Le),(D=new J(Le,R,e)).isWebGL2||(R.get("WEBGL_depth_texture"),R.get("OES_texture_float"),R.get("OES_texture_half_float"),R.get("OES_texture_half_float_linear"),R.get("OES_standard_derivatives"),R.get("OES_element_index_uint"),R.get("ANGLE_instanced_arrays")),R.get("OES_texture_float_linear"),q=new ct(Le,R,D),(I=new lt(Le,R,q,D)).scissor(ge.copy(we).multiplyScalar(be)),I.viewport(fe.copy(xe).multiplyScalar(be)),O=new ne(Le),N=new Ze,U=new ut(Le,R,I,N,D,q,O),k=new v(Le),H=new ee(Le,k,O),G=new ae(H,O),B=new oe(Le),V=new Xe(re,R,D),j=new et,F=new ot,z=new X(re,I,G,T),W=new Z(Le,R,O,D),Y=new te(Le,R,O,D),O.programs=V.programs,re.context=Le,re.capabilities=D,re.extensions=R,re.properties=N,re.renderLists=j,re.state=I,re.info=O}function o(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ie=!0}function i(){console.log("THREE.WebGLRenderer: Context Restored."),ie=!1,n()}function s(e){(e=e.target).removeEventListener("dispose",s),u(e),N.remove(e)}function u(e){var t=N.get(e).program;e.program=void 0,void 0!==t&&V.releaseProgram(t)}function c(e,t,n,r){for(var o=0,a=e.length;o<a;o++){var i=e[o],s=i.object,l=i.geometry,u=void 0===r?i.material:r;if(i=i.group,n.isArrayCamera){me=n;for(var c=n.cameras,d=0,h=c.length;d<h;d++){var m=c[d];if(s.layers.test(m.layers)){if("viewport"in m)I.viewport(fe.copy(m.viewport));else{var f=m.bounds;I.viewport(fe.set(f.x*ye,f.y*_e,f.z*ye,f.w*_e).multiplyScalar(be))}p(s,t,m,l,u,i)}}}else me=null,p(s,t,n,l,u,i)}}function p(e,n,r,o,a,i){if(e.onBeforeRender(re,n,r,o,a,i),L=F.get(n,me||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){I.setMaterial(a);var s=m(r,n.fog,a,e);de=t=null,pe=!1,function(e,t){e.render((function(e){re.renderBufferImmediate(e,t)}))}(e,s)}else re.renderBufferDirect(r,n.fog,o,a,e,i);e.onAfterRender(re,n,r,o,a,i),L=F.get(n,me||r)}function h(e,t,n){var r=N.get(e),o=L.state.lights,a=r.lightsHash,i=o.state.hash;n=V.getParameters(e,o.state,L.state.shadowsArray,t,Ee.numPlanes,Ee.numIntersection,n);var l=V.getProgramCode(e,n),c=r.program,d=!0;if(void 0===c)e.addEventListener("dispose",s);else if(c.code!==l)u(e);else{if(a.stateID!==i.stateID||a.directionalLength!==i.directionalLength||a.pointLength!==i.pointLength||a.spotLength!==i.spotLength||a.rectAreaLength!==i.rectAreaLength||a.hemiLength!==i.hemiLength||a.shadowsLength!==i.shadowsLength)a.stateID=i.stateID,a.directionalLength=i.directionalLength,a.pointLength=i.pointLength,a.spotLength=i.spotLength,a.rectAreaLength=i.rectAreaLength,a.hemiLength=i.hemiLength,a.shadowsLength=i.shadowsLength;else if(void 0!==n.shaderID)return;d=!1}if(d&&(r.shader=n.shaderID?{name:e.type,uniforms:Qo.clone((l=na[n.shaderID]).uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}:{name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},e.onBeforeCompile(r.shader,re),l=V.getProgramCode(e,n),c=V.acquireProgram(e,r.shader,n,l),r.program=c,e.program=c),n=c.getAttributes(),e.morphTargets)for(l=e.numSupportedMorphTargets=0;l<re.maxMorphTargets;l++)0<=n["morphTarget"+l]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(l=e.numSupportedMorphNormals=0;l<re.maxMorphNormals;l++)0<=n["morphNormal"+l]&&e.numSupportedMorphNormals++;n=r.shader.uniforms,(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=Ee.numPlanes,r.numIntersection=Ee.numIntersection,n.clippingPlanes=Ee.uniform),r.fog=t,void 0===a&&(r.lightsHash=a={}),a.stateID=i.stateID,a.directionalLength=i.directionalLength,a.pointLength=i.pointLength,a.spotLength=i.spotLength,a.rectAreaLength=i.rectAreaLength,a.hemiLength=i.hemiLength,a.shadowsLength=i.shadowsLength,e.lights&&(n.ambientLightColor.value=o.state.ambient,n.directionalLights.value=o.state.directional,n.spotLights.value=o.state.spot,n.rectAreaLights.value=o.state.rectArea,n.pointLights.value=o.state.point,n.hemisphereLights.value=o.state.hemi,n.directionalShadowMap.value=o.state.directionalShadowMap,n.directionalShadowMatrix.value=o.state.directionalShadowMatrix,n.spotShadowMap.value=o.state.spotShadowMap,n.spotShadowMatrix.value=o.state.spotShadowMatrix,n.pointShadowMap.value=o.state.pointShadowMap,n.pointShadowMatrix.value=o.state.pointShadowMatrix),e=r.program.getUniforms(),e=Ue.seqWithValue(e.seq,n),r.uniformsList=e}function m(e,t,n,r){ve=0;var o=N.get(n),a=o.lightsHash,i=L.state.lights.state.hash;Te&&(Ce||e!==he)&&Ee.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,o,e===he&&n.id===ce),!1===n.needsUpdate&&(void 0===o.program?n.needsUpdate=!0:n.fog&&o.fog!==t?n.needsUpdate=!0:(!n.lights||a.stateID===i.stateID&&a.directionalLength===i.directionalLength&&a.pointLength===i.pointLength&&a.spotLength===i.spotLength&&a.rectAreaLength===i.rectAreaLength&&a.hemiLength===i.hemiLength&&a.shadowsLength===i.shadowsLength)&&(void 0===o.numClippingPlanes||o.numClippingPlanes===Ee.numPlanes&&o.numIntersection===Ee.numIntersection)||(n.needsUpdate=!0)),n.needsUpdate&&(h(n,t,r),n.needsUpdate=!1);var s=!1,l=!1,u=!1;i=(a=o.program).getUniforms();var c=o.shader.uniforms;if(I.useProgram(a.program)&&(u=l=s=!0),n.id!==ce&&(ce=n.id,l=!0),(s||e!==he)&&(i.setValue(Le,"projectionMatrix",e.projectionMatrix),D.logarithmicDepthBuffer&&i.setValue(Le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),he!==(me||e)&&(he=me||e,u=l=!0),(n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap)&&void 0!==(s=i.map.cameraPosition)&&s.setValue(Le,Ae.setFromMatrixPosition(e.matrixWorld)),(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&i.setValue(Le,"viewMatrix",e.matrixWorldInverse)),n.skinning&&(i.setOptional(Le,r,"bindMatrix"),i.setOptional(Le,r,"bindMatrixInverse"),e=r.skeleton))if(s=e.bones,D.floatVertexTextures){if(void 0===e.boneTexture){s=Math.sqrt(4*s.length),s=Xo.ceilPowerOfTwo(s),s=Math.max(s,4);var p=new Float32Array(s*s*4);p.set(e.boneMatrices);var m=new d(p,s,s,1023,1015);m.needsUpdate=!0,e.boneMatrices=p,e.boneTexture=m,e.boneTextureSize=s}i.setValue(Le,"boneTexture",e.boneTexture),i.setValue(Le,"boneTextureSize",e.boneTextureSize)}else i.setOptional(Le,e,"boneMatrices");return l&&(i.setValue(Le,"toneMappingExposure",re.toneMappingExposure),i.setValue(Le,"toneMappingWhitePoint",re.toneMappingWhitePoint),n.lights&&(c.ambientLightColor.needsUpdate=l=u,c.directionalLights.needsUpdate=l,c.pointLights.needsUpdate=l,c.spotLights.needsUpdate=l,c.rectAreaLights.needsUpdate=l,c.hemisphereLights.needsUpdate=l),t&&n.fog&&(c.fogColor.value=t.color,t.isFog?(c.fogNear.value=t.near,c.fogFar.value=t.far):t.isFogExp2&&(c.fogDensity.value=t.density)),n.isMeshBasicMaterial?g(c,n):n.isMeshLambertMaterial?(g(c,n),n.emissiveMap&&(c.emissiveMap.value=n.emissiveMap)):n.isMeshPhongMaterial?(g(c,n),n.isMeshToonMaterial?(y(c,n),n.gradientMap&&(c.gradientMap.value=n.gradientMap)):y(c,n)):n.isMeshStandardMaterial?(g(c,n),n.isMeshPhysicalMaterial?(_(c,n),c.reflectivity.value=n.reflectivity,c.clearCoat.value=n.clearCoat,c.clearCoatRoughness.value=n.clearCoatRoughness):_(c,n)):n.isMeshDepthMaterial?(g(c,n),n.displacementMap&&(c.displacementMap.value=n.displacementMap,c.displacementScale.value=n.displacementScale,c.displacementBias.value=n.displacementBias)):n.isMeshDistanceMaterial?(g(c,n),n.displacementMap&&(c.displacementMap.value=n.displacementMap,c.displacementScale.value=n.displacementScale,c.displacementBias.value=n.displacementBias),c.referencePosition.value.copy(n.referencePosition),c.nearDistance.value=n.nearDistance,c.farDistance.value=n.farDistance):n.isMeshNormalMaterial?(g(c,n),n.bumpMap&&(c.bumpMap.value=n.bumpMap,c.bumpScale.value=n.bumpScale,1===n.side&&(c.bumpScale.value*=-1)),n.normalMap&&(c.normalMap.value=n.normalMap,c.normalScale.value.copy(n.normalScale),1===n.side&&c.normalScale.value.negate()),n.displacementMap&&(c.displacementMap.value=n.displacementMap,c.displacementScale.value=n.displacementScale,c.displacementBias.value=n.displacementBias)):n.isLineBasicMaterial?(c.diffuse.value=n.color,c.opacity.value=n.opacity,n.isLineDashedMaterial&&(c.dashSize.value=n.dashSize,c.totalSize.value=n.dashSize+n.gapSize,c.scale.value=n.scale)):n.isPointsMaterial?(c.diffuse.value=n.color,c.opacity.value=n.opacity,c.size.value=n.size*be,c.scale.value=.5*_e,c.map.value=n.map,null!==n.map&&(!0===n.map.matrixAutoUpdate&&n.map.updateMatrix(),c.uvTransform.value.copy(n.map.matrix))):n.isSpriteMaterial?(c.diffuse.value=n.color,c.opacity.value=n.opacity,c.rotation.value=n.rotation,c.map.value=n.map,null!==n.map&&(!0===n.map.matrixAutoUpdate&&n.map.updateMatrix(),c.uvTransform.value.copy(n.map.matrix))):n.isShadowMaterial&&(c.color.value=n.color,c.opacity.value=n.opacity),void 0!==c.ltc_1&&(c.ltc_1.value=ta.LTC_1),void 0!==c.ltc_2&&(c.ltc_2.value=ta.LTC_2),Ue.upload(Le,o.uniformsList,c,re)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Ue.upload(Le,o.uniformsList,c,re),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&i.setValue(Le,"center",r.center),i.setValue(Le,"modelViewMatrix",r.modelViewMatrix),i.setValue(Le,"normalMatrix",r.normalMatrix),i.setValue(Le,"modelMatrix",r.matrixWorld),a}function g(e,t){if(e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=N.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map)var n=t.map;else t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap);void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function y(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function _(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}console.log("THREE.WebGLRenderer","95");var b=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),x=void 0!==e.context?e.context:null,w=void 0!==e.alpha&&e.alpha,S=void 0===e.depth||e.depth,M=void 0===e.stencil||e.stencil,E=void 0!==e.antialias&&e.antialias,T=void 0===e.premultipliedAlpha||e.premultipliedAlpha,C=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,P=void 0!==e.powerPreference?e.powerPreference:"default",A=null,L=null;this.domElement=b,this.context=null,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1,this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var R,D,I,O,N,U,k,H,G,V,j,F,z,B,W,Y,q,re=this,ie=!1,se=null,le=null,ue=null,ce=-1,de=t=null,pe=!1,he=null,me=null,fe=new l,ge=new l,$e=null,ve=0,ye=b.width,_e=b.height,be=1,xe=new l(0,0,ye,_e),we=new l(0,0,ye,_e),Se=!1,Me=new f,Ee=new K,Te=!1,Ce=!1,Pe=new r,Ae=new a;try{w={alpha:w,depth:S,stencil:M,antialias:E,premultipliedAlpha:T,preserveDrawingBuffer:C,powerPreference:P},b.addEventListener("webglcontextlost",o,!1),b.addEventListener("webglcontextrestored",i,!1);var Le=x||b.getContext("webgl",w)||b.getContext("experimental-webgl",w);if(null===Le){if(null!==b.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Le.getShaderPrecisionFormat&&(Le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ne){console.error("THREE.WebGLRenderer: "+Ne.message)}n();var Re="xr"in navigator?new ft(re):new mt(re);this.vr=Re;var De=new st(re,G,D.maxTextureSize);this.shadowMap=De,this.getContext=function(){return Le},this.getContextAttributes=function(){return Le.getContextAttributes()},this.forceContextLoss=function(){var e=R.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=R.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return be},this.setPixelRatio=function(e){void 0!==e&&(be=e,this.setSize(ye,_e,!1))},this.getSize=function(){return{width:ye,height:_e}},this.setSize=function(e,t,n){Re.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(ye=e,_e=t,b.width=e*be,b.height=t*be,!1!==n&&(b.style.width=e+"px",b.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:ye*be,height:_e*be}},this.setDrawingBufferSize=function(e,t,n){ye=e,_e=t,be=n,b.width=e*n,b.height=t*n,this.setViewport(0,0,e,t)},this.getCurrentViewport=function(){return fe},this.setViewport=function(e,t,n,r){xe.set(e,_e-t-r,n,r),I.viewport(fe.copy(xe).multiplyScalar(be))},this.setScissor=function(e,t,n,r){we.set(e,_e-t-r,n,r),I.scissor(ge.copy(we).multiplyScalar(be))},this.setScissorTest=function(e){I.setScissorTest(Se=e)},this.getClearColor=function(){return z.getClearColor()},this.setClearColor=function(){z.setClearColor.apply(z,arguments)},this.getClearAlpha=function(){return z.getClearAlpha()},this.setClearAlpha=function(){z.setClearAlpha.apply(z,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=Le.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=Le.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=Le.STENCIL_BUFFER_BIT),Le.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.dispose=function(){b.removeEventListener("webglcontextlost",o,!1),b.removeEventListener("webglcontextrestored",i,!1),j.dispose(),F.dispose(),N.dispose(),G.dispose(),V.disposeCached(),Re.dispose(),Oe.stop()},this.renderBufferImmediate=function(e,t){I.initAttributes();var n=N.get(e);e.hasPositions&&!n.position&&(n.position=Le.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=Le.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=Le.createBuffer()),e.hasColors&&!n.color&&(n.color=Le.createBuffer()),t=t.getAttributes(),e.hasPositions&&(Le.bindBuffer(Le.ARRAY_BUFFER,n.position),Le.bufferData(Le.ARRAY_BUFFER,e.positionArray,Le.DYNAMIC_DRAW),I.enableAttribute(t.position),Le.vertexAttribPointer(t.position,3,Le.FLOAT,!1,0,0)),e.hasNormals&&(Le.bindBuffer(Le.ARRAY_BUFFER,n.normal),Le.bufferData(Le.ARRAY_BUFFER,e.normalArray,Le.DYNAMIC_DRAW),I.enableAttribute(t.normal),Le.vertexAttribPointer(t.normal,3,Le.FLOAT,!1,0,0)),e.hasUvs&&(Le.bindBuffer(Le.ARRAY_BUFFER,n.uv),Le.bufferData(Le.ARRAY_BUFFER,e.uvArray,Le.DYNAMIC_DRAW),I.enableAttribute(t.uv),Le.vertexAttribPointer(t.uv,2,Le.FLOAT,!1,0,0)),e.hasColors&&(Le.bindBuffer(Le.ARRAY_BUFFER,n.color),Le.bufferData(Le.ARRAY_BUFFER,e.colorArray,Le.DYNAMIC_DRAW),I.enableAttribute(t.color),Le.vertexAttribPointer(t.color,3,Le.FLOAT,!1,0,0)),I.disableUnusedAttributes(),Le.drawArrays(Le.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,n,r,o,a,i){var s=a.isMesh&&0>a.normalMatrix.determinant();I.setMaterial(o,s);var l=m(e,n,o,a),u=!1;t===r.id&&de===l.id&&pe===(!0===o.wireframe)||(t=r.id,de=l.id,pe=!0===o.wireframe,u=!0),a.morphTargetInfluences&&(B.update(a,r,o,l),u=!0),s=r.index;var c=r.attributes.position;if(n=1,!0===o.wireframe&&(s=H.getWireframeAttribute(r),n=2),e=W,null!==s){var d=k.get(s);(e=Y).setIndex(d)}if(u){if(r&&r.isInstancedBufferGeometry&!D.isWebGL2&&null===R.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{I.initAttributes(),u=r.attributes,l=l.getAttributes();var p=o.defaultAttributeValues;for(w in l){var h=l[w];if(0<=h){var f=u[w];if(void 0!==f){var g=f.normalized,$=f.itemSize,v=k.get(f);if(void 0!==v){var y=v.buffer,_=v.type;if(v=v.bytesPerElement,f.isInterleavedBufferAttribute){var b=f.data,x=b.stride;f=f.offset,b&&b.isInstancedInterleavedBuffer?(I.enableAttributeAndDivisor(h,b.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=b.meshPerAttribute*b.count)):I.enableAttribute(h),Le.bindBuffer(Le.ARRAY_BUFFER,y),Le.vertexAttribPointer(h,$,_,g,x*v,f*v)}else f.isInstancedBufferAttribute?(I.enableAttributeAndDivisor(h,f.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=f.meshPerAttribute*f.count)):I.enableAttribute(h),Le.bindBuffer(Le.ARRAY_BUFFER,y),Le.vertexAttribPointer(h,$,_,g,0,0)}}else if(void 0!==p&&void 0!==(g=p[w]))switch(g.length){case 2:Le.vertexAttrib2fv(h,g);break;case 3:Le.vertexAttrib3fv(h,g);break;case 4:Le.vertexAttrib4fv(h,g);break;default:Le.vertexAttrib1fv(h,g)}}}I.disableUnusedAttributes()}null!==s&&Le.bindBuffer(Le.ELEMENT_ARRAY_BUFFER,d.buffer)}d=1/0,null!==s?d=s.count:void 0!==c&&(d=c.count),s=r.drawRange.start*n,c=null!==i?i.start*n:0;var w=Math.max(s,c);if(0!==(i=Math.max(0,Math.min(d,s+r.drawRange.count*n,c+(null!==i?i.count*n:1/0))-1-w+1))){if(a.isMesh)if(!0===o.wireframe)I.setLineWidth(o.wireframeLinewidth*(null===le?be:1)),e.setMode(Le.LINES);else switch(a.drawMode){case 0:e.setMode(Le.TRIANGLES);break;case 1:e.setMode(Le.TRIANGLE_STRIP);break;case 2:e.setMode(Le.TRIANGLE_FAN)}else a.isLine?(void 0===(o=o.linewidth)&&(o=1),I.setLineWidth(o*(null===le?be:1)),e.setMode(a.isLineSegments?Le.LINES:a.isLineLoop?Le.LINE_LOOP:Le.LINE_STRIP)):a.isPoints?e.setMode(Le.POINTS):a.isSprite&&e.setMode(Le.TRIANGLES);r&&r.isInstancedBufferGeometry?0<r.maxInstancedCount&&e.renderInstances(r,w,i):e.render(w,i)}},this.compile=function(e,t){(L=F.get(e,t)).init(),e.traverse((function(e){e.isLight&&(L.pushLight(e),e.castShadow&&L.pushShadow(e))})),L.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)h(t.material[n],e.fog,t);else h(t.material,e.fog,t)}))};var Ie=null,Oe=new $;Oe.setAnimationLoop((function(e){Re.isPresenting()||Ie&&Ie(e)})),"undefined"!=typeof window&&Oe.setContext(window),this.setAnimationLoop=function(e){Ie=e,Re.setAnimationLoop(e),Oe.start()},this.render=function(e,n,r,o){if(n&&n.isCamera){if(!ie){de=t=null,pe=!1,ce=-1,he=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),Re.enabled&&(n=Re.getCamera(n)),(L=F.get(e,n)).init(),e.onBeforeRender(re,e,n,r),Pe.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),Me.setFromMatrix(Pe),Te=Ee.init(this.clippingPlanes,Ce=this.localClippingEnabled,n),(A=j.get(e,n)).init(),function e(t,n,r){if(!1!==t.visible){if(t.layers.test(n.layers))if(t.isLight)L.pushLight(t),t.castShadow&&L.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Me.intersectsSprite(t)){r&&Ae.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Pe);var o=G.update(t),a=t.material;A.push(t,o,a,Ae.z,null)}}else if(t.isImmediateRenderObject)r&&Ae.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Pe),A.push(t,null,t.material,Ae.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||Me.intersectsObject(t)))if(r&&Ae.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Pe),o=G.update(t),a=t.material,Array.isArray(a))for(var i=o.groups,s=0,l=i.length;s<l;s++){var u=i[s],c=a[u.materialIndex];c&&c.visible&&A.push(t,o,c,Ae.z,u)}else a.visible&&A.push(t,o,a,Ae.z,null);for(s=0,l=(t=t.children).length;s<l;s++)e(t[s],n,r)}}(e,n,re.sortObjects),!0===re.sortObjects&&A.sort(),Te&&Ee.beginShadows(),De.render(L.state.shadowsArray,e,n),L.setupLights(n),Te&&Ee.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),z.render(A,e,n,o),o=A.opaque;var a=A.transparent;if(e.overrideMaterial){var i=e.overrideMaterial;o.length&&c(o,e,n,i),a.length&&c(a,e,n,i)}else o.length&&c(o,e,n),a.length&&c(a,e,n);r&&U.updateRenderTargetMipmap(r),I.buffers.depth.setTest(!0),I.buffers.depth.setMask(!0),I.buffers.color.setMask(!0),I.setPolygonOffset(!1),e.onAfterRender(re,e,n),Re.enabled&&Re.submitFrame(),L=A=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=ve;return e>=D.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+D.maxTextures),ve+=1,e},this.setTexture2D=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),U.setTexture2D(t,n)}}(),this.setTexture=function(){var e=!1;return function(t,n){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),U.setTexture2D(t,n)}}(),this.setTextureCube=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?U.setTextureCube(t,n):U.setTextureCubeDynamic(t,n)}}(),this.setFramebuffer=function(e){se=e},this.getRenderTarget=function(){return le},this.setRenderTarget=function(e){(le=e)&&void 0===N.get(e).__webglFramebuffer&&U.setupRenderTarget(e);var t=se,n=!1;e?(t=N.get(e).__webglFramebuffer,e.isWebGLRenderTargetCube&&(t=t[e.activeCubeFace],n=!0),fe.copy(e.viewport),ge.copy(e.scissor),$e=e.scissorTest):(fe.copy(xe).multiplyScalar(be),ge.copy(we).multiplyScalar(be),$e=Se),ue!==t&&(Le.bindFramebuffer(Le.FRAMEBUFFER,t),ue=t),I.viewport(fe),I.scissor(ge),I.setScissorTest($e),n&&(n=N.get(e.texture),Le.framebufferTexture2D(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel))},this.readRenderTargetPixels=function(e,t,n,r,o,a){if(e&&e.isWebGLRenderTarget){var i=N.get(e).__webglFramebuffer;if(i){var s=!1;i!==ue&&(Le.bindFramebuffer(Le.FRAMEBUFFER,i),s=!0);try{var l=e.texture,u=l.format,c=l.type;1023!==u&&q.convert(u)!==Le.getParameter(Le.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===c||q.convert(c)===Le.getParameter(Le.IMPLEMENTATION_COLOR_READ_TYPE)||1015===c&&(D.isWebGL2||R.get("OES_texture_float")||R.get("WEBGL_color_buffer_float"))||1016===c&&R.get(D.isWebGL2?"EXT_color_buffer_float":"EXT_color_buffer_half_float")?Le.checkFramebufferStatus(Le.FRAMEBUFFER)===Le.FRAMEBUFFER_COMPLETE?0<=t&&t<=e.width-r&&0<=n&&n<=e.height-o&&Le.readPixels(t,n,r,o,q.convert(u),q.convert(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{s&&Le.bindFramebuffer(Le.FRAMEBUFFER,ue)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var r=t.image.width,o=t.image.height,a=q.convert(t.format);this.setTexture2D(t,0),Le.copyTexImage2D(Le.TEXTURE_2D,n||0,a,e.x,e.y,r,o,0)},this.copyTextureToTexture=function(e,t,n,r){var o=t.image.width,a=t.image.height,i=q.convert(n.format),s=q.convert(n.type);this.setTexture2D(n,0),t.isDataTexture?Le.texSubImage2D(Le.TEXTURE_2D,r||0,e.x,e.y,o,a,i,s,t.image.data):Le.texSubImage2D(Le.TEXTURE_2D,r||0,e.x,e.y,i,s,t.image)}}function $t(e,t){this.name="",this.color=new g(e),this.density=void 0!==t?t:25e-5}function vt(e,t,n){this.name="",this.color=new g(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function yt(){b.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.background=null,this.autoUpdate=!0}function _t(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function bt(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function xt(e){F.call(this),this.type="SpriteMaterial",this.color=new g(16777215),this.map=null,this.rotation=0,this.lights=!1,this.transparent=!0,this.setValues(e)}function wt(e){if(b.call(this),this.type="Sprite",void 0===wa){wa=new k;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);t=new _t(t,5),wa.setIndex([0,1,2,0,2,3]),wa.addAttribute("position",new bt(t,3,0,!1)),wa.addAttribute("uv",new bt(t,2,3,!1))}this.geometry=wa,this.material=void 0!==e?e:new xt,this.center=new n(.5,.5)}function St(){b.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Mt(e,t){if(this.bones=(e=e||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new r)}function Et(){b.call(this),this.type="Bone"}function Tt(e,t){q.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new r,this.bindMatrixInverse=new r,e=new Mt(e=this.initBones()),this.bind(e,this.matrixWorld),this.normalizeSkinWeights()}function Ct(e){F.call(this),this.type="LineBasicMaterial",this.color=new g(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.lights=!1,this.setValues(e),this.attributes=["position","color"]}function Pt(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),b.call(this),this.type="Line",this.geometry=void 0!==e?e:new k,this.material=void 0!==t?t:new Ct({color:16777215*Math.random()})}function At(e,t){Pt.call(this,e,t),this.type="LineSegments"}function Lt(e,t){Pt.call(this,e,t),this.type="LineLoop"}function Rt(e){F.call(this),this.type="PointsMaterial",this.color=new g(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=this.morphTargets=!1,this.setValues(e)}function Dt(e,t){b.call(this),this.type="Points",this.geometry=void 0!==e?e:new k,this.material=void 0!==t?t:new Rt({color:16777215*Math.random()})}function It(e,t,n,r,o,a,i,l,u){s.call(this,e,t,n,r,o,a,i,l,u),this.generateMipmaps=!1}function Ot(e,t,n,r,o,a,i,l,u,c,d,p){s.call(this,null,a,i,l,u,c,r,o,d,p),this.image={width:t,height:n},this.mipmaps=e,this.generateMipmaps=this.flipY=!1}function Nt(e,t,n,r,o,a,i,l,u){s.call(this,e,t,n,r,o,a,i,l,u),this.needsUpdate=!0}function Ut(e,t,n,r,o,a,i,l,u,c){if(1026!==(c=void 0!==c?c:1026)&&1027!==c)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===c&&(n=1012),void 0===n&&1027===c&&(n=1020),s.call(this,null,r,o,a,i,l,c,n,u),this.image={width:e,height:t},this.magFilter=void 0!==i?i:1003,this.minFilter=void 0!==l?l:1003,this.generateMipmaps=this.flipY=!1}function kt(e){k.call(this),this.type="WireframeGeometry";var t,n,r,o=[],i=[0,0],s={},l=["a","b","c"];if(e&&e.isGeometry){var u=e.faces,c=0;for(n=u.length;c<n;c++){var d=u[c];for(t=0;3>t;t++){var p=d[l[t]],h=d[l[(t+1)%3]];i[0]=Math.min(p,h),i[1]=Math.max(p,h),void 0===s[p=i[0]+","+i[1]]&&(s[p]={index1:i[0],index2:i[1]})}}for(p in s)o.push((l=e.vertices[(c=s[p]).index1]).x,l.y,l.z),o.push((l=e.vertices[c.index2]).x,l.y,l.z)}else if(e&&e.isBufferGeometry)if(l=new a,null!==e.index){u=e.attributes.position,d=e.index;var m=e.groups;for(0===m.length&&(m=[{start:0,count:d.count,materialIndex:0}]),e=0,r=m.length;e<r;++e)for(n=(c=m[e]).count,c=t=c.start,n=t+n;c<n;c+=3)for(t=0;3>t;t++)p=d.getX(c+t),h=d.getX(c+(t+1)%3),i[0]=Math.min(p,h),i[1]=Math.max(p,h),void 0===s[p=i[0]+","+i[1]]&&(s[p]={index1:i[0],index2:i[1]});for(p in s)l.fromBufferAttribute(u,(c=s[p]).index1),o.push(l.x,l.y,l.z),l.fromBufferAttribute(u,c.index2),o.push(l.x,l.y,l.z)}else for(c=0,n=(u=e.attributes.position).count/3;c<n;c++)for(t=0;3>t;t++)l.fromBufferAttribute(u,s=3*c+t),o.push(l.x,l.y,l.z),l.fromBufferAttribute(u,s=3*c+(t+1)%3),o.push(l.x,l.y,l.z);this.addAttribute("position",new I(o,3))}function Ht(e,t,n){M.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Gt(e,t,n)),this.mergeVertices()}function Gt(e,t,n){k.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r,o,i=[],s=[],l=[],u=[],c=new a,d=new a,p=new a,h=new a,m=new a;3>e.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=t+1;for(r=0;r<=n;r++){var g=r/n;for(o=0;o<=t;o++){var $=o/t;e($,g,d),s.push(d.x,d.y,d.z),0<=$-1e-5?(e($-1e-5,g,p),h.subVectors(d,p)):(e($+1e-5,g,p),h.subVectors(p,d)),0<=g-1e-5?(e($,g-1e-5,p),m.subVectors(d,p)):(e($,g+1e-5,p),m.subVectors(p,d)),c.crossVectors(h,m).normalize(),l.push(c.x,c.y,c.z),u.push($,g)}}for(r=0;r<n;r++)for(o=0;o<t;o++)c=(r+1)*f+o+1,i.push(r*f+o,e=r*f+o+1,d=(r+1)*f+o),i.push(e,c,d);this.setIndex(i),this.addAttribute("position",new I(s,3)),this.addAttribute("normal",new I(l,3)),this.addAttribute("uv",new I(u,2))}function Vt(e,t,n,r){M.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new jt(e,t,n,r)),this.mergeVertices()}function jt(e,t,r,o){function i(e){u.push(e.x,e.y,e.z)}function s(t,n){n.x=e[0+(t*=3)],n.y=e[t+1],n.z=e[t+2]}function l(e,t,n,r){0>r&&1===e.x&&(c[t]=e.x-1),0===n.x&&0===n.z&&(c[t]=r/2/Math.PI+.5)}k.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:o},r=r||1;var u=[],c=[];!function(e){for(var n=new a,r=new a,o=new a,l=0;l<t.length;l+=3){s(t[l+0],n),s(t[l+1],r),s(t[l+2],o);var u,c,d=n,p=r,h=o,m=Math.pow(2,e),f=[];for(c=0;c<=m;c++){f[c]=[];var g=d.clone().lerp(h,c/m),$=p.clone().lerp(h,c/m),v=m-c;for(u=0;u<=v;u++)f[c][u]=0===u&&c===m?g:g.clone().lerp($,u/v)}for(c=0;c<m;c++)for(u=0;u<2*(m-c)-1;u++)d=Math.floor(u/2),0==u%2?(i(f[c][d+1]),i(f[c+1][d]),i(f[c][d])):(i(f[c][d+1]),i(f[c+1][d+1]),i(f[c+1][d]))}}(o=o||0),function(e){for(var t=new a,n=0;n<u.length;n+=3)t.x=u[n+0],t.y=u[n+1],t.z=u[n+2],t.normalize().multiplyScalar(e),u[n+0]=t.x,u[n+1]=t.y,u[n+2]=t.z}(r),function(){for(var e=new a,t=0;t<u.length;t+=3)e.x=u[t+0],e.y=u[t+1],e.z=u[t+2],c.push(Math.atan2(e.z,-e.x)/2/Math.PI+.5,1-(Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5));e=new a,t=new a;for(var r=new a,o=new a,i=new n,s=new n,d=new n,p=0,h=0;p<u.length;p+=9,h+=6){e.set(u[p+0],u[p+1],u[p+2]),t.set(u[p+3],u[p+4],u[p+5]),r.set(u[p+6],u[p+7],u[p+8]),i.set(c[h+0],c[h+1]),s.set(c[h+2],c[h+3]),d.set(c[h+4],c[h+5]),o.copy(e).add(t).add(r).divideScalar(3);var m=Math.atan2(o.z,-o.x);l(i,h+0,e,m),l(s,h+2,t,m),l(d,h+4,r,m)}for(e=0;e<c.length;e+=6)t=c[e+0],r=c[e+2],o=c[e+4],i=Math.min(t,r,o),.9<Math.max(t,r,o)&&.1>i&&(.2>t&&(c[e+0]+=1),.2>r&&(c[e+2]+=1),.2>o&&(c[e+4]+=1))}(),this.addAttribute("position",new I(u,3)),this.addAttribute("normal",new I(u.slice(),3)),this.addAttribute("uv",new I(c,2)),0===o?this.computeVertexNormals():this.normalizeNormals()}function Ft(e,t){M.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new zt(e,t)),this.mergeVertices()}function zt(e,t){jt.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Bt(e,t){M.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Wt(e,t)),this.mergeVertices()}function Wt(e,t){jt.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Yt(e,t){M.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qt(e,t)),this.mergeVertices()}function qt(e,t){var n=(1+Math.sqrt(5))/2;jt.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Xt(e,t){M.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Zt(e,t)),this.mergeVertices()}function Zt(e,t){var n=(1+Math.sqrt(5))/2,r=1/n;jt.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Jt(e,t,n,r,o,a){M.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:o},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed."),e=new Kt(e,t,n,r,o),this.tangents=e.tangents,this.normals=e.normals,this.binormals=e.binormals,this.fromBufferGeometry(e),this.mergeVertices()}function Kt(e,t,r,o,i){function s(n){m=e.getPointAt(n/t,m);var a=l.normals[n];for(n=l.binormals[n],c=0;c<=o;c++){var i=c/o*Math.PI*2,s=Math.sin(i);i=-Math.cos(i),p.x=i*a.x+s*n.x,p.y=i*a.y+s*n.y,p.z=i*a.z+s*n.z,p.normalize(),g.push(p.x,p.y,p.z),d.x=m.x+r*p.x,d.y=m.y+r*p.y,d.z=m.z+r*p.z,f.push(d.x,d.y,d.z)}}k.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:o,closed:i},r=r||1,o=o||8;var l=e.computeFrenetFrames(t=t||64,i=i||!1);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;var u,c,d=new a,p=new a,h=new n,m=new a,f=[],g=[],$=[],v=[];for(u=0;u<t;u++)s(u);for(s(!1===i?t:0),u=0;u<=t;u++)for(c=0;c<=o;c++)h.x=u/t,h.y=c/o,$.push(h.x,h.y);!function(){for(c=1;c<=t;c++)for(u=1;u<=o;u++){var e=(o+1)*c+(u-1),n=(o+1)*c+u,r=(o+1)*(c-1)+u;v.push((o+1)*(c-1)+(u-1),e,r),v.push(e,n,r)}}(),this.setIndex(v),this.addAttribute("position",new I(f,3)),this.addAttribute("normal",new I(g,3)),this.addAttribute("uv",new I($,2))}function Qt(e,t,n,r,o,a,i){M.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:o,q:a},void 0!==i&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new en(e,t,n,r,o,a)),this.mergeVertices()}function en(e,t,n,r,o,i){function s(e,t,n,r,o){var a=Math.sin(e);t=n/t*e,n=Math.cos(t),o.x=r*(2+n)*.5*Math.cos(e),o.y=r*(2+n)*a*.5,o.z=r*Math.sin(t)*.5}k.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:o,q:i},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,o=o||2,i=i||3;var l,u=[],c=[],d=[],p=[],h=new a,m=new a,f=new a,g=new a,$=new a,v=new a,y=new a;for(l=0;l<=n;++l){var _=l/n*o*Math.PI*2;for(s(_,o,i,e,f),s(_+.01,o,i,e,g),v.subVectors(g,f),y.addVectors(g,f),$.crossVectors(v,y),y.crossVectors($,v),$.normalize(),y.normalize(),_=0;_<=r;++_){var b=_/r*Math.PI*2,x=-t*Math.cos(b);b=t*Math.sin(b),h.x=f.x+(x*y.x+b*$.x),h.y=f.y+(x*y.y+b*$.y),h.z=f.z+(x*y.z+b*$.z),c.push(h.x,h.y,h.z),m.subVectors(h,f).normalize(),d.push(m.x,m.y,m.z),p.push(l/n),p.push(_/r)}}for(_=1;_<=n;_++)for(l=1;l<=r;l++)t=(r+1)*_+l,u.push((r+1)*(_-1)+(l-1),e=(r+1)*_+(l-1),o=(r+1)*(_-1)+l),u.push(e,t,o);this.setIndex(u),this.addAttribute("position",new I(c,3)),this.addAttribute("normal",new I(d,3)),this.addAttribute("uv",new I(p,2))}function tn(e,t,n,r,o){M.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:o},this.fromBufferGeometry(new nn(e,t,n,r,o)),this.mergeVertices()}function nn(e,t,n,r,o){k.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:o},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,o=o||2*Math.PI;var i,s,l=[],u=[],c=[],d=[],p=new a,h=new a,m=new a;for(i=0;i<=n;i++)for(s=0;s<=r;s++){var f=s/r*o,g=i/n*Math.PI*2;h.x=(e+t*Math.cos(g))*Math.cos(f),h.y=(e+t*Math.cos(g))*Math.sin(f),h.z=t*Math.sin(g),u.push(h.x,h.y,h.z),p.x=e*Math.cos(f),p.y=e*Math.sin(f),m.subVectors(h,p).normalize(),c.push(m.x,m.y,m.z),d.push(s/r),d.push(i/n)}for(i=1;i<=n;i++)for(s=1;s<=r;s++)t=(r+1)*(i-1)+s,l.push((r+1)*i+s-1,e=(r+1)*(i-1)+s-1,o=(r+1)*i+s),l.push(e,t,o);this.setIndex(l),this.addAttribute("position",new I(u,3)),this.addAttribute("normal",new I(c,3)),this.addAttribute("uv",new I(d,2))}function rn(e,t,n,r,o){for(var a,i=0,s=t,l=n-r;s<n;s+=r)i+=(e[l]-e[s])*(e[s+1]+e[l+1]),l=s;if(o===0<i)for(o=t;o<n;o+=r)a=gn(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=gn(o,e[o],e[o+1],a);return a&&pn(a,a.next)&&($n(a),a=a.next),a}function on(e,t){if(!e)return e;t||(t=e);do{var n=!1;if(e.steiner||!pn(e,e.next)&&0!==dn(e.prev,e,e.next))e=e.next;else{if($n(e),(e=t=e.prev)===e.next)break;n=!0}}while(n||e!==t);return t}function an(e,t){return e.x-t.x}function sn(e,t){var n=t,r=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var i=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(i<=r&&i>a){if(a=i,i===r){if(o===n.y)return n;if(o===n.next.y)return n.next}var s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!s)return null;if(r===a)return s.prev;t=s,i=s.x;var l=s.y,u=1/0;for(n=s.next;n!==t;){if(r>=n.x&&n.x>=i&&r!==n.x&&cn(o<l?r:a,o,i,l,o<l?a:r,o,n.x,n.y)){var c=Math.abs(o-n.y)/(r-n.x);(c<u||c===u&&n.x>s.x)&&mn(n,e)&&(s=n,u=c)}n=n.next}return s}function ln(e,t,n,r,o){return 1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1)|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function un(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function cn(e,t,n,r,o,a,i,s){return 0<=(o-i)*(t-s)-(e-i)*(a-s)&&0<=(e-i)*(r-s)-(n-i)*(t-s)&&0<=(n-i)*(a-s)-(o-i)*(r-s)}function dn(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function pn(e,t){return e.x===t.x&&e.y===t.y}function hn(e,t,n,r){return!!(pn(e,t)&&pn(n,r)||pn(e,r)&&pn(n,t))||0<dn(e,t,n)!=0<dn(e,t,r)&&0<dn(n,r,e)!=0<dn(n,r,t)}function mn(e,t){return 0>dn(e.prev,e,e.next)?0<=dn(e,t,e.next)&&0<=dn(e,e.prev,t):0>dn(e,t,e.prev)||0>dn(e,e.next,t)}function fn(e,t){var n=new vn(e.i,e.x,e.y),r=new vn(t.i,t.x,t.y),o=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function gn(e,t,n,r){return e=new vn(e,t,n),r?(e.next=r.next,e.prev=r,r.next.prev=e,r.next=e):(e.prev=e,e.next=e),e}function $n(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vn(e,t,n){this.i=e,this.x=t,this.y=n,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function yn(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function _n(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function bn(e,t){M.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new xn(e,t)),this.mergeVertices()}function xn(e,t){function r(e){function r(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}function l(e,t,r){var o=e.x-t.x,a=e.y-t.y,i=r.x-e.x,s=r.y-e.y,l=o*o+a*a;if(Math.abs(o*s-a*i)>Number.EPSILON){var u=Math.sqrt(l),c=Math.sqrt(i*i+s*s);if(2>=(a=(i=(l=t.x-a/u)+o*(s=((r.x-s/c-l)*s-(r.y+i/c-(t=t.y+o/u))*i)/(o*s-a*i))-e.x)*i+(o=t+a*s-e.y)*o))return new n(i,o);a=Math.sqrt(a/2)}else e=!1,o>Number.EPSILON?i>Number.EPSILON&&(e=!0):o<-Number.EPSILON?i<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(s)&&(e=!0),e?(i=-a,a=Math.sqrt(l)):(i=o,o=a,a=Math.sqrt(l/2));return new n(i/a,o/a)}function u(e,t){for(G=e.length;0<=--G;){var n=G,r=G-1;0>r&&(r=e.length-1);var a,s=g+2*b;for(a=0;a<s;a++){var l=k*a,u=k*(a+1),c=t+r+l,d=t+r+u;u=t+n+u,p(t+n+l),p(c),p(u),p(c),p(d),p(u),h((l=w.generateSideWallUV(o,i,(l=i.length/3)-6,l-3,l-2,l-1))[0]),h(l[1]),h(l[3]),h(l[1]),h(l[2]),h(l[3])}}}function c(e,t,n){m.push(e),m.push(t),m.push(n)}function d(e,t,n){p(e),p(t),p(n),h((e=w.generateTopUV(o,i,(e=i.length/3)-3,e-2,e-1))[0]),h(e[1]),h(e[2])}function p(e){i.push(m[3*e]),i.push(m[3*e+1]),i.push(m[3*e+2])}function h(e){s.push(e.x),s.push(e.y)}var m=[],f=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,$=void 0!==t.depth?t.depth:100,v=void 0===t.bevelEnabled||t.bevelEnabled,y=void 0!==t.bevelThickness?t.bevelThickness:6,_=void 0!==t.bevelSize?t.bevelSize:y-2,b=void 0!==t.bevelSegments?t.bevelSegments:3,x=t.extrudePath,w=void 0!==t.UVGenerator?t.UVGenerator:Ea;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),$=t.amount);var S,M=!1;if(x){var E=x.getSpacedPoints(g);M=!0,v=!1;var T=x.computeFrenetFrames(g,!1),C=new a,P=new a,A=new a}v||(_=y=b=0);var L=(f=e.extractPoints(f)).holes;if(!Ma.isClockWise(e=f.shape)){e=e.reverse();var R=0;for(S=L.length;R<S;R++){var D=L[R];Ma.isClockWise(D)&&(L[R]=D.reverse())}}var I=Ma.triangulateShape(e,L),O=e;for(R=0,S=L.length;R<S;R++)e=e.concat(D=L[R]);var N,U,k=e.length,H=I.length;f=[];var G=0,V=O.length,j=V-1;for(N=G+1;G<V;G++,j++,N++)j===V&&(j=0),N===V&&(N=0),f[G]=l(O[G],O[j],O[N]);x=[];var F=f.concat();for(R=0,S=L.length;R<S;R++){var z=[];for(j=(V=(D=L[R]).length)-1,N=1+(G=0);G<V;G++,j++,N++)j===V&&(j=0),N===V&&(N=0),z[G]=l(D[G],D[j],D[N]);x.push(z),F=F.concat(z)}for(j=0;j<b;j++){V=j/b;var B=y*Math.cos(V*Math.PI/2);for(N=_*Math.sin(V*Math.PI/2),G=0,V=O.length;G<V;G++){var W=r(O[G],f[G],N);c(W.x,W.y,-B)}for(R=0,S=L.length;R<S;R++)for(z=x[R],G=0,V=(D=L[R]).length;G<V;G++)c((W=r(D[G],z[G],N)).x,W.y,-B)}for(N=_,G=0;G<k;G++)W=v?r(e[G],F[G],N):e[G],M?(P.copy(T.normals[0]).multiplyScalar(W.x),C.copy(T.binormals[0]).multiplyScalar(W.y),A.copy(E[0]).add(P).add(C),c(A.x,A.y,A.z)):c(W.x,W.y,0);for(V=1;V<=g;V++)for(G=0;G<k;G++)W=v?r(e[G],F[G],N):e[G],M?(P.copy(T.normals[V]).multiplyScalar(W.x),C.copy(T.binormals[V]).multiplyScalar(W.y),A.copy(E[V]).add(P).add(C),c(A.x,A.y,A.z)):c(W.x,W.y,$/g*V);for(j=b-1;0<=j;j--){for(V=j/b,B=y*Math.cos(V*Math.PI/2),N=_*Math.sin(V*Math.PI/2),G=0,V=O.length;G<V;G++)c((W=r(O[G],f[G],N)).x,W.y,$+B);for(R=0,S=L.length;R<S;R++)for(z=x[R],G=0,V=(D=L[R]).length;G<V;G++)W=r(D[G],z[G],N),M?c(W.x,W.y+E[g-1].y,E[g-1].x+B):c(W.x,W.y,$+B)}!function(){var e=i.length/3;if(v){var t=0*k;for(G=0;G<H;G++)d((U=I[G])[2]+t,U[1]+t,U[0]+t);for(t=k*(g+2*b),G=0;G<H;G++)d((U=I[G])[0]+t,U[1]+t,U[2]+t)}else{for(G=0;G<H;G++)d((U=I[G])[2],U[1],U[0]);for(G=0;G<H;G++)d((U=I[G])[0]+k*g,U[1]+k*g,U[2]+k*g)}o.addGroup(e,i.length/3-e,0)}(),function(){var e=i.length/3,t=0;for(u(O,t),t+=O.length,R=0,S=L.length;R<S;R++)u(D=L[R],t),t+=D.length;o.addGroup(e,i.length/3-e,1)}()}k.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var o=this,i=[],s=[],l=0,u=e.length;l<u;l++)r(e[l]);this.addAttribute("position",new I(i,3)),this.addAttribute("uv",new I(s,2)),this.computeVertexNormals()}function wn(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,o=e.length;r<o;r++)n.shapes.push(e[r].uuid);else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function Sn(e,t){M.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Mn(e,t)),this.mergeVertices()}function Mn(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new M;e=n.generateShapes(e,t.size),t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),xn.call(this,e,t),this.type="TextBufferGeometry"}function En(e,t,n,r,o,a,i){M.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:o,thetaStart:a,thetaLength:i},this.fromBufferGeometry(new Tn(e,t,n,r,o,a,i)),this.mergeVertices()}function Tn(e,t,n,r,o,i,s){k.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:o,thetaStart:i,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI;var l,u,c=(i=void 0!==i?i:0)+(s=void 0!==s?s:Math.PI),d=0,p=[],h=new a,m=new a,f=[],g=[],$=[],v=[];for(u=0;u<=n;u++){var y=[],_=u/n;for(l=0;l<=t;l++){var b=l/t;h.x=-e*Math.cos(r+b*o)*Math.sin(i+_*s),h.y=e*Math.cos(i+_*s),h.z=e*Math.sin(r+b*o)*Math.sin(i+_*s),g.push(h.x,h.y,h.z),m.set(h.x,h.y,h.z).normalize(),$.push(m.x,m.y,m.z),v.push(b,1-_),y.push(d++)}p.push(y)}for(u=0;u<n;u++)for(l=0;l<t;l++)e=p[u][l+1],r=p[u][l],o=p[u+1][l],s=p[u+1][l+1],(0!==u||0<i)&&f.push(e,r,s),(u!==n-1||c<Math.PI)&&f.push(r,o,s);this.setIndex(f),this.addAttribute("position",new I(g,3)),this.addAttribute("normal",new I($,3)),this.addAttribute("uv",new I(v,2))}function Cn(e,t,n,r,o,a){M.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Pn(e,t,n,r,o,a)),this.mergeVertices()}function Pn(e,t,r,o,i,s){k.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:o,thetaStart:i,thetaLength:s},e=e||.5,t=t||1,i=void 0!==i?i:0,s=void 0!==s?s:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var l,u,c=[],d=[],p=[],h=[],m=e,f=(t-e)/(o=void 0!==o?Math.max(1,o):1),g=new a,$=new n;for(l=0;l<=o;l++){for(u=0;u<=r;u++)e=i+u/r*s,g.x=m*Math.cos(e),g.y=m*Math.sin(e),d.push(g.x,g.y,g.z),p.push(0,0,1),$.x=(g.x/t+1)/2,$.y=(g.y/t+1)/2,h.push($.x,$.y);m+=f}for(l=0;l<o;l++)for(t=l*(r+1),u=0;u<r;u++)s=(e=u+t)+r+2,c.push(e,i=e+r+1,m=e+1),c.push(i,s,m);this.setIndex(c),this.addAttribute("position",new I(d,3)),this.addAttribute("normal",new I(p,3)),this.addAttribute("uv",new I(h,2))}function An(e,t,n,r){M.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new Ln(e,t,n,r)),this.mergeVertices()}function Ln(e,t,r,o){k.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:o},t=Math.floor(t)||12,r=r||0,o=o||2*Math.PI,o=Xo.clamp(o,0,2*Math.PI);var i,s=[],l=[],u=[],c=1/t,d=new a,p=new n;for(i=0;i<=t;i++){var h=r+i*c*o,m=Math.sin(h),f=Math.cos(h);for(h=0;h<=e.length-1;h++)d.x=e[h].x*m,d.y=e[h].y,d.z=e[h].x*f,l.push(d.x,d.y,d.z),p.x=i/t,p.y=h/(e.length-1),u.push(p.x,p.y)}for(i=0;i<t;i++)for(h=0;h<e.length-1;h++)d=(r=h+i*e.length)+e.length+1,s.push(r,c=r+e.length,p=r+1),s.push(c,d,p);if(this.setIndex(s),this.addAttribute("position",new I(l,3)),this.addAttribute("uv",new I(u,2)),this.computeVertexNormals(),o===2*Math.PI)for(o=this.attributes.normal.array,s=new a,l=new a,u=new a,r=t*e.length*3,h=i=0;i<e.length;i++,h+=3)s.x=o[h+0],s.y=o[h+1],s.z=o[h+2],l.x=o[r+h+0],l.y=o[r+h+1],l.z=o[r+h+2],u.addVectors(s,l).normalize(),o[h+0]=o[r+h+0]=u.x,o[h+1]=o[r+h+1]=u.y,o[h+2]=o[r+h+2]=u.z}function Rn(e,t){M.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Dn(e,t)),this.mergeVertices()}function Dn(e,t){function n(e){var n,s=o.length/3,u=(e=e.extractPoints(t)).shape,c=e.holes;if(!1===Ma.isClockWise(u))for(u=u.reverse(),e=0,n=c.length;e<n;e++){var d=c[e];!0===Ma.isClockWise(d)&&(c[e]=d.reverse())}var p=Ma.triangulateShape(u,c);for(e=0,n=c.length;e<n;e++)u=u.concat(d=c[e]);for(e=0,n=u.length;e<n;e++)o.push((d=u[e]).x,d.y,0),a.push(0,0,1),i.push(d.x,d.y);for(e=0,n=p.length;e<n;e++)r.push((u=p[e])[0]+s,u[1]+s,u[2]+s),l+=3}k.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],o=[],a=[],i=[],s=0,l=0;if(!1===Array.isArray(e))n(e);else for(var u=0;u<e.length;u++)n(e[u]),this.addGroup(s,l,u),s+=l,l=0;this.setIndex(r),this.addAttribute("position",new I(o,3)),this.addAttribute("normal",new I(a,3)),this.addAttribute("uv",new I(i,2))}function In(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++)t.shapes.push(e[n].uuid);else t.shapes.push(e.uuid);return t}function On(e,t){k.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t};var n=[];t=Math.cos(Xo.DEG2RAD*(void 0!==t?t:1));var r=[0,0],o={},a=["a","b","c"];if(e.isBufferGeometry){var i=new M;i.fromBufferGeometry(e)}else i=e.clone();i.mergeVertices(),i.computeFaceNormals(),e=i.vertices;for(var s=0,l=(i=i.faces).length;s<l;s++)for(var u=i[s],c=0;3>c;c++){var d=u[a[c]],p=u[a[(c+1)%3]];r[0]=Math.min(d,p),r[1]=Math.max(d,p),void 0===o[d=r[0]+","+r[1]]?o[d]={index1:r[0],index2:r[1],face1:s,face2:void 0}:o[d].face2=s}for(d in o)(void 0===(r=o[d]).face2||i[r.face1].normal.dot(i[r.face2].normal)<=t)&&(n.push((a=e[r.index1]).x,a.y,a.z),n.push((a=e[r.index2]).x,a.y,a.z));this.addAttribute("position",new I(n,3))}function Nn(e,t,n,r,o,a,i,s){M.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:o,openEnded:a,thetaStart:i,thetaLength:s},this.fromBufferGeometry(new Un(e,t,n,r,o,a,i,s)),this.mergeVertices()}function Un(e,t,r,o,i,s,l,u){function c(r){var i,s=new n,c=new a,$=0,_=!0===r?e:t,b=!0===r?1:-1,x=g;for(i=1;i<=o;i++)h.push(0,v*b,0),m.push(0,b,0),f.push(.5,.5),g++;var w=g;for(i=0;i<=o;i++){var S=i/o*u+l,M=Math.cos(S);S=Math.sin(S),c.x=_*S,c.y=v*b,c.z=_*M,h.push(c.x,c.y,c.z),m.push(0,b,0),s.x=.5*M+.5,s.y=.5*S*b+.5,f.push(s.x,s.y),g++}for(i=0;i<o;i++)s=x+i,c=w+i,!0===r?p.push(c,c+1,s):p.push(c+1,c,s),$+=3;d.addGroup(y,$,!0===r?1:2),y+=$}k.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:o,heightSegments:i,openEnded:s,thetaStart:l,thetaLength:u};var d=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,o=Math.floor(o)||8,i=Math.floor(i)||1,s=void 0!==s&&s,l=void 0!==l?l:0,u=void 0!==u?u:2*Math.PI;var p=[],h=[],m=[],f=[],g=0,$=[],v=r/2,y=0;!function(){var n,s,c=new a,_=new a,b=0,x=(t-e)/r;for(s=0;s<=i;s++){var w=[],S=s/i,M=S*(t-e)+e;for(n=0;n<=o;n++){var E=n/o,T=E*u+l,C=Math.sin(T);T=Math.cos(T),_.x=M*C,_.y=-S*r+v,_.z=M*T,h.push(_.x,_.y,_.z),c.set(C,x,T).normalize(),m.push(c.x,c.y,c.z),f.push(E,1-S),w.push(g++)}$.push(w)}for(n=0;n<o;n++)for(s=0;s<i;s++)_=$[s+1][n+1],p.push($[s][n],c=$[s+1][n],x=$[s][n+1]),p.push(c,_,x),b+=6;d.addGroup(y,b,0),y+=b}(),!1===s&&(0<e&&c(!0),0<t&&c(!1)),this.setIndex(p),this.addAttribute("position",new I(h,3)),this.addAttribute("normal",new I(m,3)),this.addAttribute("uv",new I(f,2))}function kn(e,t,n,r,o,a,i){Nn.call(this,0,e,t,n,r,o,a,i),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:i}}function Hn(e,t,n,r,o,a,i){Un.call(this,0,e,t,n,r,o,a,i),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:i}}function Gn(e,t,n,r){M.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new Vn(e,t,n,r)),this.mergeVertices()}function Vn(e,t,r,o){k.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:o},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI;var i,s=[],l=[],u=[],c=[],d=new a,p=new n;l.push(0,0,0),u.push(0,0,1),c.push(.5,.5);var h=0;for(i=3;h<=t;h++,i+=3){var m=r+h/t*o;d.x=e*Math.cos(m),d.y=e*Math.sin(m),l.push(d.x,d.y,d.z),u.push(0,0,1),p.x=(l[i]/e+1)/2,p.y=(l[i+1]/e+1)/2,c.push(p.x,p.y)}for(i=1;i<=t;i++)s.push(i,i+1,0);this.setIndex(s),this.addAttribute("position",new I(l,3)),this.addAttribute("normal",new I(u,3)),this.addAttribute("uv",new I(c,2))}function jn(e){F.call(this),this.type="ShadowMaterial",this.color=new g(0),this.transparent=!0,this.setValues(e)}function Fn(e){B.call(this,e),this.type="RawShaderMaterial"}function zn(e){F.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new g(16777215),this.metalness=this.roughness=.5,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new g(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Bn(e){zn.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoatRoughness=this.clearCoat=0,this.setValues(e)}function Wn(e){F.call(this),this.type="MeshPhongMaterial",this.color=new g(16777215),this.specular=new g(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new g(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Yn(e){Wn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function qn(e){F.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new n(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1,this.setValues(e),this.attributes=["position","normal"]}function Xn(e){F.call(this),this.type="MeshLambertMaterial",this.color=new g(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new g(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Zn(e){Ct.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function Jn(e,t,n){var r=this,o=!1,a=0,i=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){i++,!1===o&&void 0!==r.onStart&&r.onStart(e,a,i),o=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,i),a===i&&(o=!1,void 0!==r.onLoad)&&r.onLoad()},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}function Kn(e){this.manager=void 0!==e?e:Aa}function Qn(e){this.manager=void 0!==e?e:Aa,this._parser=null}function er(e){this.manager=void 0!==e?e:Aa,this._parser=null}function tr(e){this.manager=void 0!==e?e:Aa}function nr(e){this.manager=void 0!==e?e:Aa}function rr(e){this.manager=void 0!==e?e:Aa}function or(){this.type="Curve",this.arcLengthDivisions=200}function ar(e,t,n,r,o,a,i,s){or.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=o||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=i||!1,this.aRotation=s||0}function ir(e,t,n,r,o,a){ar.call(this,e,t,n,n,r,o,a),this.type="ArcCurve"}function sr(){var e=0,t=0,n=0,r=0;return{initCatmullRom:function(o,a,i,s,l){e=a,t=o=l*(i-o),n=-3*a+3*i-2*o-(s=l*(s-a)),r=2*a-2*i+o+s},initNonuniformCatmullRom:function(o,a,i,s,l,u,c){e=a,t=o=((a-o)/l-(i-o)/(l+u)+(i-a)/u)*u,n=-3*a+3*i-2*o-(s=((i-a)/u-(s-a)/(u+c)+(s-i)/c)*u),r=2*a-2*i+o+s},calc:function(o){var a=o*o;return e+t*o+n*a+r*a*o}}}function lr(e,t,n,r){or.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function ur(e,t,n,r,o){var a=e*e;return(2*n-2*r+(t=.5*(r-t))+(o=.5*(o-n)))*e*a+(-3*n+3*r-2*t-o)*a+t*e+n}function cr(e,t,n,r){var o=1-e;return o*o*t+2*(1-e)*e*n+e*e*r}function dr(e,t,n,r,o){var a=1-e,i=1-e;return a*a*a*t+3*i*i*e*n+3*(1-e)*e*e*r+e*e*e*o}function pr(e,t,r,o){or.call(this),this.type="CubicBezierCurve",this.v0=e||new n,this.v1=t||new n,this.v2=r||new n,this.v3=o||new n}function hr(e,t,n,r){or.call(this),this.type="CubicBezierCurve3",this.v0=e||new a,this.v1=t||new a,this.v2=n||new a,this.v3=r||new a}function mr(e,t){or.call(this),this.type="LineCurve",this.v1=e||new n,this.v2=t||new n}function fr(e,t){or.call(this),this.type="LineCurve3",this.v1=e||new a,this.v2=t||new a}function gr(e,t,r){or.call(this),this.type="QuadraticBezierCurve",this.v0=e||new n,this.v1=t||new n,this.v2=r||new n}function $r(e,t,n){or.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new a,this.v1=t||new a,this.v2=n||new a}function vr(e){or.call(this),this.type="SplineCurve",this.points=e||[]}function yr(){or.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function _r(e){yr.call(this),this.type="Path",this.currentPoint=new n,e&&this.setFromPoints(e)}function br(e){_r.call(this,e),this.uuid=Xo.generateUUID(),this.type="Shape",this.holes=[]}function xr(e,t){b.call(this),this.type="Light",this.color=new g(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function wr(e,t,n){xr.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(b.DefaultUp),this.updateMatrix(),this.groundColor=new g(t)}function Sr(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new n(512,512),this.map=null,this.matrix=new r}function Mr(){Sr.call(this,new pt(50,1,.5,500))}function Er(e,t,n,r,o,a){xr.call(this,e,t),this.type="SpotLight",this.position.copy(b.DefaultUp),this.updateMatrix(),this.target=new b,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==o?o:0,this.decay=void 0!==a?a:1,this.shadow=new Mr}function Tr(e,t,n,r){xr.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new Sr(new pt(90,1,.5,500))}function Cr(){Sr.call(this,new w(-5,5,5,-5,.5,500))}function Pr(e,t){xr.call(this,e,t),this.type="DirectionalLight",this.position.copy(b.DefaultUp),this.updateMatrix(),this.target=new b,this.shadow=new Cr}function Ar(e,t){xr.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Lr(e,t,n,r){xr.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function Rr(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Dr(e,t,n,r){Rr.call(this,e,t,n,r),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Ir(e,t,n,r){Rr.call(this,e,t,n,r)}function Or(e,t,n,r){Rr.call(this,e,t,n,r)}function Nr(e,t,n,r){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ua.convertArray(t,this.TimeBufferType),this.values=Ua.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Ur(e,t,n){Nr.call(this,e,t,n)}function kr(e,t,n,r){Nr.call(this,e,t,n,r)}function Hr(e,t,n,r){Nr.call(this,e,t,n,r)}function Gr(e,t,n,r){Rr.call(this,e,t,n,r)}function Vr(e,t,n,r){Nr.call(this,e,t,n,r)}function jr(e,t,n,r){Nr.call(this,e,t,n,r)}function Fr(e,t,n,r){Nr.call(this,e,t,n,r)}function zr(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Xo.generateUUID(),0>this.duration&&this.resetDuration()}function Br(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Hr;case"vector":case"vector2":case"vector3":case"vector4":return Fr;case"color":return kr;case"quaternion":return Vr;case"bool":case"boolean":return Ur;case"string":return jr}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];Ua.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function Wr(e){this.manager=void 0!==e?e:Aa,this.textures={}}function Yr(e){this.manager=void 0!==e?e:Aa}function qr(){}function Xr(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Aa,this.withCredentials=!1}function Zr(e){this.manager=void 0!==e?e:Aa,this.texturePath=""}function Jr(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Aa,this.options=void 0}function Kr(){this.type="ShapePath",this.color=new g,this.subPaths=[],this.currentPath=null}function Qr(e){this.type="Font",this.data=e}function eo(e){this.manager=void 0!==e?e:Aa}function to(e){this.manager=void 0!==e?e:Aa}function no(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new pt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new pt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function ro(e,t,n){b.call(this),this.type="CubeCamera";var r=new pt(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new a(1,0,0)),this.add(r);var o=new pt(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new a(-1,0,0)),this.add(o);var i=new pt(90,1,e,t);i.up.set(0,0,1),i.lookAt(new a(0,1,0)),this.add(i);var s=new pt(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new a(0,-1,0)),this.add(s);var l=new pt(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new a(0,0,1)),this.add(l);var u=new pt(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new a(0,0,-1)),this.add(u),this.renderTarget=new c(n,n,{format:1022,magFilter:1006,minFilter:1006}),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,a=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,o,n),n.activeCubeFace=2,e.render(t,i,n),n.activeCubeFace=3,e.render(t,s,n),n.activeCubeFace=4,e.render(t,l,n),n.texture.generateMipmaps=a,n.activeCubeFace=5,e.render(t,u,n),e.setRenderTarget(null)},this.clear=function(e,t,n,r){for(var o=this.renderTarget,a=0;6>a;a++)o.activeCubeFace=a,e.setRenderTarget(o),e.clear(t,n,r);e.setRenderTarget(null)}}function oo(){b.call(this),this.type="AudioListener",this.context=Wa.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function ao(e){b.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.offset=this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function io(e){ao.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function so(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function lo(e,t,n){switch(this.binding=e,this.valueSize=n,e=Float64Array,t){case"quaternion":t=this._slerp;break;case"string":case"bool":e=Array,t=this._select;break;default:t=this._lerp}this.buffer=new e(4*n),this._mixBufferRegion=t,this.referenceCount=this.useCount=this.cumulativeWeight=0}function uo(e,t,n){n=n||co.parseTrackName(t),this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function co(e,t,n){this.path=t,this.parsedPath=n||co.parseTrackName(t),this.node=co.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function po(){this.uuid=Xo.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function ho(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null,t=(e=t.tracks).length,n=Array(t);for(var r={endingStart:2400,endingEnd:2400},o=0;o!==t;++o){var a=e[o].createInterpolant(null);n[o]=a,a.settings=r}this._interpolantSettings=r,this._interpolants=n,this._propertyBindings=Array(t),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function mo(e){this._root=e,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function fo(e,t){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=t),this.value=e}function go(){k.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function $o(e,t,n){_t.call(this,e,t),this.meshPerAttribute=n||1}function vo(e,t,n){E.call(this,e,t),this.meshPerAttribute=n||1}function yo(e,t,n,r){this.ray=new W(e,t),this.near=n||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function _o(e,t){return e.distance-t.distance}function bo(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r)){r=0;for(var o=(e=e.children).length;r<o;r++)bo(e[r],t,n,!0)}}function xo(e){this.autoStart=void 0===e||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function wo(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function So(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}function Mo(e,t){this.min=void 0!==e?e:new n(1/0,1/0),this.max=void 0!==t?t:new n(-1/0,-1/0)}function Eo(e,t){this.start=void 0!==e?e:new a,this.end=void 0!==t?t:new a}function To(e){b.call(this),this.material=e,this.render=function(){}}function Co(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,e=void 0!==n?n:16711680,r=void 0!==r?r:1,t=0,(n=this.object.geometry)&&n.isGeometry?t=3*n.faces.length:n&&n.isBufferGeometry&&(t=n.attributes.normal.count),n=new k,t=new I(6*t,3),n.addAttribute("position",t),At.call(this,n,new Ct({color:e,linewidth:r})),this.matrixAutoUpdate=!1,this.update()}function Po(e,t){b.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,e=new k,t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var n=0,r=1;32>n;n++,r++){var o=n/32*Math.PI*2,a=r/32*Math.PI*2;t.push(Math.cos(o),Math.sin(o),1,Math.cos(a),Math.sin(a),1)}e.addAttribute("position",new I(t,3)),t=new Ct({fog:!1}),this.cone=new At(e,t),this.add(this.cone),this.update()}function Ao(e){for(var t=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new k,r=[],o=[],a=new g(0,0,1),i=new g(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(a.r,a.g,a.b),o.push(i.r,i.g,i.b))}n.addAttribute("position",new I(r,3)),n.addAttribute("color",new I(o,3)),r=new Ct({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0}),At.call(this,n,r),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Lo(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n,e=new Tn(t,4,2),t=new z({wireframe:!0,fog:!1}),q.call(this,e,t),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Ro(e,t){b.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,e=new Ct({fog:!1}),(t=new k).addAttribute("position",new E(new Float32Array(15),3)),this.line=new Pt(t,e),this.add(this.line),this.update()}function Do(e,t,n){b.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,(e=new Wt(t)).rotateY(.5*Math.PI),this.material=new z({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2),t=e.getAttribute("position"),t=new Float32Array(3*t.count),e.addAttribute("color",new E(t,3)),this.add(new q(e,this.material)),this.update()}function Io(e,t,n,r){e=e||10,t=t||10,n=new g(void 0!==n?n:4473924),r=new g(void 0!==r?r:8947848);var o=t/2,a=e/t,i=e/2;e=[];for(var s=[],l=0,u=0,c=-i;l<=t;l++,c+=a){e.push(-i,0,c,i,0,c),e.push(c,0,-i,c,0,i);var d=l===o?n:r;d.toArray(s,u),d.toArray(s,u+=3),d.toArray(s,u+=3),d.toArray(s,u+=3),u+=3}(t=new k).addAttribute("position",new I(e,3)),t.addAttribute("color",new I(s,3)),n=new Ct({vertexColors:2}),At.call(this,t,n)}function Oo(e,t,n,r,o,a){e=e||10,t=t||16,n=n||8,r=r||64,o=new g(void 0!==o?o:4473924),a=new g(void 0!==a?a:8947848);var i,s=[],l=[];for(i=0;i<=t;i++){var u=i/t*2*Math.PI,c=Math.sin(u)*e;u=Math.cos(u)*e,s.push(0,0,0),s.push(c,0,u);var d=1&i?o:a;l.push(d.r,d.g,d.b),l.push(d.r,d.g,d.b)}for(i=0;i<=n;i++){d=1&i?o:a;var p=e-e/n*i;for(t=0;t<r;t++)u=t/r*2*Math.PI,c=Math.sin(u)*p,u=Math.cos(u)*p,s.push(c,0,u),l.push(d.r,d.g,d.b),u=(t+1)/r*2*Math.PI,c=Math.sin(u)*p,u=Math.cos(u)*p,s.push(c,0,u),l.push(d.r,d.g,d.b)}(e=new k).addAttribute("position",new I(s,3)),e.addAttribute("color",new I(l,3)),s=new Ct({vertexColors:2}),At.call(this,e,s)}function No(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,e=void 0!==n?n:16776960,r=void 0!==r?r:1,t=0,(n=this.object.geometry)&&n.isGeometry?t=n.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead."),n=new k,t=new I(6*t,3),n.addAttribute("position",t),At.call(this,n,new Ct({color:e,linewidth:r})),this.matrixAutoUpdate=!1,this.update()}function Uo(e,t,n){b.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1),(e=new k).addAttribute("position",new I([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3)),t=new Ct({fog:!1}),this.lightPlane=new Pt(e,t),this.add(this.lightPlane),(e=new k).addAttribute("position",new I([0,0,0,0,0,1],3)),this.targetLine=new Pt(e,t),this.add(this.targetLine),this.update()}function ko(e){function t(e,t,r){n(e,r),n(t,r)}function n(e,t){a.push(0,0,0),i.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(a.length/3-1)}var r=new k,o=new Ct({color:16777215,vertexColors:1}),a=[],i=[],s={},l=new g(16755200),u=new g(16711680),c=new g(43775),d=new g(16777215),p=new g(3355443);t("n1","n2",l),t("n2","n4",l),t("n4","n3",l),t("n3","n1",l),t("f1","f2",l),t("f2","f4",l),t("f4","f3",l),t("f3","f1",l),t("n1","f1",l),t("n2","f2",l),t("n3","f3",l),t("n4","f4",l),t("p","n1",u),t("p","n2",u),t("p","n3",u),t("p","n4",u),t("u1","u2",c),t("u2","u3",c),t("u3","u1",c),t("c","t",d),t("p","c",p),t("cn1","cn2",p),t("cn3","cn4",p),t("cf1","cf2",p),t("cf3","cf4",p),r.addAttribute("position",new I(a,3)),r.addAttribute("color",new I(i,3)),At.call(this,r,o),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function Ho(e,t){this.object=e,void 0===t&&(t=16776960),e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var n=new Float32Array(24),r=new k;r.setIndex(new E(e,1)),r.addAttribute("position",new E(n,3)),At.call(this,r,new Ct({color:t})),this.matrixAutoUpdate=!1,this.update()}function Go(e,t){this.type="Box3Helper",this.box=e,e=void 0!==t?t:16776960,t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var n=new k;n.setIndex(new E(t,1)),n.addAttribute("position",new I([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),At.call(this,n,new Ct({color:e})),this.geometry.computeBoundingSphere()}function Vo(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t,e=void 0!==n?n:16776960,(t=new k).addAttribute("position",new I([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),t.computeBoundingSphere(),Pt.call(this,t,new Ct({color:e})),(t=new k).addAttribute("position",new I([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),t.computeBoundingSphere(),this.add(new q(t,new z({color:e,opacity:.2,transparent:!0,depthWrite:!1})))}function jo(e,t,n,r,o,a){b.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),void 0===o&&(o=.2*n),void 0===a&&(a=.2*o),void 0===za&&((za=new k).addAttribute("position",new I([0,0,0,0,1,0],3)),(Ba=new Un(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Pt(za,new Ct({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new q(Ba,new z({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,a)}function Fo(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e];(e=new k).addAttribute("position",new I(t,3)),e.addAttribute("color",new I([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),t=new Ct({vertexColors:2}),At.call(this,e,t)}function zo(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),lr.call(this,e),this.type="catmullrom",this.closed=!0}function Bo(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),lr.call(this,e),this.type="catmullrom"}function Wo(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),lr.call(this,e),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:0<e?1:+e}),0=="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&void 0!==(e=this._listeners[e])&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=0,r=(t=t.slice(0)).length;n<r;n++)t[n].call(this,e)}}}});var Yo,qo,Xo={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;256>t;t++)e[t]=(16>t?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&o]+e[o>>8&255]+e[o>>16&255]+e[o>>24&255]).toUpperCase()}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,o){return r+(e-t)*(o-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Xo.DEG2RAD},radToDeg:function(e){return e*Xo.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(n.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(n.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y;return this.x=(e=e.elements)[0]*t+e[3]*n+e[6],this.y=e[1]*t+e[4]*n+e[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(Yo=new n,qo=new n,function(e,t){return Yo.set(e,e),qo.set(t,t),this.clamp(Yo,qo)}),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return 0>e&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return t*t+(e=this.y-e.y)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t);t=Math.sin(t);var r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*t+e.x,this.y=r*t+o*n+e.y,this}}),Object.assign(r.prototype,{isMatrix4:!0,set:function(e,t,n,r,o,a,i,s,l,u,c,d,p,h,m,f){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=o,g[5]=a,g[9]=i,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=d,g[3]=p,g[7]=h,g[11]=m,g[15]=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new r).fromArray(this.elements)},copy:function(e){var t=this.elements;return t[0]=(e=e.elements)[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements;return t[12]=(e=e.elements)[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new a;return function(t){var n=this.elements,r=t.elements,o=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length();return t=1/e.setFromMatrixColumn(t,2).length(),n[0]=r[0]*o,n[1]=r[1]*o,n[2]=r[2]*o,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*t,n[9]=r[9]*t,n[10]=r[10]*t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,o=e.z,a=Math.cos(n);n=Math.sin(n);var i=Math.cos(r);r=Math.sin(r);var s=Math.cos(o);if(o=Math.sin(o),"XYZ"===e.order){e=a*s;var l=a*o,u=n*s,c=n*o;t[0]=i*s,t[4]=-i*o,t[8]=r,t[1]=l+u*r,t[5]=e-c*r,t[9]=-n*i,t[2]=c-e*r,t[6]=u+l*r,t[10]=a*i}else"YXZ"===e.order?(l=i*o,u=r*s,t[0]=(e=i*s)+(c=r*o)*n,t[4]=u*n-l,t[8]=a*r,t[1]=a*o,t[5]=a*s,t[9]=-n,t[2]=l*n-u,t[6]=c+e*n,t[10]=a*i):"ZXY"===e.order?(l=i*o,u=r*s,t[0]=(e=i*s)-(c=r*o)*n,t[4]=-a*o,t[8]=u+l*n,t[1]=l+u*n,t[5]=a*s,t[9]=c-e*n,t[2]=-a*r,t[6]=n,t[10]=a*i):"ZYX"===e.order?(e=a*s,l=a*o,u=n*s,c=n*o,t[0]=i*s,t[4]=u*r-l,t[8]=e*r+c,t[1]=i*o,t[5]=c*r+e,t[9]=l*r-u,t[2]=-r,t[6]=n*i,t[10]=a*i):"YZX"===e.order?(e=a*i,l=a*r,u=n*i,c=n*r,t[0]=i*s,t[4]=c-e*o,t[8]=u*o+l,t[1]=o,t[5]=a*s,t[9]=-n*s,t[2]=-r*s,t[6]=l*o+u,t[10]=e-c*o):"XZY"===e.order&&(e=a*i,l=a*r,u=n*i,c=n*r,t[0]=i*s,t[4]=-o,t[8]=r*s,t[1]=e*o+c,t[5]=a*s,t[9]=l*o-u,t[2]=u*o-l,t[6]=n*s,t[10]=c*o+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new a(0,0,0),t=new a(1,1,1);return function(n){return this.compose(e,n,t)}}(),lookAt:function(){var e=new a,t=new a,n=new a;return function(r,o,a){var i=this.elements;return n.subVectors(r,o),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(a,n),0===e.lengthSq()&&(1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(a,n)),e.normalize(),t.crossVectors(n,e),i[0]=e.x,i[4]=t.x,i[8]=n.x,i[1]=e.y,i[5]=t.y,i[9]=n.y,i[2]=e.z,i[6]=t.z,i[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements;e=n[0];var o=n[4],a=n[8],i=n[12],s=n[1],l=n[5],u=n[9],c=n[13],d=n[2],p=n[6],h=n[10],m=n[14],f=n[3],g=n[7],$=n[11];n=n[15];var v=r[0],y=r[4],_=r[8],b=r[12],x=r[1],w=r[5],S=r[9],M=r[13],E=r[2],T=r[6],C=r[10],P=r[14],A=r[3],L=r[7],R=r[11];return r=r[15],(t=this.elements)[0]=e*v+o*x+a*E+i*A,t[4]=e*y+o*w+a*T+i*L,t[8]=e*_+o*S+a*C+i*R,t[12]=e*b+o*M+a*P+i*r,t[1]=s*v+l*x+u*E+c*A,t[5]=s*y+l*w+u*T+c*L,t[9]=s*_+l*S+u*C+c*R,t[13]=s*b+l*M+u*P+c*r,t[2]=d*v+p*x+h*E+m*A,t[6]=d*y+p*w+h*T+m*L,t[10]=d*_+p*S+h*C+m*R,t[14]=d*b+p*M+h*P+m*r,t[3]=f*v+g*x+$*E+n*A,t[7]=f*y+g*w+$*T+n*L,t[11]=f*_+g*S+$*C+n*R,t[15]=f*b+g*M+$*P+n*r,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new a;return function(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],o=e[12],a=e[1],i=e[5],s=e[9],l=e[13],u=e[2],c=e[6],d=e[10],p=e[14];return e[3]*(+o*s*c-r*l*c-o*i*d+n*l*d+r*i*p-n*s*p)+e[7]*(+t*s*p-t*l*d+o*a*d-r*a*p+r*l*u-o*s*u)+e[11]*(+t*l*c-t*i*p-o*a*c+n*a*p+o*i*u-n*l*u)+e[15]*(-r*i*u-t*s*c+t*i*d+r*a*c-n*a*d+n*s*u)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements;e=r[0];var o=r[1],a=r[2],i=r[3],s=r[4],l=r[5],u=r[6],c=r[7],d=r[8],p=r[9],h=r[10],m=r[11],f=r[12],g=r[13],$=r[14],v=p*$*c-g*h*c+g*u*m-l*$*m-p*u*(r=r[15])+l*h*r,y=f*h*c-d*$*c-f*u*m+s*$*m+d*u*r-s*h*r,_=d*g*c-f*p*c+f*l*m-s*g*m-d*l*r+s*p*r,b=f*p*u-d*g*u-f*l*h+s*g*h+d*l*$-s*p*$,x=e*v+o*y+a*_+i*b;if(0===x){if(!0===t)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return n[0]=v*(t=1/x),n[1]=(g*h*i-p*$*i-g*a*m+o*$*m+p*a*r-o*h*r)*t,n[2]=(l*$*i-g*u*i+g*a*c-o*$*c-l*a*r+o*u*r)*t,n[3]=(p*u*i-l*h*i-p*a*c+o*h*c+l*a*m-o*u*m)*t,n[4]=y*t,n[5]=(d*$*i-f*h*i+f*a*m-e*$*m-d*a*r+e*h*r)*t,n[6]=(f*u*i-s*$*i-f*a*c+e*$*c+s*a*r-e*u*r)*t,n[7]=(s*h*i-d*u*i+d*a*c-e*h*c-s*a*m+e*u*m)*t,n[8]=_*t,n[9]=(f*p*i-d*g*i-f*o*m+e*g*m+d*o*r-e*p*r)*t,n[10]=(s*g*i-f*l*i+f*o*c-e*g*c-s*o*r+e*l*r)*t,n[11]=(d*l*i-s*p*i-d*o*c+e*p*c+s*o*m-e*l*m)*t,n[12]=b*t,n[13]=(d*g*a-f*p*a+f*o*h-e*g*h-d*o*$+e*p*$)*t,n[14]=(f*l*a-s*g*a-f*o*u+e*g*u+s*o*$-e*l*$)*t,n[15]=(s*p*a-d*l*a+d*o*u-e*p*u-s*o*h+e*l*h)*t,this},scale:function(e){var t=this.elements,n=e.x,r=e.y;return e=e.z,t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t);t=Math.sin(t);var r=1-n,o=e.x,a=e.y,i=r*o,s=r*a;return this.set(i*o+n,i*a-t*(e=e.z),i*e+t*a,0,i*a+t*e,s*a+n,s*e-t*o,0,i*e-t*a,s*e+t*o,r*e*e+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,o=t._x,a=t._y,i=t._z,s=t._w,l=o+o,u=a+a,c=i+i;t=o*l;var d=o*u;o*=c;var p=a*u;a*=c,i*=c,l*=s,u*=s,s*=c,c=n.x;var h=n.y;return n=n.z,r[0]=(1-(p+i))*c,r[1]=(d+s)*c,r[2]=(o-u)*c,r[3]=0,r[4]=(d-s)*h,r[5]=(1-(t+i))*h,r[6]=(a+l)*h,r[7]=0,r[8]=(o+u)*n,r[9]=(a-l)*n,r[10]=(1-(t+p))*n,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(){var e=new a,t=new r;return function(n,r,o){var a=this.elements,i=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),l=e.set(a[8],a[9],a[10]).length();0>this.determinant()&&(i=-i),n.x=a[12],n.y=a[13],n.z=a[14],t.copy(this),a=1/s;var u=1/l;return t.elements[0]*=n=1/i,t.elements[1]*=n,t.elements[2]*=n,t.elements[4]*=a,t.elements[5]*=a,t.elements[6]*=a,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,r.setFromRotationMatrix(t),o.x=i,o.y=s,o.z=l,this}}(),makePerspective:function(e,t,n,r,o,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var i=this.elements;return i[0]=2*o/(t-e),i[4]=0,i[8]=(t+e)/(t-e),i[12]=0,i[1]=0,i[5]=2*o/(n-r),i[9]=(n+r)/(n-r),i[13]=0,i[2]=0,i[6]=0,i[10]=-(a+o)/(a-o),i[14]=-2*a*o/(a-o),i[3]=0,i[7]=0,i[11]=-1,i[15]=0,this},makeOrthographic:function(e,t,n,r,o,a){var i=this.elements,s=1/(t-e),l=1/(n-r),u=1/(a-o);return i[0]=2*s,i[4]=0,i[8]=0,i[12]=-(t+e)*s,i[1]=0,i[5]=2*l,i[9]=0,i[13]=-(n+r)*l,i[2]=0,i[6]=0,i[10]=-2*u,i[14]=-(a+o)*u,i[3]=0,i[7]=0,i[11]=0,i[15]=1,this},equals:function(e){var t=this.elements;e=e.elements;for(var n=0;16>n;n++)if(t[n]!==e[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;16>n;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}),Object.assign(o,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,o,a,i){var s=n[r+0],l=n[r+1],u=n[r+2];n=n[r+3],r=o[a+0];var c=o[a+1],d=o[a+2];if(n!==(o=o[a+3])||s!==r||l!==c||u!==d){a=1-i;var p=s*r+l*c+u*d+n*o,h=0<=p?1:-1,m=1-p*p;m>Number.EPSILON&&(m=Math.sqrt(m),p=Math.atan2(m,p*h),a=Math.sin(a*p)/m,i=Math.sin(i*p)/m),s=s*a+r*(h*=i),l=l*a+c*h,u=u*a+d*h,n=n*a+o*h,a===1-i&&(s*=i=1/Math.sqrt(s*s+l*l+u*u+n*n),l*=i,u*=i,n*=i)}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=n}}),Object.defineProperties(o.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(o.prototype,{set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,o=e._z;e=e.order;var a=Math.cos,i=Math.sin,s=a(n/2),l=a(r/2);return a=a(o/2),n=i(n/2),r=i(r/2),o=i(o/2),"XYZ"===e?(this._x=n*l*a+s*r*o,this._y=s*r*a-n*l*o,this._z=s*l*o+n*r*a,this._w=s*l*a-n*r*o):"YXZ"===e?(this._x=n*l*a+s*r*o,this._y=s*r*a-n*l*o,this._z=s*l*o-n*r*a,this._w=s*l*a+n*r*o):"ZXY"===e?(this._x=n*l*a-s*r*o,this._y=s*r*a+n*l*o,this._z=s*l*o+n*r*a,this._w=s*l*a-n*r*o):"ZYX"===e?(this._x=n*l*a-s*r*o,this._y=s*r*a+n*l*o,this._z=s*l*o-n*r*a,this._w=s*l*a+n*r*o):"YZX"===e?(this._x=n*l*a+s*r*o,this._y=s*r*a+n*l*o,this._z=s*l*o-n*r*a,this._w=s*l*a-n*r*o):"XZY"===e&&(this._x=n*l*a-s*r*o,this._y=s*r*a-n*l*o,this._z=s*l*o+n*r*a,this._w=s*l*a+n*r*o),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){t/=2;var n=Math.sin(t);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(t),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0];e=t[4];var r=t[8],o=t[1],a=t[5],i=t[9],s=t[2],l=t[6],u=n+a+(t=t[10]);return 0<u?(n=.5/Math.sqrt(u+1),this._w=.25/n,this._x=(l-i)*n,this._y=(r-s)*n,this._z=(o-e)*n):n>a&&n>t?(n=2*Math.sqrt(1+n-a-t),this._w=(l-i)/n,this._x=.25*n,this._y=(e+o)/n,this._z=(r+s)/n):a>t?(n=2*Math.sqrt(1+a-n-t),this._w=(r-s)/n,this._x=(e+o)/n,this._y=.25*n,this._z=(i+l)/n):(n=2*Math.sqrt(1+t-n-a),this._w=(o-e)/n,this._x=(r+s)/n,this._y=(i+l)/n,this._z=.25*n),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new a;return function(n,r){return void 0===t&&(t=new a),1e-6>(e=n.dot(r)+1)?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(Xo.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);return 0===n?this:(this.slerp(e,Math.min(1,t/n)),this)},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(this._x*=e=1/e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,o=e._z,a=t._x,i=t._y,s=t._z;return this._x=n*(t=t._w)+(e=e._w)*a+r*s-o*i,this._y=r*t+e*i+o*a-n*s,this._z=o*t+e*s+n*i-r*a,this._w=e*t-n*a-r*i-o*s,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,o=this._z,a=this._w,i=a*e._w+n*e._x+r*e._y+o*e._z;if(0>i?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,i=-i):this.copy(e),1<=i)return this._w=a,this._x=n,this._y=r,this._z=o,this;if((e=1-i*i)<=Number.EPSILON)return this._w=(i=1-t)*a+t*this._w,this._x=i*n+t*this._x,this._y=i*r+t*this._y,this._z=i*o+t*this._z,this.normalize();e=Math.sqrt(e);var s=Math.atan2(e,i);return i=Math.sin((1-t)*s)/e,t=Math.sin(t*s)/e,this._w=a*i+this._w*t,this._x=n*i+this._x*t,this._y=r*i+this._y*t,this._z=o*i+this._z*t,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(a.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new o;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new o;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z;return this.x=(e=e.elements)[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,o=1/((e=e.elements)[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*o,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*o,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,o=e.x,a=e.y,i=e.z,s=(e=e.w)*t+a*r-i*n,l=e*n+i*t-o*r,u=e*r+o*n-a*t;return this.x=s*e+(t=-o*t-a*n-i*r)*-o+l*-i-u*-a,this.y=l*e+t*-a+u*-o-s*-i,this.z=u*e+t*-i+s*-a-l*-o,this},project:function(){var e=new r;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new r;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,r=this.z;return this.x=(e=e.elements)[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new a,t=new a;return function(n,r){return e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,o=t.x,a=t.y;return this.x=r*(t=t.z)-(e=e.z)*a,this.y=e*o-n*t,this.z=n*a-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new a;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new a;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq()),Math.acos(Xo.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n+(e=this.z-e.z)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){return this.x=(e=e.elements)[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length();return e=this.setFromMatrixColumn(e,2).length(),this.x=t,this.y=n,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(i.prototype,{isMatrix3:!0,set:function(e,t,n,r,o,a,i,s,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=i,u[3]=t,u[4]=o,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements;return t[0]=(e=e.elements)[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},setFromMatrix4:function(e){return this.set((e=e.elements)[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var e=new a;return function(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements;e=n[0];var o=n[3],a=n[6],i=n[1],s=n[4],l=n[7],u=n[2],c=n[5];n=n[8];var d=r[0],p=r[3],h=r[6],m=r[1],f=r[4],g=r[7],$=r[2],v=r[5];return r=r[8],(t=this.elements)[0]=e*d+o*m+a*$,t[3]=e*p+o*f+a*v,t[6]=e*h+o*g+a*r,t[1]=i*d+s*m+l*$,t[4]=i*p+s*f+l*v,t[7]=i*h+s*g+l*r,t[2]=u*d+c*m+n*$,t[5]=u*p+c*f+n*v,t[8]=u*h+c*g+n*r,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],i=e[5],s=e[6],l=e[7];return t*a*(e=e[8])-t*i*l-n*o*e+n*i*s+r*o*l-r*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements;e=this.elements;var r=n[0],o=n[1],a=n[2],i=n[3],s=n[4],l=n[5],u=n[6],c=n[7],d=(n=n[8])*s-l*c,p=l*u-n*i,h=c*i-s*u,m=r*d+o*p+a*h;if(0===m){if(!0===t)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return e[0]=d*(t=1/m),e[1]=(a*c-n*o)*t,e[2]=(l*o-a*s)*t,e[3]=p*t,e[4]=(n*r-a*u)*t,e[5]=(a*i-l*r)*t,e[6]=h*t,e[7]=(o*u-c*r)*t,e[8]=(s*r-o*i)*t,this},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,o,a,i){var s=Math.cos(o);o=Math.sin(o),this.set(n*s,n*o,-n*(s*a+o*i)+a+e,-r*o,r*s,-r*(-o*a+s*i)+i+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e);e=Math.sin(e);var n=this.elements,r=n[0],o=n[3],a=n[6],i=n[1],s=n[4],l=n[7];return n[0]=t*r+e*i,n[3]=t*o+e*s,n[6]=t*a+e*l,n[1]=-e*r+t*i,n[4]=-e*o+t*s,n[7]=-e*a+t*l,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){var t=this.elements;e=e.elements;for(var n=0;9>n;n++)if(t[n]!==e[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;9>n;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Zo={getDataURL:function(e){if(e instanceof HTMLCanvasElement)var t=e;else{"undefined"!=typeof OffscreenCanvas?t=new OffscreenCanvas(e.width,e.height):((t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height);var n=t.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height)}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Jo=0;s.DEFAULT_IMAGE=void 0,s.DEFAULT_MAPPING=300,s.prototype=Object.assign(Object.create(t.prototype),{constructor:s,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Xo.generateUUID()),!t&&void 0===e.images[r.uuid]){if(Array.isArray(r))for(var o=[],a=0,i=r.length;a<i;a++)o.push(Zo.getDataURL(r[a]));else o=Zo.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:o}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300===this.mapping){if(e.applyMatrix3(this.matrix),0>e.x||1<e.x)switch(this.wrapS){case 1e3:e.x-=Math.floor(e.x);break;case 1001:e.x=0>e.x?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(0>e.y||1<e.y)switch(this.wrapT){case 1e3:e.y-=Math.floor(e.y);break;case 1001:e.y=0>e.y?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(s.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(l.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.w=this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,o=this.w;return this.x=(e=e.elements)[0]*t+e[4]*n+e[8]*r+e[12]*o,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*o,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*o,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*o,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t=(e=e.elements)[0],n=e[4],r=e[8],o=e[1],a=e[5],i=e[9],s=e[2],l=e[6],u=e[10];return.01>Math.abs(n-o)&&.01>Math.abs(r-s)&&.01>Math.abs(i-l)?.1>Math.abs(n+o)&&.1>Math.abs(r+s)&&.1>Math.abs(i+l)&&.1>Math.abs(t+a+u-3)?(this.set(1,0,0,0),this):(e=Math.PI,u=(u+1)/2,n=(n+o)/4,r=(r+s)/4,i=(i+l)/4,(t=(t+1)/2)>(a=(a+1)/2)&&t>u?.01>t?(l=0,n=s=.707106781):(s=n/(l=Math.sqrt(t)),n=r/l):a>u?.01>a?(l=.707106781,s=0,n=.707106781):(l=n/(s=Math.sqrt(a)),n=i/s):.01>u?(s=l=.707106781,n=0):(l=r/(n=Math.sqrt(u)),s=i/n),this.set(l,s,n,e),this):(e=Math.sqrt((l-i)*(l-i)+(r-s)*(r-s)+(o-n)*(o-n)),.001>Math.abs(e)&&(e=1),this.x=(l-i)/e,this.y=(r-s)/e,this.z=(o-n)/e,this.w=Math.acos((t+a+u-1)/2),this)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new l,t=new l),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),u.prototype=Object.assign(Object.create(t.prototype),{constructor:u,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(c.prototype=Object.create(u.prototype)).constructor=c,c.prototype.isWebGLRenderTargetCube=!0,(d.prototype=Object.create(s.prototype)).constructor=d,d.prototype.isDataTexture=!0,Object.assign(p.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,i=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],d=e[s+2];u<t&&(t=u),c<n&&(n=c),d<r&&(r=d),u>o&&(o=u),c>a&&(a=c),d>i&&(i=d)}return this.min.set(t,n,r),this.max.set(o,a,i),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,i=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),d=e.getZ(s);u<t&&(t=u),c<n&&(n=c),d<r&&(r=d),u>o&&(o=u),c>a&&(a=c),d>i&&(i=d)}return this.min.set(t,n,r),this.max.set(o,a,i),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new a;return function(t,n){return n=e.copy(n).multiplyScalar(.5),this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new a),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new a),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function e(e){var a=e.geometry;if(void 0!==a)if(a.isGeometry)for(n=0,r=(a=a.vertices).length;n<r;n++)o.copy(a[n]),o.applyMatrix4(e.matrixWorld),t.expandByPoint(o);else if(a.isBufferGeometry&&void 0!==(a=a.attributes.position))for(n=0,r=a.count;n<r;n++)o.fromBufferAttribute(a,n).applyMatrix4(e.matrixWorld),t.expandByPoint(o)}var t,n,r,o=new a;return function(n){return t=this,n.updateMatrixWorld(!0),n.traverse(e),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new a),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new a;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){if(0<e.normal.x)var t=e.normal.x*this.min.x,n=e.normal.x*this.max.x;else t=e.normal.x*this.max.x,n=e.normal.x*this.min.x;return 0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant},intersectsTriangle:function(){function e(e){var o,a=0;for(o=e.length-3;a<=o;a+=3){l.fromArray(e,a);var i=c.x*Math.abs(l.x)+c.y*Math.abs(l.y)+c.z*Math.abs(l.z),s=t.dot(l),u=n.dot(l),d=r.dot(l);if(Math.max(-Math.max(s,u,d),Math.min(s,u,d))>i)return!1}return!0}var t=new a,n=new a,r=new a,o=new a,i=new a,s=new a,l=new a,u=new a,c=new a,d=new a;return function(a){return!this.isEmpty()&&(this.getCenter(u),c.subVectors(this.max,u),t.subVectors(a.a,u),n.subVectors(a.b,u),r.subVectors(a.c,u),o.subVectors(n,t),i.subVectors(r,n),s.subVectors(t,r),!!e(a=[0,-o.z,o.y,0,-i.z,i.y,0,-s.z,s.y,o.z,0,-o.x,i.z,0,-i.x,s.z,0,-s.x,-o.y,o.x,0,-i.y,i.x,0,-s.y,s.x,0])&&!!e(a=[1,0,0,0,1,0,0,0,1])&&(d.crossVectors(o,i),e(a=[d.x,d.y,d.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new a),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new a;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new a;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new h),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){if(this.isEmpty())return this;var t=(e=e.elements)[0]*this.min.x,n=e[1]*this.min.x,r=e[2]*this.min.x,o=e[0]*this.max.x,a=e[1]*this.max.x,i=e[2]*this.max.x,s=e[4]*this.min.y,l=e[5]*this.min.y,u=e[6]*this.min.y,c=e[4]*this.max.y,d=e[5]*this.max.y,p=e[6]*this.max.y,h=e[8]*this.min.z,m=e[9]*this.min.z,f=e[10]*this.min.z,g=e[8]*this.max.z,$=e[9]*this.max.z,v=e[10]*this.max.z;return this.min.x=Math.min(t,o)+Math.min(s,c)+Math.min(h,g)+e[12],this.min.y=Math.min(n,a)+Math.min(l,d)+Math.min(m,$)+e[13],this.min.z=Math.min(r,i)+Math.min(u,p)+Math.min(f,v)+e[14],this.max.x=Math.max(t,o)+Math.max(s,c)+Math.max(h,g)+e[12],this.max.y=Math.max(n,a)+Math.max(l,d)+Math.max(m,$)+e[13],this.max.z=Math.max(r,i)+Math.max(u,p)+Math.max(f,v)+e[14],this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(h.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new p;return function(t,n){var r=this.center;void 0!==n?r.copy(n):e.setFromPoints(t).getCenter(r);for(var o=n=0,a=t.length;o<a;o++)n=Math.max(n,r.distanceToSquared(t[o]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new a),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new p),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(m.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new a,t=new a;return function(n,r,o){return r=e.subVectors(o,r).cross(t.subVectors(n,r)).normalize(),this.setFromNormalAndCoplanarPoint(r,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new a),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new a;return function(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new a);var r=t.delta(e),o=this.normal.dot(r);if(0===o){if(0===this.distanceToPoint(t.start))return n.copy(t.start)}else if(!(0>(o=-(t.start.dot(this.normal)+this.constant)/o)||1<o))return n.copy(r).multiplyScalar(o).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new a),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new a,t=new i;return function(n,r){return r=r||t.getNormalMatrix(n),n=this.coplanarPoint(e).applyMatrix4(n),r=this.normal.applyMatrix3(r).normalize(),this.constant=-n.dot(r),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(f.prototype,{set:function(e,t,n,r,o,a){var i=this.planes;return i[0].copy(e),i[1].copy(t),i[2].copy(n),i[3].copy(r),i[4].copy(o),i[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;6>n;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[1],o=n[2],a=n[3],i=n[4],s=n[5],l=n[6],u=n[7],c=n[8],d=n[9],p=n[10],h=n[11],m=n[12],f=n[13],g=n[14];return t[0].setComponents(a-(e=n[0]),u-i,h-c,(n=n[15])-m).normalize(),t[1].setComponents(a+e,u+i,h+c,n+m).normalize(),t[2].setComponents(a+r,u+s,h+d,n+f).normalize(),t[3].setComponents(a-r,u-s,h-d,n-f).normalize(),t[4].setComponents(a-o,u-l,h-p,n-g).normalize(),t[5].setComponents(a+o,u+l,h+p,n+g).normalize(),this},intersectsObject:function(){var e=new h;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new h;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,n=e.center;e=-e.radius;for(var r=0;6>r;r++)if(t[r].distanceToPoint(n)<e)return!1;return!0},intersectsBox:function(){var e=new a;return function(t){for(var n=this.planes,r=0;6>r;r++){var o=n[r];if(e.x=0<o.normal.x?t.max.x:t.min.x,e.y=0<o.normal.y?t.max.y:t.min.y,e.z=0<o.normal.z?t.max.z:t.min.z,0>o.distanceToPoint(e))return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;6>n;n++)if(0>t[n].distanceToPoint(e))return!1;return!0}});var Ko={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tvec4 mvPosition;\n\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n"},Qo={merge:function(e){for(var t={},n=0;n<e.length;n++){var r,o=this.clone(e[n]);for(r in o)t[r]=o[r]}return t},clone:function(e){var t,n={};for(t in e)for(var r in n[t]={},e[t]){var o=e[t][r];n[t][r]=o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture)?o.clone():Array.isArray(o)?o.slice():o}return n}},ea={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(g.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.b=this.g=this.r=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(){function e(e,t,n){return 0>n&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e}return function(t,n,r){return t=Xo.euclideanModulo(t,1),n=Xo.clamp(n,0,1),r=Xo.clamp(r,0,1),0===n?this.r=this.g=this.b=r:(this.r=e(r=2*r-(n=.5>=r?r*(1+n):r+n-r*n),n,t+1/3),this.g=e(r,n,t),this.b=e(r,n,t-1/3)),this}}(),setStyle:function(e){var t;if(t=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n=t[2];switch(t[1]){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this;if(t=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this;break;case"hsl":case"hsla":if(t=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return e=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,t=parseInt(t[3],10)/100,this.setHSL(e,n,t)}}else if(t=/^#([A-Fa-f0-9]+)$/.exec(e)){if(3===(n=(t=t[1]).length))return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return e&&0<e.length&&(void 0!==(t=ea[e])?this.setHex(t):console.warn("THREE.Color: Unknown color "+e)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){return void 0===t&&(t=2),t=0<t?1/t:1,this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return.04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return.0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n=this.r,r=this.g,o=this.b,a=Math.max(n,r,o),i=Math.min(n,r,o),s=(i+a)/2;if(i===a)i=t=0;else{var l=a-i;switch(i=.5>=s?l/(a+i):l/(2-a-i),a){case n:t=(r-o)/l+(r<o?6:0);break;case r:t=(o-n)/l+2;break;case o:t=(n-r)/l+4}t/=6}return e.h=t,e.s=i,e.l=s,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,n,r){return this.getHSL(e),e.h+=t,e.s+=n,e.l+=r,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var ta={common:{diffuse:{value:new g(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new i},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new n(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new g(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new g(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new i}},sprite:{diffuse:{value:new g(15658734)},opacity:{value:1},center:{value:new n(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new i}}},na={basic:{uniforms:Qo.merge([ta.common,ta.specularmap,ta.envmap,ta.aomap,ta.lightmap,ta.fog]),vertexShader:Ko.meshbasic_vert,fragmentShader:Ko.meshbasic_frag},lambert:{uniforms:Qo.merge([ta.common,ta.specularmap,ta.envmap,ta.aomap,ta.lightmap,ta.emissivemap,ta.fog,ta.lights,{emissive:{value:new g(0)}}]),vertexShader:Ko.meshlambert_vert,fragmentShader:Ko.meshlambert_frag},phong:{uniforms:Qo.merge([ta.common,ta.specularmap,ta.envmap,ta.aomap,ta.lightmap,ta.emissivemap,ta.bumpmap,ta.normalmap,ta.displacementmap,ta.gradientmap,ta.fog,ta.lights,{emissive:{value:new g(0)},specular:{value:new g(1118481)},shininess:{value:30}}]),vertexShader:Ko.meshphong_vert,fragmentShader:Ko.meshphong_frag},standard:{uniforms:Qo.merge([ta.common,ta.envmap,ta.aomap,ta.lightmap,ta.emissivemap,ta.bumpmap,ta.normalmap,ta.displacementmap,ta.roughnessmap,ta.metalnessmap,ta.fog,ta.lights,{emissive:{value:new g(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ko.meshphysical_vert,fragmentShader:Ko.meshphysical_frag},points:{uniforms:Qo.merge([ta.points,ta.fog]),vertexShader:Ko.points_vert,fragmentShader:Ko.points_frag},dashed:{uniforms:Qo.merge([ta.common,ta.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ko.linedashed_vert,fragmentShader:Ko.linedashed_frag},depth:{uniforms:Qo.merge([ta.common,ta.displacementmap]),vertexShader:Ko.depth_vert,fragmentShader:Ko.depth_frag},normal:{uniforms:Qo.merge([ta.common,ta.bumpmap,ta.normalmap,ta.displacementmap,{opacity:{value:1}}]),vertexShader:Ko.normal_vert,fragmentShader:Ko.normal_frag},sprite:{uniforms:Qo.merge([ta.sprite,ta.fog]),vertexShader:Ko.sprite_vert,fragmentShader:Ko.sprite_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ko.cube_vert,fragmentShader:Ko.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ko.equirect_vert,fragmentShader:Ko.equirect_frag},distanceRGBA:{uniforms:Qo.merge([ta.common,ta.displacementmap,{referencePosition:{value:new a},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ko.distanceRGBA_vert,fragmentShader:Ko.distanceRGBA_frag},shadow:{uniforms:Qo.merge([ta.lights,ta.fog,{color:{value:new g(0)},opacity:{value:1}}]),vertexShader:Ko.shadow_vert,fragmentShader:Ko.shadow_frag}};na.physical={uniforms:Qo.merge([na.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ko.meshphysical_vert,fragmentShader:Ko.meshphysical_frag},y.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),y.DefaultOrder="XYZ",Object.defineProperties(y.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(y.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=Xo.clamp,o=e.elements;e=o[0];var a=o[4],i=o[8],s=o[1],l=o[5],u=o[9],c=o[2],d=o[6];return o=o[10],"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(i,-1,1)),.99999>Math.abs(i)?(this._x=Math.atan2(-u,o),this._z=Math.atan2(-a,e)):(this._x=Math.atan2(d,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),.99999>Math.abs(u)?(this._y=Math.atan2(i,o),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,e),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),.99999>Math.abs(d)?(this._y=Math.atan2(-c,o),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,e))):"ZYX"===t?(this._y=Math.asin(-r(c,-1,1)),.99999>Math.abs(c)?(this._x=Math.atan2(d,o),this._z=Math.atan2(s,e)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===t?(this._z=Math.asin(r(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,e)):(this._x=0,this._y=Math.atan2(i,o))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(d,l),this._y=Math.atan2(i,e)):(this._x=Math.atan2(-u,o),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new r;return function(t,n,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new o;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new a(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(_.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask=this.mask|1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var ra=0;b.DefaultUp=new a(0,1,0),b.DefaultMatrixAutoUpdate=!0,b.prototype=Object.assign(Object.create(t.prototype),{constructor:b,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new o;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new o;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new a(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new a(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new a(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new a;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new a(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new a(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new a(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new r;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new r,t=new a;return function(n,r,o){n.isVector3?t.copy(n):t.set(n,r,o),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}return-1!==(t=this.children.indexOf(e))&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(t,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var o=this.children[n].getObjectByProperty(e,t);if(void 0!==o)return o}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new a),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new a,t=new a;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new o),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldScale:function(){var e=new a,t=new o;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new a),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(){var e=new o;return function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new a),this.getWorldQuaternion(e),t.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},toJSON:function(e){function t(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}function n(e){var t,n=[];for(t in e){var r=e[t];delete r.metadata,n.push(r)}return n}var r=void 0===e||"string"==typeof e,o={};r&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},o.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var a={};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),!0===this.castShadow&&(a.castShadow=!0),!0===this.receiveShadow&&(a.receiveShadow=!0),!1===this.visible&&(a.visible=!1),!1===this.frustumCulled&&(a.frustumCulled=!1),0!==this.renderOrder&&(a.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(a.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){a.geometry=t(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes)if(i=i.shapes,Array.isArray(i))for(var s=0,l=i.length;s<l;s++)t(e.shapes,i[s]);else t(e.shapes,i)}if(void 0!==this.material)if(Array.isArray(this.material)){for(i=[],s=0,l=this.material.length;s<l;s++)i.push(t(e.materials,this.material[s]));a.material=i}else a.material=t(e.materials,this.material);if(0<this.children.length)for(a.children=[],s=0;s<this.children.length;s++)a.children.push(this.children[s].toJSON(e).object);if(r){r=n(e.geometries),s=n(e.materials),l=n(e.textures);var u=n(e.images);i=n(e.shapes),0<r.length&&(o.geometries=r),0<s.length&&(o.materials=s),0<l.length&&(o.textures=l),0<u.length&&(o.images=u),0<i.length&&(o.shapes=i)}return o.object=a,o},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}}),x.prototype=Object.assign(Object.create(b.prototype),{constructor:x,isCamera:!0,copy:function(e,t){return b.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new o;return function(t){return void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new a),this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){b.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),w.prototype=Object.assign(Object.create(x.prototype),{constructor:w,isOrthographicCamera:!0,copy:function(e,t){return x.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,o,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,o=n-e;if(n+=e,e=r+t,t=r-t,null!==this.view&&this.view.enabled){var a=(this.right-this.left)/this.view.width;n=(o+=this.view.offsetX/(n=this.zoom/(this.view.width/this.view.fullWidth))*a)+this.view.width/n*a,t=(e-=this.view.offsetY/(t=this.zoom/(this.view.height/this.view.fullHeight))*(r=(this.top-this.bottom)/this.view.height))-this.view.height/t*r}this.projectionMatrix.makeOrthographic(o,n,e,t,this.near,this.far)},toJSON:function(e){return(e=b.prototype.toJSON.call(this,e)).object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Object.assign(S.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var oa=0;M.prototype=Object.assign(Object.create(t.prototype),{constructor:M,isGeometry:!0,applyMatrix:function(e){for(var t=(new i).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);for(n=0,r=this.faces.length;n<r;n++){(e=this.faces[n]).normal.applyMatrix3(t).normalize();for(var o=0,a=e.vertexNormals.length;o<a;o++)e.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(){var e=new r;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new r;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new r;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new r;return function(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){var e=new r;return function(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new b;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,n,o){o=new S(e,t,n,void 0!==l?[p[e].clone(),p[t].clone(),p[n].clone()]:[],void 0!==u?[r.colors[e].clone(),r.colors[t].clone(),r.colors[n].clone()]:[],o),r.faces.push(o),void 0!==c&&r.faceVertexUvs[0].push([h[e].clone(),h[t].clone(),h[n].clone()]),void 0!==d&&r.faceVertexUvs[1].push([m[e].clone(),m[t].clone(),m[n].clone()])}var r=this,o=null!==e.index?e.index.array:void 0,i=e.attributes,s=i.position.array,l=void 0!==i.normal?i.normal.array:void 0,u=void 0!==i.color?i.color.array:void 0,c=void 0!==i.uv?i.uv.array:void 0,d=void 0!==i.uv2?i.uv2.array:void 0;void 0!==d&&(this.faceVertexUvs[1]=[]);for(var p=[],h=[],m=[],f=i=0;i<s.length;i+=3,f+=2)r.vertices.push(new a(s[i],s[i+1],s[i+2])),void 0!==l&&p.push(new a(l[i],l[i+1],l[i+2])),void 0!==u&&r.colors.push(new g(u[i],u[i+1],u[i+2])),void 0!==c&&h.push(new n(c[f],c[f+1])),void 0!==d&&m.push(new n(d[f],d[f+1]));var $=e.groups;if(0<$.length)for(i=0;i<$.length;i++){var v=(s=$[i]).start;for(f=v,v+=s.count;f<v;f+=3)void 0!==o?t(o[f],o[f+1],o[f+2],s.materialIndex):t(f,f+1,f+2,s.materialIndex)}else if(void 0!==o)for(i=0;i<o.length;i+=3)t(o[i],o[i+1],o[i+2]);else for(i=0;i<s.length/3;i+=3)t(i,i+1,i+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new a;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius;t=0===t?1:1/t;var n=new r;return n.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new a,t=new a,n=0,r=this.faces.length;n<r;n++){var o=this.faces[n],i=this.vertices[o.a],s=this.vertices[o.b];e.subVectors(this.vertices[o.c],s),t.subVectors(i,s),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t;void 0===e&&(e=!0);var n=Array(this.vertices.length),r=0;for(t=this.vertices.length;r<t;r++)n[r]=new a;if(e){var o=new a,i=new a;for(e=0,r=this.faces.length;e<r;e++){var s=this.vertices[(t=this.faces[e]).a],l=this.vertices[t.b];o.subVectors(this.vertices[t.c],l),i.subVectors(s,l),o.cross(i),n[t.a].add(o),n[t.b].add(o),n[t.c].add(o)}}else for(this.computeFaceNormals(),e=0,r=this.faces.length;e<r;e++)n[(t=this.faces[e]).a].add(t.normal),n[t.b].add(t.normal),n[t.c].add(t.normal);for(r=0,t=this.vertices.length;r<t;r++)n[r].normalize();for(e=0,r=this.faces.length;e<r;e++)3===(s=(t=this.faces[e]).vertexNormals).length?(s[0].copy(n[t.a]),s[1].copy(n[t.b]),s[2].copy(n[t.c])):(s[0]=n[t.a].clone(),s[1]=n[t.b].clone(),s[2]=n[t.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e;this.computeFaceNormals();var t=0;for(e=this.faces.length;t<e;t++){var n=this.faces[t],r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n=0;for(t=this.faces.length;n<t;n++){var r=this.faces[n];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);var o=0;for(e=r.vertexNormals.length;o<e;o++)r.__originalVertexNormals[o]?r.__originalVertexNormals[o].copy(r.vertexNormals[o]):r.__originalVertexNormals[o]=r.vertexNormals[o].clone()}var i=new M;for(i.faces=this.faces,o=0,e=this.morphTargets.length;o<e;o++){if(!this.morphNormals[o]){this.morphNormals[o]={},this.morphNormals[o].faceNormals=[],this.morphNormals[o].vertexNormals=[],r=this.morphNormals[o].faceNormals;var s=this.morphNormals[o].vertexNormals;for(n=0,t=this.faces.length;n<t;n++){var l=new a,u={a:new a,b:new a,c:new a};r.push(l),s.push(u)}}for(s=this.morphNormals[o],i.vertices=this.morphTargets[o].vertices,i.computeFaceNormals(),i.computeVertexNormals(),n=0,t=this.faces.length;n<t;n++)u=s.vertexNormals[n],(l=s.faceNormals[n]).copy((r=this.faces[n]).normal),u.a.copy(r.vertexNormals[0]),u.b.copy(r.vertexNormals[1]),u.c.copy(r.vertexNormals[2])}for(n=0,t=this.faces.length;n<t;n++)(r=this.faces[n]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new h),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,o=this.vertices.length,a=this.vertices,s=e.vertices,l=this.faces,u=e.faces,c=this.faceVertexUvs[0],d=e.faceVertexUvs[0],p=this.colors,h=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new i).getNormalMatrix(t)),e=0;for(var m=s.length;e<m;e++){var f=s[e].clone();void 0!==t&&f.applyMatrix4(t),a.push(f)}for(e=0,m=h.length;e<m;e++)p.push(h[e].clone());for(e=0,m=u.length;e<m;e++){var g=(s=u[e]).vertexNormals;for(h=s.vertexColors,(p=new S(s.a+o,s.b+o,s.c+o)).normal.copy(s.normal),void 0!==r&&p.normal.applyMatrix3(r).normalize(),t=0,a=g.length;t<a;t++)f=g[t].clone(),void 0!==r&&f.applyMatrix3(r).normalize(),p.vertexNormals.push(f);for(p.color.copy(s.color),t=0,a=h.length;t<a;t++)p.vertexColors.push((f=h[t]).clone());p.materialIndex=s.materialIndex+n,l.push(p)}for(e=0,m=d.length;e<m;e++)if(r=[],void 0!==(n=d[e])){for(t=0,a=n.length;t<a;t++)r.push(n[t].clone());c.push(r)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t={},n=[],r=[],o=Math.pow(10,4),a=0;for(e=this.vertices.length;a<e;a++){var i=this.vertices[a];void 0===t[i=Math.round(i.x*o)+"_"+Math.round(i.y*o)+"_"+Math.round(i.z*o)]?(t[i]=a,n.push(this.vertices[a]),r[a]=n.length-1):r[a]=r[t[i]]}for(t=[],a=0,e=this.faces.length;a<e;a++)for((o=this.faces[a]).a=r[o.a],o.b=r[o.b],o.c=r[o.c],o=[o.a,o.b,o.c],i=0;3>i;i++)if(o[i]===o[(i+1)%3]){t.push(a);break}for(a=t.length-1;0<=a;a--)for(this.faces.splice(o=t[a],1),r=0,e=this.faceVertexUvs.length;r<e;r++)this.faceVertexUvs[r].splice(o,1);return a=this.vertices.length-n.length,this.vertices=n,a},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new a(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,o,a=this.faceVertexUvs[0],i=this.faceVertexUvs[1];for(a&&a.length===t&&(r=[]),i&&i.length===t&&(o=[]),n=0;n<t;n++){var s=e[n]._id;r&&r.push(a[s]),o&&o.push(i[s])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){function e(e,t,n){return n?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==u[t]?u[t]:(u[t]=l.length/3,l.push(e.x,e.y,e.z),u[t])}function n(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==d[t]?d[t]:(d[t]=c.length,c.push(e.getHex()),d[t])}function r(e){var t=e.x.toString()+e.y.toString();return void 0!==h[t]?h[t]:(h[t]=p.length/2,p.push(e.x,e.y),h[t])}var o={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),void 0!==this.parameters){var a,i=this.parameters;for(a in i)void 0!==i[a]&&(o[a]=i[a]);return o}for(i=[],a=0;a<this.vertices.length;a++){var s=this.vertices[a];i.push(s.x,s.y,s.z)}s=[];var l=[],u={},c=[],d={},p=[],h={};for(a=0;a<this.faces.length;a++){var m=this.faces[a],f=void 0!==this.faceVertexUvs[0][a],g=0<m.normal.length(),$=0<m.vertexNormals.length,v=1!==m.color.r||1!==m.color.g||1!==m.color.b,y=0<m.vertexColors.length,_=0;_=e(_,0,0),_=e(_,1,!0),_=e(_,2,!1),_=e(_,3,f),_=e(_,4,g),_=e(_,5,$),_=e(_,6,v),_=e(_,7,y),s.push(_),s.push(m.a,m.b,m.c),s.push(m.materialIndex),f&&s.push(r((f=this.faceVertexUvs[0][a])[0]),r(f[1]),r(f[2])),g&&s.push(t(m.normal)),$&&s.push(t((g=m.vertexNormals)[0]),t(g[1]),t(g[2])),v&&s.push(n(m.color)),y&&s.push(n((m=m.vertexColors)[0]),n(m[1]),n(m[2]))}return o.data={},o.data.vertices=i,o.data.normals=l,0<c.length&&(o.data.colors=c),0<p.length&&(o.data.uvs=[p]),o.data.faces=s,o},clone:function(){return(new M).copy(this)},copy:function(e){var t,n,r;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var o=e.vertices,a=0;for(t=o.length;a<t;a++)this.vertices.push(o[a].clone());for(a=0,t=(o=e.colors).length;a<t;a++)this.colors.push(o[a].clone());for(a=0,t=(o=e.faces).length;a<t;a++)this.faces.push(o[a].clone());for(a=0,t=e.faceVertexUvs.length;a<t;a++){var i=e.faceVertexUvs[a];for(void 0===this.faceVertexUvs[a]&&(this.faceVertexUvs[a]=[]),o=0,n=i.length;o<n;o++){var s=i[o],l=[],u=0;for(r=s.length;u<r;u++)l.push(s[u].clone());this.faceVertexUvs[a].push(l)}}for(a=0,t=(u=e.morphTargets).length;a<t;a++){if((r={}).name=u[a].name,void 0!==u[a].vertices)for(r.vertices=[],o=0,n=u[a].vertices.length;o<n;o++)r.vertices.push(u[a].vertices[o].clone());if(void 0!==u[a].normals)for(r.normals=[],o=0,n=u[a].normals.length;o<n;o++)r.normals.push(u[a].normals[o].clone());this.morphTargets.push(r)}for(a=0,t=(u=e.morphNormals).length;a<t;a++){if(r={},void 0!==u[a].vertexNormals)for(r.vertexNormals=[],o=0,n=u[a].vertexNormals.length;o<n;o++)(s={}).a=(i=u[a].vertexNormals[o]).a.clone(),s.b=i.b.clone(),s.c=i.c.clone(),r.vertexNormals.push(s);if(void 0!==u[a].faceNormals)for(r.faceNormals=[],o=0,n=u[a].faceNormals.length;o<n;o++)r.faceNormals.push(u[a].faceNormals[o].clone());this.morphNormals.push(r)}for(a=0,t=(o=e.skinWeights).length;a<t;a++)this.skinWeights.push(o[a].clone());for(a=0,t=(o=e.skinIndices).length;a<t;a++)this.skinIndices.push(o[a].clone());for(a=0,t=(o=e.lineDistances).length;a<t;a++)this.lineDistances.push(o[a]);return null!==(a=e.boundingBox)&&(this.boundingBox=a.clone()),null!==(a=e.boundingSphere)&&(this.boundingSphere=a.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(E.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(E.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,o=e.length;r<o;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new g),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,o=0,a=e.length;o<a;o++){var i=e[o];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",o),i=new n),t[r++]=i.x,t[r++]=i.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,o=e.length;r<o;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new a),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,o=e.length;r<o;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new l),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,o){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=o,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(T.prototype=Object.create(E.prototype)).constructor=T,(C.prototype=Object.create(E.prototype)).constructor=C,(P.prototype=Object.create(E.prototype)).constructor=P,(A.prototype=Object.create(E.prototype)).constructor=A,(L.prototype=Object.create(E.prototype)).constructor=L,(R.prototype=Object.create(E.prototype)).constructor=R,(D.prototype=Object.create(E.prototype)).constructor=D,(I.prototype=Object.create(E.prototype)).constructor=I,(O.prototype=Object.create(E.prototype)).constructor=O,Object.assign(N.prototype,{computeGroups:function(e){var t=[],n=void 0;e=e.faces;for(var r=0;r<e.length;r++){var o=e[r];if(o.materialIndex!==n){n=o.materialIndex,void 0!==a&&(a.count=3*r-a.start,t.push(a));var a={start:3*r,materialIndex:n}}}void 0!==a&&(a.count=3*r-a.start,t.push(a)),this.groups=t},fromGeometry:function(e){var t=e.faces,r=e.vertices,o=e.faceVertexUvs,a=o[0]&&0<o[0].length,i=o[1]&&0<o[1].length,s=e.morphTargets,l=s.length;if(0<l){for(var u=[],c=0;c<l;c++)u[c]=[];this.morphTargets.position=u}var d=e.morphNormals,p=d.length;if(0<p){var h=[];for(c=0;c<p;c++)h[c]=[];this.morphTargets.normal=h}var m=e.skinIndices,f=e.skinWeights,g=m.length===r.length,$=f.length===r.length;for(0<r.length&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),c=0;c<t.length;c++){var v=t[c];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;for(3===y.length?this.normals.push(y[0],y[1],y[2]):this.normals.push(y=v.normal,y,y),3===(y=v.vertexColors).length?this.colors.push(y[0],y[1],y[2]):this.colors.push(y=v.color,y,y),!0===a&&(void 0!==(y=o[0][c])?this.uvs.push(y[0],y[1],y[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new n,new n,new n))),!0===i&&(void 0!==(y=o[1][c])?this.uvs2.push(y[0],y[1],y[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new n,new n,new n))),y=0;y<l;y++){var _=s[y].vertices;u[y].push(_[v.a],_[v.b],_[v.c])}for(y=0;y<p;y++)h[y].push((_=d[y].vertexNormals[c]).a,_.b,_.c);g&&this.skinIndices.push(m[v.a],m[v.b],m[v.c]),$&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var aa=1;k.prototype=Object.assign(Object.create(t.prototype),{constructor:k,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){this.index=Array.isArray(e)?new(65535<U(e)?D:L)(e,1):e},addAttribute:function(e,t,n){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new E(t,n)))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;return void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0),void 0!==(t=this.attributes.normal)&&((new i).getNormalMatrix(e).applyToBufferAttribute(t),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new r;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new r;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new r;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new r;return function(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){var e=new r;return function(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new b;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new a;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){e=new I(3*t.vertices.length,3);var n=new I(3*t.colors.length,3);this.addAttribute("position",e.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new I(t.lineDistances.length,1),this.addAttribute("lineDistance",e.copyArray(t.lineDistances))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];t.push(o.x,o.y,o.z||0)}return this.addAttribute("position",new I(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var n=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(n=void 0,t.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(t);n.verticesNeedUpdate=t.verticesNeedUpdate,n.normalsNeedUpdate=t.normalsNeedUpdate,n.colorsNeedUpdate=t.colorsNeedUpdate,n.uvsNeedUpdate=t.uvsNeedUpdate,n.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=n}return!0===t.verticesNeedUpdate&&(void 0!==(n=this.attributes.position)&&(n.copyVector3sArray(t.vertices),n.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(n=this.attributes.normal)&&(n.copyVector3sArray(t.normals),n.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(n=this.attributes.color)&&(n.copyColorsArray(t.colors),n.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(n=this.attributes.uv)&&(n.copyVector2sArray(t.uvs),n.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(n=this.attributes.lineDistance)&&(n.copyArray(t.lineDistances),n.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new N).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);for(var n in this.addAttribute("position",new E(t,3).copyVector3sArray(e.vertices)),0<e.normals.length&&(t=new Float32Array(3*e.normals.length),this.addAttribute("normal",new E(t,3).copyVector3sArray(e.normals))),0<e.colors.length&&(t=new Float32Array(3*e.colors.length),this.addAttribute("color",new E(t,3).copyColorsArray(e.colors))),0<e.uvs.length&&(t=new Float32Array(2*e.uvs.length),this.addAttribute("uv",new E(t,2).copyVector2sArray(e.uvs))),0<e.uvs2.length&&(t=new Float32Array(2*e.uvs2.length),this.addAttribute("uv2",new E(t,2).copyVector2sArray(e.uvs2))),this.groups=e.groups,e.morphTargets){t=[];for(var r=e.morphTargets[n],o=0,a=r.length;o<a;o++){var i=r[o],s=new I(3*i.length,3);t.push(s.copyVector3sArray(i))}this.morphAttributes[n]=t}return 0<e.skinIndices.length&&(n=new I(4*e.skinIndices.length,4),this.addAttribute("skinIndex",n.copyVector4sArray(e.skinIndices))),0<e.skinWeights.length&&(n=new I(4*e.skinWeights.length,4),this.addAttribute("skinWeight",n.copyVector4sArray(e.skinWeights))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new p,t=new a;return function(){null===this.boundingSphere&&(this.boundingSphere=new h);var n=this.attributes.position;if(n){var r=this.boundingSphere.center;e.setFromBufferAttribute(n),e.getCenter(r);for(var o=0,a=0,i=n.count;a<i;a++)t.x=n.getX(a),t.y=n.getY(a),t.z=n.getZ(a),o=Math.max(o,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,n=this.groups;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new E(new Float32Array(r.length),3));else for(var o=t.normal.array,i=0,s=o.length;i<s;i++)o[i]=0;o=t.normal.array;var l=new a,u=new a,c=new a,d=new a,p=new a;if(e){e=e.array,0===n.length&&this.addGroup(0,e.length);for(var h=0,m=n.length;h<m;++h){var f=(i=n[h]).count;for(i=s=i.start,s+=f;i<s;i+=3){var g=3*e[i+1],$=3*e[i+2];l.fromArray(r,f=3*e[i+0]),u.fromArray(r,g),c.fromArray(r,$),d.subVectors(c,u),p.subVectors(l,u),d.cross(p),o[f]+=d.x,o[f+1]+=d.y,o[f+2]+=d.z,o[g]+=d.x,o[g+1]+=d.y,o[g+2]+=d.z,o[$]+=d.x,o[$+1]+=d.y,o[$+2]+=d.z}}}else for(i=0,s=r.length;i<s;i+=9)l.fromArray(r,i),u.fromArray(r,i+3),c.fromArray(r,i+6),d.subVectors(c,u),p.subVectors(l,u),d.cross(p),o[i]=d.x,o[i+1]=d.y,o[i+2]=d.z,o[i+3]=d.x,o[i+4]=d.y,o[i+5]=d.z,o[i+6]=d.x,o[i+7]=d.y,o[i+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n,r=this.attributes;for(n in r)if(void 0!==e.attributes[n]){var o=r[n].array,a=e.attributes[n],i=a.array,s=0;for(a=a.itemSize*t;s<i.length;s++,a++)o[a]=i[s]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new a;return function(){for(var t=this.attributes.normal,n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.normalize(),t.setXYZ(n,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e,t=new k,n=this.index.array,r=this.attributes;for(e in r){var o=r[e],a=o.array,i=o.itemSize,s=new a.constructor(n.length*i),l=0;o=0;for(var u=n.length;o<u;o++)for(var c=n[o]*i,d=0;d<i;d++)s[l++]=a[c++];t.addAttribute(e,new E(s,i))}for(o=0,u=(n=this.groups).length;o<u;o++)t.addGroup((r=n[o]).start,r.count,r.materialIndex);return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(o in t)void 0!==t[o]&&(e[o]=t[o]);return e}e.data={attributes:{}};var n=this.index;for(o in null!==n&&(t=Array.prototype.slice.call(n.array),e.data.index={type:n.array.constructor.name,array:t}),n=this.attributes){var r=n[o];t=Array.prototype.slice.call(r.array),e.data.attributes[o]={itemSize:r.itemSize,type:r.array.constructor.name,array:t,normalized:r.normalized}}var o=this.groups;return 0<o.length&&(e.data.groups=JSON.parse(JSON.stringify(o))),null!==(o=this.boundingSphere)&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e},clone:function(){return(new k).copy(this)},copy:function(e){var t;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var n=e.index;for(i in null!==n&&this.setIndex(n.clone()),n=e.attributes)this.addAttribute(i,n[i].clone());var r=e.morphAttributes;for(i in r){var o=[],a=r[i];for(n=0,t=a.length;n<t;n++)o.push(a[n].clone());this.morphAttributes[i]=o}var i=e.groups;for(n=0,t=i.length;n<t;n++)this.addGroup((r=i[n]).start,r.count,r.materialIndex);return null!==(i=e.boundingBox)&&(this.boundingBox=i.clone()),null!==(i=e.boundingSphere)&&(this.boundingSphere=i.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(H.prototype=Object.create(M.prototype)).constructor=H,(G.prototype=Object.create(k.prototype)).constructor=G,(V.prototype=Object.create(M.prototype)).constructor=V,(j.prototype=Object.create(k.prototype)).constructor=j;var ia=0;F.prototype=Object.assign(Object.create(t.prototype),{constructor:F,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0===n)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if("shading"===t)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else{var r=this[t];void 0===r?console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]="overdraw"===t?Number(n):n}}},toJSON:function(e){function t(e){var t,n=[];for(t in e){var r=e[t];delete r.metadata,n.push(r)}return n}var n=void 0===e||"string"==typeof e;n&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),0!==this.side&&(r.side=this.side),0!==this.vertexColors&&(r.vertexColors=this.vertexColors),1>this.opacity&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,0!==this.rotation&&(r.rotation=this.rotation),1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),n&&(n=t(e.textures),e=t(e.images),0<n.length&&(r.textures=n),0<e.length&&(r.images=e)),r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=Array(r);for(var o=0;o!==r;++o)n[o]=t[o].clone()}return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(z.prototype=Object.create(F.prototype)).constructor=z,z.prototype.isMeshBasicMaterial=!0,z.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},(B.prototype=Object.create(F.prototype)).constructor=B,B.prototype.isShaderMaterial=!0,B.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Qo.clone(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},B.prototype.toJSON=function(e){return(e=F.prototype.toJSON.call(this,e)).uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Object.assign(W.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new a),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new a;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new a),t.subVectors(e,this.origin),0>(e=t.dot(this.direction))?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new a;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return 0>n?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new a,t=new a,n=new a;return function(r,o,a,i){e.copy(r).add(o).multiplyScalar(.5),t.copy(o).sub(r).normalize(),n.copy(this.origin).sub(e);var s=.5*r.distanceTo(o),l=-this.direction.dot(t),u=n.dot(this.direction),c=-n.dot(t),d=n.lengthSq(),p=Math.abs(1-l*l);if(0<p){o=l*u-c;var h=s*p;0<=(r=l*c-u)?o>=-h?o<=h?l=(r*=s=1/p)*(r+l*(o*=s)+2*u)+o*(l*r+o+2*c)+d:(o=s,l=-(r=Math.max(0,-(l*o+u)))*r+o*(o+2*c)+d):(o=-s,l=-(r=Math.max(0,-(l*o+u)))*r+o*(o+2*c)+d):o<=-h?l=-(r=Math.max(0,-(-l*s+u)))*r+(o=0<r?-s:Math.min(Math.max(-s,-c),s))*(o+2*c)+d:o<=h?(r=0,l=(o=Math.min(Math.max(-s,-c),s))*(o+2*c)+d):l=-(r=Math.max(0,-(l*s+u)))*r+(o=0<r?s:Math.min(Math.max(-s,-c),s))*(o+2*c)+d}else o=0<l?-s:s,l=-(r=Math.max(0,-(l*o+u)))*r+o*(o+2*c)+d;return a&&a.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(t).multiplyScalar(o).add(e),l}}(),intersectSphere:function(){var e=new a;return function(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),o=e.dot(e)-r*r;return o>(t=t.radius*t.radius)?null:(o=r-(t=Math.sqrt(t-o)),r+=t,0>o&&0>r?null:this.at(0>o?r:o,n))}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:0<=(e=-(this.origin.dot(e.normal)+e.constant)/t)?e:null},intersectPlane:function(e,t){return null===(e=this.distanceToPlane(e))?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t},intersectBox:function(e,t){var n=1/this.direction.x,r=1/this.direction.y,o=1/this.direction.z,a=this.origin;if(0<=n){var i=(e.min.x-a.x)*n;n*=e.max.x-a.x}else i=(e.max.x-a.x)*n,n*=e.min.x-a.x;if(0<=r){var s=(e.min.y-a.y)*r;r*=e.max.y-a.y}else s=(e.max.y-a.y)*r,r*=e.min.y-a.y;return i>r||s>n?null:((s>i||i!=i)&&(i=s),(r<n||n!=n)&&(n=r),0<=o?(s=(e.min.z-a.z)*o,e=(e.max.z-a.z)*o):(s=(e.max.z-a.z)*o,e=(e.min.z-a.z)*o),i>e||s>n?null:((s>i||i!=i)&&(i=s),(e<n||n!=n)&&(n=e),0>n?null:this.at(0<=i?i:n,t)))},intersectsBox:function(){var e=new a;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new a,t=new a,n=new a,r=new a;return function(o,a,i,s,l){if(t.subVectors(a,o),n.subVectors(i,o),r.crossVectors(t,n),0<(a=this.direction.dot(r))){if(s)return null;s=1}else{if(!(0>a))return null;s=-1,a=-a}return e.subVectors(this.origin,o),0>(o=s*this.direction.dot(n.crossVectors(e,n)))?null:0>(i=s*this.direction.dot(t.cross(e)))||o+i>a?null:0>(o=-s*e.dot(r))?null:this.at(o/a,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Y,{getNormal:function(){var e=new a;return function(t,n,r,o){return void 0===o&&(console.warn("THREE.Triangle: .getNormal() target is now required"),o=new a),o.subVectors(r,n),e.subVectors(t,n),o.cross(e),0<(t=o.lengthSq())?o.multiplyScalar(1/Math.sqrt(t)):o.set(0,0,0)}}(),getBarycoord:function(){var e=new a,t=new a,n=new a;return function(r,o,i,s,l){e.subVectors(s,o),t.subVectors(i,o),n.subVectors(r,o),r=e.dot(e),o=e.dot(t),i=e.dot(n);var u=t.dot(t);s=t.dot(n);var c=r*u-o*o;return void 0===l&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),l=new a),0===c?l.set(-2,-1,-1):l.set(1-(u=(u*i-o*s)*(c=1/c))-(r=(r*s-o*i)*c),r,u)}}(),containsPoint:function(){var e=new a;return function(t,n,r,o){return Y.getBarycoord(t,n,r,o,e),0<=e.x&&0<=e.y&&1>=e.x+e.y}}()}),Object.assign(Y.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new a,t=new a;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new a),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Y.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new a),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Y.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Y.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new a,t=new a,n=new a,r=new a,o=new a,i=new a;return function(s,l){void 0===l&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),l=new a);var u=this.a,c=this.b,d=this.c;e.subVectors(c,u),t.subVectors(d,u),r.subVectors(s,u);var p=e.dot(r),h=t.dot(r);if(0>=p&&0>=h)return l.copy(u);o.subVectors(s,c);var m=e.dot(o),f=t.dot(o);if(0<=m&&f<=m)return l.copy(c);var g=p*f-m*h;if(0>=g&&0<=p&&0>=m)return c=p/(p-m),l.copy(u).addScaledVector(e,c);i.subVectors(s,d),s=e.dot(i);var $=t.dot(i);return 0<=$&&s<=$?l.copy(d):0>=(p=s*h-p*$)&&0<=h&&0>=$?(g=h/(h-$),l.copy(u).addScaledVector(t,g)):0>=(h=m*$-s*f)&&0<=f-m&&0<=s-$?(n.subVectors(d,c),g=(f-m)/(f-m+(s-$)),l.copy(c).addScaledVector(n,g)):(c=p*(d=1/(h+p+g)),g*=d,l.copy(u).addScaledVector(e,c).addScaledVector(t,g))}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),q.prototype=Object.assign(Object.create(b.prototype),{constructor:q,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return b.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var n=e[t[0]];if(void 0!==n)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=n.length;e<t;e++){var r=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}}else if(void 0!==(n=e.morphTargets)&&0<n.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=n.length;e<t;e++)r=n[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e},raycast:function(){function e(e,t,n,r,o,a,i){return Y.getBarycoord(e,t,n,r,y),o.multiplyScalar(y.x),a.multiplyScalar(y.y),i.multiplyScalar(y.z),o.add(a).add(i),o.clone()}function t(e,t,n,r,o,a,i,s){return null===(1===t.side?r.intersectTriangle(i,a,o,!0,s):r.intersectTriangle(o,a,i,2!==t.side,s))?null:(b.copy(s),b.applyMatrix4(e.matrixWorld),(t=n.ray.origin.distanceTo(b))<n.near||t>n.far?null:{distance:t,point:b.clone(),object:e})}function o(n,r,o,a,i,s,l,p,h){return u.fromBufferAttribute(i,l),c.fromBufferAttribute(i,p),d.fromBufferAttribute(i,h),(n=t(n,r,o,a,u,c,d,_))&&(s&&(g.fromBufferAttribute(s,l),$.fromBufferAttribute(s,p),v.fromBufferAttribute(s,h),n.uv=e(_,u,c,d,g,$,v)),s=new S(l,p,h),Y.getNormal(u,c,d,s.normal),n.face=s),n}var i=new r,s=new W,l=new h,u=new a,c=new a,d=new a,p=new a,m=new a,f=new a,g=new n,$=new n,v=new n,y=new a,_=new a,b=new a;return function(n,r){var a=this.geometry,h=this.material,y=this.matrixWorld;if(void 0!==h&&(null===a.boundingSphere&&a.computeBoundingSphere(),l.copy(a.boundingSphere),l.applyMatrix4(y),!1!==n.ray.intersectsSphere(l)&&(i.getInverse(y),s.copy(n.ray).applyMatrix4(i),null===a.boundingBox||!1!==s.intersectsBox(a.boundingBox))))if(a.isBufferGeometry){var b,x=a.index,w=a.attributes.position,S=a.attributes.uv,M=a.groups;if(a=a.drawRange,null!==x)if(Array.isArray(h)){var E=0;for(b=M.length;E<b;E++){var T=M[E],C=h[T.materialIndex];y=Math.max(T.start,a.start);var P=Math.min(T.start+T.count,a.start+a.count);for(T=y;T<P;T+=3){y=x.getX(T);var A=x.getX(T+1),L=x.getX(T+2);(y=o(this,C,n,s,w,S,y,A,L))&&(y.faceIndex=Math.floor(T/3),r.push(y))}}}else for(E=y=Math.max(0,a.start),b=P=Math.min(x.count,a.start+a.count);E<b;E+=3)y=x.getX(E),A=x.getX(E+1),L=x.getX(E+2),(y=o(this,h,n,s,w,S,y,A,L))&&(y.faceIndex=Math.floor(E/3),r.push(y));else if(void 0!==w)if(Array.isArray(h))for(E=0,b=M.length;E<b;E++)for(C=h[(T=M[E]).materialIndex],y=Math.max(T.start,a.start),P=Math.min(T.start+T.count,a.start+a.count),T=y;T<P;T+=3)(y=o(this,C,n,s,w,S,y=T,A=T+1,L=T+2))&&(y.faceIndex=Math.floor(T/3),r.push(y));else for(E=y=Math.max(0,a.start),b=P=Math.min(w.count,a.start+a.count);E<b;E+=3)(y=o(this,h,n,s,w,S,y=E,A=E+1,L=E+2))&&(y.faceIndex=Math.floor(E/3),r.push(y))}else if(a.isGeometry)for(w=Array.isArray(h),S=a.vertices,0<(y=a.faceVertexUvs[0]).length&&(x=y),T=0,P=(M=a.faces).length;T<P;T++)if(A=M[T],void 0!==(y=w?h[A.materialIndex]:h)){if(E=S[A.a],b=S[A.b],C=S[A.c],!0===y.morphTargets){L=a.morphTargets;var R=this.morphTargetInfluences;u.set(0,0,0),c.set(0,0,0),d.set(0,0,0);for(var D=0,I=L.length;D<I;D++){var O=R[D];if(0!==O){var N=L[D].vertices;u.addScaledVector(p.subVectors(N[A.a],E),O),c.addScaledVector(m.subVectors(N[A.b],b),O),d.addScaledVector(f.subVectors(N[A.c],C),O)}}u.add(E),c.add(b),d.add(C),E=u,b=c,C=d}(y=t(this,y,n,s,E,b,C,_))&&(x&&x[T]&&(g.copy((L=x[T])[0]),$.copy(L[1]),v.copy(L[2]),y.uv=e(_,E,b,C,g,$,v)),y.face=A,y.faceIndex=T,r.push(y))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var sa=function(e,t){this._instance=t,this.bind=function(n){return"object"==typeof n&&(Object.keys(e).forEach((function(e){if("function"!=typeof n[e])throw Error(typeof n+" must implement "+e)})),this._instance=n),t},this.resolve=function(){return this._instance}},la={log:function(){},error:function(){},warn:function(){},info:function(){},debug:function(){}},ua={debug:function(){return!1},allowedCachedPrograms:function(){return 50}},ca={Logger:new sa(la,la),Settings:new sa(ua,ua)},da={getWebGLProgramDiagnostics:function(e,t,n,r,o,a,i){var s=ca.Logger.resolve(),l=e.getProgramInfoLog(t).trim();n=e.getShaderInfoLog(n).trim(),r=e.getShaderInfoLog(r).trim();var u=!0,c=!0;return!1===e.getProgramParameter(t,e.LINK_STATUS)?(u=!1,s.error("THREE.WebGLProgram: shader error: ",e.getError(),"gl.VALIDATE_STATUS",e.getProgramParameter(t,e.VALIDATE_STATUS),"gl.getProgramInfoLog",l,n,r)):""!==l?s.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",l):""!==n&&""!==r||(c=!1),c?{runnable:u,material:i,programLog:l,vertexShader:{log:n,prefix:o},fragmentShader:{log:r,prefix:a}}:null}};(ie.prototype=Object.create(s.prototype)).constructor=ie,ie.prototype.isCubeTexture=!0,Object.defineProperty(ie.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var pa=new s,ha=new ie,ma=[],fa=[],ga=new Float32Array(16),$a=new Float32Array(9),va=new Float32Array(4);Oe.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ue(t,e)},Ne.prototype.setValue=function(e,t,n){for(var r=this.seq,o=0,a=r.length;o!==a;++o){var i=r[o];i.setValue(e,t[i.id],n)}};var ya=/([\w\d_]+)(\])?(\[|\.)?/g;Ue.prototype.setValue=function(e,t,n){void 0!==(t=this.map[t])&&t.setValue(e,n,this.renderer)},Ue.prototype.setOptional=function(e,t,n){void 0!==(t=t[n])&&this.setValue(e,n,t)},Ue.upload=function(e,t,n,r){for(var o=0,a=t.length;o!==a;++o){var i=t[o],s=n[i.id];!1!==s.needsUpdate&&i.setValue(e,s.value,r)}},Ue.seqWithValue=function(e,t){for(var n=[],r=0,o=e.length;r!==o;++r){var a=e[r];a.id in t&&n.push(a)}return n};var _a=function(){var e=ca.Logger.resolve();return{logShaderCompilationInformation:function(t,n,r,o){!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&e.error("THREE.WebGLShader: Shader couldn't compile."),""!==(n=t.getShaderInfoLog(n))&&e.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r===t.VERTEX_SHADER?"vertex":"fragment",n,function(e){e=e.split("\n");for(var t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(o))}}}(),ba=0,xa=ca.Logger.resolve();ca.Settings.resolve();var wa,Sa=0;(at.prototype=Object.create(F.prototype)).constructor=at,at.prototype.isMeshDepthMaterial=!0,at.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},(it.prototype=Object.create(F.prototype)).constructor=it,it.prototype.isMeshDistanceMaterial=!0,it.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},dt.prototype=Object.assign(Object.create(b.prototype),{constructor:dt,isGroup:!0}),pt.prototype=Object.assign(Object.create(x.prototype),{constructor:pt,isPerspectiveCamera:!0,copy:function(e,t){return x.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e,this.fov=2*Xo.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Xo.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Xo.RAD2DEG*Math.atan(Math.tan(.5*Xo.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,o,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Xo.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,o=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var i=a.fullWidth,s=a.fullHeight;o+=a.offsetX*r/i,t-=a.offsetY*n/s,r*=a.width/i,n*=a.height/s}0!==(a=this.filmOffset)&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-n,e,this.far)},toJSON:function(e){return(e=b.prototype.toJSON.call(this,e)).object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),ht.prototype=Object.assign(Object.create(pt.prototype),{constructor:ht,isArrayCamera:!0}),$t.prototype.isFogExp2=!0,$t.prototype.clone=function(){return new $t(this.color,this.density)},$t.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},vt.prototype.isFog=!0,vt.prototype.clone=function(){return new vt(this.color,this.near,this.far)},vt.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},yt.prototype=Object.assign(Object.create(b.prototype),{constructor:yt,copy:function(e,t){return b.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=b.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Object.defineProperty(_t.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(_t.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,o=this.stride;r<o;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(bt.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(bt.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,o){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=o,this}}),(xt.prototype=Object.create(F.prototype)).constructor=xt,xt.prototype.isSpriteMaterial=!0,xt.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},wt.prototype=Object.assign(Object.create(b.prototype),{constructor:wt,isSprite:!0,raycast:function(){function e(e,t,n,r,o,a){s.subVectors(e,n).addScalar(.5).multiply(r),void 0!==o?(l.x=a*s.x-o*s.y,l.y=o*s.x+a*s.y):l.copy(s),e.copy(t),e.x+=l.x,e.y+=l.y,e.applyMatrix4(u)}var t=new a,o=new a,i=new a,s=new n,l=new n,u=new r,c=new a,d=new a,p=new a;return function(n,r){o.setFromMatrixScale(this.matrixWorld),u.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),i.setFromMatrixPosition(this.modelViewMatrix);var a=this.material.rotation;if(0!==a)var s=Math.cos(a),l=Math.sin(a);a=this.center,e(c.set(-.5,-.5,0),i,a,o,l,s),e(d.set(.5,-.5,0),i,a,o,l,s),e(p.set(.5,.5,0),i,a,o,l,s);var h=n.ray.intersectTriangle(c,d,p,!1,t);null===h&&(e(d.set(-.5,.5,0),i,a,o,l,s),null===(h=n.ray.intersectTriangle(c,p,d,!1,t)))||(l=n.ray.origin.distanceTo(t))<n.near||l>n.far||r.push({distance:l,point:t.clone(),face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return b.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),St.prototype=Object.assign(Object.create(b.prototype),{constructor:St,copy:function(e){b.prototype.copy.call(this,e,!1);for(var t=0,n=(e=e.levels).length;t<n;t++){var r=e[t];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);n.splice(r,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object},raycast:function(){var e=new a;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,n)}}(),update:function(){var e=new a,t=new a;return function(n){var r=this.levels;if(1<r.length){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld),n=e.distanceTo(t),r[0].object.visible=!0;for(var o=1,a=r.length;o<a&&n>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<a;o++)r[o].object.visible=!1}}}(),toJSON:function(e){(e=b.prototype.toJSON.call(this,e)).object.levels=[];for(var t=this.levels,n=0,r=t.length;n<r;n++){var o=t[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),Object.assign(Mt.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new r;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n=0;for(t=this.bones.length;n<t;n++)(e=this.bones[n])&&e.matrixWorld.getInverse(this.boneInverses[n]);for(n=0,t=this.bones.length;n<t;n++)(e=this.bones[n])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new r,t=new r;return function(){for(var n=this.bones,r=this.boneInverses,o=this.boneMatrices,a=this.boneTexture,i=0,s=n.length;i<s;i++)e.multiplyMatrices(n[i]?n[i].matrixWorld:t,r[i]),e.toArray(o,16*i);void 0!==a&&(a.needsUpdate=!0)}}(),clone:function(){return new Mt(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),Et.prototype=Object.assign(Object.create(b.prototype),{constructor:Et,isBone:!0}),Tt.prototype=Object.assign(Object.create(q.prototype),{constructor:Tt,isSkinnedMesh:!0,initBones:function(){var e,t=[];if(this.geometry&&void 0!==this.geometry.bones){var n=0;for(e=this.geometry.bones.length;n<e;n++){var r=this.geometry.bones[n],o=new Et;t.push(o),o.name=r.name,o.position.fromArray(r.pos),o.quaternion.fromArray(r.rotq),void 0!==r.scl&&o.scale.fromArray(r.scl)}for(n=0,e=this.geometry.bones.length;n<e;n++)-1!==(r=this.geometry.bones[n]).parent&&null!==r.parent&&void 0!==t[r.parent]?t[r.parent].add(t[n]):this.add(t[n])}return this.updateMatrixWorld(!0),t},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e],n=1/t.manhattanLength();1/0!==n?t.multiplyScalar(n):t.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){t=new l;var r=this.geometry.attributes.skinWeight;for(e=0;e<r.count;e++)t.x=r.getX(e),t.y=r.getY(e),t.z=r.getZ(e),t.w=r.getW(e),1/0!=(n=1/t.manhattanLength())?t.multiplyScalar(n):t.set(1,0,0,0),r.setXYZW(e,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(e){q.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(Ct.prototype=Object.create(F.prototype)).constructor=Ct,Ct.prototype.isLineBasicMaterial=!0,Ct.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Pt.prototype=Object.assign(Object.create(b.prototype),{constructor:Pt,isLine:!0,computeLineDistances:function(){var e=new a,t=new a;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var r=n.attributes.position,o=[0],a=1,i=r.count;a<i;a++)e.fromBufferAttribute(r,a-1),t.fromBufferAttribute(r,a),o[a]=o[a-1],o[a]+=e.distanceTo(t);n.addAttribute("lineDistance",new I(o,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry)for(r=n.vertices,(o=n.lineDistances)[0]=0,a=1,i=r.length;a<i;a++)o[a]=o[a-1],o[a]+=r[a-1].distanceTo(r[a]);return this}}(),raycast:function(){var e=new r,t=new W,n=new h;return function(r,o){var i=r.linePrecision;i*=i;var s=this.geometry,l=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(l),!1!==r.ray.intersectsSphere(n)){e.getInverse(l),t.copy(r.ray).applyMatrix4(e);var u=new a,c=new a;l=new a;var d=new a,p=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var h=s.index,m=s.attributes.position.array;if(null!==h){s=0;for(var f=(h=h.array).length-1;s<f;s+=p){var g=h[s+1];u.fromArray(m,3*h[s]),c.fromArray(m,3*g),(g=t.distanceSqToSegment(u,c,d,l))>i||(d.applyMatrix4(this.matrixWorld),(g=r.ray.origin.distanceTo(d))<r.near||g>r.far||o.push({distance:g,point:l.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}}else for(s=0,f=m.length/3-1;s<f;s+=p)u.fromArray(m,3*s),c.fromArray(m,3*s+3),(g=t.distanceSqToSegment(u,c,d,l))>i||(d.applyMatrix4(this.matrixWorld),(g=r.ray.origin.distanceTo(d))<r.near||g>r.far||o.push({distance:g,point:l.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}else if(s.isGeometry)for(c=(u=s.vertices).length,s=0;s<c-1;s+=p)(g=t.distanceSqToSegment(u[s],u[s+1],d,l))>i||(d.applyMatrix4(this.matrixWorld),(g=r.ray.origin.distanceTo(d))<r.near||g>r.far||o.push({distance:g,point:l.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),At.prototype=Object.assign(Object.create(Pt.prototype),{constructor:At,isLineSegments:!0,computeLineDistances:function(){var e=new a,t=new a;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var r=n.attributes.position,o=[],a=0,i=r.count;a<i;a+=2)e.fromBufferAttribute(r,a),t.fromBufferAttribute(r,a+1),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+e.distanceTo(t);n.addAttribute("lineDistance",new I(o,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry)for(o=n.lineDistances,a=0,i=(r=n.vertices).length;a<i;a+=2)e.copy(r[a]),t.copy(r[a+1]),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+e.distanceTo(t);return this}}()}),Lt.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Lt,isLineLoop:!0}),(Rt.prototype=Object.create(F.prototype)).constructor=Rt,Rt.prototype.isPointsMaterial=!0,Rt.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Dt.prototype=Object.assign(Object.create(b.prototype),{constructor:Dt,isPoints:!0,raycast:function(){var e=new r,t=new W,n=new h;return function(r,o){function i(e,n){var a=t.distanceSqToPoint(e);a<d&&(t.closestPointToPoint(e,p),p.applyMatrix4(u),(e=r.ray.origin.distanceTo(p))<r.near||e>r.far||o.push({distance:e,distanceToRay:Math.sqrt(a),point:p.clone(),index:n,face:null,object:s}))}var s=this,l=this.geometry,u=this.matrixWorld,c=r.params.Points.threshold;if(null===l.boundingSphere&&l.computeBoundingSphere(),n.copy(l.boundingSphere),n.applyMatrix4(u),n.radius+=c,!1!==r.ray.intersectsSphere(n)){e.getInverse(u),t.copy(r.ray).applyMatrix4(e);var d=(c/=(this.scale.x+this.scale.y+this.scale.z)/3)*c;c=new a;var p=new a;if(l.isBufferGeometry){var h=l.index;if(l=l.attributes.position.array,null!==h){var m=h.array;h=0;for(var f=m.length;h<f;h++){var g=m[h];c.fromArray(l,3*g),i(c,g)}}else for(h=0,m=l.length/3;h<m;h++)c.fromArray(l,3*h),i(c,h)}else for(h=0,m=(c=l.vertices).length;h<m;h++)i(c[h],h)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),It.prototype=Object.assign(Object.create(s.prototype),{constructor:It,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(Ot.prototype=Object.create(s.prototype)).constructor=Ot,Ot.prototype.isCompressedTexture=!0,(Nt.prototype=Object.create(s.prototype)).constructor=Nt,Nt.prototype.isCanvasTexture=!0,(Ut.prototype=Object.create(s.prototype)).constructor=Ut,Ut.prototype.isDepthTexture=!0,(kt.prototype=Object.create(k.prototype)).constructor=kt,(Ht.prototype=Object.create(M.prototype)).constructor=Ht,(Gt.prototype=Object.create(k.prototype)).constructor=Gt,(Vt.prototype=Object.create(M.prototype)).constructor=Vt,(jt.prototype=Object.create(k.prototype)).constructor=jt,(Ft.prototype=Object.create(M.prototype)).constructor=Ft,(zt.prototype=Object.create(jt.prototype)).constructor=zt,(Bt.prototype=Object.create(M.prototype)).constructor=Bt,(Wt.prototype=Object.create(jt.prototype)).constructor=Wt,(Yt.prototype=Object.create(M.prototype)).constructor=Yt,(qt.prototype=Object.create(jt.prototype)).constructor=qt,(Xt.prototype=Object.create(M.prototype)).constructor=Xt,(Zt.prototype=Object.create(jt.prototype)).constructor=Zt,(Jt.prototype=Object.create(M.prototype)).constructor=Jt,(Kt.prototype=Object.create(k.prototype)).constructor=Kt,(Qt.prototype=Object.create(M.prototype)).constructor=Qt,(en.prototype=Object.create(k.prototype)).constructor=en,(tn.prototype=Object.create(M.prototype)).constructor=tn,(nn.prototype=Object.create(k.prototype)).constructor=nn;var Ma={area:function(e){for(var t=e.length,n=0,r=t-1,o=0;o<t;r=o++)n+=e[r].x*e[o].y-e[o].x*e[r].y;return.5*n},isClockWise:function(e){return 0>Ma.area(e)},triangulateShape:function(e,t){var n=[],r=[],o=[];yn(e),_n(n,e);var a=e.length;for(t.forEach(yn),e=0;e<t.length;e++)r.push(a),a+=t[e].length,_n(n,t[e]);for(t=function(e,t,n){n=n||2;var r,o=t&&t.length,a=o?t[0]*n:e.length,i=rn(e,0,a,n,!0),s=[];if(!i)return s;if(o){var l,u=n;o=[];var c=0;for(l=t.length;c<l;c++){var d=t[c]*u;(d=rn(e,d,c<l-1?t[c+1]*u:e.length,u,!1))===d.next&&(d.steiner=!0),o.push(un(d))}for(o.sort(an),c=0;c<o.length;c++)(u=sn(t=o[c],u=i))&&on(t=fn(u,t),t.next),i=on(i,i.next)}if(e.length>80*n){var p=r=e[0],h=o=e[1];for(u=n;u<a;u+=n)(c=e[u])<p&&(p=c),(t=e[u+1])<h&&(h=t),c>r&&(r=c),t>o&&(o=t);r=0!==(r=Math.max(r-p,o-h))?1/r:0}return function e(t,n,r,o,a,i,s){if(t){if(!s&&i){var l=t,u=l;do{null===u.z&&(u.z=ln(u.x,u.y,o,a,i)),u.prevZ=u.prev,u=u.nextZ=u.next}while(u!==l);u.prevZ.nextZ=null,u.prevZ=null,l=u;var c,d,p,h,m=1;do{u=l;var f=l=null;for(d=0;u;){d++;var g=u;for(c=p=0;c<m&&(p++,g=g.nextZ);c++);for(h=m;0<p||0<h&&g;)0!==p&&(0===h||!g||u.z<=g.z)?(c=u,u=u.nextZ,p--):(c=g,g=g.nextZ,h--),f?f.nextZ=c:l=c,c.prevZ=f,f=c;u=g}f.nextZ=null,m*=2}while(1<d)}for(l=t;t.prev!==t.next;){if(u=t.prev,g=t.next,i)e:{h=o;var $=a,v=i;if(0<=dn(d=(f=t).prev,p=f,m=f.next))f=!1;else{var y=d.x>p.x?d.x>m.x?d.x:m.x:p.x>m.x?p.x:m.x,_=d.y>p.y?d.y>m.y?d.y:m.y:p.y>m.y?p.y:m.y;for(c=ln(d.x<p.x?d.x<m.x?d.x:m.x:p.x<m.x?p.x:m.x,d.y<p.y?d.y<m.y?d.y:m.y:p.y<m.y?p.y:m.y,h,$,v),h=ln(y,_,h,$,v),$=f.nextZ;$&&$.z<=h;){if($!==f.prev&&$!==f.next&&cn(d.x,d.y,p.x,p.y,m.x,m.y,$.x,$.y)&&0<=dn($.prev,$,$.next)){f=!1;break e}$=$.nextZ}for($=f.prevZ;$&&$.z>=c;){if($!==f.prev&&$!==f.next&&cn(d.x,d.y,p.x,p.y,m.x,m.y,$.x,$.y)&&0<=dn($.prev,$,$.next)){f=!1;break e}$=$.prevZ}f=!0}}else e:if(f=t,d=f.prev,p=f,m=f.next,0<=dn(d,p,m))f=!1;else{for(c=f.next.next;c!==f.prev;){if(cn(d.x,d.y,p.x,p.y,m.x,m.y,c.x,c.y)&&0<=dn(c.prev,c,c.next)){f=!1;break e}c=c.next}f=!0}if(f)n.push(u.i/r),n.push(t.i/r),n.push(g.i/r),$n(t),l=t=g.next;else if((t=g)===l){if(s){if(1===s){s=n,l=r,u=t;do{!pn(g=u.prev,f=u.next.next)&&hn(g,u,u.next,f)&&mn(g,f)&&mn(f,g)&&(s.push(g.i/l),s.push(u.i/l),s.push(f.i/l),$n(u),$n(u.next),u=t=f),u=u.next}while(u!==t);e(t=u,n,r,o,a,i,2)}else if(2===s)e:{s=t;do{for(l=s.next.next;l!==s.prev;){if(u=s.i!==l.i){if(f=(u=s).next.i!==(g=l).i&&u.prev.i!==g.i){t:{f=u;do{if(f.i!==u.i&&f.next.i!==u.i&&f.i!==g.i&&f.next.i!==g.i&&hn(f,f.next,u,g)){f=!0;break t}f=f.next}while(f!==u);f=!1}f=!f}if(f=f&&mn(u,g)&&mn(g,u)){f=u,d=!1,p=(u.x+g.x)/2,g=(u.y+g.y)/2;do{f.y>g!=f.next.y>g&&f.next.y!==f.y&&p<(f.next.x-f.x)*(g-f.y)/(f.next.y-f.y)+f.x&&(d=!d),f=f.next}while(f!==u);f=d}u=f}if(u){t=fn(s,l),s=on(s,s.next),t=on(t,t.next),e(s,n,r,o,a,i),e(t,n,r,o,a,i);break e}l=l.next}s=s.next}while(s!==t)}}else e(on(t),n,r,o,a,i,1);break}}}}(i,s,n,p,h,r),s}(n,r),e=0;e<t.length;e+=3)o.push(t.slice(e,e+3));return o}};(bn.prototype=Object.create(M.prototype)).constructor=bn,bn.prototype.toJSON=function(){var e=M.prototype.toJSON.call(this);return wn(this.parameters.shapes,this.parameters.options,e)},(xn.prototype=Object.create(k.prototype)).constructor=xn,xn.prototype.toJSON=function(){var e=k.prototype.toJSON.call(this);return wn(this.parameters.shapes,this.parameters.options,e)};var Ea={generateTopUV:function(e,t,r,o,a){e=t[3*o],o=t[3*o+1];var i=t[3*a];return a=t[3*a+1],[new n(t[3*r],t[3*r+1]),new n(e,o),new n(i,a)]},generateSideWallUV:function(e,t,r,o,a,i){e=t[3*r];var s=t[3*r+1];r=t[3*r+2];var l=t[3*o],u=t[3*o+1];o=t[3*o+2];var c=t[3*a],d=t[3*a+1];a=t[3*a+2];var p=t[3*i],h=t[3*i+1];return t=t[3*i+2],.01>Math.abs(s-u)?[new n(e,1-r),new n(l,1-o),new n(c,1-a),new n(p,1-t)]:[new n(s,1-r),new n(u,1-o),new n(d,1-a),new n(h,1-t)]}};(Sn.prototype=Object.create(M.prototype)).constructor=Sn,(Mn.prototype=Object.create(xn.prototype)).constructor=Mn,(En.prototype=Object.create(M.prototype)).constructor=En,(Tn.prototype=Object.create(k.prototype)).constructor=Tn,(Cn.prototype=Object.create(M.prototype)).constructor=Cn,(Pn.prototype=Object.create(k.prototype)).constructor=Pn,(An.prototype=Object.create(M.prototype)).constructor=An,(Ln.prototype=Object.create(k.prototype)).constructor=Ln,(Rn.prototype=Object.create(M.prototype)).constructor=Rn,Rn.prototype.toJSON=function(){var e=M.prototype.toJSON.call(this);return In(this.parameters.shapes,e)},(Dn.prototype=Object.create(k.prototype)).constructor=Dn,Dn.prototype.toJSON=function(){var e=k.prototype.toJSON.call(this);return In(this.parameters.shapes,e)},(On.prototype=Object.create(k.prototype)).constructor=On,(Nn.prototype=Object.create(M.prototype)).constructor=Nn,(Un.prototype=Object.create(k.prototype)).constructor=Un,(kn.prototype=Object.create(Nn.prototype)).constructor=kn,(Hn.prototype=Object.create(Un.prototype)).constructor=Hn,(Gn.prototype=Object.create(M.prototype)).constructor=Gn,(Vn.prototype=Object.create(k.prototype)).constructor=Vn;var Ta=Object.freeze({WireframeGeometry:kt,ParametricGeometry:Ht,ParametricBufferGeometry:Gt,TetrahedronGeometry:Ft,TetrahedronBufferGeometry:zt,OctahedronGeometry:Bt,OctahedronBufferGeometry:Wt,IcosahedronGeometry:Yt,IcosahedronBufferGeometry:qt,DodecahedronGeometry:Xt,DodecahedronBufferGeometry:Zt,PolyhedronGeometry:Vt,PolyhedronBufferGeometry:jt,TubeGeometry:Jt,TubeBufferGeometry:Kt,TorusKnotGeometry:Qt,TorusKnotBufferGeometry:en,TorusGeometry:tn,TorusBufferGeometry:nn,TextGeometry:Sn,TextBufferGeometry:Mn,SphereGeometry:En,SphereBufferGeometry:Tn,RingGeometry:Cn,RingBufferGeometry:Pn,PlaneGeometry:V,PlaneBufferGeometry:j,LatheGeometry:An,LatheBufferGeometry:Ln,ShapeGeometry:Rn,ShapeBufferGeometry:Dn,ExtrudeGeometry:bn,ExtrudeBufferGeometry:xn,EdgesGeometry:On,ConeGeometry:kn,ConeBufferGeometry:Hn,CylinderGeometry:Nn,CylinderBufferGeometry:Un,CircleGeometry:Gn,CircleBufferGeometry:Vn,BoxGeometry:H,BoxBufferGeometry:G});(jn.prototype=Object.create(F.prototype)).constructor=jn,jn.prototype.isShadowMaterial=!0,jn.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.color.copy(e.color),this},(Fn.prototype=Object.create(B.prototype)).constructor=Fn,Fn.prototype.isRawShaderMaterial=!0,(zn.prototype=Object.create(F.prototype)).constructor=zn,zn.prototype.isMeshStandardMaterial=!0,zn.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Bn.prototype=Object.create(zn.prototype)).constructor=Bn,Bn.prototype.isMeshPhysicalMaterial=!0,Bn.prototype.copy=function(e){return zn.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},(Wn.prototype=Object.create(F.prototype)).constructor=Wn,Wn.prototype.isMeshPhongMaterial=!0,Wn.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Yn.prototype=Object.create(Wn.prototype)).constructor=Yn,Yn.prototype.isMeshToonMaterial=!0,Yn.prototype.copy=function(e){return Wn.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},(qn.prototype=Object.create(F.prototype)).constructor=qn,qn.prototype.isMeshNormalMaterial=!0,qn.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Xn.prototype=Object.create(F.prototype)).constructor=Xn,Xn.prototype.isMeshLambertMaterial=!0,Xn.prototype.copy=function(e){return F.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Zn.prototype=Object.create(Ct.prototype)).constructor=Zn,Zn.prototype.isLineDashedMaterial=!0,Zn.prototype.copy=function(e){return Ct.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Ca=Object.freeze({ShadowMaterial:jn,SpriteMaterial:xt,RawShaderMaterial:Fn,ShaderMaterial:B,PointsMaterial:Rt,MeshPhysicalMaterial:Bn,MeshStandardMaterial:zn,MeshPhongMaterial:Wn,MeshToonMaterial:Yn,MeshNormalMaterial:qn,MeshLambertMaterial:Xn,MeshDepthMaterial:at,MeshDistanceMaterial:it,MeshBasicMaterial:z,LineDashedMaterial:Zn,LineBasicMaterial:Ct,Material:F}),Pa={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Aa=new Jn,La={};Object.assign(Kn.prototype,{load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,a=Pa.get(e);if(void 0!==a)return o.manager.itemStart(e),setTimeout((function(){t&&t(a),o.manager.itemEnd(e)}),0),a;if(void 0===La[e]){var i=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){n=i[1];var s=!!i[2];i=i[3],i=window.decodeURIComponent(i),s&&(i=window.atob(i));try{var l=(this.responseType||"").toLowerCase();switch(l){case"arraybuffer":case"blob":var u=new Uint8Array(i.length);for(s=0;s<i.length;s++)u[s]=i.charCodeAt(s);var c="blob"===l?new Blob([u.buffer],{type:n}):u.buffer;break;case"document":c=(new DOMParser).parseFromString(i,n);break;case"json":c=JSON.parse(i);break;default:c=i}window.setTimeout((function(){t&&t(c),o.manager.itemEnd(e)}),0)}catch(p){window.setTimeout((function(){r&&r(p),o.manager.itemEnd(e),o.manager.itemError(e)}),0)}}else{La[e]=[],La[e].push({onLoad:t,onProgress:n,onError:r});var d=new XMLHttpRequest;for(s in d.open("GET",e,!0),d.addEventListener("load",(function(t){var n=this.response;Pa.add(e,n);var r=La[e];if(delete La[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,i=r.length;a<i;a++){var s=r[a];s.onLoad&&s.onLoad(n)}o.manager.itemEnd(e)}else{for(a=0,i=r.length;a<i;a++)(s=r[a]).onError&&s.onError(t);o.manager.itemEnd(e),o.manager.itemError(e)}}),!1),d.addEventListener("progress",(function(t){for(var n=La[e],r=0,o=n.length;r<o;r++){var a=n[r];a.onProgress&&a.onProgress(t)}}),!1),d.addEventListener("error",(function(t){var n=La[e];delete La[e];for(var r=0,a=n.length;r<a;r++){var i=n[r];i.onError&&i.onError(t)}o.manager.itemEnd(e),o.manager.itemError(e)}),!1),void 0!==this.responseType&&(d.responseType=this.responseType),void 0!==this.withCredentials&&(d.withCredentials=this.withCredentials),d.overrideMimeType&&d.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)d.setRequestHeader(s,this.requestHeader[s]);d.send(null)}return o.manager.itemStart(e),d}La[e].push({onLoad:t,onProgress:n,onError:r})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Qn.prototype,{load:function(e,t,n,r){function o(o){l.load(e[o],(function(e){e=a._parser(e,!0),i[o]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(u+=1)&&(1===e.mipmapCount&&(s.minFilter=1006),s.format=e.format,s.needsUpdate=!0,t&&t(s))}),n,r)}var a=this,i=[],s=new Ot;s.image=i;var l=new Kn(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,c=0,d=e.length;c<d;++c)o(c);else l.load(e,(function(e){if((e=a._parser(e,!0)).isCubemap)for(var n=e.mipmaps.length/e.mipmapCount,r=0;r<n;r++){i[r]={mipmaps:[]};for(var o=0;o<e.mipmapCount;o++)i[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+o]),i[r].format=e.format,i[r].width=e.width,i[r].height=e.height}else s.image.width=e.width,s.image.height=e.height,s.mipmaps=e.mipmaps;1===e.mipmapCount&&(s.minFilter=1006),s.format=e.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s},setPath:function(e){return this.path=e,this}}),Object.assign(er.prototype,{load:function(e,t,n,r){var o=this,a=new d,i=new Kn(this.manager);return i.setResponseType("arraybuffer"),i.load(e,(function(e){(e=o._parser(e))&&(void 0!==e.image?a.image=e.image:void 0!==e.data&&(a.image.width=e.width,a.image.height=e.height,a.image.data=e.data),a.wrapS=void 0!==e.wrapS?e.wrapS:1001,a.wrapT=void 0!==e.wrapT?e.wrapT:1001,a.magFilter=void 0!==e.magFilter?e.magFilter:1006,a.minFilter=void 0!==e.minFilter?e.minFilter:1008,a.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(a.format=e.format),void 0!==e.type&&(a.type=e.type),void 0!==e.mipmaps&&(a.mipmaps=e.mipmaps),1===e.mipmapCount&&(a.minFilter=1006),a.needsUpdate=!0,t&&t(a,e))}),n,r),a}}),Object.assign(tr.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){function o(){l.removeEventListener("load",o,!1),l.removeEventListener("error",a,!1),Pa.add(e,this),t&&t(this),i.manager.itemEnd(e)}function a(t){l.removeEventListener("load",o,!1),l.removeEventListener("error",a,!1),r&&r(t),i.manager.itemEnd(e),i.manager.itemError(e)}void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,s=Pa.get(e);if(void 0!==s)return i.manager.itemStart(e),setTimeout((function(){t&&t(s),i.manager.itemEnd(e)}),0),s;var l=document.createElementNS("http://www.w3.org/1999/xhtml","img");return l.addEventListener("load",o,!1),l.addEventListener("error",a,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),i.manager.itemStart(e),l.src=e,l},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(nr.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){function o(n){i.load(e[n],(function(e){a.images[n]=e,6==++s&&(a.needsUpdate=!0,t&&t(a))}),void 0,r)}var a=new ie,i=new tr(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);var s=0;for(n=0;n<e.length;++n)o(n);return a},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(rr.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){var o=new s,a=new tr(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(n){o.image=n,n=0<e.search(/\.(jpg|jpeg)$/)||0===e.search(/^data:image\/jpeg/),o.format=n?1022:1023,o.needsUpdate=!0,void 0!==t&&t(o)}),n,r),o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(or.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){return e=this.getUtoTmapping(e),this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),o=0;for(n.push(0),t=1;t<=e;t++){var a=this.getPoint(t/e);o+=a.distanceTo(r),n.push(o),r=a}return this.cacheArcLengths=n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n=this.getLengths(),r=n.length;t=t||e*n[r-1];for(var o,a=0,i=r-1;a<=i;)if(0>(o=n[e=Math.floor(a+(i-a)/2)]-t))a=e+1;else{if(!(0<o)){i=e;break}i=e-1}return n[e=i]===t?e/(r-1):(e+(t-(a=n[e]))/(n[e+1]-a))/(r-1)},getTangent:function(e){var t=e-1e-4;return 0>t&&(t=0),1<(e+=1e-4)&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},computeFrenetFrames:function(e,t){var n,o=new a,i=[],s=[],l=[],u=new a,c=new r;for(n=0;n<=e;n++){var d=n/e;i[n]=this.getTangentAt(d),i[n].normalize()}s[0]=new a,l[0]=new a,n=Number.MAX_VALUE,d=Math.abs(i[0].x);var p=Math.abs(i[0].y),h=Math.abs(i[0].z);for(d<=n&&(n=d,o.set(1,0,0)),p<=n&&(n=p,o.set(0,1,0)),h<=n&&o.set(0,0,1),u.crossVectors(i[0],o).normalize(),s[0].crossVectors(i[0],u),l[0].crossVectors(i[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),l[n]=l[n-1].clone(),u.crossVectors(i[n-1],i[n]),u.length()>Number.EPSILON&&(u.normalize(),o=Math.acos(Xo.clamp(i[n-1].dot(i[n]),-1,1)),s[n].applyMatrix4(c.makeRotationAxis(u,o))),l[n].crossVectors(i[n],s[n]);if(!0===t)for(o=Math.acos(Xo.clamp(s[0].dot(s[e]),-1,1)),o/=e,0<i[0].dot(u.crossVectors(s[0],s[e]))&&(o=-o),n=1;n<=e;n++)s[n].applyMatrix4(c.makeRotationAxis(i[n],o*n)),l[n].crossVectors(i[n],s[n]);return{tangents:i,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),(ar.prototype=Object.create(or.prototype)).constructor=ar,ar.prototype.isEllipseCurve=!0,ar.prototype.getPoint=function(e,t){t=t||new n;for(var r=2*Math.PI,o=this.aEndAngle-this.aStartAngle,a=Math.abs(o)<Number.EPSILON;0>o;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(o=a?0:r),!0!==this.aClockwise||a||(o=o===r?-r:o-r),r=this.aStartAngle+e*o,e=this.aX+this.xRadius*Math.cos(r);var i=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(r=Math.cos(this.aRotation),o=Math.sin(this.aRotation),e=(a=e-this.aX)*r-(i-=this.aY)*o+this.aX,i=a*o+i*r+this.aY),t.set(e,i)},ar.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ar.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},ar.prototype.fromJSON=function(e){return or.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},(ir.prototype=Object.create(ar.prototype)).constructor=ir,ir.prototype.isArcCurve=!0;var Ra=new a,Da=new sr,Ia=new sr,Oa=new sr;(lr.prototype=Object.create(or.prototype)).constructor=lr,lr.prototype.isCatmullRomCurve3=!0,lr.prototype.getPoint=function(e,t){t=t||new a;var n=this.points,r=n.length;e*=r-(this.closed?0:1);var o=Math.floor(e);if(e-=o,this.closed?o+=0<o?0:(Math.floor(Math.abs(o)/r)+1)*r:0===e&&o===r-1&&(o=r-2,e=1),this.closed||0<o)var i=n[(o-1)%r];else Ra.subVectors(n[0],n[1]).add(n[0]),i=Ra;var s=n[o%r],l=n[(o+1)%r];if(this.closed||o+2<r?n=n[(o+2)%r]:(Ra.subVectors(n[r-1],n[r-2]).add(n[r-1]),n=Ra),"centripetal"===this.curveType||"chordal"===this.curveType){var u="chordal"===this.curveType?.5:.25;r=Math.pow(i.distanceToSquared(s),u),1e-4>(o=Math.pow(s.distanceToSquared(l),u))&&(o=1),1e-4>r&&(r=o),1e-4>(u=Math.pow(l.distanceToSquared(n),u))&&(u=o),Da.initNonuniformCatmullRom(i.x,s.x,l.x,n.x,r,o,u),Ia.initNonuniformCatmullRom(i.y,s.y,l.y,n.y,r,o,u),Oa.initNonuniformCatmullRom(i.z,s.z,l.z,n.z,r,o,u)}else"catmullrom"===this.curveType&&(Da.initCatmullRom(i.x,s.x,l.x,n.x,this.tension),Ia.initCatmullRom(i.y,s.y,l.y,n.y,this.tension),Oa.initCatmullRom(i.z,s.z,l.z,n.z,this.tension));return t.set(Da.calc(e),Ia.calc(e),Oa.calc(e)),t},lr.prototype.copy=function(e){or.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},lr.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},lr.prototype.fromJSON=function(e){or.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new a).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},(pr.prototype=Object.create(or.prototype)).constructor=pr,pr.prototype.isCubicBezierCurve=!0,pr.prototype.getPoint=function(e,t){t=t||new n;var r=this.v0,o=this.v1,a=this.v2,i=this.v3;return t.set(dr(e,r.x,o.x,a.x,i.x),dr(e,r.y,o.y,a.y,i.y)),t},pr.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},pr.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},pr.prototype.fromJSON=function(e){return or.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},(hr.prototype=Object.create(or.prototype)).constructor=hr,hr.prototype.isCubicBezierCurve3=!0,hr.prototype.getPoint=function(e,t){t=t||new a;var n=this.v0,r=this.v1,o=this.v2,i=this.v3;return t.set(dr(e,n.x,r.x,o.x,i.x),dr(e,n.y,r.y,o.y,i.y),dr(e,n.z,r.z,o.z,i.z)),t},hr.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},hr.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},hr.prototype.fromJSON=function(e){return or.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},(mr.prototype=Object.create(or.prototype)).constructor=mr,mr.prototype.isLineCurve=!0,mr.prototype.getPoint=function(e,t){return t=t||new n,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},mr.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},mr.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},mr.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},mr.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},mr.prototype.fromJSON=function(e){return or.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(fr.prototype=Object.create(or.prototype)).constructor=fr,fr.prototype.isLineCurve3=!0,fr.prototype.getPoint=function(e,t){return t=t||new a,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},fr.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},fr.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},fr.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},fr.prototype.fromJSON=function(e){return or.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(gr.prototype=Object.create(or.prototype)).constructor=gr,gr.prototype.isQuadraticBezierCurve=!0,gr.prototype.getPoint=function(e,t){t=t||new n;var r=this.v0,o=this.v1,a=this.v2;return t.set(cr(e,r.x,o.x,a.x),cr(e,r.y,o.y,a.y)),t},gr.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},gr.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},gr.prototype.fromJSON=function(e){return or.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},($r.prototype=Object.create(or.prototype)).constructor=$r,$r.prototype.isQuadraticBezierCurve3=!0,$r.prototype.getPoint=function(e,t){t=t||new a;var n=this.v0,r=this.v1,o=this.v2;return t.set(cr(e,n.x,r.x,o.x),cr(e,n.y,r.y,o.y),cr(e,n.z,r.z,o.z)),t},$r.prototype.copy=function(e){return or.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},$r.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},$r.prototype.fromJSON=function(e){return or.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(vr.prototype=Object.create(or.prototype)).constructor=vr,vr.prototype.isSplineCurve=!0,vr.prototype.getPoint=function(e,t){t=t||new n;var r=this.points,o=(r.length-1)*e,a=r[0===(e=Math.floor(o))?e:e-1],i=r[e],s=r[e>r.length-2?r.length-1:e+1];return t.set(ur(o-=e,a.x,i.x,s.x,(r=r[e>r.length-3?r.length-1:e+2]).x),ur(o,a.y,i.y,s.y,r.y)),t},vr.prototype.copy=function(e){or.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this},vr.prototype.toJSON=function(){var e=or.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e},vr.prototype.fromJSON=function(e){or.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var o=e.points[t];this.points.push((new n).fromArray(o))}return this};var Na=Object.freeze({ArcCurve:ir,CatmullRomCurve3:lr,CubicBezierCurve:pr,CubicBezierCurve3:hr,EllipseCurve:ar,LineCurve:mr,LineCurve3:fr,QuadraticBezierCurve:gr,QuadraticBezierCurve3:$r,SplineCurve:vr});yr.prototype=Object.assign(Object.create(or.prototype),{constructor:yr,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new mr(t,e))},getPoint:function(e){var t=e*this.getLength(),n=this.getCurveLengths();for(e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,n=(e=this.curves[e]).getLength(),e.getPointAt(0===n?0:1-t/n);e++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,o=this.curves;r<o.length;r++){var a=o[r];a=a.getPoints(a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e);for(var i=0;i<a.length;i++){var s=a[i];t&&t.equals(s)||(n.push(s),t=s)}}return this.autoClose&&1<n.length&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){or.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this},toJSON:function(){var e=or.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++)e.curves.push(this.curves[t].toJSON());return e},fromJSON:function(e){or.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new Na[r.type]).fromJSON(r))}return this}}),_r.prototype=Object.assign(Object.create(yr.prototype),{constructor:_r,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new mr(this.currentPoint.clone(),new n(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,o){e=new gr(this.currentPoint.clone(),new n(e,t),new n(r,o)),this.curves.push(e),this.currentPoint.set(r,o)},bezierCurveTo:function(e,t,r,o,a,i){e=new pr(this.currentPoint.clone(),new n(e,t),new n(r,o),new n(a,i)),this.curves.push(e),this.currentPoint.set(a,i)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e);t=new vr(t),this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,n,r,o,a){this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,n,r,o,a)},absarc:function(e,t,n,r,o,a){this.absellipse(e,t,n,n,r,o,a)},ellipse:function(e,t,n,r,o,a,i,s){this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,n,r,o,a,i,s)},absellipse:function(e,t,n,r,o,a,i,s){e=new ar(e,t,n,r,o,a,i,s),0<this.curves.length&&((t=e.getPoint(0)).equals(this.currentPoint)||this.lineTo(t.x,t.y)),this.curves.push(e),e=e.getPoint(1),this.currentPoint.copy(e)},copy:function(e){return yr.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=yr.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return yr.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),br.prototype=Object.assign(Object.create(_r.prototype),{constructor:br,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){_r.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++)this.holes.push(e.holes[t].clone());return this},toJSON:function(){var e=_r.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++)e.holes.push(this.holes[t].toJSON());return e},fromJSON:function(e){_r.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new _r).fromJSON(r))}return this}}),xr.prototype=Object.assign(Object.create(b.prototype),{constructor:xr,isLight:!0,copy:function(e){return b.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){return(e=b.prototype.toJSON.call(this,e)).object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),wr.prototype=Object.assign(Object.create(xr.prototype),{constructor:wr,isHemisphereLight:!0,copy:function(e){return xr.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Sr.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Mr.prototype=Object.assign(Object.create(Sr.prototype),{constructor:Mr,isSpotLightShadow:!0,update:function(e){var t=this.camera,n=2*Xo.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height;e=e.distance||t.far,n===t.fov&&r===t.aspect&&e===t.far||(t.fov=n,t.aspect=r,t.far=e,t.updateProjectionMatrix())}}),Er.prototype=Object.assign(Object.create(xr.prototype),{constructor:Er,isSpotLight:!0,copy:function(e){return xr.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Tr.prototype=Object.assign(Object.create(xr.prototype),{constructor:Tr,isPointLight:!0,copy:function(e){return xr.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Cr.prototype=Object.assign(Object.create(Sr.prototype),{constructor:Cr}),Pr.prototype=Object.assign(Object.create(xr.prototype),{constructor:Pr,isDirectionalLight:!0,copy:function(e){return xr.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ar.prototype=Object.assign(Object.create(xr.prototype),{constructor:Ar,isAmbientLight:!0}),Lr.prototype=Object.assign(Object.create(xr.prototype),{constructor:Lr,isRectAreaLight:!0,copy:function(e){return xr.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){return(e=xr.prototype.toJSON.call(this,e)).object.width=this.width,e.object.height=this.height,e}});var Ua={arraySlice:function(e,t,n){return Ua.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,o=new e.constructor(r),a=0,i=0;i!==r;++a)for(var s=n[a]*t,l=0;l!==t;++l)o[i++]=e[s+l];return o},flattenJSON:function(e,t,n,r){for(var o=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[o++];if(void 0!==a){var i=a[r];if(void 0!==i)if(Array.isArray(i))do{void 0!==(i=a[r])&&(t.push(a.time),n.push.apply(n,i)),a=e[o++]}while(void 0!==a);else if(void 0!==i.toArray)do{void 0!==(i=a[r])&&(t.push(a.time),i.toArray(n,n.length)),a=e[o++]}while(void 0!==a);else do{void 0!==(i=a[r])&&(t.push(a.time),n.push(i)),a=e[o++]}while(void 0!==a)}}};Object.assign(Rr.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],o=t[n-1];e:{t:{n:{r:if(!(e<r)){for(var a=n+2;;){if(void 0===r){if(e<o)break r;return this._cachedIndex=n=t.length,this.afterEnd_(n-1,e,o)}if(n===a)break;if(o=r,e<(r=t[++n]))break t}r=t.length;break n}if(e>=o)break e;for(e<(a=t[1])&&(n=2,o=a),a=n-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===a)break;if(r=o,e>=(o=t[--n-1]))break t}r=n,n=0}for(;n<r;)e<t[o=n+r>>>1]?r=o:n=o+1;if(r=t[n],void 0===(o=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return this._cachedIndex=n=t.length,this.afterEnd_(n-1,o,e)}this._cachedIndex=n,this.intervalChanged_(n,o,r)}return this.interpolate_(n,o,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize;e*=r;for(var o=0;o!==r;++o)t[o]=n[e+o];return t},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Rr.prototype,{beforeStart_:Rr.prototype.copySampleValue_,afterEnd_:Rr.prototype.copySampleValue_}),Dr.prototype=Object.assign(Object.create(Rr.prototype),{constructor:Dr,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){var r=this.parameterPositions,o=e-2,a=e+1,i=r[o],s=r[a];if(void 0===i)switch(this.getSettings_().endingStart){case 2401:o=e,i=2*t-n;break;case 2402:i=t+r[o=r.length-2]-r[o+1];break;default:o=e,i=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*n-t;break;case 2402:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}r=this.valueSize,this._weightPrev=(e=.5*(n-t))/(t-i),this._weightNext=e/(s-n),this._offsetPrev=o*r,this._offsetNext=a*r},interpolate_:function(e,t,n,r){var o=this.resultBuffer,a=this.sampleValues,i=this.valueSize,s=(e*=i)-i,l=this._offsetPrev,u=this._offsetNext,c=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t);for(t=-c*(r=(n=p*p)*p)+2*c*n-c*p,c=(1+c)*r+(-1.5-2*c)*n+(-.5+c)*p+1,p=(-1-d)*r+(1.5+d)*n+.5*p,d=d*r-d*n,n=0;n!==i;++n)o[n]=t*a[l+n]+c*a[s+n]+p*a[e+n]+d*a[u+n];return o}}),Ir.prototype=Object.assign(Object.create(Rr.prototype),{constructor:Ir,interpolate_:function(e,t,n,r){var o=this.resultBuffer,a=this.sampleValues,i=this.valueSize,s=(e*=i)-i;for(n=1-(t=(n-t)/(r-t)),r=0;r!==i;++r)o[r]=a[s+r]*n+a[e+r]*t;return o}}),Or.prototype=Object.assign(Object.create(Rr.prototype),{constructor:Or,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Nr,{toJSON:function(e){var t=e.constructor;if(void 0!==t.toJSON)t=t.toJSON(e);else{t={name:e.name,times:Ua.convertArray(e.times,Array),values:Ua.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(Nr.prototype,{constructor:Nr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new Or(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Ir(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Dr(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){switch(e){case 2300:var t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){if(t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,o=0,a=r-1;o!==r&&n[o]<e;)++o;for(;-1!==a&&n[a]>t;)--a;return++a,0===o&&a===r||(o>=a&&(o=(a=Math.max(a,1))-1),e=this.getValueSize(),this.times=Ua.arraySlice(n,o,a),this.values=Ua.arraySlice(this.values,o*e,a*e)),this},validate:function(){var e=!0,t=this.getValueSize();0!=t-Math.floor(t)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times;t=this.values;var r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==r;a++){var i=n[a];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,i),e=!1;break}if(null!==o&&o>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,i,o),e=!1;break}o=i}if(void 0!==t&&Ua.isTypedArray(t))for(a=0,n=t.length;a!==n;++a)if(r=t[a],isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,r),e=!1;break}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),r=2302===this.getInterpolation(),o=1,a=e.length-1,i=1;i<a;++i){var s=!1,l=e[i];if(l!==e[i+1]&&(1!==i||l!==l[0]))if(r)s=!0;else{var u=i*n,c=u-n,d=u+n;for(l=0;l!==n;++l){var p=t[u+l];if(p!==t[c+l]||p!==t[d+l]){s=!0;break}}}if(s){if(i!==o)for(e[o]=e[i],s=i*n,u=o*n,l=0;l!==n;++l)t[u+l]=t[s+l];++o}}if(0<a){for(e[o]=e[a],s=a*n,u=o*n,l=0;l!==n;++l)t[u+l]=t[s+l];++o}return o!==e.length&&(this.times=Ua.arraySlice(e,0,o),this.values=Ua.arraySlice(t,0,o*n)),this}}),Ur.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Ur,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),kr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:kr,ValueTypeName:"color"}),Hr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Hr,ValueTypeName:"number"}),Gr.prototype=Object.assign(Object.create(Rr.prototype),{constructor:Gr,interpolate_:function(e,t,n,r){var a=this.resultBuffer,i=this.sampleValues,s=this.valueSize;for(t=(n-t)/(r-t),n=(e*=s)+s;e!==n;e+=4)o.slerpFlat(a,0,i,e-s,i,e,t);return a}}),Vr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Vr,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Gr(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),jr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:jr,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Fr.prototype=Object.assign(Object.create(Nr.prototype),{constructor:Fr,ValueTypeName:"vector"}),Object.assign(zr,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),o=0,a=n.length;o!==a;++o)t.push(Br(n[o]).scale(r));return new zr(e.name,e.duration,t)},toJSON:function(e){var t=[],n=e.tracks;e={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid};for(var r=0,o=n.length;r!==o;++r)t.push(Nr.toJSON(n[r]));return e},CreateFromMorphTargetSequence:function(e,t,n,r){for(var o=t.length,a=[],i=0;i<o;i++){var s=[],l=[];s.push((i+o-1)%o,i,(i+1)%o),l.push(0,1,0);var u=Ua.getKeyframeOrder(s);s=Ua.sortedArray(s,1,u),l=Ua.sortedArray(l,1,u),r||0!==s[0]||(s.push(o),l.push(l[0])),a.push(new Hr(".morphTargetInfluences["+t[i].name+"]",s,l).scale(1/n))}return new zr(e,-1,a)},findByName:function(e,t){var n=e;for(Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations),e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},o=/^([\w-]*?)([\d]+)$/,a=0,i=e.length;a<i;a++){var s=e[a],l=s.name.match(o);if(l&&1<l.length){var u=l[1];(l=r[u])||(r[u]=l=[]),l.push(s)}}for(u in e=[],r)e.push(zr.CreateFromMorphTargetSequence(u,r[u],t,n));return e},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var n=function(e,t,n,r,o){if(0!==n.length){var a=[],i=[];Ua.flattenJSON(n,a,i,r),0!==a.length&&o.push(new e(t,a,i))}},r=[],o=e.name||"default",a=e.length||-1,i=e.fps||30;e=e.hierarchy||[];for(var s=0;s<e.length;s++){var l=e[s].keys;if(l&&0!==l.length)if(l[0].morphTargets){a={};for(var u=0;u<l.length;u++)if(l[u].morphTargets)for(var c=0;c<l[u].morphTargets.length;c++)a[l[u].morphTargets[c]]=-1;for(var d in a){var p=[],h=[];for(c=0;c!==l[u].morphTargets.length;++c){var m=l[u];p.push(m.time),h.push(m.morphTarget===d?1:0)}r.push(new Hr(".morphTargetInfluence["+d+"]",p,h))}a=a.length*(i||1)}else n(Fr,(u=".bones["+t[s].name+"]")+".position",l,"pos",r),n(Vr,u+".quaternion",l,"rot",r),n(Fr,u+".scale",l,"scl",r)}return 0===r.length?null:new zr(o,a,r)}}),Object.assign(zr.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(Wr.prototype,{load:function(e,t,n,r){var o=this;new Kn(o.manager).load(e,(function(e){t(o.parse(JSON.parse(e)))}),n,r)},setTextures:function(e){this.textures=e},parse:function(e){function t(e){return void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),r[e]}var r=this.textures,o=new Ca[e.type];if(void 0!==e.uuid&&(o.uuid=e.uuid),void 0!==e.name&&(o.name=e.name),void 0!==e.color&&o.color.setHex(e.color),void 0!==e.roughness&&(o.roughness=e.roughness),void 0!==e.metalness&&(o.metalness=e.metalness),void 0!==e.emissive&&o.emissive.setHex(e.emissive),void 0!==e.specular&&o.specular.setHex(e.specular),void 0!==e.shininess&&(o.shininess=e.shininess),void 0!==e.clearCoat&&(o.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(o.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(o.uniforms=e.uniforms),void 0!==e.vertexShader&&(o.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(o.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(o.vertexColors=e.vertexColors),void 0!==e.fog&&(o.fog=e.fog),void 0!==e.flatShading&&(o.flatShading=e.flatShading),void 0!==e.blending&&(o.blending=e.blending),void 0!==e.side&&(o.side=e.side),void 0!==e.opacity&&(o.opacity=e.opacity),void 0!==e.transparent&&(o.transparent=e.transparent),void 0!==e.alphaTest&&(o.alphaTest=e.alphaTest),void 0!==e.depthTest&&(o.depthTest=e.depthTest),void 0!==e.depthWrite&&(o.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(o.colorWrite=e.colorWrite),void 0!==e.wireframe&&(o.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(o.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(o.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(o.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(o.rotation=e.rotation),1!==e.linewidth&&(o.linewidth=e.linewidth),void 0!==e.dashSize&&(o.dashSize=e.dashSize),void 0!==e.gapSize&&(o.gapSize=e.gapSize),void 0!==e.scale&&(o.scale=e.scale),void 0!==e.polygonOffset&&(o.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(o.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(o.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(o.skinning=e.skinning),void 0!==e.morphTargets&&(o.morphTargets=e.morphTargets),void 0!==e.dithering&&(o.dithering=e.dithering),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.shading&&(o.flatShading=1===e.shading),void 0!==e.size&&(o.size=e.size),void 0!==e.sizeAttenuation&&(o.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(o.map=t(e.map)),void 0!==e.alphaMap&&(o.alphaMap=t(e.alphaMap),o.transparent=!0),void 0!==e.bumpMap&&(o.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(o.bumpScale=e.bumpScale),void 0!==e.normalMap&&(o.normalMap=t(e.normalMap)),void 0!==e.normalMapType&&(o.normalMapType=e.normalMapType),void 0!==e.normalScale){var a=e.normalScale;!1===Array.isArray(a)&&(a=[a,a]),o.normalScale=(new n).fromArray(a)}return void 0!==e.displacementMap&&(o.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(o.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(o.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(o.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(o.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(o.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(o.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(o.specularMap=t(e.specularMap)),void 0!==e.envMap&&(o.envMap=t(e.envMap)),void 0!==e.reflectivity&&(o.reflectivity=e.reflectivity),void 0!==e.lightMap&&(o.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(o.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(o.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(o.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(o.gradientMap=t(e.gradientMap)),o}}),Object.assign(Yr.prototype,{load:function(e,t,n,r){var o=this;new Kn(o.manager).load(e,(function(e){t(o.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=new k,n=e.data.index;void 0!==n&&(n=new ka[n.type](n.array),t.setIndex(new E(n,1)));var r=e.data.attributes;for(i in r){var o=r[i];n=new ka[o.type](o.array),t.addAttribute(i,new E(n,o.itemSize,o.normalized))}var i=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==i)for(n=0,r=i.length;n!==r;++n)t.addGroup((o=i[n]).start,o.count,o.materialIndex);return void 0!==(e=e.data.boundingSphere)&&(i=new a,void 0!==e.center&&i.fromArray(e.center),t.boundingSphere=new h(i,e.radius)),t}});var ka={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};qr.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,n=0,r=t.length;n<r;n+=2){var o=t[n+1];if(t[n].test(e))return o}return null}},Object.assign(qr.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,n){for(var r=[],o=0;o<e.length;++o)r[o]=this.createMaterial(e[o],t,n);return r},createMaterial:function(){var e={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},t=new g,n=new rr,r=new Wr;return function(o,a,i){function s(e,t,r,o,s){var l=qr.Handlers.get(e=a+e);return null!==l?e=l.load(e):(n.setCrossOrigin(i),e=n.load(e)),void 0!==t&&(e.repeat.fromArray(t),1!==t[0]&&(e.wrapS=1e3),1!==t[1]&&(e.wrapT=1e3)),void 0!==r&&e.offset.fromArray(r),void 0!==o&&("repeat"===o[0]&&(e.wrapS=1e3),"mirror"===o[0]&&(e.wrapS=1002),"repeat"===o[1]&&(e.wrapT=1e3),"mirror"===o[1]&&(e.wrapT=1002)),void 0!==s&&(e.anisotropy=s),t=Xo.generateUUID(),u[t]=e,t}var l,u={},c={uuid:Xo.generateUUID(),type:"MeshLambertMaterial"};for(l in o){var d=o[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=d;break;case"blending":c.blending=e[d];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":c.color=t.fromArray(d).getHex();break;case"colorSpecular":c.specular=t.fromArray(d).getHex();break;case"colorEmissive":c.emissive=t.fromArray(d).getHex();break;case"specularCoef":c.shininess=d;break;case"shading":"basic"===d.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===d.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===d.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=s(d,o.mapDiffuseRepeat,o.mapDiffuseOffset,o.mapDiffuseWrap,o.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=s(d,o.mapEmissiveRepeat,o.mapEmissiveOffset,o.mapEmissiveWrap,o.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=s(d,o.mapLightRepeat,o.mapLightOffset,o.mapLightWrap,o.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=s(d,o.mapAORepeat,o.mapAOOffset,o.mapAOWrap,o.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=s(d,o.mapBumpRepeat,o.mapBumpOffset,o.mapBumpWrap,o.mapBumpAnisotropy);break;case"mapBumpScale":c.bumpScale=d;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=s(d,o.mapNormalRepeat,o.mapNormalOffset,o.mapNormalWrap,o.mapNormalAnisotropy);break;case"mapNormalFactor":c.normalScale=d;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=s(d,o.mapSpecularRepeat,o.mapSpecularOffset,o.mapSpecularWrap,o.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=s(d,o.mapMetalnessRepeat,o.mapMetalnessOffset,o.mapMetalnessWrap,o.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=s(d,o.mapRoughnessRepeat,o.mapRoughnessOffset,o.mapRoughnessWrap,o.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=s(d,o.mapAlphaRepeat,o.mapAlphaOffset,o.mapAlphaWrap,o.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=1;break;case"doubleSided":c.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=d;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[l]=d;break;case"vertexColors":!0===d&&(c.vertexColors=2),"face"===d&&(c.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,d)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,1>c.opacity&&(c.transparent=!0),r.setTextures(u),r.parse(c)}}()});var Ha={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};Object.assign(Xr.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){var o=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Ha.extractUrlBase(e),i=new Kn(this.manager);i.setWithCredentials(this.withCredentials),i.load(e,(function(n){var r=(n=JSON.parse(n)).metadata;void 0===r||void 0===(r=r.type)||"object"!==r.toLowerCase()?(n=o.parse(n,a),t(n.geometry,n.materials)):console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}),n,r)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setTexturePath:function(e){return this.texturePath=e,this},parse:function(e,t){void 0!==e.data&&(e=e.data),e.scale=void 0!==e.scale?1/e.scale:1;var r,o,i,s=new M,u=e,c=u.faces,d=u.vertices,p=u.normals,h=u.colors,m=u.scale,f=0;if(void 0!==u.uvs){for(r=0;r<u.uvs.length;r++)u.uvs[r].length&&f++;for(r=0;r<f;r++)s.faceVertexUvs[r]=[]}var $=0;for(i=d.length;$<i;)(r=new a).x=d[$++]*m,r.y=d[$++]*m,r.z=d[$++]*m,s.vertices.push(r);for($=0,i=c.length;$<i;){var v=1&(d=c[$++]),y=2&d;r=8&d;var _=16&d,b=32&d;if(m=64&d,d&=128,v){(v=new S).a=c[$],v.b=c[$+1],v.c=c[$+3];var x=new S;if(x.a=c[$+1],x.b=c[$+2],x.c=c[$+3],$+=4,y&&(y=c[$++],v.materialIndex=y,x.materialIndex=y),y=s.faces.length,r)for(r=0;r<f;r++){var w=u.uvs[r];for(s.faceVertexUvs[r][y]=[],s.faceVertexUvs[r][y+1]=[],o=0;4>o;o++){var E=c[$++],T=w[2*E];T=new n(T,E=w[2*E+1]),2!==o&&s.faceVertexUvs[r][y].push(T),0!==o&&s.faceVertexUvs[r][y+1].push(T)}}if(_&&(_=3*c[$++],v.normal.set(p[_++],p[_++],p[_]),x.normal.copy(v.normal)),b)for(r=0;4>r;r++)_=3*c[$++],b=new a(p[_++],p[_++],p[_]),2!==r&&v.vertexNormals.push(b),0!==r&&x.vertexNormals.push(b);if(m&&(m=c[$++],v.color.setHex(m=h[m]),x.color.setHex(m)),d)for(r=0;4>r;r++)m=h[m=c[$++]],2!==r&&v.vertexColors.push(new g(m)),0!==r&&x.vertexColors.push(new g(m));s.faces.push(v),s.faces.push(x)}else{if((v=new S).a=c[$++],v.b=c[$++],v.c=c[$++],y&&(y=c[$++],v.materialIndex=y),y=s.faces.length,r)for(r=0;r<f;r++)for(w=u.uvs[r],s.faceVertexUvs[r][y]=[],o=0;3>o;o++)T=new n(T=w[2*(E=c[$++])],E=w[2*E+1]),s.faceVertexUvs[r][y].push(T);if(_&&(_=3*c[$++],v.normal.set(p[_++],p[_++],p[_])),b)for(r=0;3>r;r++)_=3*c[$++],b=new a(p[_++],p[_++],p[_]),v.vertexNormals.push(b);if(m&&(m=c[$++],v.color.setHex(h[m])),d)for(r=0;3>r;r++)m=c[$++],v.vertexColors.push(new g(h[m]));s.faces.push(v)}}if($=void 0!==(u=e).influencesPerVertex?u.influencesPerVertex:2,u.skinWeights)for(i=0,c=u.skinWeights.length;i<c;i+=$)s.skinWeights.push(new l(u.skinWeights[i],1<$?u.skinWeights[i+1]:0,2<$?u.skinWeights[i+2]:0,3<$?u.skinWeights[i+3]:0));if(u.skinIndices)for(i=0,c=u.skinIndices.length;i<c;i+=$)s.skinIndices.push(new l(u.skinIndices[i],1<$?u.skinIndices[i+1]:0,2<$?u.skinIndices[i+2]:0,3<$?u.skinIndices[i+3]:0));if(s.bones=u.bones,s.bones&&0<s.bones.length&&(s.skinWeights.length!==s.skinIndices.length||s.skinIndices.length!==s.vertices.length)&&console.warn("When skinning, number of vertices ("+s.vertices.length+"), skinIndices ("+s.skinIndices.length+"), and skinWeights ("+s.skinWeights.length+") should match."),c=(i=e).scale,void 0!==i.morphTargets)for(u=0,$=i.morphTargets.length;u<$;u++)for(s.morphTargets[u]={},s.morphTargets[u].name=i.morphTargets[u].name,s.morphTargets[u].vertices=[],p=s.morphTargets[u].vertices,f=0,d=(h=i.morphTargets[u].vertices).length;f<d;f+=3)(m=new a).x=h[f]*c,m.y=h[f+1]*c,m.z=h[f+2]*c,p.push(m);if(void 0!==i.morphColors&&0<i.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),i=i.morphColors[0].colors,u=0,$=(c=s.faces).length;u<$;u++)c[u].color.fromArray(i,3*u);for(u=[],$=[],void 0!==(i=e).animation&&$.push(i.animation),void 0!==i.animations&&(i.animations.length?$=$.concat(i.animations):$.push(i.animations)),i=0;i<$.length;i++)(c=zr.parseAnimation($[i],s.bones))&&u.push(c);return s.morphTargets&&($=zr.CreateClipsFromMorphTargetSequences(s.morphTargets,10),u=u.concat($)),0<u.length&&(s.animations=u),s.computeFaceNormals(),s.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:s}:{geometry:s,materials:e=qr.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}),Object.assign(Zr.prototype,{crossOrigin:"anonymous",load:function(e,t,n,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var o=this;new Kn(o.manager).load(e,(function(n){var a=null;try{a=JSON.parse(n)}catch(i){return void 0!==r&&r(i),void console.error("THREE:ObjectLoader: Can't parse "+e+".",i.message)}void 0===(n=a.metadata)||void 0===n.type||"geometry"===n.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead."):o.parse(a,t)}),n,r)},setTexturePath:function(e){return this.texturePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var n=this.parseShape(e.shapes);n=this.parseGeometries(e.geometries,n);var r=this.parseImages(e.images,(function(){void 0!==t&&t(o)}));r=this.parseTextures(e.textures,r),r=this.parseMaterials(e.materials,r);var o=this.parseObject(e.object,n,r);return e.animations&&(o.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0===t||t(o),o},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var o=(new br).fromJSON(e[n]);t[o.uuid]=o}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new Xr,o=new Yr,a=0,i=e.length;a<i;a++){var s=e[a];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":var l=new Ta[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":l=new Ta[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":l=new Ta[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":l=new Ta[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":l=new Ta[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":l=new Ta[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":l=new Ta[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":l=new Ta[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":l=new Ta[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":l=new Ta[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":l=new Ta[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":l=new Ta[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":l=[];for(var u=0,c=s.shapes.length;u<c;u++){var d=t[s.shapes[u]];l.push(d)}l=new Ta[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,c=s.shapes.length;u<c;u++)l.push(d=t[s.shapes[u]]);void 0!==(u=s.options.extrudePath)&&(s.options.extrudePath=(new Na[u.type]).fromJSON(u)),l=new Ta[s.type](l,s.options);break;case"BufferGeometry":l=o.parse(s);break;case"Geometry":l=r.parse(s,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),!0===l.isBufferGeometry&&void 0!==s.userData&&(l.userData=s.userData),n[s.uuid]=l}return n},parseMaterials:function(e,t){var n={};if(void 0!==e){var r=new Wr;r.setTextures(t),t=0;for(var o=e.length;t<o;t++){var a=e[t];if("MultiMaterial"===a.type){for(var i=[],s=0;s<a.materials.length;s++)i.push(r.parse(a.materials[s]));n[a.uuid]=i}else n[a.uuid]=r.parse(a)}}return n},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=zr.parse(r);void 0!==r.uuid&&(o.uuid=r.uuid),t.push(o)}return t},parseImages:function(e,t){function n(e){return r.manager.itemStart(e),a.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemEnd(e),r.manager.itemError(e)}))}var r=this,o={};if(void 0!==e&&0<e.length){var a=new tr(t=new Jn(t));a.setCrossOrigin(this.crossOrigin),t=0;for(var i=e.length;t<i;t++){var s=e[t],l=s.url;if(Array.isArray(l)){o[s.uuid]=[];for(var u=0,c=l.length;u<c;u++){var d=l[u];d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:r.texturePath+d,o[s.uuid].push(n(d))}}else d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:r.texturePath+s.url,o[s.uuid]=n(d)}}return o},parseTextures:function(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var o=0,a=e.length;o<a;o++){var i=e[o];void 0===i.image&&console.warn('THREE.ObjectLoader: No "image" specified for',i.uuid),void 0===t[i.image]&&console.warn("THREE.ObjectLoader: Undefined image",i.image);var l=Array.isArray(t[i.image])?new ie(t[i.image]):new s(t[i.image]);l.needsUpdate=!0,l.uuid=i.uuid,void 0!==i.name&&(l.name=i.name),void 0!==i.mapping&&(l.mapping=n(i.mapping,Ga)),void 0!==i.offset&&l.offset.fromArray(i.offset),void 0!==i.repeat&&l.repeat.fromArray(i.repeat),void 0!==i.center&&l.center.fromArray(i.center),void 0!==i.rotation&&(l.rotation=i.rotation),void 0!==i.wrap&&(l.wrapS=n(i.wrap[0],Va),l.wrapT=n(i.wrap[1],Va)),void 0!==i.format&&(l.format=i.format),void 0!==i.minFilter&&(l.minFilter=n(i.minFilter,ja)),void 0!==i.magFilter&&(l.magFilter=n(i.magFilter,ja)),void 0!==i.anisotropy&&(l.anisotropy=i.anisotropy),void 0!==i.flipY&&(l.flipY=i.flipY),r[i.uuid]=l}return r},parseObject:function(e,t,n){function r(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,o=e.length;r<o;r++){var a=e[r];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":var a=new yt;void 0!==e.background&&Number.isInteger(e.background)&&(a.background=new g(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new vt(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new $t(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":a=new pt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new w(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Ar(e.color,e.intensity);break;case"DirectionalLight":a=new Pr(e.color,e.intensity);break;case"PointLight":a=new Tr(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Lr(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Er(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new wr(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":a=r(e.geometry);var i=o(e.material);a=a.bones&&0<a.bones.length?new Tt(a,i):new q(a,i);break;case"LOD":a=new St;break;case"Line":a=new Pt(r(e.geometry),o(e.material),e.mode);break;case"LineLoop":a=new Lt(r(e.geometry),o(e.material));break;case"LineSegments":a=new At(r(e.geometry),o(e.material));break;case"PointCloud":case"Points":a=new Dt(r(e.geometry),o(e.material));break;case"Sprite":a=new wt(o(e.material));break;case"Group":a=new dt;break;default:a=new b}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){i=e.children;for(var s=0;s<i.length;s++)a.add(this.parseObject(i[s],t,n))}if("LOD"===e.type)for(e=e.levels,i=0;i<e.length;i++){var l=a.getObjectByProperty("uuid",(s=e[i]).object);void 0!==l&&a.addLevel(l,s.distance)}return a}});var Ga={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Va={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},ja={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};Jr.prototype={constructor:Jr,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var o=this,a=Pa.get(e);if(void 0!==a)return o.manager.itemStart(e),setTimeout((function(){t&&t(a),o.manager.itemEnd(e)}),0),a;fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,o.options)})).then((function(n){Pa.add(e,n),t&&t(n),o.manager.itemEnd(e)})).catch((function(t){r&&r(t),o.manager.itemEnd(e),o.manager.itemError(e)}))},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(Kr.prototype,{moveTo:function(e,t){this.currentPath=new _r,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,n,r){this.currentPath.quadraticCurveTo(e,t,n,r)},bezierCurveTo:function(e,t,n,r,o,a){this.currentPath.bezierCurveTo(e,t,n,r,o,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n],a=new br;a.curves=o.curves,t.push(a)}return t}function r(e,t){for(var n=t.length,r=!1,o=n-1,a=0;a<n;o=a++){var i=t[o],s=t[a],l=s.x-i.x,u=s.y-i.y;if(Math.abs(u)>Number.EPSILON){if(0>u&&(i=t[a],l=-l,s=t[o],u=-u),!(e.y<i.y||e.y>s.y))if(e.y===i.y){if(e.x===i.x)return!0}else{if(0==(o=u*(e.x-i.x)-l*(e.y-i.y)))return!0;0>o||(r=!r)}}else if(e.y===i.y&&(s.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=s.x))return!0}return r}var o=Ma.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return n(a);if(t=[],1===a.length){var i=a[0],s=new br;return s.curves=i.curves,t.push(s),t}var l=!o(a[0].getPoints());l=e?!l:l,s=[];var u=[],c=[],d=0;u[d]=void 0,c[d]=[];for(var p=0,h=a.length;p<h;p++){var m=(i=a[p]).getPoints(),f=o(m);(f=e?!f:f)?(!l&&u[d]&&d++,u[d]={s:new br,p:m},u[d].s.curves=i.curves,l&&d++,c[d]=[]):c[d].push({h:i,p:m[0]})}if(!u[0])return n(a);if(1<u.length){for(p=!1,e=[],o=0,a=u.length;o<a;o++)s[o]=[];for(o=0,a=u.length;o<a;o++)for(i=c[o],f=0;f<i.length;f++){for(l=i[f],d=!0,m=0;m<u.length;m++)r(l.p,u[m].p)&&(o!==m&&e.push({froms:o,tos:m,hole:f}),d?(d=!1,s[m].push(l)):p=!0);d&&s[o].push(l)}0<e.length&&(p||(c=s))}for(p=0,o=u.length;p<o;p++)for(t.push(s=u[p].s),a=0,i=(e=c[p]).length;a<i;a++)s.holes.push(e[a].h);return t}}),Object.assign(Qr.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);var n=[],r=t;t=this.data;var o=Array.from?Array.from(e):String(e).split(""),a=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*(r/=t.resolution);e=[];for(var i=0,s=0,l=0;l<o.length;l++){var u=o[l];if("\n"===u)i=0,s-=a;else{var c=r,d=i,p=s;if(u=t.glyphs[u]||t.glyphs["?"]){var h=new Kr;if(u.o)for(var m=u._cachedOutline||(u._cachedOutline=u.o.split(" ")),f=0,g=m.length;f<g;)switch(m[f++]){case"m":var $=m[f++]*c+d,v=m[f++]*c+p;h.moveTo($,v);break;case"l":$=m[f++]*c+d,v=m[f++]*c+p,h.lineTo($,v);break;case"q":var y=m[f++]*c+d,_=m[f++]*c+p,b=m[f++]*c+d,x=m[f++]*c+p;h.quadraticCurveTo(b,x,y,_);break;case"b":y=m[f++]*c+d,_=m[f++]*c+p,b=m[f++]*c+d,x=m[f++]*c+p,$=m[f++]*c+d,v=m[f++]*c+p,h.bezierCurveTo(b,x,$,v,y,_)}c={offsetX:u.ha*c,path:h}}else c=void 0;i+=c.offsetX,e.push(c.path)}}for(t=0,o=e.length;t<o;t++)Array.prototype.push.apply(n,e[t].toShapes());return n}}),Object.assign(eo.prototype,{load:function(e,t,n,r){var o=this,a=new Kn(this.manager);a.setPath(this.path),a.load(e,(function(e){try{var n=JSON.parse(e)}catch(r){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}e=o.parse(n),t&&t(e)}),n,r)},parse:function(e){return new Qr(e)},setPath:function(e){return this.path=e,this}});var Fa,za,Ba,Wa={getContext:function(){return void 0===Fa&&(Fa=new(window.AudioContext||window.webkitAudioContext)),Fa},setContext:function(e){Fa=e}};Object.assign(to.prototype,{load:function(e,t,n,r){var o=new Kn(this.manager);o.setResponseType("arraybuffer"),o.load(e,(function(e){e=e.slice(0),Wa.getContext().decodeAudioData(e,(function(e){t(e)}))}),n,r)}}),Object.assign(no.prototype,{update:function(){var e,t,n,o,a,i,s,l,u=new r,c=new r;return function(r){if(e!==this||t!==r.focus||n!==r.fov||o!==r.aspect*this.aspect||a!==r.near||i!==r.far||s!==r.zoom||l!==this.eyeSep){e=this,t=r.focus,n=r.fov,o=r.aspect*this.aspect,a=r.near,i=r.far,s=r.zoom;var d=r.projectionMatrix.clone(),p=(l=this.eyeSep/2)*a/t,h=a*Math.tan(Xo.DEG2RAD*n*.5)/s;c.elements[12]=-l,u.elements[12]=l;var m=-h*o+p,f=h*o+p;d.elements[0]=2*a/(f-m),d.elements[8]=(f+m)/(f-m),this.cameraL.projectionMatrix.copy(d),d.elements[0]=2*a/((f=h*o-p)-(m=-h*o-p)),d.elements[8]=(f+m)/(f-m),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(r.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(r.matrixWorld).multiply(u)}}()}),(ro.prototype=Object.create(b.prototype)).constructor=ro,oo.prototype=Object.assign(Object.create(b.prototype),{constructor:oo,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new a,t=new o,n=new a,r=new a;return function(o){b.prototype.updateMatrixWorld.call(this,o),o=this.context.listener;var a=this.up;this.matrixWorld.decompose(e,t,n),r.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(r.x,this.context.currentTime),o.forwardY.setValueAtTime(r.y,this.context.currentTime),o.forwardZ.setValueAtTime(r.z,this.context.currentTime),o.upX.setValueAtTime(a.x,this.context.currentTime),o.upY.setValueAtTime(a.y,this.context.currentTime),o.upZ.setValueAtTime(a.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z,a.x,a.y,a.z))}}()}),ao.prototype=Object.assign(Object.create(b.prototype),{constructor:ao,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),io.prototype=Object.assign(Object.create(ao.prototype),{constructor:io,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(){var e=new a,t=new o,n=new a,r=new a;return function(o){b.prototype.updateMatrixWorld.call(this,o),o=this.panner,this.matrixWorld.decompose(e,t,n),r.set(0,0,1).applyQuaternion(t),o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z)}}()}),Object.assign(so.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(lo.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize;e=e*r+r;var o=this.cumulativeWeight;if(0===o){for(o=0;o!==r;++o)n[e+o]=n[o];o=t}else this._mixBufferRegion(n,e,0,t/(o+=t),r);this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,n=this.buffer;e=e*t+t;var r=this.cumulativeWeight,o=this.binding;this.cumulativeWeight=0,1>r&&this._mixBufferRegion(n,e,3*t,1-r,t),r=t;for(var a=t+t;r!==a;++r)if(n[r]!==n[r+t]){o.setValue(n,e);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,n=3*t;this.binding.getValue(e,n);for(var r=t;r!==n;++r)e[r]=e[n+r%t];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(e,t,n,r,o){if(.5<=r)for(r=0;r!==o;++r)e[t+r]=e[n+r]},_slerp:function(e,t,n,r){o.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,o){for(var a=1-r,i=0;i!==o;++i){var s=t+i;e[s]=e[s]*a+e[n+i]*r}}}),Object.assign(uo.prototype,{getValue:function(e,t){this.bind();var n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,o=n.length;r!==o;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(co,{Composite:uo,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new co.Composite(e,t,n):new co(e,t,n)},sanitizeNodeName:function(){var e=/[\[\]\.:\/]/g;return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",t=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]");e=/(WCOD+)?/.source.replace("WCOD",e);var n=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),r=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),o=new RegExp("^"+t+e+n+r+"$"),a=["material","materials","bones"];return function(e){var t=o.exec(e);if(!t)throw Error("PropertyBinding: Cannot parse trackName: "+e);var n=(t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]}).nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var r=t.nodeName.substring(n+1);-1!==a.indexOf(r)&&(t.nodeName=t.nodeName.substring(0,n),t.objectName=r)}if(null===t.propertyName||0===t.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var o=e[n];if(o.name===t||o.uuid===t||(o=r(o.children)))return o}return null};if(e=r(e.children))return e}return null}}),Object.assign(co.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,o=n.length;r!==o;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,o=t.propertyIndex;if(e||(this.node=e=co.findNode(this.rootNode,t.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(e=e.skeleton.bones,n=0;n<e.length;n++)if(e[n].name===a){a=n;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}if(void 0===(a=e[r]))console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+r+" but it wasn't found.",e);else{if(t=this.Versioning.None,void 0!==e.needsUpdate?(t=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(t=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e),n=this.BindingType.Direct,void 0!==o){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(n=0;n<this.node.geometry.morphAttributes.position.length;n++)if(e.geometry.morphAttributes.position[n].name===o){o=n;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(n=0;n<this.node.geometry.morphTargets.length;n++)if(e.geometry.morphTargets[n].name===o){o=n;break}}}n=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(n=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(n=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[n],this.setValue=this.SetterByBindingTypeAndVersioning[n][t]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(co.prototype,{_getValue_unbound:co.prototype.getValue,_setValue_unbound:co.prototype.setValue}),Object.assign(po.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._paths,a=this._parsedPaths,i=this._bindings,s=i.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var d=arguments[u],p=d.uuid,h=r[p];if(void 0===h){h=t++,r[p]=h,e.push(d),p=0;for(var m=s;p!==m;++p)i[p].push(new co(d,o[p],a[p]))}else if(h<n){l=e[h];var f=--n;for(r[(m=e[f]).uuid]=h,e[h]=m,r[p]=f,e[f]=d,p=0,m=s;p!==m;++p){var g=i[p],$=g[h];g[h]=g[f],void 0===$&&($=new co(d,o[p],a[p])),g[f]=$}}else e[h]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,a=0,i=arguments.length;a!==i;++a){var s=arguments[a],l=s.uuid,u=n[l];if(void 0!==u&&u>=t){var c=t++,d=e[c];for(n[d.uuid]=u,e[u]=d,n[l]=c,e[c]=s,s=0,l=o;s!==l;++s){var p=(d=r[s])[u];d[u]=d[c],d[c]=p}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,o=this._bindings,a=o.length,i=0,s=arguments.length;i!==s;++i){var l=arguments[i].uuid,u=r[l];if(void 0!==u)if(delete r[l],u<n){var c=e[l=--n],d=--t,p=e[d];for(r[c.uuid]=u,e[u]=c,r[p.uuid]=l,e[l]=p,e.pop(),c=0,p=a;c!==p;++c){var h=o[c],m=h[d];h[u]=h[l],h[l]=m,h.pop()}}else for(r[(p=e[d=--t]).uuid]=u,e[u]=p,e.pop(),c=0,p=a;c!==p;++c)(h=o[c])[u]=h[d],h.pop()}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],o=this._bindings;if(void 0!==r)return o[r];var a=this._paths,i=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,u=Array(s.length);for(n[e]=r=o.length,a.push(e),i.push(t),o.push(u),n=l,r=s.length;n!==r;++n)u[n]=new co(s[n],e,t);return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,o=this._parsedPaths,a=this._bindings,i=a.length-1,s=a[i];t[e[i]]=n,a[n]=s,a.pop(),o[n]=o[i],o.pop(),r[n]=r[i],r.pop()}}}),Object.assign(ho.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=e._clip.duration,o=(n=this._clip.duration)/r;e.warp(1,r/n,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,o=r.time,a=this._timeScaleInterpolant,i=this.timeScale;return null===a&&(this._timeScaleInterpolant=a=r._lendControlInterpolant()),r=a.parameterPositions,a=a.sampleValues,r[0]=o,r[1]=o+n,a[0]=e/i,a[1]=t/i,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,r){if(this.enabled){var o=this._startTime;if(null!==o){if(0>(t=(e-o)*n)||0===n)return;this._startTime=null,t*=n}if(t*=this._updateTimeScale(e),n=this._updateTime(t),0<(e=this._updateWeight(e))){o=this._propertyBindings;for(var a=0,i=(t=this._interpolants).length;a!==i;++a)t[a].evaluate(n),o[a].accumulate(r,e)}}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,r=this.loop,o=this._loopCount,a=2202===r;if(0===e)return-1===o?t:a&&1==(1&o)?n-t:t;if(2200===r)e:{if(-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1)),t>=n)t=n;else{if(!(0>t))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}else{if(-1===o&&(0<=e?(o=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=n||0>t){t-=n*(r=Math.floor(t/n)),o+=Math.abs(r);var i=this.repetitions-o;0>=i?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1===i?this._setEndings(e=0>e,!e,a):this._setEndings(!1,!1,a),this._loopCount=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r}))}if(a&&1==(1&o))return this.time=t,n-t}return this.time=t},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,n){var r=this._mixer,o=r.time,a=this._weightInterpolant;return null===a&&(this._weightInterpolant=a=r._lendControlInterpolant()),r=a.parameterPositions,a=a.sampleValues,r[0]=o,a[0]=t,r[1]=o+e,a[1]=n,this}}),mo.prototype=Object.assign(Object.create(t.prototype),{constructor:mo,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,o=r.length,a=e._propertyBindings;e=e._interpolants;var i=n.uuid,s=this._bindingsByRootAndName,l=s[i];for(void 0===l&&(s[i]=l={}),s=0;s!==o;++s){var u=r[s],c=u.name,d=l[c];if(void 0===d){if(void 0!==(d=a[s])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,i,c));continue}++(d=new lo(co.create(n,c,t&&t._propertyBindings[s].binding.parsedPath),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(d,i,c)}a[s]=d,e[s].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(n=0,r=(t=e._propertyBindings).length;n!==r;++n){var o=t[n];0==o.useCount++&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var o=t[n];0==--o.useCount&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){return null!==(e=e._cacheIndex)&&e<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,o=this._actionsByClip,a=o[t];void 0===a?(a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=a):(e._byClipCacheIndex=(t=a.knownActions).length,t.push(e)),e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var o=(r=(n=this._actionsByClip)[t=e._clip.uuid]).knownActions,a=o[o.length-1],i=e._byClipCacheIndex;a._byClipCacheIndex=i,o[i]=a,o.pop(),e._byClipCacheIndex=null,delete r.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete n[t],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=0,n=(e=e._propertyBindings).length;t!==n;++t){var r=e[t];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=n,t[n]=o},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=n,t[n]=o},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,o=r[t],a=this._bindings;void 0===o&&(r[t]=o={}),o[n]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid;n=n.path;var o=this._bindingsByRootAndName,a=o[r],i=t[t.length-1];i._cacheIndex=e=e._cacheIndex,t[e]=i,t.pop(),delete a[n];e:{for(var s in a)break e;delete o[r]}},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=n,t[n]=o},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=n,t[n]=o},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Ir(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=t[r];e.__cacheIndex=r,t[r]=e,o.__cacheIndex=n,t[n]=o},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,r=n.uuid;n="string"==typeof e?zr.findByName(n,e):e;var o=this._actionsByClip[e=null!==n?n.uuid:e],a=null;if(void 0!==o){if(void 0!==(a=o.actionByRoot[r]))return a;a=o.knownActions[0],null===n&&(n=a._clip)}return null===n?null:(t=new ho(this,n,t),this._bindAction(t,a),this._addInactiveAction(t,e,r),t)},existingAction:function(e,t){var n=t||this._root;return t=n.uuid,n="string"==typeof e?zr.findByName(n,e):e,void 0!==(e=this._actionsByClip[n?n.uuid:e])&&e.actionByRoot[t]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings,o=this._nActiveBindings=this._nActiveActions=0;o!==t;++o)e[o].reset();for(o=0;o!==r;++o)n[o].useCount=0;return this},update:function(e){for(var t=this._actions,n=this._nActiveActions,r=this.time+=e*=this.timeScale,o=Math.sign(e),a=this._accuIndex^=1,i=0;i!==n;++i)t[i]._update(r,e,o,a);for(e=this._bindings,t=this._nActiveBindings,i=0;i!==t;++i)e[i].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=this._actionsByClip,r=n[e=e.uuid];if(void 0!==r){for(var o=0,a=(r=r.knownActions).length;o!==a;++o){var i=r[o];this._deactivateAction(i);var s=i._cacheIndex,l=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,l._cacheIndex=s,t[s]=l,t.pop(),this._removeInactiveBindingsForAction(i)}delete n[e]}},uncacheRoot:function(e){e=e.uuid;var t=this._actionsByClip;for(r in t){var n=t[r].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var r=this._bindingsByRootAndName[e];if(void 0!==r)for(var o in r)(e=r[o]).restoreOriginalState(),this._removeInactiveBinding(e)},uncacheAction:function(e,t){null!==(e=this.existingAction(e,t))&&(this._deactivateAction(e),this._removeInactiveAction(e))}}),fo.prototype.clone=function(){return new fo(void 0===this.value.clone?this.value:this.value.clone())},go.prototype=Object.assign(Object.create(k.prototype),{constructor:go,isInstancedBufferGeometry:!0,copy:function(e){return k.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),$o.prototype=Object.assign(Object.create(_t.prototype),{constructor:$o,isInstancedInterleavedBuffer:!0,copy:function(e){return _t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),vo.prototype=Object.assign(Object.create(E.prototype),{constructor:vo,isInstancedBufferAttribute:!0,copy:function(e){return E.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(yo.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){return bo(e,this,n=n||[],t),n.sort(_o),n},intersectObjects:function(e,t,n){if(n=n||[],!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var r=0,o=e.length;r<o;r++)bo(e[r],this,n,t);return n.sort(_o),n}}),Object.assign(xo.prototype,{start:function(){this.oldTime=this.startTime=("undefined"==typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(wo.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Xo.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(So.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),Object.assign(Mo.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new n;return function(t,n){return n=e.copy(n).multiplyScalar(.5),this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new n),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new n),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new n),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new n),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new n;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Eo.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new a),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new a),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new a),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new a,t=new a;return function(n,r){return e.subVectors(n,this.start),t.subVectors(this.end,this.start),n=t.dot(t),n=t.dot(e)/n,r&&(n=Xo.clamp(n,0,1)),n}}(),closestPointToPoint:function(e,t,n){return e=this.closestPointToPointParameter(e,t),void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new a),this.delta(n).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),(To.prototype=Object.create(b.prototype)).constructor=To,To.prototype.isImmediateRenderObject=!0,(Co.prototype=Object.create(At.prototype)).constructor=Co,Co.prototype.update=function(){var e=new a,t=new a,n=new i;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var o=this.object.matrixWorld,a=this.geometry.attributes.position,i=this.object.geometry;if(i&&i.isGeometry)for(var s=i.vertices,l=i.faces,u=i=0,c=l.length;u<c;u++)for(var d=l[u],p=0,h=d.vertexNormals.length;p<h;p++){var m=d.vertexNormals[p];e.copy(s[d[r[p]]]).applyMatrix4(o),t.copy(m).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(i,e.x,e.y,e.z),a.setXYZ(i+=1,t.x,t.y,t.z),i+=1}else if(i&&i.isBufferGeometry)for(r=i.attributes.position,s=i.attributes.normal,p=i=0,h=r.count;p<h;p++)e.set(r.getX(p),r.getY(p),r.getZ(p)).applyMatrix4(o),t.set(s.getX(p),s.getY(p),s.getZ(p)),t.applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(i,e.x,e.y,e.z),a.setXYZ(i+=1,t.x,t.y,t.z),i+=1;a.needsUpdate=!0}}(),(Po.prototype=Object.create(b.prototype)).constructor=Po,Po.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Po.prototype.update=function(){var e=new a,t=new a;return function(){this.light.updateMatrixWorld();var n=this.light.distance?this.light.distance:1e3,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(Ao.prototype=Object.create(At.prototype)).constructor=Ao,Ao.prototype.updateMatrixWorld=function(){var e=new a,t=new r,n=new r;return function(r){var o=this.bones,a=this.geometry,i=a.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<o.length;s++){var u=o[s];u.parent&&u.parent.isBone&&(t.multiplyMatrices(n,u.matrixWorld),e.setFromMatrixPosition(t),i.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(n,u.parent.matrixWorld),e.setFromMatrixPosition(t),i.setXYZ(l+1,e.x,e.y,e.z),l+=2)}a.getAttribute("position").needsUpdate=!0,b.prototype.updateMatrixWorld.call(this,r)}}(),(Lo.prototype=Object.create(q.prototype)).constructor=Lo,Lo.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Lo.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(Ro.prototype=Object.create(b.prototype)).constructor=Ro,Ro.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ro.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,n=this.line.geometry.attributes.position,r=n.array;r[0]=e,r[1]=-t,r[2]=0,r[3]=e,r[4]=t,r[5]=0,r[6]=-e,r[7]=t,r[8]=0,r[9]=-e,r[10]=-t,r[11]=0,r[12]=e,r[13]=-t,r[14]=0,n.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Do.prototype=Object.create(b.prototype)).constructor=Do,Do.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Do.prototype.update=function(){var e=new a,t=new g,n=new g;return function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var o=r.geometry.getAttribute("color");t.copy(this.light.color),n.copy(this.light.groundColor);for(var a=0,i=o.count;a<i;a++){var s=a<i/2?t:n;o.setXYZ(a,s.r,s.g,s.b)}o.needsUpdate=!0}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Io.prototype=Object.create(At.prototype)).constructor=Io,(Oo.prototype=Object.create(At.prototype)).constructor=Oo,(No.prototype=Object.create(At.prototype)).constructor=No,No.prototype.update=function(){var e=new a,t=new a,n=new i;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry,i=a.vertices,s=0,l=0,u=(a=a.faces).length;l<u;l++){var c=a[l],d=c.normal;e.copy(i[c.a]).add(i[c.b]).add(i[c.c]).divideScalar(3).applyMatrix4(r),t.copy(d).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),o.setXYZ(s,e.x,e.y,e.z),o.setXYZ(s+=1,t.x,t.y,t.z),s+=1}o.needsUpdate=!0}}(),(Uo.prototype=Object.create(b.prototype)).constructor=Uo,Uo.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Uo.prototype.update=function(){var e=new a,t=new a,n=new a;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(n),this.targetLine.scale.z=n.length()}}(),(ko.prototype=Object.create(At.prototype)).constructor=ko,ko.prototype.update=function(){function e(e,a,i,s){if(r.set(a,i,s).unproject(o),void 0!==(e=n[e]))for(a=t.getAttribute("position"),i=0,s=e.length;i<s;i++)a.setXYZ(e[i],r.x,r.y,r.z)}var t,n,r=new a,o=new x;return function(){t=this.geometry,n=this.pointMap,o.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),(Ho.prototype=Object.create(At.prototype)).constructor=Ho,Ho.prototype.update=function(){var e=new p;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){t=e.min;var n=e.max,r=this.geometry.attributes.position,o=r.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Ho.prototype.setFromObject=function(e){return this.object=e,this.update(),this},(Go.prototype=Object.create(At.prototype)).constructor=Go,Go.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),b.prototype.updateMatrixWorld.call(this,e))},(Vo.prototype=Object.create(Pt.prototype)).constructor=Vo,Vo.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;1e-8>Math.abs(t)&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=0>t?1:0,this.lookAt(this.plane.normal),b.prototype.updateMatrixWorld.call(this,e)},(jo.prototype=Object.create(b.prototype)).constructor=jo,jo.prototype.setDirection=function(){var e,t=new a;return function(n){.99999<n.y?this.quaternion.set(0,0,0,1):-.99999>n.y?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}(),jo.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},jo.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},(Fo.prototype=Object.create(At.prototype)).constructor=Fo,or.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(or.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(yr.prototype,{createPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getPoints(e),this.createGeometry(e)},createSpacedPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getSpacedPoints(e),this.createGeometry(e)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new M,n=0,r=e.length;n<r;n++){var o=e[n];t.vertices.push(new a(o.x,o.y,o.z||0))}return t}}),Object.assign(_r.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),zo.prototype=Object.create(lr.prototype),Bo.prototype=Object.create(lr.prototype),Wo.prototype=Object.create(lr.prototype),Object.assign(Wo.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Io.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ao.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(qr.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ha.extractUrlBase(e)}}),Object.assign(Mo.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(p.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Eo.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Xo,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Xo.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Xo.ceilPowerOfTwo(e)}}),Object.assign(i.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(r.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new a),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,o,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,o,a)}}),m.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},o.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(W.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Y.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Y,{barycoordFromPoint:function(e,t,n,r,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Y.getBarycoord(e,t,n,r,o)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Y.getNormal(e,t,n,r)}}),Object.assign(br.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new bn(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Rn(this,e)}}),Object.assign(n.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(a.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(l.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(M.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(b.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(b.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(St.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Mt.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(or.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),pt.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(xr.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(E.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(k.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(k.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(xn.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(fo.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(F.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new g}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Wn.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(B.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(gt.prototype,{animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(gt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(st.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(u.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(mt.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),ao.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new to).load(e,(function(e){t.setBuffer(e)})),this},so.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ro.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Zo.crossOrigin=void 0,Zo.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var o=new rr;return o.setCrossOrigin(this.crossOrigin),e=o.load(e,n,void 0,r),t&&(e.mapping=t),e},Zo.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var o=new nr;return o.setCrossOrigin(this.crossOrigin),e=o.load(e,n,void 0,r),t&&(e.mapping=t),e},Zo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Zo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},e.WebGLRenderTargetCube=c,e.WebGLRenderTarget=u,e.WebGLRenderer=gt,e.ShaderLib=na,e.UniformsLib=ta,e.UniformsUtils=Qo,e.ShaderChunk=Ko,e.FogExp2=$t,e.Fog=vt,e.Scene=yt,e.Sprite=wt,e.LOD=St,e.SkinnedMesh=Tt,e.Skeleton=Mt,e.Bone=Et,e.Mesh=q,e.LineSegments=At,e.LineLoop=Lt,e.Line=Pt,e.Points=Dt,e.Group=dt,e.VideoTexture=It,e.DataTexture=d,e.CompressedTexture=Ot,e.CubeTexture=ie,e.CanvasTexture=Nt,e.DepthTexture=Ut,e.Texture=s,e.CompressedTextureLoader=Qn,e.DataTextureLoader=er,e.CubeTextureLoader=nr,e.TextureLoader=rr,e.ObjectLoader=Zr,e.MaterialLoader=Wr,e.BufferGeometryLoader=Yr,e.DefaultLoadingManager=Aa,e.LoadingManager=Jn,e.JSONLoader=Xr,e.ImageLoader=tr,e.ImageBitmapLoader=Jr,e.FontLoader=eo,e.FileLoader=Kn,e.Loader=qr,e.LoaderUtils=Ha,e.Cache=Pa,e.AudioLoader=to,e.SpotLightShadow=Mr,e.SpotLight=Er,e.PointLight=Tr,e.RectAreaLight=Lr,e.HemisphereLight=wr,e.DirectionalLightShadow=Cr,e.DirectionalLight=Pr,e.AmbientLight=Ar,e.LightShadow=Sr,e.Light=xr,e.StereoCamera=no,e.PerspectiveCamera=pt,e.OrthographicCamera=w,e.CubeCamera=ro,e.ArrayCamera=ht,e.Camera=x,e.AudioListener=oo,e.PositionalAudio=io,e.AudioContext=Wa,e.AudioAnalyser=so,e.Audio=ao,e.VectorKeyframeTrack=Fr,e.StringKeyframeTrack=jr,e.QuaternionKeyframeTrack=Vr,e.NumberKeyframeTrack=Hr,e.ColorKeyframeTrack=kr,e.BooleanKeyframeTrack=Ur,e.PropertyMixer=lo,e.PropertyBinding=co,e.KeyframeTrack=Nr,e.AnimationUtils=Ua,e.AnimationObjectGroup=po,e.AnimationMixer=mo,e.AnimationClip=zr,e.Uniform=fo,e.InstancedBufferGeometry=go,e.BufferGeometry=k,e.Geometry=M,e.InterleavedBufferAttribute=bt,e.InstancedInterleavedBuffer=$o,e.InterleavedBuffer=_t,e.InstancedBufferAttribute=vo,e.Face3=S,e.Object3D=b,e.Raycaster=yo,e.Layers=_,e.EventDispatcher=t,e.Clock=xo,e.QuaternionLinearInterpolant=Gr,e.LinearInterpolant=Ir,e.DiscreteInterpolant=Or,e.CubicInterpolant=Dr,e.Interpolant=Rr,e.Triangle=Y,e.Math=Xo,e.Spherical=wo,e.Cylindrical=So,e.Plane=m,e.Frustum=f,e.Sphere=h,e.Ray=W,e.Matrix4=r,e.Matrix3=i,e.Box3=p,e.Box2=Mo,e.Line3=Eo,e.Euler=y,e.Vector4=l,e.Vector3=a,e.Vector2=n,e.Quaternion=o,e.Color=g,e.ImmediateRenderObject=To,e.VertexNormalsHelper=Co,e.SpotLightHelper=Po,e.SkeletonHelper=Ao,e.PointLightHelper=Lo,e.RectAreaLightHelper=Ro,e.HemisphereLightHelper=Do,e.GridHelper=Io,e.PolarGridHelper=Oo,e.FaceNormalsHelper=No,e.DirectionalLightHelper=Uo,e.CameraHelper=ko,e.BoxHelper=Ho,e.Box3Helper=Go,e.PlaneHelper=Vo,e.ArrowHelper=jo,e.AxesHelper=Fo,e.Shape=br,e.Path=_r,e.ShapePath=Kr,e.Font=Qr,e.CurvePath=yr,e.Curve=or,e.ImageUtils=Zo,e.ShapeUtils=Ma,e.WebGLUtils=ct,e.Extensions=ca,e.WireframeGeometry=kt,e.ParametricGeometry=Ht,e.ParametricBufferGeometry=Gt,e.TetrahedronGeometry=Ft,e.TetrahedronBufferGeometry=zt,e.OctahedronGeometry=Bt,e.OctahedronBufferGeometry=Wt,e.IcosahedronGeometry=Yt,e.IcosahedronBufferGeometry=qt,e.DodecahedronGeometry=Xt,e.DodecahedronBufferGeometry=Zt,e.PolyhedronGeometry=Vt,e.PolyhedronBufferGeometry=jt,e.TubeGeometry=Jt,e.TubeBufferGeometry=Kt,e.TorusKnotGeometry=Qt,e.TorusKnotBufferGeometry=en,e.TorusGeometry=tn,e.TorusBufferGeometry=nn,e.TextGeometry=Sn,e.TextBufferGeometry=Mn,e.SphereGeometry=En,e.SphereBufferGeometry=Tn,e.RingGeometry=Cn,e.RingBufferGeometry=Pn,e.PlaneGeometry=V,e.PlaneBufferGeometry=j,e.LatheGeometry=An,e.LatheBufferGeometry=Ln,e.ShapeGeometry=Rn,e.ShapeBufferGeometry=Dn,e.ExtrudeGeometry=bn,e.ExtrudeBufferGeometry=xn,e.EdgesGeometry=On,e.ConeGeometry=kn,e.ConeBufferGeometry=Hn,e.CylinderGeometry=Nn,e.CylinderBufferGeometry=Un,e.CircleGeometry=Gn,e.CircleBufferGeometry=Vn,e.BoxGeometry=H,e.BoxBufferGeometry=G,e.ShadowMaterial=jn,e.SpriteMaterial=xt,e.RawShaderMaterial=Fn,e.ShaderMaterial=B,e.PointsMaterial=Rt,e.MeshPhysicalMaterial=Bn,e.MeshStandardMaterial=zn,e.MeshPhongMaterial=Wn,e.MeshToonMaterial=Yn,e.MeshNormalMaterial=qn,e.MeshLambertMaterial=Xn,e.MeshDepthMaterial=at,e.MeshDistanceMaterial=it,e.MeshBasicMaterial=z,e.LineDashedMaterial=Zn,e.LineBasicMaterial=Ct,e.Material=F,e.Float64BufferAttribute=O,e.Float32BufferAttribute=I,e.Uint32BufferAttribute=D,e.Int32BufferAttribute=R,e.Uint16BufferAttribute=L,e.Int16BufferAttribute=A,e.Uint8ClampedBufferAttribute=P,e.Uint8BufferAttribute=C,e.Int8BufferAttribute=T,e.BufferAttribute=E,e.ArcCurve=ir,e.CatmullRomCurve3=lr,e.CubicBezierCurve=pr,e.CubicBezierCurve3=hr,e.EllipseCurve=ar,e.LineCurve=mr,e.LineCurve3=fr,e.QuadraticBezierCurve=gr,e.QuadraticBezierCurve3=$r,e.SplineCurve=vr,e.REVISION="95",e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.MinEquation=103,e.MaxEquation=104,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.NeverDepth=0,e.AlwaysDepth=1,e.LessDepth=2,e.LessEqualDepth=3,e.EqualDepth=4,e.GreaterEqualDepth=5,e.GreaterDepth=6,e.NotEqualDepth=7,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.NoToneMapping=0,e.LinearToneMapping=1,e.ReinhardToneMapping=2,e.Uncharted2ToneMapping=3,e.CineonToneMapping=4,e.UVMapping=300,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.SphericalReflectionMapping=305,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.HalfFloatType=1016,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedInt248Type=1020,e.AlphaFormat=1021,e.RGBFormat=1022,e.RGBAFormat=1023,e.LuminanceFormat=1024,e.LuminanceAlphaFormat=1025,e.RGBEFormat=1023,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.RGB_S3TC_DXT1_Format=33776,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGB_ETC1_Format=36196,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.LoopOnce=2200,e.LoopRepeat=2201,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=2400,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=0,e.TriangleStripDrawMode=1,e.TriangleFanDrawMode=2,e.LinearEncoding=3e3,e.sRGBEncoding=3001,e.GammaEncoding=3007,e.RGBEEncoding=3002,e.LogLuvEncoding=3003,e.RGBM7Encoding=3004,e.RGBM16Encoding=3005,e.RGBDEncoding=3006,e.BasicDepthPacking=3200,e.RGBADepthPacking=3201,e.TangentSpaceNormalMap=0,e.ObjectSpaceNormalMap=1,e.CubeGeometry=H,e.Face4=function(e,t,n,r,o,a,i){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new S(e,t,n,o,a,i)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Dt(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new wt(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Dt(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Rt(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Rt(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Rt(e)},e.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new a(e,t,n)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new E(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new T(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new C(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new P(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new A(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new L(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new R(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new D(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new I(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new O(e,t)},e.ClosedSplineCurve3=zo,e.SplineCurve3=Bo,e.Spline=Wo,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Fo(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ho(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new At(new On(e.geometry),new Ct({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new At(new kt(e.geometry),new Ct({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Kn(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new er(e)},e.GeometryUtils={merge:function(e,t,n){if(console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();var r=t.matrix;t=t.geometry}e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},e.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}},e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(e,"__esModule",{value:!0})})),function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).verb=e()}((function(){var e={},t=this,n=(new Function("try {return this===window;}catch(e){ return false;}"),new Function("try {return this===global;}catch(e){return false;}")),r=new Function("try {return typeof importScripts === 'function';}catch(e){return false;}");if(n()&&!r()&&(console.log(typeof o),Worker=require("webworker-threads").Worker),n()||r()){var o=t;if(r()){var a=function(e,n){var r=t;return e.split(".").forEach((function(e){r&&(r=r[e])})),r?r[n]:null};onmessage=function(e){if(e.data.className&&e.data.methodName){var t=a(e.data.className,e.data.methodName);return t?void postMessage({result:t.apply(null,e.data.args),id:e.data.id}):console.error("could not find "+e.data.className+"."+e.data.methodName)}}}}return function(e,t,n){"use strict";function r(e,t){function n(){}n.prototype=e;var r=new n;for(var o in t)r[o]=t[o];return t.toString!==Object.prototype.toString&&(r.toString=t.toString),r}function o(e){return e instanceof Array?function(){return l.iter(e)}:"function"==typeof e.iterator?a(e,e.iterator):e.iterator}function a(e,t){return null==t?null:(null==t.__id__&&(t.__id__=lt++),null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[t.__id__],null==n&&((n=function(){return n.method.apply(n.scope,arguments)}).scope=e,n.method=t,e.hx__closures__[t.__id__]=n),n);var n}t.geom=t.geom||{},t.exe=t.exe||{},t.eval=t.eval||{},t.core=t.core||{},t.promhx=t.promhx||{};var i={},s=function(){return P.__string_rec(this,"")},l=function(){};i.HxOverrides=l,l.__name__=["HxOverrides"],l.strDate=function(e){switch(e.length){case 8:var t=e.split(":"),n=new Date;return n.setTime(0),n.setUTCHours(t[0]),n.setUTCMinutes(t[1]),n.setUTCSeconds(t[2]),n;case 10:var r=e.split("-");return new Date(r[0],r[1]-1,r[2],0,0,0);case 19:var o=e.split(" "),a=o[0].split("-"),i=o[1].split(":");return new Date(a[0],a[1]-1,a[2],i[0],i[1],i[2]);default:throw new C("Invalid date format : "+e)}},l.cca=function(e,t){var n=e.charCodeAt(t);if(n==n)return n},l.substr=function(e,t,n){return null!=t&&0!=t&&null!=n&&n<0?"":(null==n&&(n=e.length),t<0?(t=e.length+t)<0&&(t=0):n<0&&(n=e.length+n-t),e.substr(t,n))},l.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var u=function(){};i.Lambda=u,u.__name__=["Lambda"],u.fold=function(e,t,n){for(var r=o(e)();r.hasNext();)n=t(r.next(),n);return n};var c=function(){this.length=0};i.List=c,c.__name__=["List"],c.prototype={add:function(e){var t=[e];null==this.h?this.h=t:this.q[1]=t,this.q=t,this.length++},pop:function(){if(null==this.h)return null;var e=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,e},isEmpty:function(){return null==this.h},__class__:c},Math.__name__=["Math"];var d=function(){};i.Reflect=d,d.__name__=["Reflect"],d.field=function(e,t){try{return e[t]}catch(n){return n instanceof C&&(n=n.val),null}},d.callMethod=function(e,t,n){return t.apply(e,n)},d.fields=function(e){var t=[];if(null!=e){var n=Object.prototype.hasOwnProperty;for(var r in e)"__id__"!=r&&"hx__closures__"!=r&&n.call(e,r)&&t.push(r)}return t},d.isFunction=function(e){return"function"==typeof e&&!(e.__name__||e.__ename__)},d.deleteField=function(e,t){return!!Object.prototype.hasOwnProperty.call(e,t)&&(delete e[t],!0)};var p=function(){};i.Std=p,p.__name__=["Std"],p.string=function(e){return P.__string_rec(e,"")},p.parseFloat=function(e){return parseFloat(e)};var h=function(){this.b=""};i.StringBuf=h,h.__name__=["StringBuf"],h.prototype={add:function(e){this.b+=p.string(e)},__class__:h};var m=function(){};i.StringTools=m,m.__name__=["StringTools"],m.fastCodeAt=function(e,t){return e.charCodeAt(t)};var f=i.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};f.TNull=["TNull",0],f.TNull.toString=s,f.TNull.__enum__=f,f.TInt=["TInt",1],f.TInt.toString=s,f.TInt.__enum__=f,f.TFloat=["TFloat",2],f.TFloat.toString=s,f.TFloat.__enum__=f,f.TBool=["TBool",3],f.TBool.toString=s,f.TBool.__enum__=f,f.TObject=["TObject",4],f.TObject.toString=s,f.TObject.__enum__=f,f.TFunction=["TFunction",5],f.TFunction.toString=s,f.TFunction.__enum__=f,f.TClass=function(e){var t=["TClass",6,e];return t.__enum__=f,t.toString=s,t},f.TEnum=function(e){var t=["TEnum",7,e];return t.__enum__=f,t.toString=s,t},f.TUnknown=["TUnknown",8],f.TUnknown.toString=s,f.TUnknown.__enum__=f;var g=function(){};i.Type=g,g.__name__=["Type"],g.getClassName=function(e){var t=e.__name__;return null==t?null:t.join(".")},g.getEnumName=function(e){return e.__ename__.join(".")},g.resolveClass=function(e){var t=i[e];return null!=t&&t.__name__?t:null},g.resolveEnum=function(e){var t=i[e];return null!=t&&t.__ename__?t:null},g.createEmptyInstance=function(e){function t(){}return t.prototype=e.prototype,new t},g.createEnum=function(e,t,n){var r=d.field(e,t);if(null==r)throw new C("No such constructor "+t);if(d.isFunction(r)){if(null==n)throw new C("Constructor "+t+" need parameters");return d.callMethod(e,r,n)}if(null!=n&&0!=n.length)throw new C("Constructor "+t+" does not need parameters");return r},g.getEnumConstructs=function(e){return e.__constructs__.slice()},g.typeof=function(e){switch(typeof e){case"boolean":return f.TBool;case"string":return f.TClass(String);case"number":return Math.ceil(e)==e%2147483648?f.TInt:f.TFloat;case"object":if(null==e)return f.TNull;var t=e.__enum__;if(null!=t)return f.TEnum(t);var n=P.getClass(e);return null!=n?f.TClass(n):f.TObject;case"function":return e.__name__||e.__ename__?f.TObject:f.TFunction;case"undefined":return f.TNull;default:return f.TUnknown}};var $=function(){};i["haxe.IMap"]=$,$.__name__=["haxe","IMap"];var v=function(e,t){this.high=e,this.low=t};i["haxe._Int64.___Int64"]=v,v.__name__=["haxe","_Int64","___Int64"],v.prototype={__class__:v};var y=function(){this.buf=new h,this.cache=[],this.useCache=y.USE_CACHE,this.useEnumIndex=y.USE_ENUM_INDEX,this.shash=new S,this.scount=0};i["haxe.Serializer"]=y,y.__name__=["haxe","Serializer"],y.prototype={toString:function(){return this.buf.b},serializeString:function(e){var t=this.shash.get(e);return null!=t?(this.buf.b+="R",void(this.buf.b+=null==t?"null":""+t)):(this.shash.set(e,this.scount++),this.buf.b+="y",e=encodeURIComponent(e),this.buf.b+=null==e.length?"null":""+e.length,this.buf.b+=":",void(this.buf.b+=null==e?"null":""+e))},serializeRef:function(e){for(var t=typeof e,n=0,r=this.cache.length;n<r;){var o=n++,a=this.cache[o];if(typeof a==t&&a==e)return this.buf.b+="r",this.buf.b+=null==o?"null":""+o,!0}return this.cache.push(e),!1},serializeFields:function(e){for(var t=0,n=d.fields(e);t<n.length;){var r=n[t];++t,this.serializeString(r),this.serialize(d.field(e,r))}this.buf.b+="g"},serialize:function(e){var t=g.typeof(e);switch(t[1]){case 0:this.buf.b+="n";break;case 1:var n=e;if(0==n)return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==n?"null":""+n;break;case 2:var r=e;isNaN(r)?this.buf.b+="k":isFinite(r)?(this.buf.b+="d",this.buf.b+=null==r?"null":""+r):this.buf.b+=r<0?"m":"p";break;case 3:this.buf.b+=e?"t":"f";break;case 6:var o=t[2];if(o==String)return void this.serializeString(e);if(this.useCache&&this.serializeRef(e))return;switch(o){case Array:var a=0;this.buf.b+="a";for(var i=e.length,s=0;s<i;){var l=s++;null==e[l]?a++:(a>0&&(1==a?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==a?"null":""+a),a=0),this.serialize(e[l]))}a>0&&(1==a?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==a?"null":""+a)),this.buf.b+="h";break;case c:this.buf.b+="l";for(var u=e.h,m=null;null!=u;)m=u[0],u=u[1],this.serialize(m);this.buf.b+="h";break;case Date:var f=e;this.buf.b+="v",this.buf.add(f.getTime());break;case S:this.buf.b+="b";for(var $=e,v=$.keys();v.hasNext();){var _=v.next();this.serializeString(_),this.serialize(null!=ft[_]?$.getReserved(_):$.h[_])}this.buf.b+="h";break;case b:this.buf.b+="q";for(var w=e,E=w.keys();E.hasNext();){var T=E.next();this.buf.b+=":",this.buf.b+=null==T?"null":""+T,this.serialize(w.h[T])}this.buf.b+="h";break;case x:this.buf.b+="M";for(var A=e,L=A.keys();L.hasNext();){var R=L.next(),D=d.field(R,"__id__");d.deleteField(R,"__id__"),this.serialize(R),R.__id__=D,this.serialize(A.h[R.__id__])}this.buf.b+="h";break;case M:for(var I=e,O=0,N=I.length-2,U=new h,k=y.BASE64;O<N;){var H=I.get(O++),G=I.get(O++),V=I.get(O++);U.add(k.charAt(H>>2)),U.add(k.charAt(63&(H<<4|G>>4))),U.add(k.charAt(63&(G<<2|V>>6))),U.add(k.charAt(63&V))}if(O==N){var j=I.get(O++),F=I.get(O++);U.add(k.charAt(j>>2)),U.add(k.charAt(63&(j<<4|F>>4))),U.add(k.charAt(F<<2&63))}else if(O==N+1){var z=I.get(O++);U.add(k.charAt(z>>2)),U.add(k.charAt(z<<4&63))}var B=U.b;this.buf.b+="s",this.buf.b+=null==B.length?"null":""+B.length,this.buf.b+=":",this.buf.b+=null==B?"null":""+B;break;default:this.useCache&&this.cache.pop(),null!=e.hxSerialize?(this.buf.b+="C",this.serializeString(g.getClassName(o)),this.useCache&&this.cache.push(e),e.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(g.getClassName(o)),this.useCache&&this.cache.push(e),this.serializeFields(e))}break;case 4:if(P.__instanceof(e,ht)){var W=g.getClassName(e);this.buf.b+="A",this.serializeString(W)}else if(P.__instanceof(e,mt))this.buf.b+="B",this.serializeString(g.getEnumName(e));else{if(this.useCache&&this.serializeRef(e))return;this.buf.b+="o",this.serializeFields(e)}break;case 7:var Y=t[2];if(this.useCache){if(this.serializeRef(e))return;this.cache.pop()}this.buf.b+=this.useEnumIndex?"j":"w",this.serializeString(g.getEnumName(Y)),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=p.string(e[1])):this.serializeString(e[0]),this.buf.b+=":";var q=e.length;this.buf.b+=p.string(q-2);for(var X=2;X<q;){var Z=X++;this.serialize(e[Z])}this.useCache&&this.cache.push(e);break;case 5:throw new C("Cannot serialize function");default:throw new C("Cannot serialize "+p.string(e))}},__class__:y};var _=function(e){this.buf=e,this.length=e.length,this.pos=0,this.scache=[],this.cache=[];var t=_.DEFAULT_RESOLVER;null==t&&(_.DEFAULT_RESOLVER=t=g),this.setResolver(t)};i["haxe.Unserializer"]=_,_.__name__=["haxe","Unserializer"],_.initCodes=function(){for(var e=[],t=0,n=_.BASE64.length;t<n;){var r=t++;e[_.BASE64.charCodeAt(r)]=r}return e},_.prototype={setResolver:function(e){this.resolver=null==e?{resolveClass:function(e){return null},resolveEnum:function(e){return null}}:e},get:function(e){return this.buf.charCodeAt(e)},readDigits:function(){for(var e=0,t=!1,n=this.pos;;){var r=this.buf.charCodeAt(this.pos);if(r!=r)break;if(45!=r){if(r<48||r>57)break;e=10*e+(r-48),this.pos++}else{if(this.pos!=n)break;t=!0,this.pos++}}return t&&(e*=-1),e},readFloat:function(){for(var e=this.pos;;){var t=this.buf.charCodeAt(this.pos);if(!(t>=43&&t<58||101==t||69==t))break;this.pos++}return p.parseFloat(l.substr(this.buf,e,this.pos-e))},unserializeObject:function(e){for(;;){if(this.pos>=this.length)throw new C("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var t=this.unserialize();if("string"!=typeof t)throw new C("Invalid object key");var n=this.unserialize();e[t]=n}this.pos++},unserializeEnum:function(e,t){if(58!=this.get(this.pos++))throw new C("Invalid enum format");var n=this.readDigits();if(0==n)return g.createEnum(e,t);for(var r=[];n-- >0;)r.push(this.unserialize());return g.createEnum(e,t,r)},unserialize:function(){switch(this.get(this.pos++)){case 110:return null;case 116:return!0;case 102:return!1;case 122:return 0;case 105:return this.readDigits();case 100:return this.readFloat();case 121:var e=this.readDigits();if(58!=this.get(this.pos++)||this.length-this.pos<e)throw new C("Invalid string length");var t=l.substr(this.buf,this.pos,e);return this.pos+=e,t=decodeURIComponent(t.split("+").join(" ")),this.scache.push(t),t;case 107:return NaN;case 109:return-1/0;case 112:return 1/0;case 97:var n=[];for(this.cache.push(n);;){var r=this.buf.charCodeAt(this.pos);if(104==r){this.pos++;break}if(117==r){this.pos++;var o=this.readDigits();n[n.length+o-1]=null}else n.push(this.unserialize())}return n;case 111:var a={};return this.cache.push(a),this.unserializeObject(a),a;case 114:var i=this.readDigits();if(i<0||i>=this.cache.length)throw new C("Invalid reference");return this.cache[i];case 82:var s=this.readDigits();if(s<0||s>=this.scache.length)throw new C("Invalid string reference");return this.scache[s];case 120:throw new C(this.unserialize());case 99:var u=this.unserialize(),d=this.resolver.resolveClass(u);if(null==d)throw new C("Class not found "+u);var p=g.createEmptyInstance(d);return this.cache.push(p),this.unserializeObject(p),p;case 119:var h=this.unserialize(),f=this.resolver.resolveEnum(h);if(null==f)throw new C("Enum not found "+h);var $=this.unserializeEnum(f,this.unserialize());return this.cache.push($),$;case 106:var v=this.unserialize(),y=this.resolver.resolveEnum(v);if(null==y)throw new C("Enum not found "+v);this.pos++;var w=this.readDigits(),E=g.getEnumConstructs(y)[w];if(null==E)throw new C("Unknown enum index "+v+"@"+w);var T=this.unserializeEnum(y,E);return this.cache.push(T),T;case 108:var P=new c;for(this.cache.push(P);104!=this.buf.charCodeAt(this.pos);)P.add(this.unserialize());return this.pos++,P;case 98:var A=new S;for(this.cache.push(A);104!=this.buf.charCodeAt(this.pos);){var L=this.unserialize();A.set(L,this.unserialize())}return this.pos++,A;case 113:var R=new b;this.cache.push(R);for(var D=this.get(this.pos++);58==D;){var I=this.readDigits();R.set(I,this.unserialize()),D=this.get(this.pos++)}if(104!=D)throw new C("Invalid IntMap format");return R;case 77:var O=new x;for(this.cache.push(O);104!=this.buf.charCodeAt(this.pos);){var N=this.unserialize();O.set(N,this.unserialize())}return this.pos++,O;case 118:var U;if(this.buf.charCodeAt(this.pos)>=48&&this.buf.charCodeAt(this.pos)<=57&&this.buf.charCodeAt(this.pos+1)>=48&&this.buf.charCodeAt(this.pos+1)<=57&&this.buf.charCodeAt(this.pos+2)>=48&&this.buf.charCodeAt(this.pos+2)<=57&&this.buf.charCodeAt(this.pos+3)>=48&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4)){var k=l.substr(this.buf,this.pos,19);U=l.strDate(k),this.pos+=19}else{var H=this.readFloat(),G=new Date;G.setTime(H),U=G}return this.cache.push(U),U;case 115:var V=this.readDigits(),j=this.buf;if(58!=this.get(this.pos++)||this.length-this.pos<V)throw new C("Invalid bytes length");var F=_.CODES;null==F&&(F=_.initCodes(),_.CODES=F);for(var z=this.pos,B=3&V,W=z+(V-B),Y=M.alloc(3*(V>>2)+(B>=2?B-1:0)),q=0;z<W;){var X=F[m.fastCodeAt(j,z++)],Z=F[m.fastCodeAt(j,z++)];Y.set(q++,X<<2|Z>>4);var J=F[m.fastCodeAt(j,z++)];Y.set(q++,Z<<4|J>>2);var K=F[m.fastCodeAt(j,z++)];Y.set(q++,J<<6|K)}if(B>=2){var Q=F[m.fastCodeAt(j,z++)],ee=F[m.fastCodeAt(j,z++)];if(Y.set(q++,Q<<2|ee>>4),3==B){var te=F[m.fastCodeAt(j,z++)];Y.set(q++,ee<<4|te>>2)}}return this.pos+=V,this.cache.push(Y),Y;case 67:var ne=this.unserialize(),re=this.resolver.resolveClass(ne);if(null==re)throw new C("Class not found "+ne);var oe=g.createEmptyInstance(re);if(this.cache.push(oe),oe.hxUnserialize(this),103!=this.get(this.pos++))throw new C("Invalid custom data");return oe;case 65:var ae=this.unserialize(),ie=this.resolver.resolveClass(ae);if(null==ie)throw new C("Class not found "+ae);return ie;case 66:var se=this.unserialize(),le=this.resolver.resolveEnum(se);if(null==le)throw new C("Enum not found "+se);return le}throw this.pos--,new C("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:_};var b=function(){this.h={}};i["haxe.ds.IntMap"]=b,b.__name__=["haxe","ds","IntMap"],b.__interfaces__=[$],b.prototype={set:function(e,t){this.h[e]=t},remove:function(e){return!!this.h.hasOwnProperty(e)&&(delete this.h[e],!0)},keys:function(){var e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(0|t);return l.iter(e)},__class__:b};var x=function(){this.h={},this.h.__keys__={}};i["haxe.ds.ObjectMap"]=x,x.__name__=["haxe","ds","ObjectMap"],x.__interfaces__=[$],x.prototype={set:function(e,t){var n=e.__id__||(e.__id__=++x.count);this.h[n]=t,this.h.__keys__[n]=e},keys:function(){var e=[];for(var t in this.h.__keys__)this.h.hasOwnProperty(t)&&e.push(this.h.__keys__[t]);return l.iter(e)},__class__:x};var w=i["haxe.ds.Option"]={__ename__:["haxe","ds","Option"],__constructs__:["Some","None"]};w.Some=function(e){var t=["Some",0,e];return t.__enum__=w,t.toString=s,t},w.None=["None",1],w.None.toString=s,w.None.__enum__=w;var S=function(){this.h={}};i["haxe.ds.StringMap"]=S,S.__name__=["haxe","ds","StringMap"],S.__interfaces__=[$],S.prototype={set:function(e,t){null!=ft[e]?this.setReserved(e,t):this.h[e]=t},get:function(e){return null!=ft[e]?this.getReserved(e):this.h[e]},setReserved:function(e,t){null==this.rh&&(this.rh={}),this.rh["$"+e]=t},getReserved:function(e){return null==this.rh?null:this.rh["$"+e]},keys:function(){var e=this.arrayKeys();return l.iter(e)},arrayKeys:function(){var e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(t);if(null!=this.rh)for(var t in this.rh)36==t.charCodeAt(0)&&e.push(t.substr(1));return e},__class__:S};var M=function(e){this.length=e.byteLength,this.b=new $t(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b};i["haxe.io.Bytes"]=M,M.__name__=["haxe","io","Bytes"],M.alloc=function(e){return new M(new gt(e))},M.prototype={get:function(e){return this.b[e]},set:function(e,t){this.b[e]=255&t},__class__:M};var E=i["haxe.io.Error"]={__ename__:["haxe","io","Error"],__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};E.Blocked=["Blocked",0],E.Blocked.toString=s,E.Blocked.__enum__=E,E.Overflow=["Overflow",1],E.Overflow.toString=s,E.Overflow.__enum__=E,E.OutsideBounds=["OutsideBounds",2],E.OutsideBounds.toString=s,E.OutsideBounds.__enum__=E,E.Custom=function(e){var t=["Custom",3,e];return t.__enum__=E,t.toString=s,t};var T=function(){};i["haxe.io.FPHelper"]=T,T.__name__=["haxe","io","FPHelper"],T.i32ToFloat=function(e){var t=e>>>23&255,n=8388607&e;return 0==n&&0==t?0:(1-(e>>>31<<1))*(1+Math.pow(2,-23)*n)*Math.pow(2,t-127)},T.floatToI32=function(e){if(0==e)return 0;var t;t=e<0?-e:e;var n=Math.floor(Math.log(t)/.6931471805599453);return n<-127?n=-127:n>128&&(n=128),(e<0?-2147483648:0)|n+127<<23|8388607&Math.round(8388608*(t/Math.pow(2,n)-1))},T.i64ToDouble=function(e,t){var n=(t>>20&2047)-1023,r=4294967296*(1048575&t)+2147483648*(e>>>31)+(2147483647&e);return 0==r&&-1023==n?0:(1-(t>>>31<<1))*(1+Math.pow(2,-52)*r)*Math.pow(2,n)},T.doubleToI64=function(e){var t=T.i64tmp;if(0==e)t.low=0,t.high=0;else{var n;n=e<0?-e:e;var r,o=Math.floor(Math.log(n)/.6931471805599453),a=4503599627370496*(n/Math.pow(2,o)-1),i=(r=Math.round(a))/4294967296|0;t.low=0|r,t.high=(e<0?-2147483648:0)|o+1023<<20|i}return t};var C=function(e){Error.call(this),this.val=e,this.message=String(e),Error.captureStackTrace&&Error.captureStackTrace(this,C)};i["js._Boot.HaxeError"]=C,C.__name__=["js","_Boot","HaxeError"],C.__super__=Error,C.prototype=r(Error.prototype,{__class__:C});var P=function(){};i["js.Boot"]=P,P.__name__=["js","Boot"],P.getClass=function(e){if(e instanceof Array&&null==e.__enum__)return Array;var t=e.__class__;if(null!=t)return t;var n=P.__nativeClassName(e);return null!=n?P.__resolveNativeClass(n):null},P.__string_rec=function(e,t){if(null==e)return"null";if(t.length>=5)return"<...>";var n=typeof e;switch("function"==n&&(e.__name__||e.__ename__)&&(n="object"),n){case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0];var r=e[0]+"(";t+="\t";for(var o=2,a=e.length;o<a;){var i=o++;r+=2!=i?","+P.__string_rec(e[i],t):P.__string_rec(e[i],t)}return r+")"}var s=e.length,l="[";t+="\t";for(var u=0;u<s;){var c=u++;l+=(c>0?",":"")+P.__string_rec(e[c],t)}return l+"]"}var d;try{d=e.toString}catch(p){return p instanceof C&&(p=p.val),"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d){var h=e.toString();if("[object Object]"!=h)return h}var m=null,f="{\n";t+="\t";var g=null!=e.hasOwnProperty;for(var m in e)g&&!e.hasOwnProperty(m)||"prototype"!=m&&"__class__"!=m&&"__super__"!=m&&"__interfaces__"!=m&&"__properties__"!=m&&(2!=f.length&&(f+=", \n"),f+=t+m+" : "+P.__string_rec(e[m],t));return f+"\n"+(t=t.substring(1))+"}";case"function":return"<function>";case"string":return e;default:return String(e)}},P.__interfLoop=function(e,t){if(null==e)return!1;if(e==t)return!0;var n=e.__interfaces__;if(null!=n)for(var r=0,o=n.length;r<o;){var a=n[r++];if(a==t||P.__interfLoop(a,t))return!0}return P.__interfLoop(e.__super__,t)},P.__instanceof=function(e,t){if(null==t)return!1;switch(t){case ut:return(0|e)===e;case dt:return"number"==typeof e;case pt:return"boolean"==typeof e;case String:return"string"==typeof e;case Array:return e instanceof Array&&null==e.__enum__;case ct:return!0;default:if(null==e)return!1;if("function"==typeof t){if(e instanceof t)return!0;if(P.__interfLoop(P.getClass(e),t))return!0}else if("object"==typeof t&&P.__isNativeObj(t)&&e instanceof t)return!0;return t==ht&&null!=e.__name__||t==mt&&null!=e.__ename__||e.__enum__==t}},P.__nativeClassName=function(e){var t=P.__toStr.call(e).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},P.__isNativeObj=function(e){return null!=P.__nativeClassName(e)},P.__resolveNativeClass=function(e){return n[e]};var A=function(e){if(e instanceof Array&&null==e.__enum__)this.a=e,this.byteLength=e.length;else{var t=e;this.a=[];for(var n=0;n<t;){var r=n++;this.a[r]=0}this.byteLength=t}};i["js.html.compat.ArrayBuffer"]=A,A.__name__=["js","html","compat","ArrayBuffer"],A.sliceImpl=function(e,t){var n=new $t(this,e,null==t?null:t-e),r=new gt(n.byteLength);return new $t(r).set(n),r},A.prototype={slice:function(e,t){return new A(this.a.slice(e,t))},__class__:A};var L=function(e,t,n){if(this.buf=e,this.offset=null==t?0:t,this.length=null==n?e.byteLength-this.offset:n,this.offset<0||this.length<0||this.offset+this.length>e.byteLength)throw new C(E.OutsideBounds)};i["js.html.compat.DataView"]=L,L.__name__=["js","html","compat","DataView"],L.prototype={getInt8:function(e){var t=this.buf.a[this.offset+e];return t>=128?t-256:t},getUint8:function(e){return this.buf.a[this.offset+e]},getInt16:function(e,t){var n=this.getUint16(e,t);return n>=32768?n-65536:n},getUint16:function(e,t){return t?this.buf.a[this.offset+e]|this.buf.a[this.offset+e+1]<<8:this.buf.a[this.offset+e]<<8|this.buf.a[this.offset+e+1]},getInt32:function(e,t){var n=this.offset+e,r=this.buf.a[n++],o=this.buf.a[n++],a=this.buf.a[n++],i=this.buf.a[n++];return t?r|o<<8|a<<16|i<<24:i|a<<8|o<<16|r<<24},getUint32:function(e,t){var n=this.getInt32(e,t);return n<0?n+4294967296:n},getFloat32:function(e,t){return T.i32ToFloat(this.getInt32(e,t))},getFloat64:function(e,t){var n=this.getInt32(e,t),r=this.getInt32(e+4,t);return T.i64ToDouble(t?n:r,t?r:n)},setInt8:function(e,t){this.buf.a[e+this.offset]=t<0?t+128&255:255&t},setUint8:function(e,t){this.buf.a[e+this.offset]=255&t},setInt16:function(e,t,n){this.setUint16(e,t<0?t+65536:t,n)},setUint16:function(e,t,n){var r=e+this.offset;n?(this.buf.a[r]=255&t,this.buf.a[r++]=t>>8&255):(this.buf.a[r++]=t>>8&255,this.buf.a[r]=255&t)},setInt32:function(e,t,n){this.setUint32(e,t,n)},setUint32:function(e,t,n){var r=e+this.offset;n?(this.buf.a[r++]=255&t,this.buf.a[r++]=t>>8&255,this.buf.a[r++]=t>>16&255,this.buf.a[r++]=t>>>24):(this.buf.a[r++]=t>>>24,this.buf.a[r++]=t>>16&255,this.buf.a[r++]=t>>8&255,this.buf.a[r++]=255&t)},setFloat32:function(e,t,n){this.setUint32(e,T.floatToI32(t),n)},setFloat64:function(e,t,n){var r=T.doubleToI64(t);n?(this.setUint32(e,r.low),this.setUint32(e,r.high)):(this.setUint32(e,r.high),this.setUint32(e,r.low))},__class__:L};var R=function(){};i["js.html.compat.Uint8Array"]=R,R.__name__=["js","html","compat","Uint8Array"],R._new=function(e,t,n){var r;if("number"==typeof e){r=[];for(var o=0;o<e;)r[o++]=0;r.byteLength=r.length,r.byteOffset=0,r.buffer=new A(r)}else if(P.__instanceof(e,A)){var a=e;null==t&&(t=0),null==n&&(n=a.byteLength-t),(r=0==t?a.a:a.a.slice(t,t+n)).byteLength=r.length,r.byteOffset=t,r.buffer=a}else{if(!(e instanceof Array&&null==e.__enum__))throw new C("TODO "+p.string(e));(r=e.slice()).byteLength=r.length,r.byteOffset=0,r.buffer=new A(r)}return r.subarray=R._subarray,r.set=R._set,r},R._set=function(e,t){var n=this;if(P.__instanceof(e.buffer,A)){var r=e;if(e.byteLength+t>n.byteLength)throw new C("set() outside of range");for(var o=0,a=e.byteLength;o<a;){var i=o++;n[i+t]=r[i]}}else{if(!(e instanceof Array&&null==e.__enum__))throw new C("TODO");var s=e;if(s.length+t>n.byteLength)throw new C("set() outside of range");for(var l=0,u=s.length;l<u;){var c=l++;n[c+t]=s[c]}}},R._subarray=function(e,t){var n=R._new(this.slice(e,t));return n.byteOffset=e,n};var D=function(e){this._resolved=!1,this._pending=!1,this._errorPending=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,null!=e&&D.link(e,this,(function(e){return e}))};i["promhx.base.AsyncBase"]=D,D.__name__=["promhx","base","AsyncBase"],D.link=function(e,t,n){e._update.push({async:t,linkf:function(e){t.handleResolve(n(e))}}),D.immediateLinkUpdate(e,t,n)},D.immediateLinkUpdate=function(e,t,n){if(!e._errored||e._errorPending||e._error.length>0||t.handleError(e._errorVal),e._resolved&&!e._pending)try{t.handleResolve(n(e._val))}catch(r){r instanceof C&&(r=r.val),t.handleError(r)}},D.linkAll=function(e,t){for(var n=function(n,r,a){if(0==n.length||D.allFulfilled(n)){for(var i=[],s=o(e)();s.hasNext();){var l=s.next();i.push(l==r?a:l._val)}t.handleResolve(i)}},r=o(e)();r.hasNext();){var a=r.next();a._update.push({async:t,linkf:function(e,t,n){return function(r){e(t,n,r)}}(n,function(t){for(var n=[],r=o(e)();r.hasNext();){var i=r.next();i!=a&&n.push(i)}return n}(),a)})}D.allFulfilled(e)&&t.handleResolve(function(t){for(var n=[],r=o(e)();r.hasNext();){var a=r.next();n.push(a._val)}return n}())},D.pipeLink=function(e,t,n){var r=!1,o=function(e){if(!r){r=!0;var o=n(e);o._update.push({async:t,linkf:a(t,t.handleResolve)}),D.immediateLinkUpdate(o,t,(function(e){return e}))}};if(e._update.push({async:t,linkf:o}),e._resolved&&!e._pending)try{o(e._val)}catch(i){i instanceof C&&(i=i.val),t.handleError(i)}},D.allResolved=function(e){for(var t=o(e)();t.hasNext();)if(!t.next()._resolved)return!1;return!0},D.allFulfilled=function(e){for(var t=o(e)();t.hasNext();)if(!t.next()._fulfilled)return!1;return!0},D.prototype={catchError:function(e){return this._error.push(e),this},errorThen:function(e){return this._errorMap=e,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isErrorHandled:function(){return this._error.length>0},isErrorPending:function(){return this._errorPending},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(e){this._resolve(e)},_resolve:function(e){var t=this;this._pending?k.enqueue(function(e,t){return function(){e(t)}}(a(this,this._resolve),e)):(this._resolved=!0,this._pending=!0,k.queue.add((function(){t._val=e;for(var n=0,r=t._update;n<r.length;){var o=r[n];++n;try{o.linkf(e)}catch(a){a instanceof C&&(a=a.val),o.async.handleError(a)}}t._fulfilled=!0,t._pending=!1})),k.continueOnNextLoop())},handleError:function(e){this._handleError(e)},_handleError:function(e){var t=this,n=function(e){if(t._error.length>0)for(var n=0,r=t._error;n<r.length;){var o=r[n];++n,o(e)}else{if(!(t._update.length>0))throw new C(e);for(var a=0,i=t._update;a<i.length;){var s=i[a];++a,s.async.handleError(e)}}t._errorPending=!1};this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=e,k.queue.add((function(){if(null!=t._errorMap)try{t._resolve(t._errorMap(e))}catch(r){r instanceof C&&(r=r.val),n(r)}else n(e)})),k.continueOnNextLoop())},then:function(e){var t=new D(null);return D.link(this,t,e),t},unlink:function(e){var t=this;k.queue.add((function(){t._update=t._update.filter((function(t){return t.async!=e}))})),k.continueOnNextLoop()},isLinked:function(e){for(var t=0,n=this._update;t<n.length;){var r=n[t];if(++t,r.async==e)return!0}return!1},__class__:D};var I=t.promhx.Deferred=function(){D.call(this)};i["promhx.Deferred"]=I,I.__name__=["promhx","Deferred"],I.__super__=D,I.prototype=r(D.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},promise:function(){return new O(this)},stream:function(){return new N(this)},publicStream:function(){return new U(this)},__class__:I});var O=t.promhx.Promise=function(e){D.call(this,e),this._rejected=!1};i["promhx.Promise"]=O,O.__name__=["promhx","Promise"],O.whenAll=function(e){var t=new O(null);return D.linkAll(e,t),t},O.promise=function(e){var t=new O;return t.handleResolve(e),t},O.__super__=D,O.prototype=r(D.prototype,{isRejected:function(){return this._rejected},reject:function(e){this._rejected=!0,this.handleError(e)},handleResolve:function(e){if(this._resolved)throw new C(H.AlreadyResolved("Promise has already been resolved"));this._resolve(e)},then:function(e){var t=new O(null);return D.link(this,t,e),t},unlink:function(e){var t=this;k.queue.add((function(){t._fulfilled?t._update=t._update.filter((function(t){return t.async!=e})):t.handleError(H.DownstreamNotFullfilled("Downstream Promise is not fullfilled"))})),k.continueOnNextLoop()},handleError:function(e){this._rejected=!0,this._handleError(e)},pipe:function(e){var t=new O(null);return D.pipeLink(this,t,e),t},errorPipe:function(e){var t=new O;return this.catchError((function(n){e(n).then(a(t,t._resolve))})),this.then(a(t,t._resolve)),t},__class__:O});var N=t.promhx.Stream=function(e){D.call(this,e),this._end_promise=new O};i["promhx.Stream"]=N,N.__name__=["promhx","Stream"],N.foreach=function(e){for(var t=new N(null),n=o(e)();n.hasNext();){var r=n.next();t.handleResolve(r)}return t.end(),t},N.wheneverAll=function(e){var t=new N(null);return D.linkAll(e,t),t},N.concatAll=function(e){for(var t=new N(null),n=o(e)();n.hasNext();){var r=n.next();t.concat(r)}return t},N.mergeAll=function(e){for(var t=new N(null),n=o(e)();n.hasNext();){var r=n.next();t.merge(r)}return t},N.stream=function(e){var t=new N(null);return t.handleResolve(e),t},N.__super__=D,N.prototype=r(D.prototype,{then:function(e){var t=new N(null);return D.link(this,t,e),this._end_promise._update.push({async:t._end_promise,linkf:function(e){t.end()}}),t},detachStream:function(e){for(var t=[],n=!1,r=0,o=this._update;r<o.length;){var a=o[r];++r,a.async==e?(this._end_promise._update=this._end_promise._update.filter((function(t){return t.async!=e._end_promise})),n=!0):t.push(a)}return this._update=t,n},first:function(){var e=new O(null);return this.then((function(t){e._resolved||e.handleResolve(t)})),e},handleResolve:function(e){this._end||this._pause||this._resolve(e)},pause:function(e){null==e&&(e=!this._pause),this._pause=e},pipe:function(e){var t=new N(null);return D.pipeLink(this,t,e),this._end_promise.then((function(e){t.end()})),t},errorPipe:function(e){var t=new N(null);return this.catchError((function(n){var r=e(n);r.then(a(t,t._resolve)),r._end_promise.then(a(st=t._end_promise,st._resolve))})),this.then(a(t,t._resolve)),this._end_promise.then((function(e){t.end()})),t},handleEnd:function(){if(this._pending)k.queue.add(a(this,this.handleEnd)),k.continueOnNextLoop();else{if(this._end_promise._resolved)return;var e;this._end=!0,e=this._resolved?w.Some(this._val):w.None,this._end_promise.handleResolve(e),this._update=[],this._error=[]}},end:function(){return k.queue.add(a(this,this.handleEnd)),k.continueOnNextLoop(),this},endThen:function(e){return this._end_promise.then(e)},filter:function(e){var t=new N(null);return this._update.push({async:t,linkf:function(n){e(n)&&t.handleResolve(n)}}),D.immediateLinkUpdate(this,t,(function(e){return e})),t},concat:function(e){var t=new N(null);return this._update.push({async:t,linkf:a(t,t.handleResolve)}),D.immediateLinkUpdate(this,t,(function(e){return e})),this._end_promise.then((function(n){e.pipe((function(e){return t.handleResolve(e),t})),e._end_promise.then((function(e){t.end()}))})),t},merge:function(e){var t=new N(null);return this._update.push({async:t,linkf:a(t,t.handleResolve)}),e._update.push({async:t,linkf:a(t,t.handleResolve)}),D.immediateLinkUpdate(this,t,(function(e){return e})),D.immediateLinkUpdate(e,t,(function(e){return e})),t},__class__:N});var U=t.promhx.PublicStream=function(e){N.call(this,e)};i["promhx.PublicStream"]=U,U.__name__=["promhx","PublicStream"],U.publicstream=function(e){var t=new U(null);return t.handleResolve(e),t},U.__super__=N,U.prototype=r(N.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},update:function(e){this.handleResolve(e)},__class__:U});var k=function(){};i["promhx.base.EventLoop"]=k,k.__name__=["promhx","base","EventLoop"],k.enqueue=function(e){k.queue.add(e),k.continueOnNextLoop()},k.set_nextLoop=function(e){if(null!=k.nextLoop)throw new C("nextLoop has already been set");return k.nextLoop=e,k.nextLoop},k.queueEmpty=function(){return k.queue.isEmpty()},k.finish=function(e){null==e&&(e=1e3);for(var t=null;e-- >0&&null!=(t=k.queue.pop());)t();return k.queue.isEmpty()},k.clear=function(){k.queue=new c},k.f=function(){var e=k.queue.pop();null!=e&&e(),k.queue.isEmpty()||k.continueOnNextLoop()},k.continueOnNextLoop=function(){null!=k.nextLoop?k.nextLoop(k.f):setImmediate(k.f)};var H=i["promhx.error.PromiseError"]={__ename__:["promhx","error","PromiseError"],__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]};H.AlreadyResolved=function(e){var t=["AlreadyResolved",0,e];return t.__enum__=H,t.toString=s,t},H.DownstreamNotFullfilled=function(e){var t=["DownstreamNotFullfilled",1,e];return t.__enum__=H,t.toString=s,t};var G=function(){};i["verb.Verb"]=G,G.__name__=["verb","Verb"],G.main=function(){e.log("verb 2.0.0")};var V=function(){};i["verb.core.ArrayExtensions"]=V,V.__name__=["verb","core","ArrayExtensions"],V.alloc=function(e,t){if(!(t<0))for(;e.length<t;)e.push(null)},V.reversed=function(e){var t=e.slice();return t.reverse(),t},V.last=function(e){return e[e.length-1]},V.first=function(e){return e[0]},V.spliceAndInsert=function(e,t,n,r){e.splice(t,n),e.splice(t,0,r)},V.left=function(e){if(0==e.length)return[];var t=Math.ceil(e.length/2);return e.slice(0,t)},V.right=function(e){if(0==e.length)return[];var t=Math.ceil(e.length/2);return e.slice(t)},V.rightWithPivot=function(e){if(0==e.length)return[];var t=Math.ceil(e.length/2);return e.slice(t-1)},V.unique=function(e,t){if(0==e.length)return[];for(var n=[e.pop()];e.length>0;){for(var r=e.pop(),o=!0,a=0;a<n.length;){var i=n[a];if(++a,t(r,i)){o=!1;break}}o&&n.push(r)}return n};var j=function(){};i["verb.core.Binomial"]=j,j.__name__=["verb","core","Binomial"],j.get=function(e,t){if(0==t)return 1;if(0==e||t>e)return 0;if(t>e-t&&(t=e-t),j.memo_exists(e,t))return j.get_memo(e,t);for(var n=1,r=e,o=1,a=t+1;o<a;){var i=o++;j.memo_exists(r,i)?(e--,n=j.get_memo(r,i)):(n*=e--,j.memoize(r,i,n/=i))}return n},j.get_no_memo=function(e,t){if(0==t)return 1;if(0==e||t>e)return 0;t>e-t&&(t=e-t);for(var n=1,r=1,o=t+1;r<o;)n*=e--,n/=r++;return n},j.memo_exists=function(e,t){return j.memo.h.hasOwnProperty(e)&&j.memo.h[e].h.hasOwnProperty(t)},j.get_memo=function(e,t){return j.memo.h[e].h[t]},j.memoize=function(e,t,n){j.memo.h.hasOwnProperty(e)||j.memo.set(e,new b),j.memo.h[e].h[t]=n};var F=t.core.BoundingBox=function(e){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=e&&this.addRange(e)};i["verb.core.BoundingBox"]=F,F.__name__=["verb","core","BoundingBox"],F.intervalsOverlap=function(e,t,n,r,o){var a;null==o&&(o=-1),a=o<-.5?z.TOLERANCE:o;var i=Math.min(e,t)-a,s=Math.max(e,t)+a,l=Math.min(n,r)-a,u=Math.max(n,r)+a;return i>=l&&i<=u||s>=l&&s<=u||l>=i&&l<=s||u>=i&&u<=s},F.prototype={fromPoint:function(e){return new F([e])},add:function(e){if(!this.initialized)return this.dim=e.length,this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this;for(var t=0,n=this.dim;t<n;){var r=t++;e[r]>this.max[r]&&(this.max[r]=e[r]),e[r]<this.min[r]&&(this.min[r]=e[r])}return this},addRange:function(e){for(var t=e.length,n=0;n<t;){var r=n++;this.add(e[r])}return this},contains:function(e,t){return null==t&&(t=-1),!!this.initialized&&this.intersects(new F([e]),t)},intersects:function(e,t){if(null==t&&(t=-1),!this.initialized||!e.initialized)return!1;for(var n=this.min,r=this.max,o=e.min,a=e.max,i=0,s=this.dim;i<s;){var l=i++;if(!F.intervalsOverlap(n[l],r[l],o[l],a[l],t))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var e=0,t=0,n=0,r=this.dim;n<r;){var o=n++,a=this.getAxisLength(o);a>e&&(e=a,t=o)}return t},getAxisLength:function(e){return e<0||e>this.dim-1?0:Math.abs(this.min[e]-this.max[e])},intersect:function(e,t){if(!this.initialized)return null;var n=this.min,r=this.max,o=e.min,a=e.max;if(!this.intersects(e,t))return null;for(var i=[],s=[],l=0,u=this.dim;l<u;){var c=l++;i.push(Math.min(r[c],a[c])),s.push(Math.max(n[c],o[c]))}return new F([s,i])},__class__:F};var z=t.core.Constants=function(){};i["verb.core.Constants"]=z,z.__name__=["verb","core","Constants"];var B=t.core.SerializableBase=function(){};i["verb.core.SerializableBase"]=B,B.__name__=["verb","core","SerializableBase"],B.prototype={serialize:function(){var e=new y;return e.serialize(this),e.toString()},__class__:B};var W=t.core.Plane=function(e,t){this.origin=e,this.normal=t};i["verb.core.Plane"]=W,W.__name__=["verb","core","Plane"],W.__super__=B,W.prototype=r(B.prototype,{__class__:W});var Y=t.core.Ray=function(e,t){this.origin=e,this.dir=t};i["verb.core.Ray"]=Y,Y.__name__=["verb","core","Ray"],Y.__super__=B,Y.prototype=r(B.prototype,{__class__:Y});var q=t.core.NurbsCurveData=function(e,t,n){this.degree=e,this.controlPoints=n,this.knots=t};i["verb.core.NurbsCurveData"]=q,q.__name__=["verb","core","NurbsCurveData"],q.__super__=B,q.prototype=r(B.prototype,{__class__:q});var X=t.core.NurbsSurfaceData=function(e,t,n,r,o){this.degreeU=e,this.degreeV=t,this.knotsU=n,this.knotsV=r,this.controlPoints=o};i["verb.core.NurbsSurfaceData"]=X,X.__name__=["verb","core","NurbsSurfaceData"],X.__super__=B,X.prototype=r(B.prototype,{__class__:X});var Z=t.core.MeshData=function(e,t,n,r){this.faces=e,this.points=t,this.normals=n,this.uvs=r};i["verb.core.MeshData"]=Z,Z.__name__=["verb","core","MeshData"],Z.empty=function(){return new Z([],[],[],[])},Z.__super__=B,Z.prototype=r(B.prototype,{__class__:Z});var J=t.core.PolylineData=function(e,t){this.points=e,this.params=t};i["verb.core.PolylineData"]=J,J.__name__=["verb","core","PolylineData"],J.__super__=B,J.prototype=r(B.prototype,{__class__:J});var K=t.core.VolumeData=function(e,t,n,r,o,a,i){this.degreeU=e,this.degreeV=t,this.degreeW=n,this.knotsU=r,this.knotsV=o,this.knotsW=a,this.controlPoints=i};i["verb.core.VolumeData"]=K,K.__name__=["verb","core","VolumeData"],K.__super__=B,K.prototype=r(B.prototype,{__class__:K});var Q=t.core.Pair=function(e,t){this.item0=e,this.item1=t};i["verb.core.Pair"]=Q,Q.__name__=["verb","core","Pair"],Q.prototype={__class__:Q};var ee=t.core.Interval=function(e,t){this.min=e,this.max=t};i["verb.core.Interval"]=ee,ee.__name__=["verb","core","Interval"],ee.prototype={__class__:ee};var te=t.core.CurveCurveIntersection=function(e,t,n,r){this.point0=e,this.point1=t,this.u0=n,this.u1=r};i["verb.core.CurveCurveIntersection"]=te,te.__name__=["verb","core","CurveCurveIntersection"],te.prototype={__class__:te};var ne=t.core.CurveSurfaceIntersection=function(e,t,n,r){this.u=e,this.uv=t,this.curvePoint=n,this.surfacePoint=r};i["verb.core.CurveSurfaceIntersection"]=ne,ne.__name__=["verb","core","CurveSurfaceIntersection"],ne.prototype={__class__:ne};var re=t.core.MeshIntersectionPoint=function(e,t,n,r,o){this.visited=!1,this.adj=null,this.opp=null,this.uv0=e,this.uv1=t,this.point=n};i["verb.core.MeshIntersectionPoint"]=re,re.__name__=["verb","core","MeshIntersectionPoint"],re.prototype={__class__:re};var oe=t.core.PolylineMeshIntersection=function(e,t,n,r,o){this.point=e,this.u=t,this.uv=n,this.polylineIndex=r,this.faceIndex=o};i["verb.core.PolylineMeshIntersection"]=oe,oe.__name__=["verb","core","PolylineMeshIntersection"],oe.prototype={__class__:oe};var ae=t.core.SurfaceSurfaceIntersectionPoint=function(e,t,n,r){this.uv0=e,this.uv1=t,this.point=n,this.dist=r};i["verb.core.SurfaceSurfaceIntersectionPoint"]=ae,ae.__name__=["verb","core","SurfaceSurfaceIntersectionPoint"],ae.prototype={__class__:ae};var ie=t.core.TriSegmentIntersection=function(e,t,n,r){this.point=e,this.s=t,this.t=n,this.p=r};i["verb.core.TriSegmentIntersection"]=ie,ie.__name__=["verb","core","TriSegmentIntersection"],ie.prototype={__class__:ie};var se=t.core.CurveTriPoint=function(e,t,n){this.u=e,this.point=t,this.uv=n};i["verb.core.CurveTriPoint"]=se,se.__name__=["verb","core","CurveTriPoint"],se.prototype={__class__:se};var le=function(e,t,n,r,o){null==o&&(o=!1),null==r&&(r=-1),this.uv=n,this.point=e,this.normal=t,this.id=r,this.degen=o};i["verb.core.SurfacePoint"]=le,le.__name__=["verb","core","SurfacePoint"],le.fromUv=function(e,t){return new le(null,null,[e,t])},le.prototype={__class__:le};var ue=t.core.CurvePoint=function(e,t){this.u=e,this.pt=t};i["verb.core.CurvePoint"]=ue,ue.__name__=["verb","core","CurvePoint"],ue.prototype={__class__:ue};var ce=t.core.KdTree=function(e,t){this.dim=3,this.points=e,this.distanceFunction=t,this.dim=e[0].point.length,this.root=this.buildTree(e,0,null)};i["verb.core.KdTree"]=ce,ce.__name__=["verb","core","KdTree"],ce.prototype={buildTree:function(e,t,n){var r,o,a=t%this.dim;return 0==e.length?null:1==e.length?new he(e[0],a,n):(e.sort((function(e,t){var n=e.point[a]-t.point[a];return 0==n?0:n>0?1:-1})),r=Math.floor(e.length/2),(o=new he(e[r],a,n)).left=this.buildTree(e.slice(0,r),t+1,o),o.right=this.buildTree(e.slice(r+1),t+1,o),o)},nearest:function(e,t,n){var r,o=this,a=new de((function(e){return-e.item1})),i=null;i=function(n){for(var r,s,l=n.dimension,u=o.distanceFunction(e,n.kdPoint.point),c=[],d=0,p=o.dim;d<p;)d++,c.push(0);s=c;for(var h,m,f=function(e,n){a.push(new Q(e,n)),a.size()>t&&a.pop()},g=0,$=o.dim;g<$;){var v=g++;s[v]=v==n.dimension?e[v]:n.kdPoint.point[v]}return h=o.distanceFunction(s,n.kdPoint.point),null==n.right&&null==n.left?void((a.size()<t||u<a.peek().item1)&&f(n,u)):(i(r=null==n.right?n.left:null==n.left?n.right:e[l]<n.kdPoint.point[l]?n.left:n.right),(a.size()<t||u<a.peek().item1)&&f(n,u),void((a.size()<t||Math.abs(h)<a.peek().item1)&&(m=r==n.left?n.right:n.left,null!=m&&i(m))))},r=i;for(var s=0;s<t;)s++,a.push(new Q(null,n));r(this.root);for(var l=[],u=0;u<t;){var c=u++;null!=a.content[c].item0&&l.push(new Q(a.content[c].item0.kdPoint,a.content[c].item1))}return l},__class__:ce};var de=function(e){this.content=[],this.scoreFunction=e};i["verb.core.BinaryHeap"]=de,de.__name__=["verb","core","BinaryHeap"],de.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,n=0;n<t;){var r=n++;if(this.content[r]==e){var o=this.content.pop();return void(r!=t-1&&(this.content[r]=o,this.scoreFunction(o)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r)))}}throw new C("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},sinkDown:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var o=2*(e+1),a=o-1,i=-1,s=0;if(a<t&&(s=this.scoreFunction(this.content[a]))<r&&(i=a),o<t&&this.scoreFunction(this.content[o])<(-1==i?r:s)&&(i=o),-1==i)break;this.content[e]=this.content[i],this.content[i]=n,e=i}},__class__:de};var pe=t.core.KdPoint=function(e,t){this.point=e,this.obj=t};i["verb.core.KdPoint"]=pe,pe.__name__=["verb","core","KdPoint"],pe.prototype={__class__:pe};var he=t.core.KdNode=function(e,t,n){this.kdPoint=e,this.left=null,this.right=null,this.parent=n,this.dimension=t};i["verb.core.KdNode"]=he,he.__name__=["verb","core","KdNode"],he.prototype={__class__:he};var me=function(){};i["verb.eval.IBoundingBoxTree"]=me,me.__name__=["verb","eval","IBoundingBoxTree"],me.prototype={__class__:me};var fe=function(e,t){this._boundingBox=null,this._curve=e,null==t&&(t=Ce.domain(this._curve.knots)/64),this._knotTol=t};i["verb.core.LazyCurveBoundingBoxTree"]=fe,fe.__name__=["verb","core","LazyCurveBoundingBoxTree"],fe.__interfaces__=[me],fe.prototype={split:function(){var e=V.first(this._curve.knots),t=V.last(this._curve.knots),n=Re.curveSplit(this._curve,(t+e)/2+.1*(t-e)*Math.random());return new Q(new fe(n[0],this._knotTol),new fe(n[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new F(Ie.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(e){return Ce.domain(this._curve.knots)<this._knotTol},empty:function(){return!1},__class__:fe};var ge=function(e,t){if(this._boundingBox=null,this._mesh=e,null==t){for(var n=[],r=0,o=e.faces.length;r<o;){var a=r++;n.push(a)}t=n}this._faceIndices=t};i["verb.core.LazyMeshBoundingBoxTree"]=ge,ge.__name__=["verb","core","LazyMeshBoundingBoxTree"],ge.__interfaces__=[me],ge.prototype={split:function(){var e=be.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),t=V.left(e),n=V.right(e);return new Q(new ge(this._mesh,t),new ge(this._mesh,n))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=be.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(e){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length},__class__:ge};var $e=function(e,t){this._boundingBox=null,this._polyline=e,null==t&&(t=new ee(0,0!=e.points.length?e.points.length-1:0)),this._interval=t};i["verb.core.LazyPolylineBoundingBoxTree"]=$e,$e.__name__=["verb","core","LazyPolylineBoundingBoxTree"],$e.__interfaces__=[me],$e.prototype={split:function(){var e=this._interval.min,t=this._interval.max,n=e+Math.ceil((t-e)/2),r=new ee(e,n),o=new ee(n,t);return new Q(new $e(this._polyline,r),new $e(this._polyline,o))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new F(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(e){return this._interval.max-this._interval.min==1},empty:function(){return this._interval.max-this._interval.min==0},__class__:$e};var ve=function(e,t,n,r){null==t&&(t=!1),this._boundingBox=null,this._surface=e,this._splitV=t,null==n&&(n=Ce.domain(e.knotsU)/16),null==r&&(r=Ce.domain(e.knotsV)/16),this._knotTolU=n,this._knotTolV=r};i["verb.core.LazySurfaceBoundingBoxTree"]=ve,ve.__name__=["verb","core","LazySurfaceBoundingBoxTree"],ve.__interfaces__=[me],ve.prototype={split:function(){var e,t;this._splitV?(e=V.first(this._surface.knotsV),t=V.last(this._surface.knotsV)):(e=V.first(this._surface.knotsU),t=V.last(this._surface.knotsU));var n=Re.surfaceSplit(this._surface,(e+t)/2,this._splitV);return new Q(new ve(n[0],!this._splitV,this._knotTolU,this._knotTolV),new ve(n[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new F;for(var e=0,t=this._surface.controlPoints;e<t.length;){var n=t[e];++e,this._boundingBox.addRange(Ie.dehomogenize1d(n))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(e){return Ce.domain(this._surface.knotsV)<this._knotTolV&&Ce.domain(this._surface.knotsU)<this._knotTolU},empty:function(){return!1},__class__:ve};var ye=t.core.Mat=function(){};i["verb.core.Mat"]=ye,ye.__name__=["verb","core","Mat"],ye.mul=function(e,t){for(var n=[],r=0,o=t.length;r<o;){var a=r++;n.push(Ce.mul(e,t[a]))}return n},ye.mult=function(e,t){var n,r,o,a,i,s,l;n=t.length,r=t[0].length,o=[];for(var u=e.length-1,c=0,d=0;u>=0;){for(a=[],i=e[u],d=r-1;d>=0;){for(s=i[n-1]*t[n-1][d],c=n-2;c>=1;)s+=i[c]*t[c][d]+i[l=c-1]*t[l][d],c-=2;0==c&&(s+=i[0]*t[0][d]),a[d]=s,d--}o[u]=a,u--}return o},ye.add=function(e,t){for(var n=[],r=0,o=e.length;r<o;){var a=r++;n.push(Ce.add(e[a],t[a]))}return n},ye.div=function(e,t){for(var n=[],r=0,o=e.length;r<o;){var a=r++;n.push(Ce.div(e[a],t))}return n},ye.sub=function(e,t){for(var n=[],r=0,o=e.length;r<o;){var a=r++;n.push(Ce.sub(e[a],t[a]))}return n},ye.dot=function(e,t){for(var n=[],r=0,o=e.length;r<o;){var a=r++;n.push(Ce.dot(e[a],t))}return n},ye.identity=function(e){for(var t=Ce.zeros2d(e,e),n=0;n<e;){var r=n++;t[r][r]=1}return t},ye.transpose=function(e){if(0==e.length)return[];for(var t=[],n=0,r=e[0].length;n<r;){var o=n++;t.push(function(t){for(var n=[],r=0,a=e.length;r<a;){var i=r++;n.push(e[i][o])}return n}())}return t},ye.solve=function(e,t){return ye.LUsolve(ye.LU(e),t)},ye.LUsolve=function(e,t){var n,r,o,a,i,s=e.LU,l=s.length,u=t.slice(),c=e.P;for(n=l-1;-1!=n;)u[n]=t[n],--n;for(n=0;n<l;){for(o=c[n],c[n]!=n&&(i=u[n],u[n]=u[o],u[o]=i),a=s[n],r=0;r<n;)u[n]-=u[r]*a[r],++r;++n}for(n=l-1;n>=0;){for(a=s[n],r=n+1;r<l;)u[n]-=u[r]*a[r],++r;u[n]/=a[n],--n}return u},ye.LU=function(e){for(var t,n,r,o,a,i,s,l,u,c=(Math,[]),d=0,p=e.length;d<p;){var h=d++;c.push(e[h].slice())}var m=(e=c).length,f=m-1,g=[];for(r=0;r<m;){for(s=r,i=e[r],u=Math.abs(i[r]),n=r+1;n<m;)u<(o=Math.abs(e[n][r]))&&(u=o,s=n),++n;for(g[r]=s,s!=r&&(e[r]=e[s],e[s]=i,i=e[r]),a=i[r],t=r+1;t<m;)e[t][r]/=a,++t;for(t=r+1;t<m;){for(l=e[t],n=r+1;n<f;)l[n]-=l[r]*i[n],l[++n]-=l[r]*i[n],++n;n==f&&(l[n]-=l[r]*i[n]),++t}++r}return new _e(e,g)};var _e=function(e,t){this.LU=e,this.P=t};i["verb.core._Mat.LUDecomp"]=_e,_e.__name__=["verb","core","_Mat","LUDecomp"],_e.prototype={__class__:_e};var be=t.core.Mesh=function(){};i["verb.core.Mesh"]=be,be.__name__=["verb","core","Mesh"],be.getTriangleNorm=function(e,t){var n=e[t[0]],r=e[t[2]],o=Ce.sub(e[t[1]],n),a=Ce.sub(r,n),i=Ce.cross(o,a);return Ce.mul(1/Ce.norm(i),i)},be.makeMeshAabb=function(e,t){for(var n=new F,r=0;r<t.length;){var o=t[r];++r,n.add(e.points[e.faces[o][0]]),n.add(e.points[e.faces[o][1]]),n.add(e.points[e.faces[o][2]])}return n},be.sortTrianglesOnLongestAxis=function(e,t,n){for(var r=e.getLongestAxis(),o=[],a=0;a<n.length;){var i=n[a];++a;var s=be.getMinCoordOnAxis(t.points,t.faces[i],r);o.push(new Q(s,i))}o.sort((function(e,t){var n=e.item0,r=t.item0;return n==r?0:n>r?1:-1}));for(var l=[],u=0,c=o.length;u<c;){var d=u++;l.push(o[d].item1)}return l},be.getMinCoordOnAxis=function(e,t,n){for(var r=1/0,o=0;o<3;){var a=e[t[o++]][n];a<r&&(r=a)}return r},be.getTriangleCentroid=function(e,t){for(var n=[0,0,0],r=0;r<3;)for(var o=r++,a=0;a<3;){var i=a++;n[i]+=e[t[o]][i]}for(var s=0;s<3;)n[s++]/=3;return n},be.triangleUVFromPoint=function(e,t,n){var r=e.faces[t],o=e.points[r[0]],a=e.points[r[1]],i=e.points[r[2]],s=e.uvs[r[0]],l=e.uvs[r[1]],u=e.uvs[r[2]],c=Ce.sub(o,n),d=Ce.sub(a,n),p=Ce.sub(i,n),h=Ce.norm(Ce.cross(Ce.sub(o,a),Ce.sub(o,i))),m=Ce.norm(Ce.cross(d,p))/h,f=Ce.norm(Ce.cross(p,c))/h,g=Ce.norm(Ce.cross(c,d))/h;return Ce.add(Ce.mul(m,s),Ce.add(Ce.mul(f,l),Ce.mul(g,u)))};var xe=function(e,t){if(this._empty=!1,this._face=-1,null==t){for(var n=[],r=0,o=e.faces.length;r<o;){var a=r++;n.push(a)}t=n}if(this._boundingBox=be.makeMeshAabb(e,t),t.length<1)this._empty=!0;else if(t.length<2)this._face=t[0];else{var i=be.sortTrianglesOnLongestAxis(this._boundingBox,e,t),s=V.left(i),l=V.right(i);this._children=new Q(new xe(e,s),new xe(e,l))}};i["verb.core.MeshBoundingBoxTree"]=xe,xe.__name__=["verb","core","MeshBoundingBoxTree"],xe.__interfaces__=[me],xe.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},yield:function(){return this._face},indivisible:function(e){return null==this._children},empty:function(){return this._empty},__class__:xe};var we=t.core.Minimizer=function(){};i["verb.core.Minimizer"]=we,we.__name__=["verb","core","Minimizer"],we.uncmin=function(e,t,n,r,o){null==n&&(n=1e-8),null==r&&(r=function(t){return we.numericalGradient(e,t)}),null==o&&(o=1e3);var a,i=(t=t.slice(0)).length,s=e(t),l=s;if(isNaN(s))throw new C("uncmin: f(x0) is a NaN!");n=Math.max(n,z.EPSILON);var u,c,d,p,h,m,f,g,$,v=ye.identity(i),y=0,_=[],b="";for(c=r(t);y<o;){if(!Ce.all(Ce.finite(c))){b="Gradient has Infinity or NaN";break}if(u=Ce.neg(ye.dot(v,c)),!Ce.all(Ce.finite(u))){b="Search direction has Infinity or NaN";break}if(($=Ce.norm(u))<n){b="Newton step smaller than tol";break}for(g=1,a=Ce.dot(c,u),p=t;y<o&&!(g*$<n)&&(_=Ce.mul(g,u),p=Ce.add(t,_),(l=e(p))-s>=.1*g*a||isNaN(l));)g*=.5,++y;if(g*$<n){b="Line search step size smaller than tol";break}if(y==o){b="maxit reached during line search";break}d=r(p),h=Ce.sub(d,c),f=Ce.dot(h,_),m=ye.dot(v,h),v=ye.sub(ye.add(v,ye.mul((f+Ce.dot(h,m))/(f*f),we.tensor(_,_))),ye.div(ye.add(we.tensor(m,_),we.tensor(_,m)),f)),t=p,s=l,c=d,++y}return new Se(t,s,c,v,y,b)},we.numericalGradient=function(e,t){var n=t.length,r=e(t);if(NaN==r)throw new C("gradient: f(x) is a NaN!");for(var o,a,i,s,l,u,c,d,p=t.slice(0),h=[],m=0,f=0;f<n;)for(var g=f++,$=Math.max(1e-6*r,1e-8);;){if(++m>20)throw new C("Numerical gradient fails");if(p[g]=t[g]+$,o=e(p),p[g]=t[g]-$,a=e(p),p[g]=t[g],isNaN(o)||isNaN(a))$/=16;else{if(h[g]=(o-a)/(2*$),i=t[g]-$,s=t[g],l=t[g]+$,u=(o-r)/$,c=(r-a)/$,d=Ce.max([Math.abs(h[g]),Math.abs(r),Math.abs(o),Math.abs(a),Math.abs(i),Math.abs(s),Math.abs(l),1e-8]),!(Math.min(Ce.max([Math.abs(u-h[g]),Math.abs(c-h[g]),Math.abs(u-c)])/d,$/d)>.001))break;$/=16}}return h},we.tensor=function(e,t){for(var n,r,o=t.length,a=[],i=e.length-1;i>=0;){n=[],r=e[i];for(var s=o-1;s>=3;)n[s]=r*t[s],n[--s]=r*t[s],n[--s]=r*t[s],n[--s]=r*t[s],--s;for(;s>=0;)n[s]=r*t[s],--s;a[i]=n,i--}return a};var Se=function(e,t,n,r,o,a){this.solution=e,this.value=t,this.gradient=n,this.invHessian=r,this.iterations=o,this.message=a};i["verb.core.MinimizationResult"]=Se,Se.__name__=["verb","core","MinimizationResult"],Se.prototype={__class__:Se};var Me=function(){};i["verb.core.ISerializable"]=Me,Me.__name__=["verb","core","ISerializable"],Me.prototype={__class__:Me};var Ee=t.core.Deserializer=function(){};i["verb.core.Deserializer"]=Ee,Ee.__name__=["verb","core","Deserializer"],Ee.deserialize=function(e){return new _(e).unserialize()};var Te=t.core.Trig=function(){};i["verb.core.Trig"]=Te,Te.__name__=["verb","core","Trig"],Te.isPointInPlane=function(e,t,n){return Math.abs(Ce.dot(Ce.sub(e,t.origin),t.normal))<n},Te.distToSegment=function(e,t,n){var r=Te.segmentClosestPoint(t,e,n,0,1);return Ce.dist(t,r.pt)},Te.rayClosestPoint=function(e,t,n){var r=Ce.sub(e,t),o=Ce.dot(r,n);return Ce.add(t,Ce.mul(o,n))},Te.distToRay=function(e,t,n){var r=Te.rayClosestPoint(e,t,n),o=Ce.sub(r,e);return Ce.norm(o)},Te.threePointsAreFlat=function(e,t,n,r){var o=Ce.sub(t,e),a=Ce.sub(n,e),i=Ce.cross(o,a);return Ce.dot(i,i)<r},Te.segmentClosestPoint=function(e,t,n,r,o){var a=Ce.sub(n,t),i=Ce.norm(a);if(i<z.EPSILON)return{u:r,pt:t};var s=t,l=Ce.mul(1/i,a),u=Ce.sub(e,s),c=Ce.dot(u,l);return c<0?{u:r,pt:t}:c>i?{u:o,pt:n}:{u:r+(o-r)*c/i,pt:Ce.add(s,Ce.mul(c,l))}};var Ce=t.core.Vec=function(){};i["verb.core.Vec"]=Ce,Ce.__name__=["verb","core","Vec"],Ce.angleBetween=function(e,t){return Math.acos(Ce.dot(e,t)/(Ce.norm(e)*Ce.norm(t)))},Ce.positiveAngleBetween=function(e,t,n){var r=Ce.cross(e,t),o=Ce.norm(e)*Ce.norm(t),a=Ce.dot(e,t),i=Ce.norm(r)/o,s=Math.atan2(i,a/o),l=Ce.dot(n,r);return Math.abs(l)<z.EPSILON?s:l>0?s:-s},Ce.signedAngleBetween=function(e,t,n){var r=Ce.cross(e,t),o=Ce.norm(e)*Ce.norm(t),a=Ce.dot(e,t),i=Ce.norm(r)/o,s=Math.atan2(i,a/o);return Ce.dot(n,r)>0?s:2*Math.PI-s},Ce.angleBetweenNormalized2d=function(e,t){return Math.atan2(e[0]*t[1]-e[1]*t[0],Ce.dot(e,t))},Ce.domain=function(e){return V.last(e)-V.first(e)},Ce.range=function(e){for(var t=[],n=0,r=0;r<e;)r++,t.push(n),n+=1;return t},Ce.span=function(e,t,n){if(null==n)return[];if(n<z.EPSILON)return[];if(e>t&&n>0)return[];if(t>e&&n<0)return[];for(var r=[],o=e;o<=t;)r.push(o),o+=n;return r},Ce.neg=function(e){return e.map((function(e){return-e}))},Ce.min=function(e){return u.fold(e,(function(e,t){return Math.min(e,t)}),1/0)},Ce.max=function(e){return u.fold(e,(function(e,t){return Math.max(e,t)}),-1/0)},Ce.all=function(e){return u.fold(e,(function(e,t){return t&&e}),!0)},Ce.finite=function(e){return e.map((function(e){return isFinite(e)}))},Ce.onRay=function(e,t,n){return Ce.add(e,Ce.mul(n,t))},Ce.lerp=function(e,t,n){return Ce.add(Ce.mul(e,t),Ce.mul(1-e,n))},Ce.normalized=function(e){return Ce.div(e,Ce.norm(e))},Ce.cross=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},Ce.dist=function(e,t){return Ce.norm(Ce.sub(e,t))},Ce.distSquared=function(e,t){return Ce.normSquared(Ce.sub(e,t))},Ce.sum=function(e){return u.fold(e,(function(e,t){return t+e}),0)},Ce.addAll=function(e){var t=o(e)();if(!t.hasNext())return null;var n=t.next().length;return u.fold(e,(function(e,t){return Ce.add(t,e)}),Ce.rep(n,0))},Ce.norm=function(e){var t=Ce.normSquared(e);return 0!=t?Math.sqrt(t):t},Ce.normSquared=function(e){return u.fold(e,(function(e,t){return t+e*e}),0)},Ce.rep=function(e,t){for(var n=[],r=0;r<e;)r++,n.push(t);return n},Ce.zeros1d=function(e){for(var t=[],n=0;n<e;)n++,t.push(0);return t},Ce.zeros2d=function(e,t){for(var n=[],r=0;r<e;)r++,n.push(Ce.zeros1d(t));return n},Ce.zeros3d=function(e,t,n){for(var r=[],o=0;o<e;)o++,r.push(Ce.zeros2d(t,n));return r},Ce.dot=function(e,t){for(var n=0,r=0,o=e.length;r<o;){var a=r++;n+=e[a]*t[a]}return n},Ce.add=function(e,t){for(var n=[],r=0,o=e.length;r<o;){var a=r++;n.push(e[a]+t[a])}return n},Ce.mul=function(e,t){for(var n=[],r=0,o=t.length;r<o;){var a=r++;n.push(e*t[a])}return n},Ce.div=function(e,t){for(var n=[],r=0,o=e.length;r<o;){var a=r++;n.push(e[a]/t)}return n},Ce.sub=function(e,t){for(var n=[],r=0,o=e.length;r<o;){var a=r++;n.push(e[a]-t[a])}return n},Ce.isZero=function(e){for(var t=0,n=e.length;t<n;){var r=t++;if(Math.abs(e[r])>z.TOLERANCE)return!1}return!0},Ce.sortedSetUnion=function(e,t){for(var n=[],r=0,o=0;r<e.length||o<t.length;)if(r>=e.length)n.push(t[o]),o++;else if(o>=t.length)n.push(e[r]),r++;else{var a=e[r]-t[o];Math.abs(a)<z.EPSILON?(n.push(e[r]),r++,o++):a>0?(n.push(t[o]),o++):(n.push(e[r]),r++)}return n},Ce.sortedSetSub=function(e,t){for(var n=[],r=0,o=0;r<e.length;)o>=t.length?(n.push(e[r]),r++):Math.abs(e[r]-t[o])<z.EPSILON?(r++,o++):(n.push(e[r]),r++);return n};var Pe=t.eval.Analyze=function(){};i["verb.eval.Analyze"]=Pe,Pe.__name__=["verb","eval","Analyze"],Pe.knotMultiplicities=function(e){for(var t=[new Ae(e[0],0)],n=t[0],r=0;r<e.length;){var o=e[r];++r,Math.abs(o-n.knot)>z.EPSILON&&(n=new Ae(o,0),t.push(n)),n.inc()}return t},Pe.isRationalSurfaceClosed=function(e,t){var n;null==t&&(t=!0);for(var r=0,o=(n=t?e.controlPoints:ye.transpose(e.controlPoints))[0].length;r<o;){var a=r++;if(!(Ce.dist(V.first(n)[a],V.last(n)[a])<z.EPSILON))return!1}return!0},Pe.rationalSurfaceClosestPoint=function(e,t){var n=Pe.rationalSurfaceClosestParam(e,t);return Ie.rationalSurfacePoint(e,n[0],n[1])},Pe.rationalSurfaceClosestParam=function(e,t){for(var n,r,o,a=0,i=e.knotsU[0],s=V.last(e.knotsU),l=e.knotsV[0],u=V.last(e.knotsV),c=Pe.isRationalSurfaceClosed(e),d=Pe.isRationalSurfaceClosed(e,!1),p=ke.rationalSurfaceAdaptive(e,new He),h=1/0,m=0,f=p.points.length;m<f;){var g=m++,$=Ce.normSquared(Ce.sub(t,p.points[g]));$<h&&(h=$,o=p.uvs[g])}for(var v=function(t){return Ie.rationalSurfaceDerivatives(e,t[0],t[1],2)},y=function(e,t,n){var r=t[1][0],o=t[0][1],a=t[2][0],i=t[0][2],s=t[1][1],l=t[1][1],u=[-Ce.dot(r,n),-Ce.dot(o,n)],c=Ce.dot(r,r)+Ce.dot(a,n),d=Ce.dot(r,o)+Ce.dot(s,n),p=Ce.dot(r,o)+Ce.dot(l,n),h=Ce.dot(o,o)+Ce.dot(i,n),m=ye.solve([[c,d],[p,h]],u);return Ce.add(m,e)};a<5;){n=v(o),r=Ce.sub(n[0][0],t);var _=Ce.norm(r),b=Ce.dot(n[1][0],r),x=Ce.norm(n[1][0])*_,w=Ce.dot(n[0][1],r),S=Ce.norm(n[0][1])*_;if(_<1e-4&&b/x<5e-4&&w/S<5e-4)return o;var M=y(o,n,r);if(M[0]<i?M=c?[s-(M[0]-i),M[1]]:[i+z.EPSILON,M[1]]:M[0]>s&&(M=c?[i+(M[0]-s),M[1]]:[s-z.EPSILON,M[1]]),M[1]<l?M=d?[M[0],u-(M[1]-l)]:[M[0],l+z.EPSILON]:M[1]>u&&(M=d?[M[0],l+(M[0]-u)]:[M[0],u-z.EPSILON]),Ce.norm(Ce.mul(M[0]-o[0],n[1][0]))+Ce.norm(Ce.mul(M[1]-o[1],n[0][1]))<1e-4)return o;o=M,a++}return o},Pe.rationalCurveClosestPoint=function(e,t){return Ie.rationalCurvePoint(e,Pe.rationalCurveClosestParam(e,t))},Pe.rationalCurveClosestParam=function(e,t){for(var n=1/0,r=0,o=ke.rationalCurveRegularSample(e,e.controlPoints.length*e.degree,!0),a=0,i=o.length-1;a<i;){var s=a++,l=o[s][0],u=o[s+1][0],c=o[s].slice(1),d=o[s+1].slice(1),p=Te.segmentClosestPoint(t,c,d,l,u),h=Ce.norm(Ce.sub(t,p.pt));h<n&&(n=h,r=p.u)}for(var m,f,g=0,$=e.knots[0],v=V.last(e.knots),y=Ce.normSquared(Ce.sub(e.controlPoints[0],V.last(e.controlPoints)))<z.EPSILON,_=r,b=function(t){return Ie.rationalCurveDerivatives(e,t,2)},x=function(e,t,n){return e-Ce.dot(t[1],n)/(Ce.dot(t[2],n)+Ce.dot(t[1],t[1]))};g<5;){m=b(_),f=Ce.sub(m[0],t);var w=Ce.norm(f),S=Ce.dot(m[1],f),M=Ce.norm(m[1])*w,E=w<1e-4,T=Math.abs(S/M)<5e-4;if(E&&T)return _;var C=x(_,m,f);if(C<$?C=y?v-(C-$):$:C>v&&(C=y?$+(C-v):v),Ce.norm(Ce.mul(C-_,m[1]))<1e-4)return _;_=C,g++}return _},Pe.rationalCurveParamAtArcLength=function(e,t,n,r,o){if(null==n&&(n=.001),t<z.EPSILON)return e.knots[0];var a;a=null!=r?r:Ue.decomposeCurveIntoBeziers(e);var i,s=0,l=-z.EPSILON;for(i=null!=o?o:[];l<t&&s<a.length;){if(i[s]=s<i.length?i[s]:Pe.rationalBezierCurveArcLength(e),t<(l+=i[s])+z.EPSILON)return Pe.rationalBezierCurveParamAtArcLength(e,t,n,i[s]);s++}return-1},Pe.rationalBezierCurveParamAtArcLength=function(e,t,n,r){if(t<0)return e.knots[0];var o;if(t>(o=null!=r?r:Pe.rationalBezierCurveArcLength(e)))return V.last(e.knots);var a,i=e.knots[0],s=0,l=V.last(e.knots),u=o,c=0,d=0;for(a=null!=n?n:2*z.TOLERANCE;u-s>a;)(d=Pe.rationalBezierCurveArcLength(e,c=(i+l)/2))>t?(l=c,u=d):(i=c,s=d);return(i+l)/2},Pe.rationalCurveArcLength=function(e,t,n){null==n&&(n=16),t=null==t?V.last(e.knots):t;for(var r=Ue.decomposeCurveIntoBeziers(e),o=0,a=r[0],i=0;o<r.length&&a.knots[0]+z.EPSILON<t;){var s=Math.min(V.last(a.knots),t);i+=Pe.rationalBezierCurveArcLength(a,s,n),a=r[++o]}return i},Pe.rationalBezierCurveArcLength=function(e,t,n){null==n&&(n=16);for(var r,o=((null==t?V.last(e.knots):t)-e.knots[0])/2,a=0,i=e.degree+n,s=0;s<i;){var l=s++;r=Ie.rationalCurveDerivatives(e,o*Pe.Tvalues[i][l]+o+e.knots[0],1),a+=Pe.Cvalues[i][l]*Ce.norm(r[1])}return o*a};var Ae=t.eval.KnotMultiplicity=function(e,t){this.knot=e,this.mult=t};i["verb.eval.KnotMultiplicity"]=Ae,Ae.__name__=["verb","eval","KnotMultiplicity"],Ae.prototype={inc:function(){this.mult++},__class__:Ae};var Le=t.eval.Check=function(){};i["verb.eval.Check"]=Le,Le.__name__=["verb","eval","Check"],Le.isValidKnotVector=function(e,t){if(0==e.length)return!1;if(e.length<2*(t+1))return!1;for(var n=V.first(e),r=0,o=t+1;r<o;){var a=r++;if(Math.abs(e[a]-n)>z.EPSILON)return!1}n=V.last(e);for(var i=e.length-t-1,s=e.length;i<s;){var l=i++;if(Math.abs(e[l]-n)>z.EPSILON)return!1}return Le.isNonDecreasing(e)},Le.isNonDecreasing=function(e){for(var t=V.first(e),n=0,r=e.length;n<r;){var o=n++;if(e[o]<t-z.EPSILON)return!1;t=e[o]}return!0},Le.isValidNurbsCurveData=function(e){if(null==e.controlPoints)throw new C("Control points array cannot be null!");if(null==e.degree)throw new C("Degree cannot be null!");if(e.degree<1)throw new C("Degree must be greater than 1!");if(null==e.knots)throw new C("Knots cannot be null!");if(e.knots.length!=e.controlPoints.length+e.degree+1)throw new C("controlPoints.length + degree + 1 must equal knots.length!");if(!Le.isValidKnotVector(e.knots,e.degree))throw new C("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return e},Le.isValidNurbsSurfaceData=function(e){if(null==e.controlPoints)throw new C("Control points array cannot be null!");if(null==e.degreeU)throw new C("DegreeU cannot be null!");if(null==e.degreeV)throw new C("DegreeV cannot be null!");if(e.degreeU<1)throw new C("DegreeU must be greater than 1!");if(e.degreeV<1)throw new C("DegreeV must be greater than 1!");if(null==e.knotsU)throw new C("KnotsU cannot be null!");if(null==e.knotsV)throw new C("KnotsV cannot be null!");if(e.knotsU.length!=e.controlPoints.length+e.degreeU+1)throw new C("controlPointsU.length + degreeU + 1 must equal knotsU.length!");if(e.knotsV.length!=e.controlPoints[0].length+e.degreeV+1)throw new C("controlPointsV.length + degreeV + 1 must equal knotsV.length!");if(!Le.isValidKnotVector(e.knotsU,e.degreeU)||!Le.isValidKnotVector(e.knotsV,e.degreeV))throw new C("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return e};var Re=t.eval.Divide=function(){};i["verb.eval.Divide"]=Re,Re.__name__=["verb","eval","Divide"],Re.surfaceSplit=function(e,t,n){var r,o,a;null==n&&(n=!1),n?(a=e.controlPoints,r=e.knotsV,o=e.degreeV):(a=ye.transpose(e.controlPoints),r=e.knotsU,o=e.degreeU);for(var i,s=[],l=0,u=o+1;l<u;)l++,s.push(t);i=s;for(var c=[],d=[],p=Ie.knotSpan(o,t,r),h=null,m=0;m<a.length;){var f=a[m];++m,h=Ue.curveKnotRefine(new q(o,r,f),i),c.push(h.controlPoints.slice(0,p+1)),d.push(h.controlPoints.slice(p+1))}var g=h.knots.slice(0,p+o+2),$=h.knots.slice(p+1);return n?[new X(e.degreeU,o,e.knotsU.slice(),g,c),new X(e.degreeU,o,e.knotsU.slice(),$,d)]:(c=ye.transpose(c),d=ye.transpose(d),[new X(o,e.degreeV,g,e.knotsV.slice(),c),new X(o,e.degreeV,$,e.knotsV.slice(),d)])},Re.curveSplit=function(e,t){for(var n=e.degree,r=e.knots,o=[],a=0,i=n+1;a<i;)a++,o.push(t);var s=Ue.curveKnotRefine(e,o),l=Ie.knotSpan(n,t,r),u=s.knots.slice(0,l+n+2),c=s.knots.slice(l+1),d=s.controlPoints.slice(0,l+1),p=s.controlPoints.slice(l+1);return[new q(n,u,d),new q(n,c,p)]},Re.rationalCurveByEqualArcLength=function(e,t){var n=Pe.rationalCurveArcLength(e);return Re.rationalCurveByArcLength(e,n/t)},Re.rationalCurveByArcLength=function(e,t){var n=Ue.decomposeCurveIntoBeziers(e),r=n.map((function(e){return Pe.rationalBezierCurveArcLength(e)})),o=Ce.sum(r),a=[new De(e.knots[0],0)];if(t>o)return a;for(var i,s=t,l=0,u=s,c=0,d=0;l<n.length;){for(c+=r[l];u<c+z.EPSILON;)i=Pe.rationalBezierCurveParamAtArcLength(n[l],u-d,z.TOLERANCE,r[l]),a.push(new De(i,u)),u+=s;d+=r[l],l++}return a};var De=t.eval.CurveLengthSample=function(e,t){this.u=e,this.len=t};i["verb.eval.CurveLengthSample"]=De,De.__name__=["verb","eval","CurveLengthSample"],De.prototype={__class__:De};var Ie=t.eval.Eval=function(){};i["verb.eval.Eval"]=Ie,Ie.__name__=["verb","eval","Eval"],Ie.rationalCurveTangent=function(e,t){return Ie.rationalCurveDerivatives(e,t,1)[1]},Ie.rationalSurfaceNormal=function(e,t,n){var r=Ie.rationalSurfaceDerivatives(e,t,n,1);return Ce.cross(r[1][0],r[0][1])},Ie.rationalSurfaceDerivatives=function(e,t,n,r){null==r&&(r=1);for(var o=Ie.surfaceDerivatives(e,t,n,r),a=Ie.rational2d(o),i=Ie.weight2d(o),s=[],l=a[0][0].length,u=0,c=r+1;u<c;){var d=u++;s.push([]);for(var p=0,h=r-d+1;p<h;){for(var m=p++,f=a[d][m],g=1,$=m+1;g<$;){var v=g++;f=Ce.sub(f,Ce.mul(j.get(m,v)*i[0][v],s[d][m-v]))}for(var y=1,_=d+1;y<_;){var b=y++;f=Ce.sub(f,Ce.mul(j.get(d,b)*i[b][0],s[d-b][m]));for(var x=Ce.zeros1d(l),w=1,S=m+1;w<S;){var M=w++;x=Ce.add(x,Ce.mul(j.get(m,M)*i[b][M],s[d-b][m-M]))}f=Ce.sub(f,Ce.mul(j.get(d,b),x))}s[d].push(Ce.mul(1/i[0][0],f))}}return s},Ie.rationalSurfacePoint=function(e,t,n){return Ie.dehomogenize(Ie.surfacePoint(e,t,n))},Ie.rationalCurveDerivatives=function(e,t,n){null==n&&(n=1);for(var r=Ie.curveDerivatives(e,t,n),o=Ie.rational1d(r),a=Ie.weight1d(r),i=[],s=0,l=n+1;s<l;){for(var u=s++,c=o[u],d=1,p=u+1;d<p;){var h=d++;c=Ce.sub(c,Ce.mul(j.get(u,h)*a[h],i[u-h]))}i.push(Ce.mul(1/a[0],c))}return i},Ie.rationalCurvePoint=function(e,t){return Ie.dehomogenize(Ie.curvePoint(e,t))},Ie.surfaceDerivatives=function(e,t,n,r){return Ie.surfaceDerivativesGivenNM(e.knotsU.length-e.degreeU-2,e.knotsV.length-e.degreeV-2,e,t,n,r)},Ie.surfaceDerivativesGivenNM=function(e,t,n,r,o,a){var i=n.degreeU,s=n.degreeV,l=n.controlPoints,u=n.knotsU,c=n.knotsV;if(!Ie.areValidRelations(i,l.length,u.length)||!Ie.areValidRelations(s,l[0].length,c.length))throw new C("Invalid relations between control points, knot vector, and n");var d,p,h=l[0][0].length;d=a<i?a:i,p=a<s?a:s;for(var m=Ce.zeros3d(a+1,a+1,h),f=Ie.knotSpanGivenN(e,i,r,u),g=Ie.knotSpanGivenN(t,s,o,c),$=Ie.derivativeBasisFunctionsGivenNI(f,r,i,e,u),v=Ie.derivativeBasisFunctionsGivenNI(g,o,s,t,c),y=Ce.zeros2d(s+1,h),_=0,b=d+1;_<b;){for(var x=_++,w=0,S=s+1;w<S;){var M=w++;y[M]=Ce.zeros1d(h);for(var E=0,T=i+1;E<T;){var P=E++;y[M]=Ce.add(y[M],Ce.mul($[x][P],l[f-i+P][g-s+M]))}}for(var A=a-x,L=0,R=(A<p?A:p)+1;L<R;){var D=L++;m[x][D]=Ce.zeros1d(h);for(var I=0,O=s+1;I<O;){var N=I++;m[x][D]=Ce.add(m[x][D],Ce.mul(v[D][N],y[N]))}}}return m},Ie.surfacePoint=function(e,t,n){return Ie.surfacePointGivenNM(e.knotsU.length-e.degreeU-2,e.knotsV.length-e.degreeV-2,e,t,n)},Ie.surfacePointGivenNM=function(e,t,n,r,o){var a=n.degreeU,i=n.degreeV,s=n.controlPoints,l=n.knotsU,u=n.knotsV;if(!Ie.areValidRelations(a,s.length,l.length)||!Ie.areValidRelations(i,s[0].length,u.length))throw new C("Invalid relations between control points, knot vector, and n");for(var c=s[0][0].length,d=Ie.knotSpanGivenN(e,a,r,l),p=Ie.knotSpanGivenN(t,i,o,u),h=Ie.basisFunctionsGivenKnotSpanIndex(d,r,a,l),m=Ie.basisFunctionsGivenKnotSpanIndex(p,o,i,u),f=d-a,g=p,$=Ce.zeros1d(c),v=Ce.zeros1d(c),y=0,_=i+1;y<_;){var b=y++;v=Ce.zeros1d(c),g=p-i+b;for(var x=0,w=a+1;x<w;){var S=x++;v=Ce.add(v,Ce.mul(h[S],s[f+S][g]))}$=Ce.add($,Ce.mul(m[b],v))}return $},Ie.curveDerivatives=function(e,t,n){return Ie.curveDerivativesGivenN(e.knots.length-e.degree-2,e,t,n)},Ie.curveDerivativesGivenN=function(e,t,n,r){var o,a=t.degree,i=t.controlPoints,s=t.knots;if(!Ie.areValidRelations(a,i.length,s.length))throw new C("Invalid relations between control points, knot vector, and n");o=r<a?r:a;for(var l=Ce.zeros2d(r+1,i[0].length),u=Ie.knotSpanGivenN(e,a,n,s),c=Ie.derivativeBasisFunctionsGivenNI(u,n,a,o,s),d=0,p=o+1;d<p;)for(var h=d++,m=0,f=a+1;m<f;){var g=m++;l[h]=Ce.add(l[h],Ce.mul(c[h][g],i[u-a+g]))}return l},Ie.curvePoint=function(e,t){return Ie.curvePointGivenN(e.knots.length-e.degree-2,e,t)},Ie.areValidRelations=function(e,t,n){return t+e+1-n==0},Ie.curvePointGivenN=function(e,t,n){var r=t.degree,o=t.controlPoints,a=t.knots;if(!Ie.areValidRelations(r,o.length,a.length))throw new C("Invalid relations between control points, knot Array, and n");for(var i=Ie.knotSpanGivenN(e,r,n,a),s=Ie.basisFunctionsGivenKnotSpanIndex(i,n,r,a),l=Ce.zeros1d(o[0].length),u=0,c=r+1;u<c;){var d=u++;l=Ce.add(l,Ce.mul(s[d],o[i-r+d]))}return l},Ie.volumePoint=function(e,t,n,r){return Ie.volumePointGivenNML(e,e.knotsU.length-e.degreeU-2,e.knotsV.length-e.degreeV-2,e.knotsW.length-e.degreeW-2,t,n,r)},Ie.volumePointGivenNML=function(e,t,n,r,o,a,i){if(!Ie.areValidRelations(e.degreeU,e.controlPoints.length,e.knotsU.length)||!Ie.areValidRelations(e.degreeV,e.controlPoints[0].length,e.knotsV.length)||!Ie.areValidRelations(e.degreeW,e.controlPoints[0][0].length,e.knotsW.length))throw new C("Invalid relations between control points and knot vector");for(var s=e.controlPoints,l=e.degreeU,u=e.degreeV,c=e.degreeW,d=e.knotsU,p=e.knotsV,h=e.knotsW,m=s[0][0][0].length,f=Ie.knotSpanGivenN(t,l,o,d),g=Ie.knotSpanGivenN(n,u,a,p),$=Ie.knotSpanGivenN(r,c,i,h),v=Ie.basisFunctionsGivenKnotSpanIndex(f,o,l,d),y=Ie.basisFunctionsGivenKnotSpanIndex(g,a,u,p),_=Ie.basisFunctionsGivenKnotSpanIndex($,i,c,h),b=f-l,x=Ce.zeros1d(m),w=Ce.zeros1d(m),S=Ce.zeros1d(m),M=0,E=c+1;M<E;){var T=M++;S=Ce.zeros1d(m);for(var P=$-c+T,A=0,L=u+1;A<L;){var R=A++;w=Ce.zeros1d(m);for(var D=g-u+R,I=0,O=l+1;I<O;){var N=I++;w=Ce.add(w,Ce.mul(v[N],s[b+N][D][P]))}S=Ce.add(S,Ce.mul(y[R],w))}x=Ce.add(x,Ce.mul(_[T],S))}return x},Ie.derivativeBasisFunctions=function(e,t,n){var r=Ie.knotSpan(t,e,n);return Ie.derivativeBasisFunctionsGivenNI(r,e,t,n.length-1-t-1,n)},Ie.derivativeBasisFunctionsGivenNI=function(e,t,n,r,o){var a=Ce.zeros2d(n+1,n+1),i=Ce.zeros1d(n+1),s=Ce.zeros1d(n+1),l=0,u=0;a[0][0]=1;for(var c=1,d=n+1;c<d;){var p=c++;i[p]=t-o[e+1-p],s[p]=o[e+p]-t,l=0;for(var h=0;h<p;){var m=h++;a[p][m]=s[m+1]+i[p-m],a[m][p]=l+s[m+1]*(u=a[m][p-1]/a[p][m]),l=i[p-m]*u}a[p][p]=l}for(var f=Ce.zeros2d(r+1,n+1),g=Ce.zeros2d(2,n+1),$=0,v=1,y=0,_=0,b=0,x=0,w=n+1;x<w;){var S=x++;f[0][S]=a[S][n]}for(var M=0,E=n+1;M<E;){var T=M++;$=0,v=1,g[0][0]=1;for(var C=1,P=r+1;C<P;){var A=C++;y=0,_=T-A,b=n-A,T>=A&&(g[v][0]=g[$][0]/a[b+1][_],y=g[v][0]*a[_][b]);for(var L=_>=-1?1:-_,R=1+(T-1<=b?A-1:n-T);L<R;){var D=L++;g[v][D]=(g[$][D]-g[$][D-1])/a[b+1][_+D],y+=g[v][D]*a[_+D][b]}T<=b&&(g[v][A]=-g[$][A-1]/a[b+1][T],y+=g[v][A]*a[T][b]),f[A][T]=y;var I=$;$=v,v=I}}for(var O=n,N=1,U=r+1;N<U;){for(var k=N++,H=0,G=n+1;H<G;){var V=H++;f[k][V]*=O}O*=n-k}return f},Ie.basisFunctions=function(e,t,n){var r=Ie.knotSpan(t,e,n);return Ie.basisFunctionsGivenKnotSpanIndex(r,e,t,n)},Ie.basisFunctionsGivenKnotSpanIndex=function(e,t,n,r){var o=Ce.zeros1d(n+1),a=Ce.zeros1d(n+1),i=Ce.zeros1d(n+1),s=0,l=0;o[0]=1;for(var u=1,c=n+1;u<c;){var d=u++;a[d]=t-r[e+1-d],i[d]=r[e+d]-t,s=0;for(var p=0;p<d;){var h=p++;o[h]=s+i[h+1]*(l=o[h]/(i[h+1]+a[d-h])),s=a[d-h]*l}o[d]=s}return o},Ie.knotSpan=function(e,t,n){return Ie.knotSpanGivenN(n.length-e-2,e,t,n)},Ie.knotSpanGivenN=function(e,t,n,r){if(n>r[e+1]-z.EPSILON)return e;if(n<r[t]+z.EPSILON)return t;for(var o=t,a=e+1,i=Math.floor((o+a)/2);n<r[i]||n>=r[i+1];)n<r[i]?a=i:o=i,i=Math.floor((o+a)/2);return i},Ie.dehomogenize=function(e){for(var t=[],n=e[e.length-1],r=e.length-1,o=0;o<r;){var a=o++;t.push(e[a]/n)}return t},Ie.rational1d=function(e){var t=e[0].length-1;return e.map((function(e){return e.slice(0,t)}))},Ie.rational2d=function(e){return e.map(Ie.rational1d)},Ie.weight1d=function(e){var t=e[0].length-1;return e.map((function(e){return e[t]}))},Ie.weight2d=function(e){return e.map(Ie.weight1d)},Ie.dehomogenize1d=function(e){return e.map(Ie.dehomogenize)},Ie.dehomogenize2d=function(e){return e.map(Ie.dehomogenize1d)},Ie.homogenize1d=function(e,t){var n,r=e.length,o=e[0].length,a=[],i=0,s=[];n=null!=t?t:Ce.rep(e.length,1);for(var l=0;l<r;){var u=l++,c=[];s=e[u],i=n[u];for(var d=0;d<o;){var p=d++;c.push(s[p]*i)}c.push(i),a.push(c)}return a},Ie.homogenize2d=function(e,t){var n,r=e.length,o=[];if(null!=t)n=t;else{for(var a=[],i=0;i<r;)i++,a.push(Ce.rep(e[0].length,1));n=a}for(var s=0;s<r;){var l=s++;o.push(Ie.homogenize1d(e[l],n[l]))}return o};var Oe=t.eval.Intersect=function(){};i["verb.eval.Intersect"]=Oe,Oe.__name__=["verb","eval","Intersect"],Oe.surfaces=function(e,t,n){var r=ke.rationalSurfaceAdaptive(e),o=ke.rationalSurfaceAdaptive(t);return Oe.meshes(r,o).map((function(r){return r.map((function(r){return Oe.surfacesAtPointWithEstimate(e,t,r.uv0,r.uv1,n)}))})).map((function(e){return Ne.rationalInterpCurve(e.map((function(e){return e.point})),3)}))},Oe.surfacesAtPointWithEstimate=function(e,t,n,r,o){var a,i,s,l,u,c,d,p,h,m,f,g,$,v=0;do{if(i=(a=Ie.rationalSurfaceDerivatives(e,n[0],n[1],1))[0][0],s=Ce.normalized(Ce.cross(l=a[1][0],u=a[0][1])),c=Ce.dot(s,i),p=(d=Ie.rationalSurfaceDerivatives(t,r[0],r[1],1))[0][0],h=Ce.normalized(Ce.cross(m=d[1][0],f=d[0][1])),g=Ce.dot(h,p),($=Ce.distSquared(i,p))<o*o)break;var y=Ce.normalized(Ce.cross(s,h)),_=Ce.dot(y,i),b=Oe.threePlanes(s,c,h,g,y,_);if(null==b)throw new C("panic!");var x=Ce.sub(b,i),w=Ce.sub(b,p),S=Ce.cross(l,s),M=Ce.cross(u,s),E=Ce.cross(m,h),T=Ce.cross(f,h),P=Ce.dot(M,x)/Ce.dot(M,l),A=Ce.dot(S,x)/Ce.dot(S,u),L=Ce.dot(T,w)/Ce.dot(T,m),R=Ce.dot(E,w)/Ce.dot(E,f);n=Ce.add([P,A],n),r=Ce.add([L,R],r),v++}while(v<5);return new ae(n,r,i,$)},Oe.meshes=function(e,t,n,r){null==n&&(n=new ge(e)),null==r&&(r=new ge(t));var o=Oe.boundingBoxTrees(n,r,0),a=V.unique(o.map((function(n){return Oe.triangles(e,n.item0,t,n.item1)})).filter((function(e){return null!=e})).filter((function(e){return Ce.distSquared(e.min.point,e.max.point)>z.EPSILON})),(function(e,t){var n=Ce.sub(e.min.uv0,t.min.uv0),r=Ce.dot(n,n),o=Ce.sub(e.max.uv0,t.max.uv0),a=Ce.dot(o,o),i=Ce.sub(e.min.uv0,t.max.uv0),s=Ce.dot(i,i),l=Ce.sub(e.max.uv0,t.min.uv0),u=Ce.dot(l,l);return r<z.EPSILON&&a<z.EPSILON||s<z.EPSILON&&u<z.EPSILON}));return Oe.makeMeshIntersectionPolylines(a)},Oe.meshSlices=function(e,t,n,r){for(var o=new xe(e),a=o.boundingBox(),i=a.min[0],s=a.min[1],l=a.max[0],u=a.max[1],c=Ce.span(t,n,r),d=[],p=0;p<c.length;){var h=c[p];++p;var m=new Z([[0,1,2],[0,2,3]],[[i,s,h],[l,s,h],[l,u,h],[i,u,h]],null,[[0,0],[1,0],[1,1],[0,1]]);d.push(Oe.meshes(e,m,o))}return d},Oe.makeMeshIntersectionPolylines=function(e){if(0==e.length)return[];for(var t=0;t<e.length;){var n=e[t];++t,n.max.opp=n.min,n.min.opp=n.max}for(var r=Oe.kdTreeFromSegments(e),o=[],a=0;a<e.length;){var i=e[a];++a,o.push(i.min),o.push(i.max)}for(var s=0;s<o.length;){var l=o[s];if(++s,null==l.adj){var u=Oe.lookupAdjacentSegment(l,r,e.length);null!=u&&null==u.adj&&(l.adj=u,u.adj=l)}}var c=o.filter((function(e){return null==e.adj}));0==c.length&&(c=o);for(var d=[],p=0,h=!1;0!=c.length;){var m=c.pop();if(!m.visited){for(var f=[],g=m;null!=g&&!g.visited&&(g.visited=!0,g.opp.visited=!0,f.push(g),p+=2,(g=g.opp.adj)!=m););f.length>0&&(f.push(f[f.length-1].opp),d.push(f))}if(0==c.length&&o.length>0&&(h||p<o.length)){h=!0;var $=o.pop();c.push($)}}return d},Oe.kdTreeFromSegments=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];++n,t.push(new pe(r.min.point,r.min)),t.push(new pe(r.max.point,r.max))}return new ce(t,Ce.distSquared)},Oe.lookupAdjacentSegment=function(e,t,n){var r=t.nearest(e.point,n,z.EPSILON).filter((function(t){return e!=t.item0.obj})).map((function(e){return e.item0.obj}));return 1==r.length?r[0]:null},Oe.curveAndSurface=function(e,t,n,r,o){null==n&&(n=.001),r=null!=r?r:new fe(e),o=null!=o?o:new ve(t);var a=Oe.boundingBoxTrees(r,o,n);return V.unique(a.map((function(e){var t=e.item0,r=e.item1,o=(V.first(t.knots)+V.last(t.knots))/2,a=V.first(r.knotsU),i=V.last(r.knotsU),s=V.first(r.knotsV),l=V.last(r.knotsV);return Oe.curveAndSurfaceWithEstimate(t,r,[o].concat([(a+i)/2,(s+l)/2]),n)})).filter((function(e){return Ce.distSquared(e.curvePoint,e.surfacePoint)<n*n})),(function(e,t){return Math.abs(e.u-t.u)<.5*n}))},Oe.curveAndSurfaceWithEstimate=function(e,t,n,r){null==r&&(r=.001);var o=we.uncmin((function(n){var r=Ie.rationalCurvePoint(e,n[0]),o=Ie.rationalSurfacePoint(t,n[1],n[2]),a=Ce.sub(r,o);return Ce.dot(a,a)}),n,r*r,(function(n){var r=Ie.rationalCurveDerivatives(e,n[0],1),o=Ie.rationalSurfaceDerivatives(t,n[1],n[2],1),a=Ce.sub(o[0][0],r[0]),i=Ce.mul(-1,r[1]),s=o[1][0],l=o[0][1];return[2*Ce.dot(i,a),2*Ce.dot(s,a),2*Ce.dot(l,a)]})).solution;return new ne(o[0],[o[1],o[2]],Ie.rationalCurvePoint(e,o[0]),Ie.rationalSurfacePoint(t,o[1],o[2]))},Oe.polylineAndMesh=function(e,t,n){for(var r=Oe.boundingBoxTrees(new $e(e),new ge(t),n),o=[],a=0;a<r.length;){var i=r[a];++a;var s=i.item0,l=i.item1,u=Oe.segmentWithTriangle(e.points[s],e.points[s+1],t.points,t.faces[l]);if(null!=u){var c=u.point,d=Ce.lerp(u.p,[e.params[s]],[e.params[s+1]])[0],p=be.triangleUVFromPoint(t,l,c);o.push(new oe(c,d,p,s,l))}}return o},Oe.boundingBoxTrees=function(e,t,n){null==n&&(n=1e-9);var r=[],o=[];r.push(e),o.push(t);for(var a=[];r.length>0;){var i=r.pop(),s=o.pop();if(!i.empty()&&!s.empty()&&i.boundingBox().intersects(s.boundingBox(),n)){var l=i.indivisible(n),u=s.indivisible(n);if(l&&u)a.push(new Q(i.yield(),s.yield()));else if(!l||u)if(l||!u){var c=i.split(),d=s.split();r.push(c.item1),o.push(d.item1),r.push(c.item1),o.push(d.item0),r.push(c.item0),o.push(d.item1),r.push(c.item0),o.push(d.item0)}else{var p=i.split();r.push(p.item1),o.push(s),r.push(p.item0),o.push(s)}else{var h=s.split();r.push(i),o.push(h.item1),r.push(i),o.push(h.item0)}}}return a},Oe.curves=function(e,t,n){var r=Oe.boundingBoxTrees(new fe(e),new fe(t),0);return V.unique(r.map((function(r){return Oe.curvesWithEstimate(e,t,V.first(r.item0.knots),V.first(r.item1.knots),n)})).filter((function(e){return Ce.distSquared(e.point0,e.point1)<n})),(function(e,t){return Math.abs(e.u0-t.u0)<5*n}))},Oe.curvesWithEstimate=function(e,t,n,r,o){var a=we.uncmin((function(n){var r=Ie.rationalCurvePoint(e,n[0]),o=Ie.rationalCurvePoint(t,n[1]),a=Ce.sub(r,o);return Ce.dot(a,a)}),[n,r],o*o,(function(n){var r=Ie.rationalCurveDerivatives(e,n[0],1),o=Ie.rationalCurveDerivatives(t,n[1],1),a=Ce.sub(r[0],o[0]),i=r[1],s=Ce.mul(-1,o[1]);return[2*Ce.dot(i,a),2*Ce.dot(s,a)]})),i=a.solution[0],s=a.solution[1],l=Ie.rationalCurvePoint(e,i),u=Ie.rationalCurvePoint(t,s);return new te(l,u,i,s)},Oe.triangles=function(e,t,n,r){var o=e.faces[t],a=n.faces[r],i=be.getTriangleNorm(e.points,o),s=be.getTriangleNorm(n.points,a),l=Oe.planes(e.points[o[0]],i,n.points[a[0]],s);if(null==l)return null;var u=Oe.clipRayInCoplanarTriangle(l,e,t);if(null==u)return null;var c=Oe.clipRayInCoplanarTriangle(l,n,r);if(null==c)return null;var d=Oe.mergeTriangleClipIntervals(u,c,e,t,n,r);return null==d?null:new ee(new re(d.min.uv0,d.min.uv1,d.min.point,t,r),new re(d.max.uv0,d.max.uv1,d.max.point,t,r))},Oe.clipRayInCoplanarTriangle=function(e,t,n){for(var r=t.faces[n],o=[t.points[r[0]],t.points[r[1]],t.points[r[2]]],a=[t.uvs[r[0]],t.uvs[r[1]],t.uvs[r[2]]],i=[Ce.sub(a[1],a[0]),Ce.sub(a[2],a[1]),Ce.sub(a[0],a[2])],s=[Ce.sub(o[1],o[0]),Ce.sub(o[2],o[1]),Ce.sub(o[0],o[2])],l=s.map(Ce.normalized),u=s.map(Ce.norm),c=null,d=null,p=0;p<3;){var h=p++,m=Oe.rays(o[h],l[h],e.origin,e.dir);if(null!=m){var f=m.u0,g=m.u1;f<-z.EPSILON||f>u[h]+z.EPSILON||((null==c||g<c.u)&&(c=new se(g,Ce.onRay(e.origin,e.dir,g),Ce.onRay(a[h],i[h],f/u[h]))),(null==d||g>d.u)&&(d=new se(g,Ce.onRay(e.origin,e.dir,g),Ce.onRay(a[h],i[h],f/u[h]))))}}return null==d||null==c?null:new ee(c,d)},Oe.mergeTriangleClipIntervals=function(e,t,n,r,o,a){if(t.min.u>e.max.u+z.EPSILON||e.min.u>t.max.u+z.EPSILON)return null;var i,s;i=e.min.u>t.min.u?new Q(e.min,0):new Q(t.min,1),s=e.max.u<t.max.u?new Q(e.max,0):new Q(t.max,1);var l=new ee(new re(null,null,i.item0.point,r,a),new re(null,null,s.item0.point,r,a));return 0==i.item1?(l.min.uv0=i.item0.uv,l.min.uv1=be.triangleUVFromPoint(o,a,i.item0.point)):(l.min.uv0=be.triangleUVFromPoint(n,r,i.item0.point),l.min.uv1=i.item0.uv),0==s.item1?(l.max.uv0=s.item0.uv,l.max.uv1=be.triangleUVFromPoint(o,a,s.item0.point)):(l.max.uv0=be.triangleUVFromPoint(n,r,s.item0.point),l.max.uv1=s.item0.uv),l},Oe.planes=function(e,t,n,r){var o=Ce.cross(t,r);if(Ce.dot(o,o)<z.EPSILON)return null;var a,i,s,l,u=0,c=Math.abs(o[0]),d=Math.abs(o[1]),p=Math.abs(o[2]);d>c&&(u=1,c=d),p>c&&(u=2,c=p),0==u?(a=t[1],i=t[2],s=r[1],l=r[2]):1==u?(a=t[0],i=t[2],s=r[0],l=r[2]):(a=t[0],i=t[1],s=r[0],l=r[1]);var h=-Ce.dot(e,t),m=-Ce.dot(n,r),f=a*l-i*s,g=(i*m-h*l)/f,$=(h*s-a*m)/f;return new Y(0==u?[0,g,$]:1==u?[g,0,$]:[g,$,0],Ce.normalized(o))},Oe.threePlanes=function(e,t,n,r,o,a){var i=Ce.cross(n,o),s=Ce.dot(e,i);if(Math.abs(s)<z.EPSILON)return null;var l=Ce.sub(Ce.mul(a,n),Ce.mul(r,o)),u=Ce.add(Ce.mul(t,i),Ce.cross(e,l));return Ce.mul(1/s,u)},Oe.polylines=function(e,t,n){for(var r=Oe.boundingBoxTrees(new $e(e),new $e(t),n),o=[],a=0;a<r.length;){var i=r[a];++a;var s=i.item0,l=i.item1,u=Oe.segments(e.points[s],e.points[s+1],t.points[l],t.points[l+1],n);null!=u&&(u.u0=Ce.lerp(u.u0,[e.params[s]],[e.params[s+1]])[0],u.u1=Ce.lerp(u.u1,[t.params[l]],[t.params[l+1]])[0],o.push(u))}return o},Oe.segments=function(e,t,n,r,o){var a=Ce.sub(t,e),i=Math.sqrt(Ce.dot(a,a)),s=Ce.mul(1/i,a),l=Ce.sub(r,n),u=Math.sqrt(Ce.dot(l,l)),c=Ce.mul(1/u,l),d=Oe.rays(e,s,n,c);if(null!=d){var p=Math.min(Math.max(0,d.u0/i),1),h=Math.min(Math.max(0,d.u1/u),1),m=Ce.onRay(e,a,p),f=Ce.onRay(n,l,h);if(Ce.distSquared(m,f)<o*o)return new te(m,f,p,h)}return null},Oe.rays=function(e,t,n,r){var o=Ce.dot(t,r),a=Ce.dot(t,n),i=Ce.dot(t,e),s=Ce.dot(r,n),l=Ce.dot(r,e),u=Ce.dot(t,t),c=u*Ce.dot(r,r)-o*o;if(Math.abs(c)<z.EPSILON)return null;var d=(o*(a-i)-u*(s-l))/c,p=(a-i+d*o)/u,h=Ce.onRay(e,t,p),m=Ce.onRay(n,r,d);return new te(h,m,p,d)},Oe.segmentWithTriangle=function(e,t,n,r){var o=n[r[0]],a=n[r[2]],i=Ce.sub(n[r[1]],o),s=Ce.sub(a,o),l=Ce.cross(i,s),u=Ce.sub(t,e),c=Ce.sub(e,o),d=-Ce.dot(l,c),p=Ce.dot(l,u);if(Math.abs(p)<z.EPSILON)return null;var h=d/p;if(h<0||h>1)return null;var m=Ce.add(e,Ce.mul(h,u)),f=Ce.dot(i,s),g=Ce.dot(i,i),$=Ce.dot(s,s),v=Ce.sub(m,o),y=Ce.dot(v,i),_=Ce.dot(v,s),b=f*f-g*$;if(Math.abs(b)<z.EPSILON)return null;var x=(f*_-$*y)/b,w=(f*y-g*_)/b;return x>1+z.EPSILON||w>1+z.EPSILON||w<-z.EPSILON||x<-z.EPSILON||x+w>1+z.EPSILON?null:new ie(m,x,w,h)},Oe.segmentAndPlane=function(e,t,n,r){var o=Ce.dot(r,Ce.sub(t,e));if(Math.abs(o)<z.EPSILON)return null;var a=Ce.dot(r,Ce.sub(n,e))/o;return a>1+z.EPSILON||a<-z.EPSILON?null:{p:a}};var Ne=t.eval.Make=function(){};i["verb.eval.Make"]=Ne,Ne.__name__=["verb","eval","Make"],Ne.rationalTranslationalSurface=function(e,t){for(var n=Ie.rationalCurvePoint(t,V.first(t.knots)),r=V.first(t.knots),o=V.last(t.knots),a=2*t.controlPoints.length,i=(o-r)/(a-1),s=[],l=0;l<a;){var u=l++,c=Ce.sub(Ie.rationalCurvePoint(t,r+u*i),n),d=Ue.rationalCurveTransform(e,[[1,0,0,c[0]],[0,1,0,c[1]],[0,0,1,c[2]],[0,0,0,1]]);s.push(d)}return Ne.loftedSurface(s)},Ne.surfaceBoundaryCurves=function(e){return[Ne.surfaceIsocurve(e,V.first(e.knotsU),!1),Ne.surfaceIsocurve(e,V.last(e.knotsU),!1),Ne.surfaceIsocurve(e,V.first(e.knotsV),!0),Ne.surfaceIsocurve(e,V.last(e.knotsV),!0)]},Ne.surfaceIsocurve=function(e,t,n){var r,o;null==n&&(n=!1),o=n?e.degreeV:e.degreeU;for(var a=Pe.knotMultiplicities(r=n?e.knotsV:e.knotsU),i=-1,s=0,l=a.length;s<l;){var u=s++;if(Math.abs(t-a[u].knot)<z.EPSILON){i=u;break}}var c,d=o+1;i>=0&&(d-=a[i].mult),c=d>0?Ue.surfaceKnotRefine(e,Ce.rep(d,t),n):e;var p=Ie.knotSpan(o,t,r);return Math.abs(t-V.first(r))<z.EPSILON?p=0:Math.abs(t-V.last(r))<z.EPSILON&&(p=(n?c.controlPoints[0].length:c.controlPoints.length)-1),n?new q(c.degreeU,c.knotsU,function(e){for(var t=[],n=0,r=c.controlPoints;n<r.length;){var o=r[n];++n,t.push(o[p])}return t}()):new q(c.degreeV,c.knotsV,c.controlPoints[p])},Ne.loftedSurface=function(e,t){var n=(e=Ue.unifyCurveKnotVectors(e))[0].degree;null==t&&(t=3),t>e.length-1&&(t=e.length-1);for(var r=e[0].knots,o=[],a=[],i=0,s=e[0].controlPoints.length;i<s;){var l=[i++],u=e.map(function(e){return function(t){return t.controlPoints[e[0]]}}(l)),c=Ne.rationalInterpCurve(u,t,!0);a.push(c.controlPoints),o=c.knots}return new X(n,t,r,o,a)},Ne.clonedCurve=function(e){return new q(e.degree,e.knots.slice(),e.controlPoints.map((function(e){return e.slice()})))},Ne.rationalBezierCurve=function(e,t){for(var n=e.length-1,r=[],o=0,a=n+1;o<a;)o++,r.push(0);for(var i=0,s=n+1;i<s;)i++,r.push(1);return null==t&&(t=Ce.rep(e.length,1)),new q(n,r,Ie.homogenize1d(e,t))},Ne.fourPointSurface=function(e,t,n,r,o){null==o&&(o=3);for(var a=o,i=[],s=0,l=o+1;s<l;){for(var u=s++,c=[],d=0,p=o+1;d<p;){var h=d++,m=1-u/a,f=Ce.lerp(m,e,t),g=Ce.lerp(m,r,n),$=Ce.lerp(1-h/a,f,g);$.push(1),c.push($)}i.push(c)}var v=Ce.rep(o+1,0),y=Ce.rep(o+1,1);return new X(o,o,v.concat(y),v.concat(y),i)},Ne.ellipseArc=function(e,t,n,r,o){var a=Ce.norm(t),i=Ce.norm(n);t=Ce.normalized(t),n=Ce.normalized(n),o<r&&(o=2*Math.PI+r);var s,l=o-r,u=l/(s=l<=Math.PI/2?1:l<=Math.PI?2:l<=3*Math.PI/2?3:4),c=Math.cos(u/2),d=Ce.add(e,Ce.add(Ce.mul(a*Math.cos(r),t),Ce.mul(i*Math.sin(r),n))),p=Ce.sub(Ce.mul(Math.cos(r),n),Ce.mul(Math.sin(r),t)),h=[],m=Ce.zeros1d(2*s+3),f=0,g=r,$=Ce.zeros1d(2*s);h[0]=d,$[0]=1;for(var v=1,y=s+1;v<y;){var _=v++;g+=u;var b=Ce.add(e,Ce.add(Ce.mul(a*Math.cos(g),t),Ce.mul(i*Math.sin(g),n)));$[f+2]=1,h[f+2]=b;var x=Ce.sub(Ce.mul(Math.cos(g),n),Ce.mul(Math.sin(g),t)),w=Oe.rays(d,Ce.mul(1/Ce.norm(p),p),b,Ce.mul(1/Ce.norm(x),x)),S=Ce.add(d,Ce.mul(w.u0,p));$[f+1]=c,h[f+1]=S,f+=2,_<s&&(d=b,p=x)}for(var M=2*s+1,E=0;E<3;){var T=E++;m[T]=0,m[T+M]=1}switch(s){case 2:m[3]=m[4]=.5;break;case 3:m[3]=m[4]=.3333333333333333,m[5]=m[6]=.6666666666666666;break;case 4:m[3]=m[4]=.25,m[5]=m[6]=.5,m[7]=m[8]=.75}return new q(2,m,Ie.homogenize1d(h,$))},Ne.arc=function(e,t,n,r,o,a){return Ne.ellipseArc(e,Ce.mul(r,Ce.normalized(t)),Ce.mul(r,Ce.normalized(n)),o,a)},Ne.polyline=function(e){for(var t=[0,0],n=0,r=0,o=e.length-1;r<o;){var a=r++;n+=Ce.dist(e[a],e[a+1]),t.push(n)}t.push(n),t=Ce.mul(1/n,t);for(var i,s=[],l=0,u=e.length;l<u;)l++,s.push(1);return i=s,new q(1,t,Ie.homogenize1d(e.slice(0),i))},Ne.extrudedSurface=function(e,t,n){for(var r=[[],[],[]],o=[[],[],[]],a=Ie.dehomogenize1d(n.controlPoints),i=Ie.weight1d(n.controlPoints),s=Ce.mul(t,e),l=Ce.mul(.5*t,e),u=0,c=a.length;u<c;){var d=u++;r[2][d]=a[d],r[1][d]=Ce.add(l,a[d]),r[0][d]=Ce.add(s,a[d]),o[0][d]=i[d],o[1][d]=i[d],o[2][d]=i[d]}return new X(2,n.degree,[0,0,0,1,1,1],n.knots,Ie.homogenize2d(r,o))},Ne.cylindricalSurface=function(e,t,n,r,o){var a=Ce.cross(e,t),i=(Math,Ne.arc(n,t,a,o,0,2*Math.PI));return Ne.extrudedSurface(e,r,i)},Ne.revolvedSurface=function(e,t,n,r){var o,a,i=Ie.dehomogenize1d(e.controlPoints),s=Ie.weight1d(e.controlPoints);r<=Math.PI/2?a=Ce.zeros1d(6+2*((o=1)-1)):r<=Math.PI?(a=Ce.zeros1d(6+2*((o=2)-1)))[3]=a[4]=.5:r<=3*Math.PI/2?((a=Ce.zeros1d(6+2*((o=3)-1)))[3]=a[4]=.3333333333333333,a[5]=a[6]=.6666666666666666):((a=Ce.zeros1d(6+2*((o=4)-1)))[3]=a[4]=.25,a[5]=a[6]=.5,a[7]=a[8]=.75);for(var l=r/o,u=3+2*(o-1),c=0;c<3;){var d=c++;a[d]=0,a[u+d]=1}for(var p=Math.cos(l/2),h=0,m=Ce.zeros1d(o+1),f=Ce.zeros1d(o+1),g=Ce.zeros3d(2*o+1,i.length,3),$=Ce.zeros2d(2*o+1,i.length),v=1,y=o+1;v<y;){var _=v++;h+=l,f[_]=Math.cos(h),m[_]=Math.sin(h)}for(var b=0,x=i.length;b<x;){var w=b++,S=Te.rayClosestPoint(i[w],t,n),M=Ce.sub(i[w],S),E=Ce.norm(M),T=Ce.cross(n,M);E>z.EPSILON&&(M=Ce.mul(1/E,M),T=Ce.mul(1/E,T)),g[0][w]=i[w];var C=i[w];$[0][w]=s[w];for(var P=T,A=0,L=1,R=o+1;L<R;){var D,I=L++;D=0==E?S:Ce.add(S,Ce.add(Ce.mul(E*f[I],M),Ce.mul(E*m[I],T))),g[A+2][w]=D,$[A+2][w]=s[w];var O=Ce.sub(Ce.mul(f[I],T),Ce.mul(m[I],M));if(0==E)g[A+1][w]=S;else{var N=Oe.rays(C,Ce.mul(1/Ce.norm(P),P),D,Ce.mul(1/Ce.norm(O),O)),U=Ce.add(C,Ce.mul(N.u0,P));g[A+1][w]=U}$[A+1][w]=p*s[w],A+=2,I<o&&(C=D,P=O)}}return new X(2,e.degree,a,e.knots,Ie.homogenize2d(g,$))},Ne.sphericalSurface=function(e,t,n,r){var o=Ne.arc(e,Ce.mul(-1,t),n,r,0,Math.PI);return Ne.revolvedSurface(o,e,t,2*Math.PI)},Ne.conicalSurface=function(e,t,n,r,o){var a=2*Math.PI,i=[Ce.add(n,Ce.mul(r,e)),Ce.add(n,Ce.mul(o,t))],s=new q(1,[0,0,1,1],Ie.homogenize1d(i,[1,1]));return Ne.revolvedSurface(s,n,e,a)},Ne.rationalInterpCurve=function(e,t,n,r,o){if(null==n&&(n=!1),null==t&&(t=3),e.length<t+1)throw new C("You need to supply at least degree + 1 points! You only supplied "+e.length+" points.");for(var a=[0],i=1,s=e.length;i<s;){var l=i++,u=Ce.norm(Ce.sub(e[l],e[l-1]));a.push(a[a.length-1]+u)}for(var c=a[a.length-1],d=0,p=a.length;d<p;){var h=d++;a[h]=a[h]/c}var m,f=Ce.rep(t+1,0),g=null!=r&&null!=o;m=g?a.length-t+1:a.length-t;for(var $=g?0:1;$<m;){for(var v=$++,y=0,_=0;_<t;)y+=a[v+_++];f.push(1/t*y)}var b,x,w=f.concat(Ce.rep(t+1,1)),S=[];b=g?e.length+1:e.length-1,x=g?e.length-(t-1):e.length-(t+1);for(var M=0;M<a.length;){var E=a[M];++M;var T=Ie.knotSpanGivenN(b,t,E,w),P=Ie.basisFunctionsGivenKnotSpanIndex(T,E,t,w),A=T-t,L=Ce.zeros1d(A),R=Ce.zeros1d(x-A);S.push(L.concat(P).concat(R))}if(g){var D=S[0].length-2,I=[-1,1].concat(Ce.zeros1d(D)),O=Ce.zeros1d(D).concat([-1,1]);V.spliceAndInsert(S,1,0,I),V.spliceAndInsert(S,S.length-1,0,O)}for(var N=e[0].length,U=[],k=(1-w[w.length-t-2])/t,H=w[t+1]/t,G=0;G<N;){var j,F=[G++];if(g){(j=[e[0][F[0]]]).push(H*r[F[0]]);for(var z=1,B=e.length-1;z<B;){var W=z++;j.push(e[W][F[0]])}j.push(k*o[F[0]]),j.push(V.last(e)[F[0]])}else j=e.map(function(e){return function(t){return t[e[0]]}}(F));var Y=ye.solve(S,j);U.push(Y)}var X=ye.transpose(U);if(!n){var Z=Ce.rep(X.length,1);X=Ie.homogenize1d(X,Z)}return new q(t,w,X)};var Ue=t.eval.Modify=function(){};i["verb.eval.Modify"]=Ue,Ue.__name__=["verb","eval","Modify"],Ue.curveReverse=function(e){return new q(e.degree,Ue.knotsReverse(e.knots),V.reversed(e.controlPoints))},Ue.surfaceReverse=function(e,t){return null==t&&(t=!1),t?new X(e.degreeU,e.degreeV,e.knotsU,Ue.knotsReverse(e.knotsV),function(t){for(var n=[],r=0,o=e.controlPoints;r<o.length;){var a=o[r];++r,n.push(V.reversed(a))}return n}()):new X(e.degreeU,e.degreeV,Ue.knotsReverse(e.knotsU),e.knotsV,V.reversed(e.controlPoints))},Ue.knotsReverse=function(e){for(var t=V.first(e),n=(V.last(e),[t]),r=e.length,o=1;o<r;){var a=o++;n.push(n[a-1]+(e[r-a]-e[r-a-1]))}return n},Ue.unifyCurveKnotVectors=function(e){e=e.map(Ne.clonedCurve);for(var t=u.fold(e,(function(e,t){return Ue.imax(e.degree,t)}),0),n=0,r=e.length;n<r;){var o=n++;e[o].degree<t&&(e[o]=Ue.curveElevateDegree(e[o],t))}for(var a,i=[],s=0;s<e.length;){var l=e[s];++s,i.push(new ee(V.first(l.knots),V.last(l.knots)))}a=i;for(var c=0,d=e.length;c<d;){var p=c++;e[p].knots=e[p].knots.map(function(e){return function(t){return t-e[0]}}([a[p].min]))}for(var h=a.map((function(e){return e.max-e.min})),m=u.fold(h,(function(e,t){return Math.max(e,t)}),0),f=0,g=e.length;f<g;){var $=f++;e[$].knots=e[$].knots.map(function(e){return function(t){return t*e[0]}}([m/h[$]]))}for(var v=u.fold(e,(function(e,t){return Ce.sortedSetUnion(e.knots,t)}),[]),y=0,_=e.length;y<_;){var b=y++,x=Ce.sortedSetSub(v,e[b].knots);0==x.length&&(e[b]=e[b]),e[b]=Ue.curveKnotRefine(e[b],x)}return e},Ue.imin=function(e,t){return e<t?e:t},Ue.imax=function(e,t){return e>t?e:t},Ue.curveElevateDegree=function(e,t){if(t<=e.degree)return e;var n=e.knots.length-e.degree-2,r=e.degree,o=e.knots,a=e.controlPoints,i=t-e.degree,s=e.controlPoints[0].length,l=Ce.zeros2d(r+i+1,r+1),u=[],c=[],d=[],p=n+r+1,h=t,m=Math.floor(h/2),f=[],g=[];l[0][0]=1,l[h][r]=1;for(var $=1,v=m+1;$<v;)for(var y=$++,_=1/j.get(h,y),b=Ue.imin(r,y),x=Ue.imax(0,y-i),w=b+1;x<w;){var S=x++;l[y][S]=_*j.get(r,S)*j.get(i,y-S)}for(var M=m+1;M<h;)for(var E=M++,T=Ue.imin(r,E),C=Ue.imax(0,E-i),P=T+1;C<P;){var A=C++;l[E][A]=l[h-E][r-A]}var L=h+1,R=-1,D=r,I=r+1,O=1,N=o[0];f[0]=a[0];for(var U=0,k=h+1;U<k;)g[U++]=N;for(var H=0,G=r+1;H<G;){var V=H++;u[V]=a[V]}for(;I<p;){for(var F=I;I<p&&o[I]==o[I+1];)I+=1;var z,B,W=I-F+1,Y=o[I],X=R;if(R=r-W,z=X>0?Math.floor((X+2)/2):1,B=R>0?Math.floor(h-(R+1)/2):h,R>0){for(var Z=Y-N,J=[],K=r;K>W;)J[K-W-1]=Z/(o[D+K]-N),K--;for(var Q=1,ee=R+1;Q<ee;){for(var te=Q++,ne=R-te,re=W+te,oe=r;oe>=re;)u[oe]=Ce.add(Ce.mul(J[oe-re],u[oe]),Ce.mul(1-J[oe-re],u[oe-1])),oe--;d[ne]=u[r]}}for(var ae=z,ie=h+1;ae<ie;){var se=ae++;c[se]=Ce.zeros1d(s);for(var le=Ue.imin(r,se),ue=Ue.imax(0,se-i),ce=le+1;ue<ce;){var de=ue++;c[se]=Ce.add(c[se],Ce.mul(l[se][de],u[de]))}}if(X>1)for(var pe=L-2,he=L,me=Y-N,fe=(Y-g[L-1])/me,ge=1;ge<X;){for(var $e=ge++,ve=pe,ye=he,_e=ye-L+1;ye-ve>$e;)ve<O&&(f[ve]=Ce.lerp((Y-g[ve])/(N-g[ve]),f[ve],f[ve-1])),ye>=z?ye-$e<=L-h+X&&(c[_e]=Ce.lerp((Y-g[ye-$e])/me,c[_e],c[_e+1])):c[_e]=Ce.lerp(fe,c[_e],c[_e+1]),ve+=1,ye-=1,_e-=1;pe-=1,he+=1}if(D!=r)for(var be=0,xe=h-X;be<xe;)be++,g[L]=N,L+=1;for(var we=z,Se=B+1;we<Se;){var Me=we++;f[O]=c[Me],O+=1}if(I<p){for(var Ee=0;Ee<R;){var Te=Ee++;u[Te]=d[Te]}for(var Pe=R,Ae=r+1;Pe<Ae;){var Le=Pe++;u[Le]=a[I-r+Le]}D=I,I+=1,N=Y}else for(var Re=0,De=h+1;Re<De;)g[L+Re++]=Y}return new q(t,g,f)},Ue.rationalSurfaceTransform=function(e,t){for(var n=Ie.dehomogenize2d(e.controlPoints),r=0,o=n.length;r<o;)for(var a=r++,i=0,s=n[a].length;i<s;){var l=i++,u=n[a][l];u.push(1),n[a][l]=ye.dot(t,u).slice(0,u.length-1)}return new X(e.degreeU,e.degreeV,e.knotsU.slice(),e.knotsV.slice(),Ie.homogenize2d(n,Ie.weight2d(e.controlPoints)))},Ue.rationalCurveTransform=function(e,t){for(var n=Ie.dehomogenize1d(e.controlPoints),r=0,o=n.length;r<o;){var a=r++,i=n[a];i.push(1),n[a]=ye.dot(t,i).slice(0,i.length-1)}return new q(e.degree,e.knots.slice(),Ie.homogenize1d(n,Ie.weight1d(e.controlPoints)))},Ue.surfaceKnotRefine=function(e,t,n){var r,o,a,i=[];n?(a=e.controlPoints,r=e.knotsV,o=e.degreeV):(a=ye.transpose(e.controlPoints),r=e.knotsU,o=e.degreeU);for(var s=null,l=0;l<a.length;){var u=a[l];++l,s=Ue.curveKnotRefine(new q(o,r,u),t),i.push(s.controlPoints)}var c=s.knots;return n?new X(e.degreeU,e.degreeV,e.knotsU.slice(),c,i):(i=ye.transpose(i),new X(e.degreeU,e.degreeV,c,e.knotsV.slice(),i))},Ue.decomposeCurveIntoBeziers=function(e){for(var t=e.degree,n=e.controlPoints,r=e.knots,o=Pe.knotMultiplicities(r),a=t+1,i=0;i<o.length;){var s=o[i];if(++i,s.mult<a){var l=Ce.rep(a-s.mult,s.knot),u=Ue.curveKnotRefine(new q(t,r,n),l);r=u.knots,n=u.controlPoints}}for(var c=2*a,d=[],p=0;p<n.length;){var h=r.slice(p,p+c),m=n.slice(p,p+a);d.push(new q(t,h,m)),p+=a}return d},Ue.curveKnotRefine=function(e,t){if(0==t.length)return Ne.clonedCurve(e);for(var n=e.degree,r=e.controlPoints,o=e.knots,a=r.length-1,i=a+n+1,s=t.length-1,l=Ie.knotSpan(n,t[0],o),u=Ie.knotSpan(n,t[s],o),c=[],d=[],p=0,h=l-n+1;p<h;){var m=p++;c[m]=r[m]}for(var f=u-1,g=a+1;f<g;){var $=f++;c[$+s+1]=r[$]}for(var v=0,y=l+1;v<y;){var _=v++;d[_]=o[_]}for(var b=u+n,x=i+1;b<x;){var w=b++;d[w+s+1]=o[w]}for(var S=u+n-1,M=u+n+s,E=s;E>=0;){for(;t[E]<=o[S]&&S>l;)c[M-n-1]=r[S-n-1],d[M]=o[S],M-=1,S-=1;c[M-n-1]=c[M-n];for(var T=1,C=n+1;T<C;){var P=T++,A=M-n+P,L=d[M+P]-t[E];c[A-1]=Math.abs(L)<z.EPSILON?c[A]:Ce.add(Ce.mul(L/=d[M+P]-o[S-n+P],c[A-1]),Ce.mul(1-L,c[A]))}d[M]=t[E],M-=1,E--}return new q(n,d,c)},Ue.curveKnotInsert=function(e,t,n){for(var r=e.degree,o=e.controlPoints,a=e.knots,i=o.length,s=Ie.knotSpan(r,t,a),l=[],u=[],c=[],d=1,p=s+1;d<p;){var h=d++;u[h]=a[h]}for(var m=1,f=n+1;m<f;)u[s+m++]=t;for(var g=s+1,$=a.length;g<$;){var v=g++;u[v+n]=a[v]}for(var y=0,_=s-r+1;y<_;){var b=y++;c[b]=o[b]}for(var x=s-0;x<i;){var w=x++;c[w+n]=o[w]}for(var S=0,M=r-0+1;S<M;){var E=S++;l[E]=o[s-r+E]}for(var T=0,C=0,P=1,A=n+1;P<A;){var L=P++;T=s-r+L;for(var R=0,D=r-L-0+1;R<D;){var I=R++;l[I]=Ce.add(Ce.mul(C=(t-a[T+I])/(a[I+s+1]-a[T+I]),l[I+1]),Ce.mul(1-C,l[I]))}c[T]=l[0],c[s+n-L-0]=l[r-L-0]}for(var O=T+1,N=s-0;O<N;){var U=O++;c[U]=l[U-T]}return new q(r,u,c)};var ke=t.eval.Tess=function(){};i["verb.eval.Tess"]=ke,ke.__name__=["verb","eval","Tess"],ke.rationalCurveRegularSample=function(e,t,n){return ke.rationalCurveRegularSampleRange(e,e.knots[0],V.last(e.knots),t,n)},ke.rationalCurveRegularSampleRange=function(e,t,n,r,o){r<1&&(r=2);for(var a=[],i=(n-t)/(r-1),s=0,l=0;l<r;)s=t+i*l++,a.push(o?[s].concat(Ie.rationalCurvePoint(e,s)):Ie.rationalCurvePoint(e,s));return a},ke.rationalCurveAdaptiveSample=function(e,t,n){if(null==n&&(n=!1),null==t&&(t=1e-6),1==e.degree){if(n){for(var r=[],o=0,a=e.controlPoints.length;o<a;){var i=o++;r.push([e.knots[i+1]].concat(Ie.dehomogenize(e.controlPoints[i])))}return r}return e.controlPoints.map(Ie.dehomogenize)}return ke.rationalCurveAdaptiveSampleRange(e,e.knots[0],V.last(e.knots),t,n)},ke.rationalCurveAdaptiveSampleRange=function(e,t,n,r,o){var a=Ie.rationalCurvePoint(e,t),i=Ie.rationalCurvePoint(e,n),s=.5+.2*Math.random(),l=Ie.rationalCurvePoint(e,t+(n-t)*s),u=Ce.sub(a,i),c=Ce.sub(a,l);if(Ce.dot(u,u)<r&&Ce.dot(c,c)>r||!Te.threePointsAreFlat(a,l,i,r)){var d=t+.5*(n-t),p=ke.rationalCurveAdaptiveSampleRange(e,t,d,r,o),h=ke.rationalCurveAdaptiveSampleRange(e,d,n,r,o);return p.slice(0,-1).concat(h)}return o?[[t].concat(a),[n].concat(i)]:[a,i]},ke.rationalSurfaceNaive=function(e,t,n){t<1&&(t=1),n<1&&(n=1);for(var r=e.knotsU,o=e.knotsV,a=(V.last(r)-r[0])/t,i=(V.last(o)-o[0])/n,s=[],l=[],u=[],c=0,d=t+1;c<d;)for(var p=c++,h=0,m=n+1;h<m;){var f=p*a,g=h++*i;l.push([f,g]);var $=Ie.rationalSurfaceDerivatives(e,f,g,1);s.push($[0][0]);var v=Ce.normalized(Ce.cross($[1][0],$[0][1]));u.push(v)}for(var y=[],_=0;_<t;)for(var b=_++,x=0;x<n;){var w=x++,S=b*(n+1)+w,M=(b+1)*(n+1)+w,E=M+1,T=[S,E,S+1];y.push([S,M,E]),y.push(T)}return new Z(y,s,u,l)},ke.divideRationalSurfaceAdaptive=function(e,t){null==t&&(t=new He),t.minDivsU=null!=t.minDivsU?t.minDivsU:1,t.minDivsU=null!=t.minDivsV?t.minDivsV:1,t.refine=null==t.refine||t.refine;var n,r,o=2*(e.controlPoints.length-1),a=2*(e.controlPoints[0].length-1);n=t.minDivsU=t.minDivsU>o?t.minDivsU:o,r=t.minDivsV=t.minDivsV>a?t.minDivsV:a;for(var i=V.last(e.knotsU),s=e.knotsU[0],l=V.last(e.knotsV),u=e.knotsV[0],c=(i-s)/n,d=(l-u)/r,p=[],h=[],m=0,f=r+1;m<f;){for(var g=m++,$=[],v=0,y=n+1;v<y;){var _=s+c*v++,b=u+d*g,x=Ie.rationalSurfaceDerivatives(e,_,b,1),w=Ce.normalized(Ce.cross(x[0][1],x[1][0]));$.push(new le(x[0][0],w,[_,b],-1,Ce.isZero(w)))}h.push($)}for(var S=0;S<r;)for(var M=S++,E=0;E<n;){var T=E++;p.push(new Ge(e,[h[r-M-1][T],h[r-M-1][T+1],h[r-M][T+1],h[r-M][T]]))}if(!t.refine)return p;for(var C=0;C<r;)for(var P=C++,A=0;A<n;){var L=A++,R=P*n+L,D=ke.north(R,P,L,n,r,p),I=ke.east(R,P,L,n,r,p),O=ke.south(R,P,L,n,r,p),N=ke.west(R,P,L,n,r,p);p[R].neighbors=[O,I,D,N],p[R].divide(t)}return p},ke.north=function(e,t,n,r,o,a){return 0==t?null:a[e-r]},ke.south=function(e,t,n,r,o,a){return t==o-1?null:a[e+r]},ke.east=function(e,t,n,r,o,a){return n==r-1?null:a[e+1]},ke.west=function(e,t,n,r,o,a){return 0==n?null:a[e-1]},ke.triangulateAdaptiveRefinementNodeTree=function(e){for(var t=Z.empty(),n=0;n<e.length;){var r=e[n];++n,r.triangulate(t)}return t},ke.rationalSurfaceAdaptive=function(e,t){t=null!=t?t:new He;var n=ke.divideRationalSurfaceAdaptive(e,t);return ke.triangulateAdaptiveRefinementNodeTree(n)};var He=t.core.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025};i["verb.eval.AdaptiveRefinementOptions"]=He,He.__name__=["verb","eval","AdaptiveRefinementOptions"],He.prototype={__class__:He};var Ge=t.core.AdaptiveRefinementNode=function(e,t,n){if(this.srf=e,this.neighbors=null==n?[null,null,null,null]:n,this.corners=t,null==this.corners){var r=e.knotsU[0],o=V.last(e.knotsU),a=e.knotsV[0],i=V.last(e.knotsV);this.corners=[le.fromUv(r,a),le.fromUv(o,a),le.fromUv(o,i),le.fromUv(r,i)]}};i["verb.eval.AdaptiveRefinementNode"]=Ge,Ge.__name__=["verb","eval","AdaptiveRefinementNode"],Ge.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var e=0;e<4;){var t=e++;if(null==this.corners[t].point){var n=this.corners[t];this.evalSrf(n.uv[0],n.uv[1],n)}}},evalSrf:function(e,t,n){var r=Ie.rationalSurfaceDerivatives(this.srf,e,t,1),o=r[0][0],a=Ce.cross(r[0][1],r[1][0]),i=Ce.isZero(a);return i||(a=Ce.normalized(a)),null!=n?(n.degen=i,n.point=o,n.normal=a,n):new le(o,a,[e,t],-1,i)},getEdgeCorners:function(e){if(this.isLeaf())return[this.corners[e]];if(this.horizontal)switch(e){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(e){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(e){var t=[this.corners[e]];if(null==this.neighbors[e])return t;var n=this.neighbors[e].getEdgeCorners((e+2)%4),r=z.EPSILON,o=this,a=n.filter([function(e){return e.uv[0]>o.corners[0].uv[0]+r&&e.uv[0]<o.corners[2].uv[0]-r},function(e){return e.uv[1]>o.corners[0].uv[1]+r&&e.uv[1]<o.corners[2].uv[1]-r}][e%2]);return a.reverse(),t.concat(a)},midpoint:function(e){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[e])return this.midPoints[e];switch(e){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[e]},hasBadNormals:function(){return this.corners[0].degen||this.corners[1].degen||this.corners[2].degen||this.corners[3].degen},fixNormals:function(){for(var e=this.corners.length,t=0;t<e;){var n=t++;if(this.corners[n].degen){var r=this.corners[(n+1)%e];this.corners[n].normal=r.degen?this.corners[(n+3)%e].normal:r.normal}}},shouldDivide:function(e,t){if(t<e.minDepth)return!0;if(t>=e.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=Ce.normSquared(Ce.sub(this.corners[0].normal,this.corners[1].normal))>e.normTol||Ce.normSquared(Ce.sub(this.corners[2].normal,this.corners[3].normal))>e.normTol,this.splitHoriz=Ce.normSquared(Ce.sub(this.corners[1].normal,this.corners[2].normal))>e.normTol||Ce.normSquared(Ce.sub(this.corners[3].normal,this.corners[0].normal))>e.normTol,this.splitVert||this.splitHoriz)return!0;var n=this.center();return Ce.normSquared(Ce.sub(n.normal,this.corners[0].normal))>e.normTol||Ce.normSquared(Ce.sub(n.normal,this.corners[1].normal))>e.normTol||Ce.normSquared(Ce.sub(n.normal,this.corners[2].normal))>e.normTol||Ce.normSquared(Ce.sub(n.normal,this.corners[3].normal))>e.normTol},divide:function(e){null==e&&(e=new He),null==e.normTol&&(e.normTol=.085),null==e.minDepth&&(e.minDepth=0),null==e.maxDepth&&(e.maxDepth=10),this._divide(e,0,!0)},_divide:function(e,t,n){if(this.evalCorners(),this.shouldDivide(e,t)){if(t++,this.splitVert&&!this.splitHoriz?n=!1:!this.splitVert&&this.splitHoriz&&(n=!0),this.horizontal=n,this.horizontal){var r=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],o=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new Ge(this.srf,r),new Ge(this.srf,o)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var a=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],i=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new Ge(this.srf,a),new Ge(this.srf,i)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var s=0,l=this.children;s<l.length;){var u=l[s];++s,u._divide(e,t,!n)}}},triangulate:function(e){if(null==e&&(e=Z.empty()),this.isLeaf())return this.triangulateLeaf(e);for(var t=0,n=this.children;t<n.length;){var r=n[t];if(++t,null==r)break;r.triangulate(e)}return e},triangulateLeaf:function(e){for(var t=e.points.length,n=[],r=[],o=0,a=0;a<4;){var i=a++,s=this.getAllCorners(i);2==s.length&&(o=i+1);for(var l=0,u=s.length;l<u;){var c=l++;n.push(s[c])}}for(var d=0;d<n.length;){var p=n[d];++d,-1==p.id?(e.uvs.push(p.uv),e.points.push(p.point),e.normals.push(p.normal),p.id=t,r.push(t),t++):r.push(p.id)}if(4==n.length)return e.faces.push([r[0],r[3],r[1]]),e.faces.push([r[3],r[2],r[1]]),e;if(5==n.length){var h=r.length;return e.faces.push([r[o],r[(o+2)%h],r[(o+1)%h]]),e.faces.push([r[(o+4)%h],r[(o+3)%h],r[o]]),e.faces.push([r[o],r[(o+3)%h],r[(o+2)%h]]),e}var m=this.center();e.uvs.push(m.uv),e.points.push(m.point),e.normals.push(m.normal);for(var f=e.points.length-1,g=0,$=n.length-1;g<n.length;)e.faces.push([f,r[g],r[$]]),$=g++;return e},__class__:Ge};var Ve=t.exe.Dispatcher=function(){};i["verb.exe.Dispatcher"]=Ve,Ve.__name__=["verb","exe","Dispatcher"],Ve.init=function(){Ve._init||(Ve._workerPool=new je(Ve.THREADS),Ve._init=!0)},Ve.dispatchMethod=function(e,t,n){Ve.init();var r=new I;return Ve._workerPool.addWork(g.getClassName(e),t,n,(function(e){r.resolve(e)})),new O(r)};var je=t.exe.WorkerPool=function(e,t){null==t&&(t="verb.js"),null==e&&(e=1),this._callbacks=new b,this._working=new b,this._pool=[],this._queue=[];for(var n=0;n<e;){var r;n++;try{r=new Worker(je.basePath+t)}catch(o){o instanceof C&&(o=o.val),r=new Worker(je.basePath+t.substring(0,-3)+".min.js")}this._pool.push(r)}};i["verb.exe.WorkerPool"]=je,je.__name__=["verb","exe","WorkerPool"],je.prototype={addWork:function(e,t,n,r){var o=new Fe(e,t,n);this._callbacks.set(o.id,r),this._queue.push(o),this.processQueue()},processQueue:function(){for(var t=this;this._queue.length>0&&this._pool.length>0;){var n=this._queue.shift(),r=[n.id],o=[this._pool.shift()];this._working.h[r[0]]=o[0],o[0].onmessage=function(n,r){return function(o){t._working.remove(r[0]),t._pool.push(n[0]);try{t._callbacks.h.hasOwnProperty(r[0])&&(t._callbacks.h[r[0]](o.data.result),t._callbacks.remove(r[0]))}catch(a){a instanceof C&&(a=a.val),e.log(a)}t.processQueue()}}(o,r),o[0].postMessage(n)}},__class__:je};var Fe=function(e,t,n){this.className=e,this.methodName=t,this.args=n,this.id=Fe.uuid++};i["verb.exe._WorkerPool.Work"]=Fe,Fe.__name__=["verb","exe","_WorkerPool","Work"],Fe.prototype={__class__:Fe};var ze=function(){};i["verb.geom.ICurve"]=ze,ze.__name__=["verb","geom","ICurve"],ze.__interfaces__=[Me],ze.prototype={__class__:ze};var Be=t.geom.NurbsCurve=function(e){this._data=Le.isValidNurbsCurveData(e)};i["verb.geom.NurbsCurve"]=Be,Be.__name__=["verb","geom","NurbsCurve"],Be.__interfaces__=[ze],Be.byKnotsControlPointsWeights=function(e,t,n,r){return new Be(new q(e,t.slice(),Ie.homogenize1d(n,r)))},Be.byPoints=function(e,t){return null==t&&(t=3),new Be(Ne.rationalInterpCurve(e,t))},Be.__super__=B,Be.prototype=r(B.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return Ie.dehomogenize1d(this._data.controlPoints)},weights:function(){return Ie.weight1d(this._data.controlPoints)},asNurbs:function(){return new q(this.degree(),this.knots(),Ie.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new Be(this._data)},domain:function(){return new ee(V.first(this._data.knots),V.last(this._data.knots))},transform:function(e){return new Be(Ue.rationalCurveTransform(this._data,e))},transformAsync:function(e){return Ve.dispatchMethod(Ue,"rationalCurveTransform",[this._data,e]).then((function(e){return new Be(e)}))},point:function(e){return Ie.rationalCurvePoint(this._data,e)},pointAsync:function(e){return Ve.dispatchMethod(Ie,"rationalCurvePoint",[this._data,e])},tangent:function(e){return Ie.rationalCurveTangent(this._data,e)},tangentAsync:function(e){return Ve.dispatchMethod(Ie,"rationalCurveTangent",[this._data,e])},derivatives:function(e,t){return null==t&&(t=1),Ie.rationalCurveDerivatives(this._data,e,t)},derivativesAsync:function(e,t){return null==t&&(t=1),Ve.dispatchMethod(Ie,"rationalCurveDerivatives",[this._data,e,t])},closestPoint:function(e){return Pe.rationalCurveClosestPoint(this._data,e)},closestPointAsync:function(e){return Ve.dispatchMethod(Pe,"rationalCurveClosestPoint",[this._data,e])},closestParam:function(e){return Pe.rationalCurveClosestParam(this._data,e)},closestParamAsync:function(e){return Ve.dispatchMethod(Pe,"rationalCurveClosestParam",[this._data,e])},length:function(){return Pe.rationalCurveArcLength(this._data)},lengthAsync:function(){return Ve.dispatchMethod(Pe,"rationalCurveArcLength",[this._data])},lengthAtParam:function(e){return Pe.rationalCurveArcLength(this._data,e)},lengthAtParamAsync:function(){return Ve.dispatchMethod(Pe,"rationalCurveArcLength",[this._data])},paramAtLength:function(e,t){return Pe.rationalCurveParamAtArcLength(this._data,e,t)},paramAtLengthAsync:function(e,t){return Ve.dispatchMethod(Pe,"rationalCurveParamAtArcLength",[this._data,e,t])},divideByEqualArcLength:function(e){return Re.rationalCurveByEqualArcLength(this._data,e)},divideByEqualArcLengthAsync:function(e){return Ve.dispatchMethod(Re,"rationalCurveByEqualArcLength",[this._data,e])},divideByArcLength:function(e){return Re.rationalCurveByArcLength(this._data,e)},divideByArcLengthAsync:function(e){return Ve.dispatchMethod(Re,"rationalCurveByArcLength",[this._data,e])},split:function(e){return Re.curveSplit(this._data,e).map((function(e){return new Be(e)}))},splitAsync:function(e){return Ve.dispatchMethod(Re,"curveSplit",[this._data,e]).then((function(e){return e.map((function(e){return new Be(e)}))}))},reverse:function(){return new Be(Ue.curveReverse(this._data))},reverseAsync:function(){return Ve.dispatchMethod(Ue,"curveReverse",[this._data]).then((function(e){return new Be(e)}))},tessellate:function(e){return ke.rationalCurveAdaptiveSample(this._data,e,!1)},tessellateAsync:function(e){return Ve.dispatchMethod(ke,"rationalCurveAdaptiveSample",[this._data,e,!1])},__class__:Be});var We=t.geom.Arc=function(e,t,n,r,o,a){Be.call(this,Ne.arc(e,t,n,r,o,a)),this._center=e,this._xaxis=t,this._yaxis=n,this._radius=r,this._minAngle=o,this._maxAngle=a};i["verb.geom.Arc"]=We,We.__name__=["verb","geom","Arc"],We.__super__=Be,We.prototype=r(Be.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:We});var Ye=t.geom.BezierCurve=function(e,t){Be.call(this,Ne.rationalBezierCurve(e,t))};i["verb.geom.BezierCurve"]=Ye,Ye.__name__=["verb","geom","BezierCurve"],Ye.__super__=Be,Ye.prototype=r(Be.prototype,{__class__:Ye});var qe=t.geom.Circle=function(e,t,n,r){We.call(this,e,t,n,r,0,2*Math.PI)};i["verb.geom.Circle"]=qe,qe.__name__=["verb","geom","Circle"],qe.__super__=We,qe.prototype=r(We.prototype,{__class__:qe});var Xe=function(){};i["verb.geom.ISurface"]=Xe,Xe.__name__=["verb","geom","ISurface"],Xe.__interfaces__=[Me],Xe.prototype={__class__:Xe};var Ze=t.geom.NurbsSurface=function(e){this._data=Le.isValidNurbsSurfaceData(e)};i["verb.geom.NurbsSurface"]=Ze,Ze.__name__=["verb","geom","NurbsSurface"],Ze.__interfaces__=[Xe],Ze.byKnotsControlPointsWeights=function(e,t,n,r,o,a){return new Ze(new X(e,t,n,r,Ie.homogenize2d(o,a)))},Ze.byCorners=function(e,t,n,r){return new Ze(Ne.fourPointSurface(e,t,n,r))},Ze.byLoftingCurves=function(e,t){return new Ze(Ne.loftedSurface(function(t){for(var n=[],r=0;r<e.length;){var o=e[r];++r,n.push(o.asNurbs())}return n}(),t))},Ze.__super__=B,Ze.prototype=r(B.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return Ie.dehomogenize2d(this._data.controlPoints)},weights:function(){return Ie.weight2d(this._data.controlPoints)},asNurbs:function(){return new X(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),Ie.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new Ze(this.asNurbs())},domainU:function(){return new ee(V.first(this._data.knotsU),V.last(this._data.knotsU))},domainV:function(){return new ee(V.first(this._data.knotsV),V.last(this._data.knotsV))},point:function(e,t){return Ie.rationalSurfacePoint(this._data,e,t)},pointAsync:function(e,t){return Ve.dispatchMethod(Ie,"rationalSurfacePoint",[this._data,e,t])},normal:function(e,t){return Ie.rationalSurfaceNormal(this._data,e,t)},normalAsync:function(e,t){return Ve.dispatchMethod(Ie,"rationalSurfaceNormal",[this._data,e,t])},derivatives:function(e,t,n){return null==n&&(n=1),Ie.rationalSurfaceDerivatives(this._data,e,t,n)},derivativesAsync:function(e,t,n){return null==n&&(n=1),Ve.dispatchMethod(Ie,"rationalSurfaceDerivatives",[this._data,e,t,n])},closestParam:function(e){return Pe.rationalSurfaceClosestParam(this._data,e)},closestParamAsync:function(e){return Ve.dispatchMethod(Pe,"rationalSurfaceClosestParam",[this._data,e])},closestPoint:function(e){return Pe.rationalSurfaceClosestPoint(this._data,e)},closestPointAsync:function(e){return Ve.dispatchMethod(Pe,"rationalSurfaceClosestPoint",[this._data,e])},split:function(e,t){return null==t&&(t=!1),Re.surfaceSplit(this._data,e,t).map((function(e){return new Ze(e)}))},splitAsync:function(e,t){return null==t&&(t=!1),Ve.dispatchMethod(Re,"surfaceSplit",[this._data,e,t]).then((function(e){return e.map((function(e){return new Ze(e)}))}))},reverse:function(e){return null==e&&(e=!1),new Ze(Ue.surfaceReverse(this._data,e))},reverseAsync:function(e){return null==e&&(e=!1),Ve.dispatchMethod(Ue,"surfaceReverse",[this._data,e]).then((function(e){return new Ze(e)}))},isocurve:function(e,t){return null==t&&(t=!1),new Be(Ne.surfaceIsocurve(this._data,e,t))},isocurveAsync:function(e,t){return null==t&&(t=!1),Ve.dispatchMethod(Ne,"surfaceIsocurve",[this._data,e,t]).then((function(e){return new Be(e)}))},boundaries:function(e){return Ne.surfaceBoundaryCurves(this._data).map((function(e){return new Be(e)}))},boundariesAsync:function(e){return Ve.dispatchMethod(Ne,"surfaceBoundaryCurves",[this._data]).then((function(e){return e.map((function(e){return new Be(e)}))}))},tessellate:function(e){return ke.rationalSurfaceAdaptive(this._data,e)},tessellateAsync:function(e){return Ve.dispatchMethod(ke,"rationalSurfaceAdaptive",[this._data,e])},transform:function(e){return new Ze(Ue.rationalSurfaceTransform(this._data,e))},transformAsync:function(e){return Ve.dispatchMethod(Ue,"rationalSurfaceTransform",[this._data,e]).then((function(e){return new Ze(e)}))},__class__:Ze});var Je=t.geom.ConicalSurface=function(e,t,n,r,o){Ze.call(this,Ne.conicalSurface(e,t,n,r,o)),this._axis=e,this._xaxis=t,this._base=n,this._height=r,this._radius=o};i["verb.geom.ConicalSurface"]=Je,Je.__name__=["verb","geom","ConicalSurface"],Je.__super__=Ze,Je.prototype=r(Ze.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Je});var Ke=t.geom.CylindricalSurface=function(e,t,n,r,o){Ze.call(this,Ne.cylindricalSurface(e,t,n,r,o)),this._axis=e,this._xaxis=t,this._base=n,this._height=r,this._radius=o};i["verb.geom.CylindricalSurface"]=Ke,Ke.__name__=["verb","geom","CylindricalSurface"],Ke.__super__=Ze,Ke.prototype=r(Ze.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:Ke});var Qe=t.geom.EllipseArc=function(e,t,n,r,o){Be.call(this,Ne.ellipseArc(e,t,n,r,o)),this._center=e,this._xaxis=t,this._yaxis=n,this._minAngle=r,this._maxAngle=o};i["verb.geom.EllipseArc"]=Qe,Qe.__name__=["verb","geom","EllipseArc"],Qe.__super__=Be,Qe.prototype=r(Be.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Qe});var et=t.geom.Ellipse=function(e,t,n){Qe.call(this,e,t,n,0,2*Math.PI)};i["verb.geom.Ellipse"]=et,et.__name__=["verb","geom","Ellipse"],et.__super__=Qe,et.prototype=r(Qe.prototype,{__class__:et});var tt=t.geom.ExtrudedSurface=function(e,t){Ze.call(this,Ne.extrudedSurface(Ce.normalized(t),Ce.norm(t),e.asNurbs())),this._profile=e,this._direction=t};i["verb.geom.ExtrudedSurface"]=tt,tt.__name__=["verb","geom","ExtrudedSurface"],tt.__super__=Ze,tt.prototype=r(Ze.prototype,{profile:function(){return this._profile},direction:function(){return this._direction},__class__:tt});var nt=t.geom.Intersect=function(){};i["verb.geom.Intersect"]=nt,nt.__name__=["verb","geom","Intersect"],nt.curves=function(e,t,n){return null==n&&(n=.001),Oe.curves(e.asNurbs(),t.asNurbs(),n)},nt.curvesAsync=function(e,t,n){return null==n&&(n=.001),Ve.dispatchMethod(Oe,"curves",[e.asNurbs(),t.asNurbs(),n])},nt.curveAndSurface=function(e,t,n){return null==n&&(n=.001),Oe.curveAndSurface(e.asNurbs(),t.asNurbs(),n)},nt.curveAndSurfaceAsync=function(e,t,n){return null==n&&(n=.001),Ve.dispatchMethod(Oe,"curveAndSurface",[e.asNurbs(),t.asNurbs(),n])},nt.surfaces=function(e,t,n){return null==n&&(n=.001),Oe.surfaces(e.asNurbs(),t.asNurbs(),n).map((function(e){return new Be(e)}))},nt.surfacesAsync=function(e,t,n){return null==n&&(n=.001),Ve.dispatchMethod(Oe,"surfaces",[e.asNurbs(),t.asNurbs(),n]).then((function(e){return e.map((function(e){return new Be(e)}))}))};var rt=t.geom.Line=function(e,t){Be.call(this,Ne.polyline([e,t])),this._start=e,this._end=t};i["verb.geom.Line"]=rt,rt.__name__=["verb","geom","Line"],rt.__super__=Be,rt.prototype=r(Be.prototype,{start:function(){return this._start},end:function(){return this._end},__class__:rt});var ot=t.geom.RevolvedSurface=function(e,t,n,r){Ze.call(this,Ne.revolvedSurface(e.asNurbs(),t,n,r)),this._profile=e,this._center=t,this._axis=n,this._angle=r};i["verb.geom.RevolvedSurface"]=ot,ot.__name__=["verb","geom","RevolvedSurface"],ot.__super__=Ze,ot.prototype=r(Ze.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle},__class__:ot});var at=t.geom.SphericalSurface=function(e,t){Ze.call(this,Ne.sphericalSurface(e,[0,0,1],[1,0,0],t)),this._center=e,this._radius=t};i["verb.geom.SphericalSurface"]=at,at.__name__=["verb","geom","SphericalSurface"],at.__super__=Ze,at.prototype=r(Ze.prototype,{center:function(){return this._center},radius:function(){return this._radius},__class__:at});var it=t.geom.SweptSurface=function(e,t){Ze.call(this,Ne.rationalTranslationalSurface(e.asNurbs(),t.asNurbs())),this._profile=e,this._rail=t};i["verb.geom.SweptSurface"]=it,it.__name__=["verb","geom","SweptSurface"],it.__super__=Ze,it.prototype=r(Ze.prototype,{profile:function(){return this._profile},rail:function(){return this._rail},__class__:it});var st,lt=0;i.Math=Math,String.prototype.__class__=i.String=String,String.__name__=["String"],i.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=i.Date=Date,Date.__name__=["Date"];var ut=i.Int={__name__:["Int"]},ct=i.Dynamic={__name__:["Dynamic"]},dt=i.Float=Number;dt.__name__=["Float"];var pt=i.Bool=Boolean;pt.__ename__=["Bool"];var ht=i.Class={__name__:["Class"]},mt={};null==Array.prototype.map&&(Array.prototype.map=function(e){for(var t=[],n=0,r=this.length;n<r;){var o=n++;t[o]=e(this[o])}return t}),null==Array.prototype.filter&&(Array.prototype.filter=function(e){for(var t=[],n=0,r=this.length;n<r;){var o=this[n++];e(o)&&t.push(o)}return t});var ft={},gt=n.ArrayBuffer||A;null==gt.prototype.slice&&(gt.prototype.slice=A.sliceImpl);var $t=n.Uint8Array||R._new;!function(e,t){function n(e){return l[s]=r.apply(t,e),s++}function r(e){var n=[].slice.call(arguments,1);return function(){"function"==typeof e?e.apply(t,n):new Function(""+e)()}}function o(e){if(u)setTimeout(r(o,e),0);else{var t=l[e];if(t){u=!0;try{t()}finally{a(e),u=!1}}}}function a(e){delete l[e]}if(!e.setImmediate){var i,s=1,l={},u=!1,c=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?i=function(){var e=n(arguments);return process.nextTick(r(o,e)),e}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),i=function(){var r=n(arguments);return e.postMessage(t+r,"*"),r}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},i=function(){var t=n(arguments);return e.port2.postMessage(t),t}}():c&&"onreadystatechange"in c.createElement("script")?function(){var e=c.documentElement;i=function(){var t=n(arguments),r=c.createElement("script");return r.onreadystatechange=function(){o(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r),t}}():i=function(){var e=n(arguments);return setTimeout(r(o,e),0),e},d.setImmediate=i,d.clearImmediate=a}}(new Function("return this")()),y.USE_CACHE=!1,y.USE_ENUM_INDEX=!1,y.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",_.DEFAULT_RESOLVER=g,_.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",x.count=0,T.i64tmp=new v(0,0),P.__toStr={}.toString,R.BYTES_PER_ELEMENT=1,k.queue=new c,j.memo=new b,z.TOLERANCE=1e-6,z.EPSILON=1e-10,z.VERSION="2.0.0",Pe.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],Pe.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],Ve.THREADS=1,Ve._init=!1,je.basePath="",Fe.uuid=0,G.main()}("undefined"!=typeof console?console:{log:function(){}},e,void 0!==o?o:void 0!==t?t:"undefined"!=typeof self?self:this),e})),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.axios=t():e.axios=t()}(this,(function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){var t=new i(e),n=a(i.prototype.request,t);return o.extend(n,i.prototype,t),o.extend(n,t),n}var o=n(2),a=n(3),i=n(5),s=n(22),l=r(n(11));l.Axios=i,l.create=function(e){return r(s(l.defaults,e))},l.Cancel=n(23),l.CancelToken=n(24),l.isCancel=n(10),l.all=function(e){return Promise.all(e)},l.spread=n(25),e.exports=l,e.exports.default=l},function(e,t,n){"use strict";function r(e){return"[object Array]"===u.call(e)}function o(e){return null!==e&&"object"==typeof e}function a(e){return"[object Function]"===u.call(e)}function i(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),r(e))for(var n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}var s=n(3),l=n(4),u=Object.prototype.toString;e.exports={isArray:r,isArrayBuffer:function(e){return"[object ArrayBuffer]"===u.call(e)},isBuffer:l,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===u.call(e)},isFile:function(e){return"[object File]"===u.call(e)},isBlob:function(e){return"[object Blob]"===u.call(e)},isFunction:a,isStream:function(e){return o(e)&&a(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:i,merge:function e(){function t(t,r){n[r]="object"==typeof n[r]&&"object"==typeof t?e(n[r],t):t}for(var n={},r=0,o=arguments.length;r<o;r++)i(arguments[r],t);return n},deepMerge:function e(){function t(t,r){n[r]="object"==typeof n[r]&&"object"==typeof t?e(n[r],t):"object"==typeof t?e({},t):t}for(var n={},r=0,o=arguments.length;r<o;r++)i(arguments[r],t);return n},extend:function(e,t,n){return i(t,(function(t,r){e[r]=n&&"function"==typeof t?s(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},function(e,t){e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},function(e,t,n){"use strict";function r(e){this.defaults=e,this.interceptors={request:new i,response:new i}}var o=n(2),a=n(6),i=n(7),s=n(8),l=n(22);r.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=l(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var t=[s,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},r.prototype.getUri=function(e){return e=l(this.defaults,e),a(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},o.forEach(["delete","get","head","options"],(function(e){r.prototype[e]=function(t,n){return this.request(o.merge(n||{},{method:e,url:t}))}})),o.forEach(["post","put","patch"],(function(e){r.prototype[e]=function(t,n,r){return this.request(o.merge(r||{},{method:e,url:t,data:n}))}})),e.exports=r},function(e,t,n){"use strict";function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var o=n(2);e.exports=function(e,t,n){if(!t)return e;var a;if(n)a=n(t);else if(o.isURLSearchParams(t))a=t.toString();else{var i=[];o.forEach(t,(function(e,t){null!=e&&(o.isArray(e)?t+="[]":e=[e],o.forEach(e,(function(e){o.isDate(e)?e=e.toISOString():o.isObject(e)&&(e=JSON.stringify(e)),i.push(r(t)+"="+r(e))})))})),a=i.join("&")}if(a){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}},function(e,t,n){"use strict";function r(){this.handlers=[]}var o=n(2);r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){o.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},function(e,t,n){"use strict";function r(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var o=n(2),a=n(9),i=n(10),s=n(11),l=n(20),u=n(21);e.exports=function(e){return r(e),e.baseURL&&!l(e.url)&&(e.url=u(e.baseURL,e.url)),e.headers=e.headers||{},e.data=a(e.data,e.headers,e.transformRequest),e.headers=o.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),o.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||s.adapter)(e).then((function(t){return r(e),t.data=a(t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(r(e),t&&t.response&&(t.response.data=a(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t,n){return r.forEach(n,(function(n){e=n(e,t)})),e}},function(e,t){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";function r(e,t){!o.isUndefined(e)&&o.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var o=n(2),a=n(12),i={"Content-Type":"application/x-www-form-urlencoded"},s={adapter:function(){var e;return"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)?e=n(13):"undefined"!=typeof XMLHttpRequest&&(e=n(13)),e}(),transformRequest:[function(e,t){return a(t,"Accept"),a(t,"Content-Type"),o.isFormData(e)||o.isArrayBuffer(e)||o.isBuffer(e)||o.isStream(e)||o.isFile(e)||o.isBlob(e)?e:o.isArrayBufferView(e)?e.buffer:o.isURLSearchParams(e)?(r(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):o.isObject(e)?(r(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};o.forEach(["delete","get","head"],(function(e){s.headers[e]={}})),o.forEach(["post","put","patch"],(function(e){s.headers[e]=o.merge(i)})),e.exports=s},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},function(e,t,n){"use strict";var r=n(2),o=n(14),a=n(6),i=n(17),s=n(18),l=n(15);e.exports=function(e){return new Promise((function(t,u){var c=e.data,d=e.headers;r.isFormData(c)&&delete d["Content-Type"];var p=new XMLHttpRequest;if(e.auth&&(d.Authorization="Basic "+btoa((e.auth.username||"")+":"+(e.auth.password||""))),p.open(e.method.toUpperCase(),a(e.url,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in p?i(p.getAllResponseHeaders()):null;o(t,u,{data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:n,config:e,request:p}),p=null}},p.onabort=function(){p&&(u(l("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){u(l("Network Error",e,null,p)),p=null},p.ontimeout=function(){u(l("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",p)),p=null},r.isStandardBrowserEnv()){var h=n(19),m=(e.withCredentials||s(e.url))&&e.xsrfCookieName?h.read(e.xsrfCookieName):void 0;m&&(d[e.xsrfHeaderName]=m)}if("setRequestHeader"in p&&r.forEach(d,(function(e,t){void 0===c&&"content-type"===t.toLowerCase()?delete d[t]:p.setRequestHeader(t,e)})),e.withCredentials&&(p.withCredentials=!0),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),u(e),p=null)})),void 0===c&&(c=null),p.send(c)}))}},function(e,t,n){"use strict";var r=n(15);e.exports=function(e,t,n){var o=n.config.validateStatus;!o||o(n.status)?e(n):t(r("Request failed with status code "+n.status,n.config,null,n.request,n))}},function(e,t,n){"use strict";var r=n(16);e.exports=function(e,t,n,o,a){var i=new Error(e);return r(i,t,n,o,a)}},function(e,t){"use strict";e.exports=function(e,t,n,r,o){return e.config=t,n&&(e.code=n),e.request=r,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var r=n(2),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,a,i={};return e?(r.forEach(e.split("\n"),(function(e){if(a=e.indexOf(":"),t=r.trim(e.substr(0,a)).toLowerCase(),n=r.trim(e.substr(a+1)),t){if(i[t]&&o.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i}},function(e,t,n){"use strict";var r=n(2);e.exports=r.isStandardBrowserEnv()?function(){function e(e){var t=e;return n&&(o.setAttribute("href",t),t=o.href),o.setAttribute("href",t),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}var t,n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");return t=e(window.location.href),function(n){var o=r.isString(n)?e(n):n;return o.protocol===t.protocol&&o.host===t.host}}():function(){return!0}},function(e,t,n){"use strict";var r=n(2);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,o,a,i){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(o)&&s.push("path="+o),r.isString(a)&&s.push("domain="+a),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e,t){t=t||{};var n={};return r.forEach(["url","method","params","data"],(function(e){void 0!==t[e]&&(n[e]=t[e])})),r.forEach(["headers","auth","proxy"],(function(o){r.isObject(t[o])?n[o]=r.deepMerge(e[o],t[o]):void 0!==t[o]?n[o]=t[o]:r.isObject(e[o])?n[o]=r.deepMerge(e[o]):void 0!==e[o]&&(n[o]=e[o])})),r.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])})),n}},function(e,t){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t,n){"use strict";function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new o(e),t(n.reason))}))}var o=n(23);r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},function(e,t){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}}])}));var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.Symbol=function(){var e=0;return function(t){return $jscomp.SYMBOL_PREFIX+(t||"")+e++}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.arrayIterator=function(e){var t=0;return $jscomp.iteratorPrototype((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.makeIterator=function(e){$jscomp.initSymbolIterator();var t=e[Symbol.iterator];return t?t.call(e):$jscomp.arrayIterator(e)},$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(e){var t=function(){};return t.prototype=e,new t},$jscomp.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(t){}return!1},$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,$jscomp.inherits=function(e,t){if(e.prototype=$jscomp.objectCreate(t.prototype),e.prototype.constructor=e,$jscomp.setPrototypeOf){var n=$jscomp.setPrototypeOf;n(e,t)}else for(n in t)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(t,n);r&&Object.defineProperty(e,n,r)}else e[n]=t[n];e.superClass_=t.prototype},$jscomp.arrayFromIterator=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n},$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))},$jscomp.checkStringArgs=function(e,t,n){if(null==e)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return e+""},$jscomp.polyfill=function(e,t,n,r){if(t){for(n=$jscomp.global,e=e.split("."),r=0;r<e.length-1;r++){var o=e[r];o in n||(n[o]={}),n=n[o]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&$jscomp.defineProperty(n,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("String.prototype.repeat",(function(e){return e||function(e){var t=$jscomp.checkStringArgs(this,null,"repeat");if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n}}),"es6","es3"),$jscomp.stringPadding=function(e,t){return e=void 0!==e?String(e):" ",0<t&&e?e.repeat(Math.ceil(t/e.length)).substring(0,t):""},$jscomp.polyfill("String.prototype.padStart",(function(e){return e||function(e,t){var n=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(t,e-n.length)+n}}),"es8","es3"),$jscomp.polyfill("String.prototype.padEnd",(function(e){return e||function(e,t){var n=$jscomp.checkStringArgs(this,null,"padStart");return n+$jscomp.stringPadding(t,e-n.length)}}),"es8","es3"),$jscomp.polyfill("Math.clz32",(function(e){return e||function(e){if(0==(e=Number(e)>>>0))return 32;var t=0;return 0==(4294901760&e)&&(e<<=16,t+=16),0==(4278190080&e)&&(e<<=8,t+=8),0==(4026531840&e)&&(e<<=4,t+=4),0==(3221225472&e)&&(e<<=2,t+=2),0==(2147483648&e)&&t++,t}}),"es6","es3"),$jscomp.polyfill("String.prototype.endsWith",(function(e){return e||function(e,t){var n=$jscomp.checkStringArgs(this,e,"endsWith");e+="",void 0===t&&(t=n.length),t=Math.max(0,Math.min(0|t,n.length));for(var r=e.length;0<r&&0<t;)if(n[--t]!=e[--r])return!1;return 0>=r}}),"es6","es3"),$jscomp.findInternal=function(e,t,n){e instanceof String&&(e=String(e));for(var r=e.length,o=0;o<r;o++){var a=e[o];if(t.call(n,a,o,e))return{i:o,v:a}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.findIndex",(function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).i}}),"es6","es3"),$jscomp.iteratorFromArray=function(e,t){$jscomp.initSymbolIterator(),e instanceof String&&(e+="");var n=0,r={next:function(){if(n<e.length){var o=n++;return{value:t(o,e[o]),done:!1}}return r.next=function(){return{done:!0,value:void 0}},r.next()}};return r[Symbol.iterator]=function(){return r},r},$jscomp.polyfill("Array.prototype.keys",(function(e){return e||function(){return $jscomp.iteratorFromArray(this,(function(e){return e}))}}),"es6","es3"),$jscomp.polyfill("Number.isNaN",(function(e){return e||function(e){return"number"==typeof e&&isNaN(e)}}),"es6","es3"),$jscomp.polyfill("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}}),"es6","es3"),$jscomp.polyfill("Array.prototype.includes",(function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(t=t||0)&&(t=Math.max(t+r,0));t<r;t++){var o=n[t];if(o===e||Object.is(o,e))return!0}return!1}}),"es7","es3"),$jscomp.polyfill("String.prototype.includes",(function(e){return e||function(e,t){return-1!==$jscomp.checkStringArgs(this,e,"includes").indexOf(e,t||0)}}),"es6","es3"),$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.polyfill("Promise",(function(e){function t(){this.batch_=null}function n(e){return e instanceof o?e:new o((function(t,n){t(e)}))}if(e&&!$jscomp.FORCE_POLYFILL_PROMISE)return e;t.prototype.asyncExecute=function(e){return null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_()),this.batch_.push(e),this},t.prototype.asyncExecuteBatch_=function(){var e=this;this.asyncExecuteFunction((function(){e.executeBatch_()}))};var r=$jscomp.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){r(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(r){this.asyncThrow_(r)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(n){t.reject(n)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(n){return void this.reject_(n)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,this.executeOnSettledCallbacks_()},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)a.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var a=new t;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var n=this.createResolveAndReject_();try{e.call(t,n.resolve,n.reject)}catch(r){n.reject(r)}},o.prototype.then=function(e,t){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(n){a(n)}}:t}var r,a,i=new o((function(e,t){r=e,a=t}));return this.callWhenSettled_(n(e,r),n(t,a)),i},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function n(){switch(r.state_){case 1:e(r.result_);break;case 2:t(r.result_);break;default:throw Error("Unexpected state: "+r.state_)}}var r=this;null==this.onSettledCallbacks_?a.asyncExecute(n):this.onSettledCallbacks_.push(n)},o.resolve=n,o.reject=function(e){return new o((function(t,n){n(e)}))},o.race=function(e){return new o((function(t,r){for(var o=$jscomp.makeIterator(e),a=o.next();!a.done;a=o.next())n(a.value).callWhenSettled_(t,r)}))},o.all=function(e){var t=$jscomp.makeIterator(e),r=t.next();return r.done?n([]):new o((function(e,o){function a(t){return function(n){i[t]=n,0==--s&&e(i)}}var i=[],s=0;do{i.push(void 0),s++,n(r.value).callWhenSettled_(a(i.length-1),o),r=t.next()}while(!r.done)}))},o}),"es6","es3"),$jscomp.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var n=$jscomp.checkStringArgs(this,e,"startsWith"),r=n.length,o=(e+="").length;t=Math.max(0,Math.min(0|t,n.length));for(var a=0;a<o&&t<r;)if(n[t++]!=e[a++])return!1;return a>=o}}),"es6","es3"),$jscomp.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},$jscomp.assign="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var o in r)$jscomp.owns(r,o)&&(e[o]=r[o])}return e},$jscomp.polyfill("Object.assign",(function(e){return e||$jscomp.assign}),"es6","es3"),$jscomp.polyfill("Object.setPrototypeOf",(function(e){return e||$jscomp.setPrototypeOf}),"es6","es5"),$jscomp.polyfill("Array.from",(function(e){return e||function(e,t,n){$jscomp.initSymbolIterator(),t=null!=t?t:function(e){return e};var r=[],o=e[Symbol.iterator];if("function"==typeof o)for(e=o.call(e);!(o=e.next()).done;)r.push(t.call(n,o.value));else{o=e.length;for(var a=0;a<o;a++)r.push(t.call(n,e[a]))}return r}}),"es6","es3"),$jscomp.polyfill("Array.prototype.find",(function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}}),"es6","es3"),$jscomp.polyfill("Number.MAX_SAFE_INTEGER",(function(){return 9007199254740991}),"es6","es3"),$jscomp.polyfill("Number.MIN_SAFE_INTEGER",(function(){return-9007199254740991}),"es6","es3"),$jscomp.polyfill("Promise.prototype.finally",(function(e){return e||function(e){return this.then((function(t){return Promise.resolve(e()).then((function(){return t}))}),(function(t){return Promise.resolve(e()).then((function(){throw t}))}))}}),"es8","es3"),$jscomp.polyfill("Math.sign",(function(e){return e||function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1}}),"es6","es3"),$jscomp.polyfill("Object.values",(function(e){return e||function(e){var t,n=[];for(t in e)$jscomp.owns(e,t)&&n.push(e[t]);return n}}),"es8","es3"),$jscomp.polyfill("Array.prototype.values",(function(e){return e||function(){return $jscomp.iteratorFromArray(this,(function(e,t){return t}))}}),"es8","es3");var module$src$polyfills$CustomEvent={default:{}};!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}if("function"==typeof window.CustomEvent)return!1;window.Event&&"function"==typeof window.Event&&(e.prototype=window.Event.prototype),window.CustomEvent=e}();var module$node_modules$tinycolor2$tinycolor={default:function(e,t){if(t=t||{},(e=e||"")instanceof module$node_modules$tinycolor2$tinycolor.default)return e;if(!(this instanceof module$node_modules$tinycolor2$tinycolor.default))return new module$node_modules$tinycolor2$tinycolor.default(e,t);var n=inputToRGB$$module$node_modules$tinycolor2$tinycolor(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=mathRound$$module$node_modules$tinycolor2$tinycolor(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,1>this._r&&(this._r=mathRound$$module$node_modules$tinycolor2$tinycolor(this._r)),1>this._g&&(this._g=mathRound$$module$node_modules$tinycolor2$tinycolor(this._g)),1>this._b&&(this._b=mathRound$$module$node_modules$tinycolor2$tinycolor(this._b)),this._ok=n.ok,this._tc_id=tinyCounter$$module$node_modules$tinycolor2$tinycolor++}},Math$$module$node_modules$tinycolor2$tinycolor=Math,trimLeft$$module$node_modules$tinycolor2$tinycolor=/^\s+/,trimRight$$module$node_modules$tinycolor2$tinycolor=/\s+$/,tinyCounter$$module$node_modules$tinycolor2$tinycolor=0,mathRound$$module$node_modules$tinycolor2$tinycolor=Math$$module$node_modules$tinycolor2$tinycolor.round,mathMin$$module$node_modules$tinycolor2$tinycolor=Math$$module$node_modules$tinycolor2$tinycolor.min,mathMax$$module$node_modules$tinycolor2$tinycolor=Math$$module$node_modules$tinycolor2$tinycolor.max,mathRandom$$module$node_modules$tinycolor2$tinycolor=Math$$module$node_modules$tinycolor2$tinycolor.random;function inputToRGB$$module$node_modules$tinycolor2$tinycolor(e){var t,n={r:0,g:0,b:0},r=1,o=t=!1;return"string"==typeof e&&(e=stringInputToObject$$module$node_modules$tinycolor2$tinycolor(e)),"object"==typeof e&&(isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.r)&&isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.g)&&isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.b)?(n=rgbToRgb$$module$node_modules$tinycolor2$tinycolor(e.r,e.g,e.b),t=!0,o="%"===String(e.r).substr(-1)?"prgb":"rgb"):isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.h)&&isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.s)&&isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.v)?(n=convertToPercentage$$module$node_modules$tinycolor2$tinycolor(e.s),t=convertToPercentage$$module$node_modules$tinycolor2$tinycolor(e.v),n=hsvToRgb$$module$node_modules$tinycolor2$tinycolor(e.h,n,t),t=!0,o="hsv"):isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.h)&&isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.s)&&isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e.l)&&(n=convertToPercentage$$module$node_modules$tinycolor2$tinycolor(e.s),t=convertToPercentage$$module$node_modules$tinycolor2$tinycolor(e.l),n=hslToRgb$$module$node_modules$tinycolor2$tinycolor(e.h,n,t),t=!0,o="hsl"),e.hasOwnProperty("a")&&(r=e.a)),r=boundAlpha$$module$node_modules$tinycolor2$tinycolor(r),{ok:t,format:e.format||o,r:mathMin$$module$node_modules$tinycolor2$tinycolor(255,mathMax$$module$node_modules$tinycolor2$tinycolor(n.r,0)),g:mathMin$$module$node_modules$tinycolor2$tinycolor(255,mathMax$$module$node_modules$tinycolor2$tinycolor(n.g,0)),b:mathMin$$module$node_modules$tinycolor2$tinycolor(255,mathMax$$module$node_modules$tinycolor2$tinycolor(n.b,0)),a:r}}function rgbToRgb$$module$node_modules$tinycolor2$tinycolor(e,t,n){return{r:255*bound01$$module$node_modules$tinycolor2$tinycolor(e,255),g:255*bound01$$module$node_modules$tinycolor2$tinycolor(t,255),b:255*bound01$$module$node_modules$tinycolor2$tinycolor(n,255)}}function rgbToHsl$$module$node_modules$tinycolor2$tinycolor(e,t,n){e=bound01$$module$node_modules$tinycolor2$tinycolor(e,255),t=bound01$$module$node_modules$tinycolor2$tinycolor(t,255),n=bound01$$module$node_modules$tinycolor2$tinycolor(n,255);var r=mathMax$$module$node_modules$tinycolor2$tinycolor(e,t,n),o=mathMin$$module$node_modules$tinycolor2$tinycolor(e,t,n),a=(r+o)/2;if(r==o)var i=o=0;else{var s=r-o;switch(o=.5<a?s/(2-r-o):s/(r+o),r){case e:i=(t-n)/s+(t<n?6:0);break;case t:i=(n-e)/s+2;break;case n:i=(e-t)/s+4}i/=6}return{h:i,s:o,l:a}}function hslToRgb$$module$node_modules$tinycolor2$tinycolor(e,t,n){function r(e,t,n){return 0>n&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=bound01$$module$node_modules$tinycolor2$tinycolor(e,360),t=bound01$$module$node_modules$tinycolor2$tinycolor(t,100),n=bound01$$module$node_modules$tinycolor2$tinycolor(n,100),0===t)n=t=e=n;else{var o=.5>n?n*(1+t):n+t-n*t,a=2*n-o;n=r(a,o,e+1/3),t=r(a,o,e),e=r(a,o,e-1/3)}return{r:255*n,g:255*t,b:255*e}}function rgbToHsv$$module$node_modules$tinycolor2$tinycolor(e,t,n){e=bound01$$module$node_modules$tinycolor2$tinycolor(e,255),t=bound01$$module$node_modules$tinycolor2$tinycolor(t,255),n=bound01$$module$node_modules$tinycolor2$tinycolor(n,255);var r=mathMax$$module$node_modules$tinycolor2$tinycolor(e,t,n),o=mathMin$$module$node_modules$tinycolor2$tinycolor(e,t,n),a=r-o;if(r==o)var i=0;else{switch(r){case e:i=(t-n)/a+(t<n?6:0);break;case t:i=(n-e)/a+2;break;case n:i=(e-t)/a+4}i/=6}return{h:i,s:0===r?0:a/r,v:r}}function hsvToRgb$$module$node_modules$tinycolor2$tinycolor(e,t,n){e=6*bound01$$module$node_modules$tinycolor2$tinycolor(e,360),t=bound01$$module$node_modules$tinycolor2$tinycolor(t,100),n=bound01$$module$node_modules$tinycolor2$tinycolor(n,100);var r=Math$$module$node_modules$tinycolor2$tinycolor.floor(e),o=e-r,a=n*(1-o*t);return{r:255*[n,a,e=n*(1-t),e,t=n*(1-(1-o)*t),n][r%=6],g:255*[t,n,n,a,e,e][r],b:255*[e,e,t,n,n,a][r]}}function rgbToHex$$module$node_modules$tinycolor2$tinycolor(e,t,n,r){return e=[pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(e).toString(16)),pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(t).toString(16)),pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(n).toString(16))],r&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function rgbaToHex$$module$node_modules$tinycolor2$tinycolor(e,t,n,r,o){return e=[pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(e).toString(16)),pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(t).toString(16)),pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(n).toString(16)),pad2$$module$node_modules$tinycolor2$tinycolor(convertDecimalToHex$$module$node_modules$tinycolor2$tinycolor(r))],o&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)&&e[3].charAt(0)==e[3].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0)+e[3].charAt(0):e.join("")}function rgbaToArgbHex$$module$node_modules$tinycolor2$tinycolor(e,t,n,r){return[pad2$$module$node_modules$tinycolor2$tinycolor(convertDecimalToHex$$module$node_modules$tinycolor2$tinycolor(r)),pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(e).toString(16)),pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(t).toString(16)),pad2$$module$node_modules$tinycolor2$tinycolor(mathRound$$module$node_modules$tinycolor2$tinycolor(n).toString(16))].join("")}function desaturate$$module$node_modules$tinycolor2$tinycolor(e,t){return t=0===t?0:t||10,(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl()).s-=t/100,e.s=clamp01$$module$node_modules$tinycolor2$tinycolor(e.s),(0,module$node_modules$tinycolor2$tinycolor.default)(e)}function saturate$$module$node_modules$tinycolor2$tinycolor(e,t){return t=0===t?0:t||10,(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl()).s+=t/100,e.s=clamp01$$module$node_modules$tinycolor2$tinycolor(e.s),(0,module$node_modules$tinycolor2$tinycolor.default)(e)}function greyscale$$module$node_modules$tinycolor2$tinycolor(e){return(0,module$node_modules$tinycolor2$tinycolor.default)(e).desaturate(100)}function lighten$$module$node_modules$tinycolor2$tinycolor(e,t){return t=0===t?0:t||10,(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl()).l+=t/100,e.l=clamp01$$module$node_modules$tinycolor2$tinycolor(e.l),(0,module$node_modules$tinycolor2$tinycolor.default)(e)}function brighten$$module$node_modules$tinycolor2$tinycolor(e,t){return t=0===t?0:t||10,(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toRgb()).r=mathMax$$module$node_modules$tinycolor2$tinycolor(0,mathMin$$module$node_modules$tinycolor2$tinycolor(255,e.r-mathRound$$module$node_modules$tinycolor2$tinycolor(-t/100*255))),e.g=mathMax$$module$node_modules$tinycolor2$tinycolor(0,mathMin$$module$node_modules$tinycolor2$tinycolor(255,e.g-mathRound$$module$node_modules$tinycolor2$tinycolor(-t/100*255))),e.b=mathMax$$module$node_modules$tinycolor2$tinycolor(0,mathMin$$module$node_modules$tinycolor2$tinycolor(255,e.b-mathRound$$module$node_modules$tinycolor2$tinycolor(-t/100*255))),(0,module$node_modules$tinycolor2$tinycolor.default)(e)}function darken$$module$node_modules$tinycolor2$tinycolor(e,t){return t=0===t?0:t||10,(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl()).l-=t/100,e.l=clamp01$$module$node_modules$tinycolor2$tinycolor(e.l),(0,module$node_modules$tinycolor2$tinycolor.default)(e)}function spin$$module$node_modules$tinycolor2$tinycolor(e,t){return(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl()).h=0>(t=(e.h+t)%360)?360+t:t,(0,module$node_modules$tinycolor2$tinycolor.default)(e)}function complement$$module$node_modules$tinycolor2$tinycolor(e){return(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl()).h=(e.h+180)%360,(0,module$node_modules$tinycolor2$tinycolor.default)(e)}function triad$$module$node_modules$tinycolor2$tinycolor(e){var t=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl(),n=t.h;return[(0,module$node_modules$tinycolor2$tinycolor.default)(e),(0,module$node_modules$tinycolor2$tinycolor.default)({h:(n+120)%360,s:t.s,l:t.l}),(0,module$node_modules$tinycolor2$tinycolor.default)({h:(n+240)%360,s:t.s,l:t.l})]}function tetrad$$module$node_modules$tinycolor2$tinycolor(e){var t=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl(),n=t.h;return[(0,module$node_modules$tinycolor2$tinycolor.default)(e),(0,module$node_modules$tinycolor2$tinycolor.default)({h:(n+90)%360,s:t.s,l:t.l}),(0,module$node_modules$tinycolor2$tinycolor.default)({h:(n+180)%360,s:t.s,l:t.l}),(0,module$node_modules$tinycolor2$tinycolor.default)({h:(n+270)%360,s:t.s,l:t.l})]}function splitcomplement$$module$node_modules$tinycolor2$tinycolor(e){var t=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl(),n=t.h;return[(0,module$node_modules$tinycolor2$tinycolor.default)(e),(0,module$node_modules$tinycolor2$tinycolor.default)({h:(n+72)%360,s:t.s,l:t.l}),(0,module$node_modules$tinycolor2$tinycolor.default)({h:(n+216)%360,s:t.s,l:t.l})]}function analogous$$module$node_modules$tinycolor2$tinycolor(e,t,n){t=t||6,n=n||30;var r=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsl();for(n=360/n,e=[(0,module$node_modules$tinycolor2$tinycolor.default)(e)],r.h=(r.h-(n*t>>1)+720)%360;--t;)r.h=(r.h+n)%360,e.push((0,module$node_modules$tinycolor2$tinycolor.default)(r));return e}function monochromatic$$module$node_modules$tinycolor2$tinycolor(e,t){t=t||6;var n=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toHsv();e=n.h;var r=n.s;n=n.v;for(var o=[],a=1/t;t--;)o.push((0,module$node_modules$tinycolor2$tinycolor.default)({h:e,s:r,v:n})),n=(n+a)%1;return o}module$node_modules$tinycolor2$tinycolor.default.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e=this.toRgb(),t=e.r/255,n=e.g/255;return e=e.b/255,.2126*(t=.03928>=t?t/12.92:Math$$module$node_modules$tinycolor2$tinycolor.pow((t+.055)/1.055,2.4))+.7152*(n=.03928>=n?n/12.92:Math$$module$node_modules$tinycolor2$tinycolor.pow((n+.055)/1.055,2.4))+.0722*(.03928>=e?e/12.92:Math$$module$node_modules$tinycolor2$tinycolor.pow((e+.055)/1.055,2.4))},setAlpha:function(e){return this._a=boundAlpha$$module$node_modules$tinycolor2$tinycolor(e),this._roundA=mathRound$$module$node_modules$tinycolor2$tinycolor(100*this._a)/100,this},toHsv:function(){var e=rgbToHsv$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=rgbToHsv$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b),t=mathRound$$module$node_modules$tinycolor2$tinycolor(360*e.h),n=mathRound$$module$node_modules$tinycolor2$tinycolor(100*e.s);return e=mathRound$$module$node_modules$tinycolor2$tinycolor(100*e.v),1==this._a?"hsv("+t+", "+n+"%, "+e+"%)":"hsva("+t+", "+n+"%, "+e+"%, "+this._roundA+")"},toHsl:function(){var e=rgbToHsl$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=rgbToHsl$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b),t=mathRound$$module$node_modules$tinycolor2$tinycolor(360*e.h),n=mathRound$$module$node_modules$tinycolor2$tinycolor(100*e.s);return e=mathRound$$module$node_modules$tinycolor2$tinycolor(100*e.l),1==this._a?"hsl("+t+", "+n+"%, "+e+"%)":"hsla("+t+", "+n+"%, "+e+"%, "+this._roundA+")"},toHex:function(e){return rgbToHex$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return rgbaToHex$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:mathRound$$module$node_modules$tinycolor2$tinycolor(this._r),g:mathRound$$module$node_modules$tinycolor2$tinycolor(this._g),b:mathRound$$module$node_modules$tinycolor2$tinycolor(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+mathRound$$module$node_modules$tinycolor2$tinycolor(this._r)+", "+mathRound$$module$node_modules$tinycolor2$tinycolor(this._g)+", "+mathRound$$module$node_modules$tinycolor2$tinycolor(this._b)+")":"rgba("+mathRound$$module$node_modules$tinycolor2$tinycolor(this._r)+", "+mathRound$$module$node_modules$tinycolor2$tinycolor(this._g)+", "+mathRound$$module$node_modules$tinycolor2$tinycolor(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._r,255))+"%",g:mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._g,255))+"%",b:mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._r,255))+"%, "+mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._g,255))+"%, "+mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._b,255))+"%)":"rgba("+mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._r,255))+"%, "+mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._g,255))+"%, "+mathRound$$module$node_modules$tinycolor2$tinycolor(100*bound01$$module$node_modules$tinycolor2$tinycolor(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(1>this._a)&&(hexNames$$module$node_modules$tinycolor2$tinycolor[rgbToHex$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+rgbaToArgbHex$$module$node_modules$tinycolor2$tinycolor(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";return e&&(n="#"+rgbaToArgbHex$$module$node_modules$tinycolor2$tinycolor((e=(0,module$node_modules$tinycolor2$tinycolor.default)(e))._r,e._g,e._b,e._a)),"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1;return t||!(1>this._a&&0<=this._a)||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return(0,module$node_modules$tinycolor2$tinycolor.default)(this.toString())},_applyModification:function(e,t){return e=e.apply(null,[this].concat([].slice.call(t))),this._r=e._r,this._g=e._g,this._b=e._b,this.setAlpha(e._a),this},lighten:function(){return this._applyModification(lighten$$module$node_modules$tinycolor2$tinycolor,arguments)},brighten:function(){return this._applyModification(brighten$$module$node_modules$tinycolor2$tinycolor,arguments)},darken:function(){return this._applyModification(darken$$module$node_modules$tinycolor2$tinycolor,arguments)},desaturate:function(){return this._applyModification(desaturate$$module$node_modules$tinycolor2$tinycolor,arguments)},saturate:function(){return this._applyModification(saturate$$module$node_modules$tinycolor2$tinycolor,arguments)},greyscale:function(){return this._applyModification(greyscale$$module$node_modules$tinycolor2$tinycolor,arguments)},spin:function(){return this._applyModification(spin$$module$node_modules$tinycolor2$tinycolor,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(analogous$$module$node_modules$tinycolor2$tinycolor,arguments)},complement:function(){return this._applyCombination(complement$$module$node_modules$tinycolor2$tinycolor,arguments)},monochromatic:function(){return this._applyCombination(monochromatic$$module$node_modules$tinycolor2$tinycolor,arguments)},splitcomplement:function(){return this._applyCombination(splitcomplement$$module$node_modules$tinycolor2$tinycolor,arguments)},triad:function(){return this._applyCombination(triad$$module$node_modules$tinycolor2$tinycolor,arguments)},tetrad:function(){return this._applyCombination(tetrad$$module$node_modules$tinycolor2$tinycolor,arguments)}},module$node_modules$tinycolor2$tinycolor.default.fromRatio=function(e,t){if("object"==typeof e){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]="a"===n?e[n]:convertToPercentage$$module$node_modules$tinycolor2$tinycolor(e[n]));e=r}return(0,module$node_modules$tinycolor2$tinycolor.default)(e,t)},module$node_modules$tinycolor2$tinycolor.default.equals=function(e,t){return!(!e||!t)&&(0,module$node_modules$tinycolor2$tinycolor.default)(e).toRgbString()==(0,module$node_modules$tinycolor2$tinycolor.default)(t).toRgbString()},module$node_modules$tinycolor2$tinycolor.default.random=function(){return module$node_modules$tinycolor2$tinycolor.default.fromRatio({r:mathRandom$$module$node_modules$tinycolor2$tinycolor(),g:mathRandom$$module$node_modules$tinycolor2$tinycolor(),b:mathRandom$$module$node_modules$tinycolor2$tinycolor()})},module$node_modules$tinycolor2$tinycolor.default.mix=function(e,t,n){return n=0===n?0:n||50,e=(0,module$node_modules$tinycolor2$tinycolor.default)(e).toRgb(),t=(0,module$node_modules$tinycolor2$tinycolor.default)(t).toRgb(),(0,module$node_modules$tinycolor2$tinycolor.default)({r:(t.r-e.r)*(n/=100)+e.r,g:(t.g-e.g)*n+e.g,b:(t.b-e.b)*n+e.b,a:(t.a-e.a)*n+e.a})},module$node_modules$tinycolor2$tinycolor.default.readability=function(e,t){return e=(0,module$node_modules$tinycolor2$tinycolor.default)(e),t=(0,module$node_modules$tinycolor2$tinycolor.default)(t),(Math$$module$node_modules$tinycolor2$tinycolor.max(e.getLuminance(),t.getLuminance())+.05)/(Math$$module$node_modules$tinycolor2$tinycolor.min(e.getLuminance(),t.getLuminance())+.05)},module$node_modules$tinycolor2$tinycolor.default.isReadable=function(e,t,n){switch(e=module$node_modules$tinycolor2$tinycolor.default.readability(e,t),t=!1,(n=validateWCAG2Parms$$module$node_modules$tinycolor2$tinycolor(n)).level+n.size){case"AAsmall":case"AAAlarge":t=4.5<=e;break;case"AAlarge":t=3<=e;break;case"AAAsmall":t=7<=e}return t},module$node_modules$tinycolor2$tinycolor.default.mostReadable=function(e,t,n){for(var r=null,o=0,a=(n=n||{}).includeFallbackColors,i=n.level,s=n.size,l=0;l<t.length;l++){var u=module$node_modules$tinycolor2$tinycolor.default.readability(e,t[l]);u>o&&(o=u,r=(0,module$node_modules$tinycolor2$tinycolor.default)(t[l]))}return module$node_modules$tinycolor2$tinycolor.default.isReadable(e,r,{level:i,size:s})||!a?r:(n.includeFallbackColors=!1,module$node_modules$tinycolor2$tinycolor.default.mostReadable(e,["#fff","#000"],n))};var names$$module$node_modules$tinycolor2$tinycolor=module$node_modules$tinycolor2$tinycolor.default.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames$$module$node_modules$tinycolor2$tinycolor=module$node_modules$tinycolor2$tinycolor.default.hexNames=flip$$module$node_modules$tinycolor2$tinycolor(names$$module$node_modules$tinycolor2$tinycolor);function flip$$module$node_modules$tinycolor2$tinycolor(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[e[t]]=t);return n}function boundAlpha$$module$node_modules$tinycolor2$tinycolor(e){return e=parseFloat(e),(isNaN(e)||0>e||1<e)&&(e=1),e}function bound01$$module$node_modules$tinycolor2$tinycolor(e,t){isOnePointZero$$module$node_modules$tinycolor2$tinycolor(e)&&(e="100%");var n=isPercentage$$module$node_modules$tinycolor2$tinycolor(e);return e=mathMin$$module$node_modules$tinycolor2$tinycolor(t,mathMax$$module$node_modules$tinycolor2$tinycolor(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),1e-6>Math$$module$node_modules$tinycolor2$tinycolor.abs(e-t)?1:e%t/parseFloat(t)}function clamp01$$module$node_modules$tinycolor2$tinycolor(e){return mathMin$$module$node_modules$tinycolor2$tinycolor(1,mathMax$$module$node_modules$tinycolor2$tinycolor(0,e))}function parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(e){return parseInt(e,16)}function isOnePointZero$$module$node_modules$tinycolor2$tinycolor(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function isPercentage$$module$node_modules$tinycolor2$tinycolor(e){return"string"==typeof e&&-1!=e.indexOf("%")}function pad2$$module$node_modules$tinycolor2$tinycolor(e){return 1==e.length?"0"+e:""+e}function convertToPercentage$$module$node_modules$tinycolor2$tinycolor(e){return 1>=e&&(e=100*e+"%"),e}function convertDecimalToHex$$module$node_modules$tinycolor2$tinycolor(e){return Math$$module$node_modules$tinycolor2$tinycolor.round(255*parseFloat(e)).toString(16)}function convertHexToDecimal$$module$node_modules$tinycolor2$tinycolor(e){return parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(e)/255}var matchers$$module$node_modules$tinycolor2$tinycolor={CSS_UNIT:/(?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?)/,rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsva:/hsva[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function isValidCSSUnit$$module$node_modules$tinycolor2$tinycolor(e){return!!matchers$$module$node_modules$tinycolor2$tinycolor.CSS_UNIT.exec(e)}function stringInputToObject$$module$node_modules$tinycolor2$tinycolor(e){e=e.replace(trimLeft$$module$node_modules$tinycolor2$tinycolor,"").replace(trimRight$$module$node_modules$tinycolor2$tinycolor,"").toLowerCase();var t,n=!1;if(names$$module$node_modules$tinycolor2$tinycolor[e])e=names$$module$node_modules$tinycolor2$tinycolor[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};return(t=matchers$$module$node_modules$tinycolor2$tinycolor.rgb.exec(e))?{r:t[1],g:t[2],b:t[3]}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.rgba.exec(e))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.hsl.exec(e))?{h:t[1],s:t[2],l:t[3]}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.hsla.exec(e))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.hsv.exec(e))?{h:t[1],s:t[2],v:t[3]}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.hsva.exec(e))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.hex8.exec(e))?{r:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[1]),g:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[2]),b:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[3]),a:convertHexToDecimal$$module$node_modules$tinycolor2$tinycolor(t[4]),format:n?"name":"hex8"}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.hex6.exec(e))?{r:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[1]),g:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[2]),b:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[3]),format:n?"name":"hex"}:(t=matchers$$module$node_modules$tinycolor2$tinycolor.hex4.exec(e))?{r:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[1]+""+t[1]),g:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[2]+""+t[2]),b:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[3]+""+t[3]),a:convertHexToDecimal$$module$node_modules$tinycolor2$tinycolor(t[4]+""+t[4]),format:n?"name":"hex8"}:!!(t=matchers$$module$node_modules$tinycolor2$tinycolor.hex3.exec(e))&&{r:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[1]+""+t[1]),g:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[2]+""+t[2]),b:parseIntFromHex$$module$node_modules$tinycolor2$tinycolor(t[3]+""+t[3]),format:n?"name":"hex"}}function validateWCAG2Parms$$module$node_modules$tinycolor2$tinycolor(e){var t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase();return"AA"!==t&&"AAA"!==t&&(t="AA"),"small"!==(e=(e.size||"small").toLowerCase())&&"large"!==e&&(e="small"),{level:t,size:e}}var module$src$externals$three={};try{module$src$externals$three.default=eval("THREE")}catch(a){"function"==typeof require&&(module$src$externals$three.default=eval("require('three')"))}var module$src$polyfills$padStart={default:{}};String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))});var module$src$polyfills$padEnd={default:{}};String.prototype.padEnd||(String.prototype.padEnd=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),String(this)+t.slice(0,e))});var module$src$shared$util$toTinyColor={},tinycolor$$module$src$shared$util$toTinyColor=module$node_modules$tinycolor2$tinycolor.default;if(void 0===module$node_modules$tinycolor2$tinycolor.default.prototype.toThreeColor){var THREE$$module$src$shared$util$toTinyColor=module$src$externals$three.default;module$node_modules$tinycolor2$tinycolor.default.prototype.toThreeColor=function(){return new module$src$externals$three.default.Color(this.toRgbString())},module$node_modules$tinycolor2$tinycolor.default.prototype.toArray=function(){return[this._r,this._g,this._b,255*this._a]}}module$src$shared$util$toTinyColor.default=function(e,t){if(e.hasOwnProperty("getOriginalInput"))return e;var n=null;if(t&&(n=(0,module$node_modules$tinycolor2$tinycolor.default)(t)),"number"==typeof e)return 3>(t=(e=e.toString(16)).length)?e=e.padStart(3,0):6>t?e=e.padStart(6,0):8>t&&(e=e.padEnd(8,0)),(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e)).isValid()?e:n;if(e.isColor&&"function"==typeof e.getHexString)return(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e.getHexString())).isValid()?e:n;if(Array.isArray(e)&&(3==e.length||4==e.length)){t=!0;for(var r=0;3>r;++r)e[r]=parseFloat(e[r]),isNaN(e[r])&&(t=!1);return t?(t=(0,module$node_modules$tinycolor2$tinycolor.default)({r:Math.max(0,Math.min(e[0],255)),g:Math.max(0,Math.min(e[1],255)),b:Math.max(0,Math.min(e[2],255))}),4==e.length&&(e=parseFloat(e[3]),isNaN(e)||t.setAlpha(Math.max(0,Math.min(e,255))/255)),t.isValid()?t:n):n}return"string"!=typeof e?(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e)).isValid()?e:n:null!==(e=e.replace("0x","#")).match(/^#[a-f0-9]{6}$/i)?(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e+"ff")).isValid()?e:n:null!==e.match(/^#[a-f0-9]{8}$/i)?(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e)).isValid()?e:n:null!==e.match(/^#[a-f0-9]{7}$/i)?(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e.slice(0,7)+"0"+e.slice(-1))).isValid()?e:n:(e=(0,module$node_modules$tinycolor2$tinycolor.default)(e)).isValid()?e:n};var module$src$shared$util$atobtoa={default:{}};module$src$shared$util$atobtoa.default.btoaUTF8=function(e,t){return originalBtoa$$module$src$shared$util$atobtoa((t?"ï»¿":"")+e.replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,btoaReplacer$$module$src$shared$util$atobtoa))},module$src$shared$util$atobtoa.default.atobUTF8=function(e,t){return t||"ï»¿"!==e.substring(0,3)||(e=e.substring(3)),originalAtob$$module$src$shared$util$atobtoa(e).replace(/[\xc0-\xff][\x80-\xbf]*/g,atobReplacer$$module$src$shared$util$atobtoa)};var log$$module$src$shared$util$atobtoa=Math.log,LN2$$module$src$shared$util$atobtoa=Math.LN2,clz32$$module$src$shared$util$atobtoa=Math.clz32||function(e){return 31-log$$module$src$shared$util$atobtoa(e>>>0)/LN2$$module$src$shared$util$atobtoa|0},fromCharCode$$module$src$shared$util$atobtoa=String.fromCharCode,originalAtob$$module$src$shared$util$atobtoa=atob,originalBtoa$$module$src$shared$util$atobtoa=btoa;function btoaReplacer$$module$src$shared$util$atobtoa(e){var t=e.charCodeAt(0);if(55296<=t&&56319>=t){var n=e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return fromCharCode$$module$src$shared$util$atobtoa(239,191,189);if(65535<(t=1024*(t-55296)+n-56320+65536))return fromCharCode$$module$src$shared$util$atobtoa(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?fromCharCode$$module$src$shared$util$atobtoa(192|t>>>6,128|63&t):fromCharCode$$module$src$shared$util$atobtoa(224|t>>>12,128|t>>>6&63,128|63&t)}function atobReplacer$$module$src$shared$util$atobtoa(e){var t=e.charCodeAt(0)<<24,n=clz32$$module$src$shared$util$atobtoa(~t),r=0,o=e.length,a="";if(5>n&&o>=n){for(t=t<<n>>>24+n,r=1;r<n;++r)t=t<<6|63&e.charCodeAt(r);65535>=t?a+=fromCharCode$$module$src$shared$util$atobtoa(t):1114111>=t?a+=fromCharCode$$module$src$shared$util$atobtoa(55296+((t-=65536)>>10),56320+(1023&t)):r=0}for(;r<o;++r)a+="�";return a}var module$src$shared$util$GlobalUtils={},TOTINYCOLOR$$module$src$shared$util$GlobalUtils=module$src$shared$util$toTinyColor.default,THREE$$module$src$shared$util$GlobalUtils=module$src$externals$three.default,ATOBTOA$$module$src$shared$util$GlobalUtils=module$src$shared$util$atobtoa.default,GlobalUtils$$module$src$shared$util$GlobalUtils=function(){var e=this,t="undefined"!=typeof window&&window.navigator&&-1<window.navigator.userAgent.indexOf("Trident"),n=t||"undefined"!=typeof document&&"function"==typeof document.getElementById&&window&&"function"==typeof window.Event,r=!1,o=n?(r=parent!==window)?document.referrer:window.location.origin:"direct";return this.runningInIE=function(){return t},this.runningInBrowser=function(){return n},this.runningInIframe=function(){return r},this.embeddingOrigin=function(){return o+""},this.getNodeAttribute=function(e,t,r){return n&&e&&!Array.isArray(e)&&"function"==typeof e.hasAttribute&&e.hasAttribute(t)?e.getAttribute(t):r},this.getBooleanNodeAttribute=function(e,t,r){return n&&e&&!Array.isArray(e)&&"function"==typeof e.hasAttribute&&e.hasAttribute(t)?this.toBoolean(e.getAttribute(t),r):r},this.parseQueryString=function(e,t){t=void 0!==t&&t,e=e.split("&");for(var n={},r=0;r<e.length;r++){var o=e[r].split("="),a=decodeURIComponent(o[0]);o=decodeURIComponent(o[1]),void 0===n[a]?n[a]=o:t&&("string"==typeof n[a]?n[a]=[n[a],o]:n[a].push(o))}return n},this.guessMimeTypeFromFilename=function(e){var t="";return(e=e.toLowerCase()).endsWith(".dxf")?t="application/dxf":e.endsWith(".obj")?t="application/wavefront-obj":e.endsWith(".csv")&&(t="text/csv"),t},this.storageAvailable=function(e){try{var t=window[e];return t.setItem("__storage_test__","__storage_test__"),t.removeItem("__storage_test__"),!0}catch(n){return n instanceof DOMException&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&0!==t.length}},this.isArrayOfType=function(e,t){return!!Array.isArray(e)&&-1===e.findIndex((function(e){return typeof e!==t}))},this.deepCopyReplacer=function(e,t){return"number"==typeof t&&isNaN(t)?"___NaN___":t===Number.POSITIVE_INFINITY?"___PosInfinity___":t===Number.NEGATIVE_INFINITY?"___NegInfinity___":t},this.deepCopyReviver=function(e,t){if("string"==typeof t){if("___NaN___"===t)return Number.NaN;if("___PosInfinity___"===t)return Number.POSITIVE_INFINITY;if("___NegInfinity___"===t)return Number.NEGATIVE_INFINITY}return t},this.deepCopy=function(t,n){if(void 0!==t){if(n){Array.isArray(n)||(n=[n]);var r=[];if(e.getPaths(t,r,"",n)||0===r.length)return e.deepCopy(t);for(var o={},a={},i=(r=$jscomp.makeIterator(r)).next();!i.done;a={p:a.p},i=r.next()){if(a.p=i.value,i=e.getAtPath(t,a.p),n.every(function(e){return function(t){return e.p!==t&&!e.p.endsWith("."+t)}}(a)))if(Array.isArray(i)){var s=i;i=[];for(var l=(s=$jscomp.makeIterator(s)).next();!l.done;l=s.next())i.push(e.deepCopy(l.value,n))}else i=e.deepCopy(i);e.forceAtPath(o,a.p,i)}return o}return JSON.parse(JSON.stringify(t,e.deepCopyReplacer),e.deepCopyReviver)}},this.setIfUndefined=function(e,t){return void 0===e?t:e},this.inject=function(e,t,n){return void 0===n&&(n=!0),Object.keys(e).forEach((function(r){!n&&t.hasOwnProperty(r)||(t[r]=e[r])})),t},this.defineHiddenProperty=function(e,t){Object.defineProperty(this,e,{enumerable:!1,configurable:!1,writable:!0,value:t})},this.defineConstantProperty=function(e,t){Object.defineProperty(this,e,{enumerable:!0,configurable:!1,writable:!1,value:t})},this.stringChecksum=function(e){var t,n=0,r=e.length;if(0===r)return n;for(t=0;t<r;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n},this.toNumber=function(e,t){return e=Number(e),Number.isNaN(e)&&(e=t),e},this.toBoolean=function(e,t){return"boolean"!=typeof t&&(t=!1),"boolean"==typeof e?e:"string"==typeof e?(e=e.toLowerCase(),t?"false"!==e&&"0"!==e:"true"===e||"1"===e):!!e},this.createRandomId=function(){return Math.random().toString(36).substring(2,15)},this.getAt=function(e,t){return t.reduce((function(e,t){return e&&void 0!==e[t]?e[t]:void 0}),e)},this.getAtPath=function(t,n){return n=n.replace(/\]$/,"").split(/[.[\]]+/),e.getAt(t,n)},this.setAt=function(e,t,n,r){var o=t.pop();if("string"==typeof o&&(0<t.length&&(e=t.reduce((function(e,t){return e&&void 0!==e[t]?e[t]:void 0}),e)),e&&(void 0!==e[o]||r)))return e[o]=n},this.setAtPath=function(t,n,r,o){return n=n.replace(/\]$/,"").split(/[.[\]]+/),e.setAt(t,n,r,o)},this.forceAt=function(e,t,n){if(void 0!==e&&"object"==typeof e){var r=t.pop();if("string"==typeof r)return 0<t.length&&(e=t.reduce((function(e,t){return e&&void 0!==e[t]&&"object"==typeof e[t]?e[t]:e[t]={}}),e)),e[r]=n}},this.forceAtPath=function(t,n,r){return n=n.replace(/\]$/,"").split(/[.[\]]+/),e.forceAt(t,n,r)},this.deleteAt=function(e,t){var n=t.pop();if("string"==typeof n&&(0<t.length&&(e=t.reduce((function(e,t){return e&&void 0!==e[t]?e[t]:void 0}),e)),e))return t=e[n],delete e[n],t},this.deleteAtPath=function(t,n){return n=n.replace(/\]$/,"").split(/[.[\]]+/),e.deleteAt(t,n)},this.getPaths=function(t,n,r,o,a){if(Array.isArray(n)||(n=[]),"string"!=typeof r&&(r=""),Array.isArray(o)||(o=[]),"boolean"!=typeof a&&(a=!1),null==t||"object"!=typeof t||Array.isArray(t))return!0;if(a){var i=[];for(var s in t)i.push(s)}else i=Object.keys(t);return 0===i.length||(i.forEach((function(i){var s=0===r.length?i:r+"."+i;o.includes(i)?n.push(s):e.getPaths(t[i],n,s,o,a)&&n.push(s)})),!1)},this.defaults=function(t,n,r){if(Array.isArray(n))return n.reduce((function(t,n){return e.defaults(t,n,r)}),t);for(var o in n)t.hasOwnProperty(o)?Array.isArray(t[o])||"object"!=typeof t[o]||"object"!=typeof n[o]?r&&(t[o]=e.deepCopy(n[o])):e.defaults(t[o],n[o],r):t[o]=e.deepCopy(n[o]);return t},this.cartesianToPolar=function(e,t,n){var r=Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2));return[r,Math.acos(n/r),Math.atan2(t,e)]},this.polarToCartesian=function(e,t,n){return[e*Math.sin(t)*Math.cos(n),e*Math.sin(t)*Math.sin(n),e*Math.cos(t)]},this.check={string:function(e){return"string"==typeof e||e instanceof String},number:function(e){return("number"==typeof e||e instanceof Number)&&!isNaN(e)},float:function(e){return("number"==typeof e||e instanceof Number)&&!isNaN(e)},notnegative:function(e){return("number"==typeof e||e instanceof Number)&&0<=e},notpositive:function(e){return("number"==typeof e||e instanceof Number)&&0>=e},negative:function(e){return("number"==typeof e||e instanceof Number)&&0>e},positive:function(e){return("number"==typeof e||e instanceof Number)&&0<e},factor:function(e){return("number"==typeof e||e instanceof Number)&&0<=e&&1>=e},color:function(e){return null!==(0,module$src$shared$util$toTinyColor.default)(e)},integer:function(e){return("number"==typeof e||e instanceof Number)&&!isNaN(e)&&e===parseInt(e,10)},boolean:function(e){return"boolean"==typeof e||e instanceof Boolean},object:function(e){return void 0!==e&&"object"==typeof e},function:function(e){return void 0!==e&&"function"==typeof e},hexadecimal:function(t){if(e.typeCheck(t,"string")){t=t.replace("#","");var n=parseInt(t,16);return!(!t.endsWith(n.toString(16))||0>n||16777215<n)}return!!e.typeCheck(t,"number")&&!(0>t||16777215<t)},vector2obj:function(t){return!(!t.x&&0!==t.x||!t.y&&0!==t.y||!e.typeCheck(t.x,"number")||!e.typeCheck(t.y,"number"))},vector2arr:function(t){return!!(Array.isArray(t)&&2<=t.length)&&!(!e.typeCheck(t[0],"number")||!e.typeCheck(t[1],"number"))},vector2any:function(t){return!(!e.typeCheck(t,"vector2arr")&&!e.typeCheck(t,"vector2obj"))},vector3obj:function(t){return!(!t.x&&0!==t.x||!t.y&&0!==t.y||!t.z&&0!==t.z||!(e.typeCheck(t.x,"number")&&e.typeCheck(t.y,"number")&&e.typeCheck(t.z,"number")))},vector3arr:function(t){return!!(Array.isArray(t)&&3<=t.length)&&!!(e.typeCheck(t[0],"number")&&e.typeCheck(t[1],"number")&&e.typeCheck(t[2],"number"))},vector3any:function(t){return!(!e.typeCheck(t,"vector3arr")&&!e.typeCheck(t,"vector3obj"))},matrix4x4obj:function(t){return!(!t.a&&0!==t.a||!t.b&&0!==t.b||!t.c&&0!==t.c||!t.d&&0!==t.d||!t.e&&0!==t.e||!t.f&&0!==t.f||!t.g&&0!==t.g||!t.h&&0!==t.h||!t.i&&0!==t.i||!t.j&&0!==t.j||!t.k&&0!==t.k||!t.l&&0!==t.l||!t.m&&0!==t.m||!t.n&&0!==t.n||!t.o&&0!==t.o||!t.p&&0!==t.p||!(e.typeCheck(t.a,"number")&&e.typeCheck(t.b,"number")&&e.typeCheck(t.c,"number")&&e.typeCheck(t.d,"number")&&e.typeCheck(t.e,"number")&&e.typeCheck(t.f,"number")&&e.typeCheck(t.g,"number")&&e.typeCheck(t.h,"number")&&e.typeCheck(t.i,"number")&&e.typeCheck(t.j,"number")&&e.typeCheck(t.k,"number")&&e.typeCheck(t.l,"number")&&e.typeCheck(t.m,"number")&&e.typeCheck(t.n,"number")&&e.typeCheck(t.o,"number")&&e.typeCheck(t.p,"number")))},matrix4x4arr:function(t){return!!(Array.isArray(t)&&16<=t.length)&&!!(e.typeCheck(t[0],"number")&&e.typeCheck(t[1],"number")&&e.typeCheck(t[2],"number")&&e.typeCheck(t[3],"number")&&e.typeCheck(t[4],"number")&&e.typeCheck(t[5],"number")&&e.typeCheck(t[6],"number")&&e.typeCheck(t[7],"number")&&e.typeCheck(t[8],"number")&&e.typeCheck(t[9],"number")&&e.typeCheck(t[10],"number")&&e.typeCheck(t[11],"number")&&e.typeCheck(t[12],"number")&&e.typeCheck(t[13],"number")&&e.typeCheck(t[14],"number")&&e.typeCheck(t[15],"number"))},matrix4x4any:function(t){return!(!e.typeCheck(t,"matrix4x4arr")&&!e.typeCheck(t,"matrix4x4obj"))}},this.typeCheck=function(e,t,n,r,o){for(var a=[],i=4;i<arguments.length;++i)a[i-4]=arguments[i];if(void 0===e){i="The given input is undefined.";var s=!1}else null===e?(i="The given input is null.",s=!1):(t=t.toLowerCase(),this.check[t]?i=(s=this.check[t](e))?"":"Value "+e+" is not a "+t:(i="No type check available for type "+t+". The possible types are ["+Object.getOwnPropertyNames(this.check).map((function(e){return" "+e}))+" ]. Choose one of them.",s=!1));return"function"==typeof n&&!1===s&&n.apply(null,r?[r,i].concat($jscomp.arrayFromIterable(a)):[i].concat($jscomp.arrayFromIterable(a))),s},this.waitForTimeout=function(e){return new Promise((function(t){setInterval(t,e)}))},this.toVector3=function(e){if(e.isVector3)return e;if(Array.isArray(e)&&2<=e.length){var t=new module$src$externals$three.default.Vector3;return t.fromArray(e),t}return new module$src$externals$three.default.Vector3(e.x,e.y,e.z)},this.versionStringLowerThan=function(e,t){if(e=e.split("."),t=t.split("."),e.length>t.length)for(var n=t.length;n<e.length;n++)t.push("0");else if(e.length<t.length)for(n=e.length;n<t.length;n++)e.push("0");e.reverse(),t.reverse();var r=1;return e.forEach((function(e){return r=e.length>r?e.length:r})),t.forEach((function(e){return r=e.length>r?e.length:r})),(e=e.reduce(n=function(e,t,n){return e+Math.pow(10,n*r)*t},0))<t.reduce(n,0)},this.ArrayToObject=function(e){if(!Array.isArray(e))return null;var t,n=e.length,r={};for(t=0;t<n;t++)r[""+t]=e[t];return r},this.ObjectToArray=function(e){if(null===e||"object"!=typeof e)return null;var t,n=[];for(t=0;;t++){var r=""+t;if(!e.hasOwnProperty(r))break;n.push(e[r])}return n},this.toTinyColor=module$src$shared$util$toTinyColor.default,this.atobUTF8=module$src$shared$util$atobtoa.default.atobUTF8,this.btoaUTF8=module$src$shared$util$atobtoa.default.btoaUTF8,this};module$src$shared$util$GlobalUtils.default=new GlobalUtils$$module$src$shared$util$GlobalUtils;var module$build$build_data={default:{}};module$build$build_data.default.build_version="2.14.0",module$build$build_data.default.build_date="2019-09-13T08:31:20.513Z",module$build$build_data.default.build_branch="2.14.0",module$build$build_data.default.build_commit="79c3d554e30c32f94506ca499f6a127b76fab060";var module$src$api$v2$ApiReflectorV2_1={},GLOBAL_UTILS$$module$src$api$v2$ApiReflectorV2_1=module$src$shared$util$GlobalUtils.default,FUNCTION_PREFIX$$module$src$api$v2$ApiReflectorV2_1="___fn_",INCLUDE_PROTOTYPE$$module$src$api$v2$ApiReflectorV2_1=!1;module$src$api$v2$ApiReflectorV2_1.default=function(e,t,n,r){if(t.startsWith("http://"))var o=t.substring(7),a="http://";else t.startsWith("https://")?(o=t.substring(8),a="https://"):o=null;o&&(0<=(t=o.indexOf("/"))&&(o=o.substring(0,t)),o=a+o),r=r||"sdv-iframe";var i={},s={};"boolean"!=typeof n&&(n=!1);var l=function(t){t.iframeId=r,n&&console.log("POSTING MSG",t),o&&e.postMessage(t,o)},u=function(e){if(n&&console.log("RECEIVING MSG",e),o){var t=e.origin;if(t!==o)n&&console.log("ORIGIN MISMATCH",t,o);else{var a=e.data;if(a&&"object"==typeof a&&"string"==typeof a.id&&a.iframeId===r&&a.token)if(a.restore)p(a.restore,a.id)?l({id:a.id,token:a.token,result:!0}):l({id:a.id,token:a.token,error:"Restoring object failed"});else if(i.hasOwnProperty(a.id))if(t=i[a.id],a.command){if("function"!=typeof(e=module$src$shared$util$GlobalUtils.default.getAtPath(t,a.command))&&(a.command.endsWith("Async")&&(e=module$src$shared$util$GlobalUtils.default.getAtPath(t,a.command.slice(0,-5))),"function"!=typeof e))return void(n&&console.log("Could not find function "+a.id));null===(t=Array.isArray(a.arguments)?a.arguments:null)&&"string"==typeof a.arguments_id&&i.hasOwnProperty(a.arguments_id)&&(t=module$src$shared$util$GlobalUtils.default.ObjectToArray(i[a.arguments_id])),n&&console.log("Calling function with arguments",e,t),(e=e.apply(null,t))instanceof Promise?e.then((function(e){e.err&&e.err instanceof Error?l({id:a.id,token:a.token,error:e.err.message}):l({id:a.id,token:a.token,result:e})}),(function(e){e instanceof Error?l({id:a.id,token:a.token,error:e.message}):l({id:a.id,token:a.token,error:e})})):l({id:a.id,token:a.token,result:e})}else a.hasOwnProperty("result")?s.hasOwnProperty(a.token)&&(s[a.token].resolve(a.result),delete s[a.token]):a.error&&s.hasOwnProperty(a.token)&&(s[a.token].reject({err:Error(a.error)}),delete s[a.token]);else n&&console.log("Could not find object "+a.id)}}else n&&console.log("NO TARGET ORIGIN TO CHECK AGAINST")},c=function(e,t,n){var r=[],o={};return module$src$shared$util$GlobalUtils.default.getPaths(e,r,"",[],INCLUDE_PROTOTYPE$$module$src$api$v2$ApiReflectorV2_1),n="boolean"==typeof n&&n,r.forEach((function(t){var r=module$src$shared$util$GlobalUtils.default.getAtPath(e,t);"function"==typeof r?t.endsWith("Async")||n?module$src$shared$util$GlobalUtils.default.forceAtPath(o,t,FUNCTION_PREFIX$$module$src$api$v2$ApiReflectorV2_1+t):t.endsWith("removeEventListener")||module$src$shared$util$GlobalUtils.default.forceAtPath(o,t+"Async",FUNCTION_PREFIX$$module$src$api$v2$ApiReflectorV2_1+t+"Async"):module$src$shared$util$GlobalUtils.default.forceAtPath(o,t,r)})),i[t]=e,h({id:t,restore:o})},d=function(e){var t=[];return module$src$shared$util$GlobalUtils.default.getPaths(e,t,"",[],INCLUDE_PROTOTYPE$$module$src$api$v2$ApiReflectorV2_1),!t.every((function(t){return"function"!=typeof module$src$shared$util$GlobalUtils.default.getAtPath(e,t)}))},p=function(e,t){if(i.hasOwnProperty(t))return null;var n=[],r={};return module$src$shared$util$GlobalUtils.default.getPaths(e,n,"",[],INCLUDE_PROTOTYPE$$module$src$api$v2$ApiReflectorV2_1),n.forEach((function(n){var o=module$src$shared$util$GlobalUtils.default.getAtPath(e,n);"string"==typeof o&&o.startsWith(FUNCTION_PREFIX$$module$src$api$v2$ApiReflectorV2_1)?module$src$shared$util$GlobalUtils.default.forceAtPath(r,n,m(t,n)):module$src$shared$util$GlobalUtils.default.forceAtPath(r,n,o)})),i[t]=r},h=function(e){var t=module$src$shared$util$GlobalUtils.default.createRandomId();return e.token=t,l(e),new Promise((function(e,n){s[t]={resolve:e,reject:n}}))},m=function(e,t){return function(){var n=Array.prototype.slice.call(arguments),r=module$src$shared$util$GlobalUtils.default.ArrayToObject(n);if(d(r)){console.log("argsobj needs reflection:",r);var o=module$src$shared$util$GlobalUtils.default.createRandomId();return c(r,o,!0).then((function(){return h({id:e,command:t,arguments_id:o})}))}return h({id:e,command:t,arguments:n})}};return window.addEventListener("message",u,!1),(a=function(){}).prototype.reflect=function(e,t){return c(e,t)},a.prototype.get=function(e){return i.hasOwnProperty(e)?i[e]:null},a.prototype.destroy=function(){window.removeEventListener("message",u,!1)},a.prototype.receiveMessage=function(e){u(e)},new a};var module$src$shared$constants$LoggingConstants={},loggingLevels$$module$src$shared$constants$LoggingConstants={NONE:-1,ERROR:0,WARN:1,INFO:2,DEBUG:3,LVLBITS:3,LOG_TO_SERVER:8,ERROR_S:8,WARN_S:9,INFO_S:10,DEBUG_S:11},defaultSettings$$module$src$shared$constants$LoggingConstants={loggingLevel:loggingLevels$$module$src$shared$constants$LoggingConstants.NONE},loggingConstants$$module$src$shared$constants$LoggingConstants={loggingLevels:loggingLevels$$module$src$shared$constants$LoggingConstants,defaultSettings:defaultSettings$$module$src$shared$constants$LoggingConstants},GlobalUtils$$module$src$shared$constants$LoggingConstants=module$src$shared$util$GlobalUtils.default;module$src$shared$constants$LoggingConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(loggingConstants$$module$src$shared$constants$LoggingConstants);var module$src$shared$constants$MessagingConstants={},GlobalUtils$$module$src$shared$constants$MessagingConstants=module$src$shared$util$GlobalUtils.default,messageTopics$$module$src$shared$constants$MessagingConstants={AR:"ar",DATA:"data",EXPORT:"export",EXPORT_AVAILABLE:"export.available",EXPORT_REGISTER:"export.register",EXPORT_REGISTERED:"export.registered",EXPORT_UPDATE:"export.update",EXPORT_STATUS:"export.status",PARAMETER:"parameter",PARAMETER_REGISTER:"parameter.register",PARAMETER_REGISTERED:"parameter.registered",PARAMETER_UPDATE:"parameter.update",PARAMETER_VALUE_UPDATE:"parameter.value.update",PLUGIN:"plugin",PLUGIN_ACTIVE:"plugin.active",PLUGIN_FAILED:"plugin.failed",PLUGIN_LOADED:"plugin.loaded",PLUGIN_REGISTERED:"plugin.registered",PLUGIN_UNLOADED:"plugin.unloaded",PROCESS:"process",SETTINGS:"settings",SETTINGS_REGISTER:"settings.register",SETTINGS_UPDATE:"settings.update",SETTINGS_REGISTERED:"settings.registered",SCENE:"scene",SCENE_ANCHOR:"scene.anchor",SCENE_ANCHOR_ADD:"scene.anchor.add",SCENE_ANCHOR_REMOVE:"scene.anchor.remove",SCENE_DRAG:"scene.drag",SCENE_DRAG_START:"scene.drag.start",SCENE_DRAG_MOVE:"scene.drag.move",SCENE_DRAG_END:"scene.drag.end",SCENE_HOVER:"scene.hover",SCENE_HOVER_ON:"scene.hover.on",SCENE_HOVER_OVER:"scene.hover.over",SCENE_HOVER_OFF:"scene.hover.off",SCENE_RENDER:"scene.render",SCENE_RENDER_BEAUTY:"scene.render.beauty",SCENE_RENDER_BEAUTY_START:"scene.render.beauty.start",SCENE_RENDER_BEAUTY_CANCEL:"scene.render.beauty.cancel",SCENE_RENDER_BEAUTY_END:"scene.render.beauty.end",SCENE_SELECT:"scene.select",SCENE_SELECT_ON:"scene.select.on",SCENE_SELECT_OFF:"scene.select.off",SCENE_SUBSCENE:"scene.subscene",SCENE_SUBSCENE_INIT:"scene.subscene.init",SCENE_SUBSCENE_OUTPUTVERSION:"scene.subscene.outputversion",SCENE_SUBSCENE_READY:"scene.subscene.ready",SCENE_SUBSCENE_PUBLISHED:"scene.subscene.published",SCENE_VISIBILITY:"scene.visibility",SCENE_VISIBILITY_ON:"scene.visibility.on",SCENE_VISIBILITY_OFF:"scene.visibility.off",STATUS:"status",STATUS_BUSY:"status.busy",STATUS_IDLE:"status.idle",STATUS_MESSAGE:"status.message",STATUS_FAILED:"status.failed"},messageDataTypes$$module$src$shared$constants$MessagingConstants={GENERIC:"generic",ANCHOR_CREATE_IMAGE:"anchor.create.image",ANCHOR_UPDATE:"anchor.update",APP_SETTINGS:"app.settings",APP_STATUS:"app.status",DATA:"data",EXPORT_DEFINITION:"export.definition",EXPORT_RESULT:"export.result",EXPORT_STATUS:"export.status",PARAMETER_DEFINITION:"parameter.definition",PARAMETER_UPDATE:"parameter.update",PLUGIN_RUNTIME_ID:"plugin.runtimeId",PROCESS_ERROR:"process.error",PROCESS_ABORT:"process.abort",PROCESS_FORK:"process.fork",PROCESS_STATUS:"process.status",PROCESS_SUCCESS:"process.success",STATUS_TRACKING:"status.tracking",STATUS_MAPPING:"status.mapping",SCENE_INTERACTION:"scene.interaction",SCENE_ANCHORDATA:"scene.anchordata",SETTINGS_UPDATE:"settings.update",SUBSCENE_UPDATE:"subscene.update",SUBSCENE_OUTPUTVERSION_JSON:"subscene.outputversion.json",SUBSCENE_OUTPUTVERSION_OBJ:"subscene.outputversion.obj",SUBSCENE_INIT:"subscene.init",STATUS_MESSAGE:"status.message"},makeMessageToken$$module$src$shared$constants$MessagingConstants=function(e,t){var n={};return"string"==typeof e?n.id=e+"":null!==e&&"object"==typeof e&&("string"==typeof e.id&&(n.id=e.id+""),"string"==typeof e.creator&&(n.creator=e.creator+""),"number"==typeof e.serial&&(n.serial=e.serial+""),n.payload=e.payload,n.attributes=e.attributes),"string"==typeof n.id&&0!==n.id.length||(n.id=module$src$shared$util$GlobalUtils.default.createRandomId()),"string"!=typeof n.creator&&"string"==typeof t&&(n.creator=t+""),"number"!=typeof n.serial&&(n.serial=Date.now()),n},loggingConstants$$module$src$shared$constants$MessagingConstants=module$src$shared$constants$LoggingConstants.default,loggingLevels$$module$src$shared$constants$MessagingConstants=module$src$shared$constants$LoggingConstants.default.loggingLevels,defaultSettings$$module$src$shared$constants$MessagingConstants={messageLoggingLevel:loggingLevels$$module$src$shared$constants$MessagingConstants.NONE},messagingConstants$$module$src$shared$constants$MessagingConstants={messageTopics:messageTopics$$module$src$shared$constants$MessagingConstants,messageDataTypes:messageDataTypes$$module$src$shared$constants$MessagingConstants,defaultSettings:defaultSettings$$module$src$shared$constants$MessagingConstants};module$src$shared$constants$MessagingConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(messagingConstants$$module$src$shared$constants$MessagingConstants),module$src$shared$constants$MessagingConstants.default.makeMessageToken=makeMessageToken$$module$src$shared$constants$MessagingConstants;var module$src$app$ViewerAppConstants={},loggingConstants$$module$src$app$ViewerAppConstants=module$src$shared$constants$LoggingConstants.default,loggingLevels$$module$src$app$ViewerAppConstants=module$src$shared$constants$LoggingConstants.default.loggingLevels,messagingConstants$$module$src$app$ViewerAppConstants=module$src$shared$constants$MessagingConstants.default,messageTopics$$module$src$app$ViewerAppConstants=module$src$shared$constants$MessagingConstants.default.messageTopics,messageDataTypes$$module$src$app$ViewerAppConstants=module$src$shared$constants$MessagingConstants.default.messageDataTypes,DEFAULT_MATERIAL$$module$src$app$ViewerAppConstants={name:"Default material",version:"2.0",bumpAmplitude:1,color:[211,211,211,255],metalness:0,roughness:1},showSceneModes$$module$src$app$ViewerAppConstants={INSTANT:0,ON_SHOW:1,ON_FIRST_PLUGIN:2,ON_ALL_PLUGINS:3},defaultSettings$$module$src$app$ViewerAppConstants={blurSceneWhenBusy:!0,defaultMaterial:DEFAULT_MATERIAL$$module$src$app$ViewerAppConstants,ignoreSuperseded:!0,hasRestoredSettings:!1,loggingLevel:loggingLevels$$module$src$app$ViewerAppConstants.NONE,messageLoggingLevel:loggingLevels$$module$src$app$ViewerAppConstants.NONE,showMessages:!0,commitParameters:!1,commitSettings:!1,showScene:!1,showSceneMode:showSceneModes$$module$src$app$ViewerAppConstants.ON_FIRST_PLUGIN,showSceneTransition:"1s",strictMode:!1,ar:{enableCameraSync:!1,enableLightingEstimation:!0,enableTouchControls:!0,enableTouchControlRotation:!0,enableAutomaticPlacement:!0,defaultHitTestType:"existingPlaneUsingGeometry"}},viewerAppConstants$$module$src$app$ViewerAppConstants={loggingLevels:loggingLevels$$module$src$app$ViewerAppConstants,messageTopics:messageTopics$$module$src$app$ViewerAppConstants,messageDataTypes:messageDataTypes$$module$src$app$ViewerAppConstants,showSceneModes:showSceneModes$$module$src$app$ViewerAppConstants,defaultSettings:defaultSettings$$module$src$app$ViewerAppConstants},GlobalUtils$$module$src$app$ViewerAppConstants=module$src$shared$util$GlobalUtils.default;module$src$app$ViewerAppConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(viewerAppConstants$$module$src$app$ViewerAppConstants);var module$src$externals$axios={};try{module$src$externals$axios.default=eval("axios")}catch(a){"function"==typeof require&&(module$src$externals$axios.default=eval("require('axios')"))}var module$src$plugins$comm$CommPluginConstants={},baseUrl$$module$src$plugins$comm$CommPluginConstants="https://model-view.shapediver.com:443",defaultSettings$$module$src$plugins$comm$CommPluginConstants={modelViewUrl:baseUrl$$module$src$plugins$comm$CommPluginConstants,ajaxTimeout:3e4,ignoreSuperseded:!0},commPluginConstants$$module$src$plugins$comm$CommPluginConstants={defaultSettings:defaultSettings$$module$src$plugins$comm$CommPluginConstants},GlobalUtils$$module$src$plugins$comm$CommPluginConstants=module$src$shared$util$GlobalUtils.default;module$src$plugins$comm$CommPluginConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(commPluginConstants$$module$src$plugins$comm$CommPluginConstants);var module$src$shared$constants$PluginConstantsGlobal={},pluginCapabilities$$module$src$shared$constants$PluginConstantsGlobal={NONE:0,SHAPEDIVER_MODEL_VIEW:1,INTERACTIVE:2,DRAGANDDROP:3,MESSAGECALLBACKS:4,LOGGING:5,SETTINGS:6,DEFAULTPARAM:7},pluginStatuses$$module$src$shared$constants$PluginConstantsGlobal={NONE:"none",READY:"ready",FAILED:"failed",LOADED:"loaded",ACTIVE:"active",UNLOADED:"unloaded"},setParameterResults$$module$src$shared$constants$PluginConstantsGlobal={PARAM_NOT_FOUND:"param_not_found",NO_VALUE:"no_value",VALUE_REJECT:"value_reject",VALUE_EXISTS:"value_exists",VALUE_OK:"value_ok",PLUGIN_NOT_FOUND:"plugin_not_found",UPLOAD_FAILED:"upload_failed",ERROR:"error",LIVE:"live",CACHE:"cache",LOAD:"load",ABORT:"abort"},requestExportResults$$module$src$shared$constants$PluginConstantsGlobal={EXPORT_NOT_FOUND:"export_not_found",PLUGIN_NOT_FOUND:"plugin_not_found",ERROR:"error",CACHE:"cache",LOAD:"load",ABORT:"abort"},pluginConstants$$module$src$shared$constants$PluginConstantsGlobal={pluginCapabilities:pluginCapabilities$$module$src$shared$constants$PluginConstantsGlobal,pluginStatuses:pluginStatuses$$module$src$shared$constants$PluginConstantsGlobal,setParameterResults:setParameterResults$$module$src$shared$constants$PluginConstantsGlobal,requestExportResults:requestExportResults$$module$src$shared$constants$PluginConstantsGlobal},GlobalUtils$$module$src$shared$constants$PluginConstantsGlobal=module$src$shared$util$GlobalUtils.default;module$src$shared$constants$PluginConstantsGlobal.default=module$src$shared$util$GlobalUtils.default.deepCopy(pluginConstants$$module$src$shared$constants$PluginConstantsGlobal);var module$src$plugins$PluginConstants={},loggingConstants$$module$src$plugins$PluginConstants=module$src$shared$constants$LoggingConstants.default,loggingLevels$$module$src$plugins$PluginConstants=module$src$shared$constants$LoggingConstants.default.loggingLevels,messagingConstants$$module$src$plugins$PluginConstants=module$src$shared$constants$MessagingConstants.default,messageTopics$$module$src$plugins$PluginConstants=module$src$shared$constants$MessagingConstants.default.messageTopics,messageDataTypes$$module$src$plugins$PluginConstants=module$src$shared$constants$MessagingConstants.default.messageDataTypes,pluginConstantsGlobal$$module$src$plugins$PluginConstants=module$src$shared$constants$PluginConstantsGlobal.default,defaultSettings$$module$src$plugins$PluginConstants={loggingLevel:loggingLevels$$module$src$plugins$PluginConstants.NONE},pluginConstants$$module$src$plugins$PluginConstants={loggingLevels:loggingLevels$$module$src$plugins$PluginConstants,messageTopics:messageTopics$$module$src$plugins$PluginConstants,messageDataTypes:messageDataTypes$$module$src$plugins$PluginConstants,pluginCapabilities:module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities,pluginStatuses:module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses,setParameterResults:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults,requestExportResults:module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults,defaultSettings:defaultSettings$$module$src$plugins$PluginConstants},GlobalUtils$$module$src$plugins$PluginConstants=module$src$shared$util$GlobalUtils.default;module$src$plugins$PluginConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(pluginConstants$$module$src$plugins$PluginConstants);var module$src$shared$mixins$GlobalMixin={default:function(){return this.jsify=function(e){return JSON.stringify(e,null,0)},this}},module$src$shared$messages$MessagePrototype={},GlobalUtils$$module$src$shared$messages$MessagePrototype=module$src$shared$util$GlobalUtils.default;module$src$shared$messages$MessagePrototype.default=function(e,t,n){var r=this;return this.origin={},this.parts=[],this.addPart=function(e,t){void 0!==e&&r.parts.push({type:e,data:t})},this.addPart(e,t),this.getPartsByType=function(e){return r.parts.filter((function(t){return t.type===e}))},this.getUniquePartByType=function(e){if(1===(e=r.getPartsByType(e)).length)return e[0]},this.token={},"string"==typeof n&&0<n.length?this.token={id:n}:null!==n&&"object"==typeof n&&"string"==typeof n.id&&0<n.id.length?this.token=n:this.token.id=module$src$shared$util$GlobalUtils.default.createRandomId(),void 0!==this.token.serial&&"number"==typeof this.token.serial||(this.token.serial=Date.now()),this.date=Date.now(),this};var module$src$shared$mixins$SettingsMixin={},GlobalUtils$$module$src$shared$mixins$SettingsMixin=module$src$shared$util$GlobalUtils.default,MessagePrototype$$module$src$shared$mixins$SettingsMixin=module$src$shared$messages$MessagePrototype.default,messagingConstants$$module$src$shared$mixins$SettingsMixin=module$src$shared$constants$MessagingConstants.default;module$src$shared$mixins$SettingsMixin.default=function(e,t,n){var r=this,o="function"==typeof r.warn?r.warn:function(){};void 0!==e&&"object"==typeof e||(e={}),void 0!==t&&"object"==typeof t||(t={});var a=module$src$shared$util$GlobalUtils.default.deepCopy(e);module$src$shared$util$GlobalUtils.default.defaults(a,t),this.getSettings=function(e){if(void 0===e||!Array.isArray(e))return module$src$shared$util$GlobalUtils.default.deepCopy(a);var t={};return e.forEach((function(e){r.hasSetting(e)&&module$src$shared$util$GlobalUtils.default.forceAtPath(t,e,r.getSetting(e))})),t},this.getSetting=function(e){return module$src$shared$util$GlobalUtils.default.deepCopy(module$src$shared$util$GlobalUtils.default.getAtPath(a,e))},this.getSettingShallow=function(e){return module$src$shared$util$GlobalUtils.default.getAtPath(a,e)},this.hasSetting=function(e){return void 0!==module$src$shared$util$GlobalUtils.default.getAtPath(a,e)};var i={},s=0;this.registerHook=function(e,t){if(e||(e=".*"),"string"==typeof e)e.startsWith("^")||(e="^"+e),e.endsWith("$")||(e+="$"),e=RegExp(e);else if(!(e instanceof RegExp))return;if("function"==typeof t){var n=s;return i[s++]={r:e,cb:t},n}},this.deregisterHook=function(e){return!!i.hasOwnProperty(e)&&(delete i[e],!0)},this.deregisterAllHooks=function(){for(var e in i)delete i[e];return!0};var l={},u=0;return this.registerNotifier=function(e,t){if(e||(e=".*"),"string"==typeof e)e.startsWith("^")||(e="^"+e),e.endsWith("$")||(e+="$"),e=RegExp(e);else if(!(e instanceof RegExp))return;if("function"==typeof t){var n=u;return l[u++]={r:e,cb:t},n}},this.deregisterNotifier=function(e){return!!l.hasOwnProperty(e)&&(delete l[e],!0)},this.deregisterAllNotifiers=function(){for(var e in l)delete l[e];return!0},this.updateSetting=function(e,t){if(!Object.keys(i).every((function(n){return!(n=i[n]).r.test(e)||((n=n.cb(t,e))instanceof Promise&&o("SettingsMixin.updateSetting","A hook for "+e+" returned a Promise, which is always a truthy value, use SettingsMixin.updateSettingAsync instead for updates to this key"),n)})))return!1;var n=r.getSetting(e);return module$src$shared$util$GlobalUtils.default.forceAtPath(a,e,module$src$shared$util$GlobalUtils.default.deepCopy(t)),Object.keys(l).forEach((function(r){if((r=l[r]).r.test(e))try{r.cb(e,n,t)}catch(a){o("SettingsMixin.updateSetting","A notifier for setting "+r.r.toString()+" threw an exception",a)}})),!0},this.updateSettingAsync=function(e,t){var n=[];return Object.keys(i).every((function(r){return!(r=i[r]).r.test(e)||((r=r.cb(t,e))instanceof Promise?(n.push(r),!0):r)}))?Promise.all(n).then((function(n){if(n.every((function(e){return e}))){var i=r.getSetting(e);return module$src$shared$util$GlobalUtils.default.forceAtPath(a,e,module$src$shared$util$GlobalUtils.default.deepCopy(t)),Object.keys(l).forEach((function(n){if((n=l[n]).r.test(e))try{n.cb(e,i,t)}catch(r){o("SettingsMixin.updateSettingAsync","A notifier for setting "+n.r.toString()+" threw an exception",r)}})),!0}return!1}),(function(){return!1})):Promise.resolve(!1)},this.updateSettings=function(e,t){"boolean"!=typeof t&&(t=!1);var n=!0;if(void 0===e||"object"!=typeof e)return n;var o=[];return module$src$shared$util$GlobalUtils.default.getPaths(e,o),o.forEach((function(o){t&&r.hasSetting(o)||r.updateSetting(o,module$src$shared$util$GlobalUtils.default.getAtPath(e,o))||(n=!1)})),n},this.updateSettingsAsync=function(){return o("SettingsMixin.updateSettingsAsync","to be implemented"),Promise.reject(Error("SettingsMixin.updateSettingsAsyncto be implemented"))},this.isSettingPersistent=function(){return!1},this.getSection=function(e){var t=r.getSettingShallow(e);return void 0!==t&&"object"==typeof t&&{getSettings:function(t){if(void 0===t||!Array.isArray(t))return t=r.getSettings([e]),module$src$shared$util$GlobalUtils.default.getAtPath(t,e);t=module$src$shared$util$GlobalUtils.default.deepCopy(t);for(var n=0;n<t.length;n++)t[n]=e+"."+t[n];return r.getSettings(t)},getSetting:function(t){return r.getSetting(e+"."+t)},getSettingShallow:function(t){return r.getSettingShallow(e+"."+t)},hasSetting:function(t){return r.hasSetting(e+"."+t)},registerHook:function(t,n){if("string"!=typeof t)return!1;t.startsWith("^")&&(t=t.substring(1));var o=e.length+1;return r.registerHook(e+"."+t,(function(e,t){return n(e,t.substring(o))}))},deregisterHook:function(e){return r.deregisterHook(e)},registerNotifier:function(t,n){if("string"!=typeof t)return!1;t.startsWith("^")&&(t=t.substring(1));var o=e.length+1;return r.registerNotifier(e+"."+t,(function(e,t,r){return n(e.substring(o),t,r)}))},deregisterNotifier:function(e){return r.deregisterNotifier(e)},updateSetting:function(t,n){return r.updateSetting(e+"."+t,n)},updateSettingAsync:function(t,n){return r.updateSettingAsync(e+"."+t,n)},updateSettings:function(t,n){"boolean"!=typeof n&&(n=!1);var o=!0;if(void 0===t||"object"!=typeof t)return o;var a=[];return module$src$shared$util$GlobalUtils.default.getPaths(t,a),a.forEach((function(a){var i=e+"."+a;n&&r.hasSetting(i)||r.updateSetting(i,module$src$shared$util$GlobalUtils.default.getAtPath(t,a))||(o=!1)})),o},updateSettingsAsync:function(){return o("SettingsMixin.updateSettingsAsync","to be implemented"),Promise.reject(Error("SettingsMixin.updateSettingsAsyncto be implemented"))},isSettingPersistent:function(t){return r.isSettingPersistent(e+"."+t)},getSection:function(t){return r.getSection(e+"."+t)}}},module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")&&r.registerNotifier("",(function(e,t,o){e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SETTINGS_UPDATE,{key:e,valueNew:o,valueOld:t,namespace:n}),r.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SETTINGS_UPDATE,e)})),this};var module$src$shared$mixins$LoggingMixin={},loggingConstants$$module$src$shared$mixins$LoggingMixin=module$src$shared$constants$LoggingConstants.default;module$src$shared$mixins$LoggingMixin.default=function(){var e=this;return this.getLoggingLevelName=function(e){var t=e.toString();return Object.keys(module$src$shared$constants$LoggingConstants.default.loggingLevels).every((function(n){return module$src$shared$constants$LoggingConstants.default.loggingLevels[n]!==e||(t=n,!1)})),t},this.logToConsole=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),t=e[0]&module$src$shared$constants$LoggingConstants.default.loggingLevels.LVLBITS,n=e[1];e=e.slice(2),t===module$src$shared$constants$LoggingConstants.default.loggingLevels.ERROR?console.error.apply(console,["ERROR."+n,":"].concat($jscomp.arrayFromIterable(e))):t===module$src$shared$constants$LoggingConstants.default.loggingLevels.WARN?console.warn.apply(console,["WARN."+n,":"].concat($jscomp.arrayFromIterable(e))):t===module$src$shared$constants$LoggingConstants.default.loggingLevels.INFO?console.log.apply(console,["INFO."+n,":"].concat($jscomp.arrayFromIterable(e))):t===module$src$shared$constants$LoggingConstants.default.loggingLevels.DEBUG?console.log.apply(console,["DEBUG."+n,":"].concat($jscomp.arrayFromIterable(e))):console.log.apply(console,["UNKNOWN."+n,":"].concat($jscomp.arrayFromIterable(e)))},this.log=function(){(arguments[0]&module$src$shared$constants$LoggingConstants.default.loggingLevels.LVLBITS)<=e.getLoggingLevel()&&e.logToConsole.apply(e,arguments)},this.error=function(){e.log.apply(e,[module$src$shared$constants$LoggingConstants.default.loggingLevels.ERROR].concat($jscomp.arrayFromIterable(arguments)))},this.warn=function(){e.log.apply(e,[module$src$shared$constants$LoggingConstants.default.loggingLevels.WARN].concat($jscomp.arrayFromIterable(arguments)))},this.info=function(){e.log.apply(e,[module$src$shared$constants$LoggingConstants.default.loggingLevels.INFO].concat($jscomp.arrayFromIterable(arguments)))},this.debug=function(){e.log.apply(e,[module$src$shared$constants$LoggingConstants.default.loggingLevels.DEBUG].concat($jscomp.arrayFromIterable(arguments)))},this.setLoggingLevel=function(t){return e.updateSetting("loggingLevel",t)},this.getLoggingLevel=function(){return e.getSetting("loggingLevel")},this};var module$src$shared$mixins$MessagingMixin={},messagingConstants$$module$src$shared$mixins$MessagingMixin=module$src$shared$constants$MessagingConstants.default,loggingConstants$$module$src$shared$mixins$MessagingMixin=module$src$shared$constants$LoggingConstants.default;module$src$shared$mixins$MessagingMixin.default=function(){var e=this;return this.messageToLog=function(t,n){var r=e.getSetting("messageLoggingLevel");r!==module$src$shared$constants$LoggingConstants.default.loggingLevels.NONE&&e.log(r,t,n)},this.messageToPubSub=function(e,t,n,r){r&&"string"==typeof r.prefix&&(e=r.prefix.concat(".",e)),r&&"string"==typeof r.postfix&&(e=e.concat(".",r.postfix)),n.publish(e,t)},this.message=function(t,n){e.messageToLog(t,n)},this.hasSetting("messageLoggingLevel")||e.updateSetting("messageLoggingLevel",module$src$shared$constants$MessagingConstants.default.defaultSettings.messageLoggingLevel),this};var module$src$externals$expo_three={default:null},module$src$externals$expo_asset_utils={default:null},module$src$shared$util$stringChecksum={default:function(e){var t,n=0,r=e.length;if(0===r)return n;for(t=0;t<r;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n}},module$src$shared$util$getImageBase64={},AXIOS$$module$src$shared$util$getImageBase64=module$src$externals$axios.default,_converterEngine$$module$src$shared$util$getImageBase64=function(e){for(var t=(e=new Uint8Array(e)).length,n=[];t--;)n[t]=String.fromCharCode(e[t]);return window.btoa(n.join(""))};module$src$shared$util$getImageBase64.default=function(e){return(0,module$src$externals$axios.default)({method:"GET",url:e,responseType:"arraybuffer"}).then((function(e){var t=_converterEngine$$module$src$shared$util$getImageBase64(e.data);return Promise.resolve({data:t,contentType:e.headers["content-type"]})}))};var module$src$shared$singletons$TextureLoader={},AXIOS$$module$src$shared$singletons$TextureLoader=module$src$externals$axios.default,THREE$$module$src$shared$singletons$TextureLoader=module$src$externals$three.default,EXPOTHREE$$module$src$shared$singletons$TextureLoader=module$src$externals$expo_three.default,EXPOASSETUTILS$$module$src$shared$singletons$TextureLoader=module$src$externals$expo_asset_utils.default,ATOBTOA$$module$src$shared$singletons$TextureLoader=module$src$shared$util$atobtoa.default,textureCache$$module$src$shared$singletons$TextureLoader={},TextureLoader$$module$src$shared$singletons$TextureLoader=function(){this.loadTexture=function(t,n,r){return window&&window.navigator&&-1!==window.navigator.userAgent.indexOf("Safari")&&-1===window.navigator.userAgent.indexOf("Chrome")?e(t,n,r).then((function(){return e(t,n,r)})):e(t,n,r)};var e=function(e,t,n){t=t||{},n=n||{};var r=function(e){e.wrapS=module$src$externals$three.default.RepeatWrapping,e.wrapT=module$src$externals$three.default.RepeatWrapping;var n=t.offset||[0,0];return e.offset=new module$src$externals$three.default.Vector2(n[0],n[1]),e.repeat=new module$src$externals$three.default.Vector2((n=t.repeat||[1,1])[0],n[1]),e.rotation=t.rotation||0,e.center=new module$src$externals$three.default.Vector2((n=t.center||[0,0])[0],n[1]),e.uvTransform=new module$src$externals$three.default.Matrix3,e.uvTransform.identity().translate(-e.center.x,-e.center.y).rotate(e.rotation).scale(e.repeat.x,e.repeat.y).translate(e.center.x,e.center.y).translate(e.offset.x,e.offset.y),e.needsUpdate=!0,e};if("object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName&&"CANVAS"===e.nodeName.toUpperCase()){var o=new module$src$externals$three.default.Texture(e);return o.SDCanvasTexture=!0,"function"!=typeof e._addTexture&&function(){var t=[];e._addTexture=function(e){return t.push(e)},Object.defineProperty(e,"needsUpdate",{set:function(e){return e&&t.forEach((function(e){return e.needsUpdate=!0}))}})}(),e._addTexture(o),Promise.resolve(r(o))}if("string"!=typeof e)return Promise.reject(Error("Input is not a string"));var a="_"+(0,module$src$shared$util$stringChecksum.default)(e);if(textureCache$$module$src$shared$singletons$TextureLoader.hasOwnProperty(a))return textureCache$$module$src$shared$singletons$TextureLoader[a].then((function(e){var t=e.clone();return module$src$externals$expo_three.default&&module$src$externals$expo_asset_utils.default&&e.isDataTexture&&!t.isDataTexture&&(t.isDataTexture=!0),r(t)}));var i=null,s=null,l=null,u=null;return textureCache$$module$src$shared$singletons$TextureLoader[a]=Promise.resolve().then((function(){if("data:"==e.substring(0,5))return u=!0,i=e.substring(e.indexOf(":")+1,e.indexOf(";")),l=-1!==e.indexOf("base64"),s=e.substring(e.indexOf(",")+1),Promise.resolve();u=!1;var t={method:"GET",url:e,headers:{}};return n.authorization&&(t.headers.Authorization=n.authorization),(0,module$src$externals$axios.default)(t).then((function(e){return-1<(i=e.headers["content-type"]).indexOf(";")&&(i=i.substr(0,i.indexOf(";"))),s=e.data,l=!1,Promise.resolve()}),(function(e){return e.scope="TextureLoader._loadTexture",e.msg=e.response?"Loading texture failed with HTTP status code "+e.response.status:e.request?"Loading texture failed, no response from the server":"Loading texture failed, unknown error",Promise.reject(e)}))})).then((function(){var t,n;if(["image/jpeg","image/png","image/gif","image/bmp"].includes(i))return new Promise((function(t,n){if(module$src$externals$expo_three.default&&module$src$externals$expo_asset_utils.default){var r=i.split("/")[1].replace("e","");module$src$externals$expo_asset_utils.default.resolveAsync(e,{fileName:"H"+a.toString()+"."+r}).then((function(e){module$src$externals$expo_three.default.loadTextureAsync({asset:e}).then((function(e){e.minFilter=module$src$externals$three.default.LinearFilter,t(e)}),(function(e){e.scope="TextureLoader._loadTexture",e.msg="EXPOTHREE.loadAsync failed",n(e)}))}),(function(e){e.scope="TextureLoader._loadTexture",e.msg="EXPOASSETUTILS.resolveAsync failed",n(e)}))}else(new module$src$externals$three.default.TextureLoader).load(e,(function(e){t(e)}),(function(){}),(function(e){e.scope="TextureLoader._loadTexture",e.msg="Texture file loading failed",n(e)}))}));if("image/svg+xml"===i){if(window&&window.navigator&&window.navigator.userAgent&&0<window.navigator.userAgent.indexOf("Trident/")){var r=Error("SVG textures not supported by Internet Explorer 11. Skipping the texture.");return r.scope="TextureLoader._loadTexture",Promise.reject(r)}var o=null;o=u?l?module$src$shared$util$atobtoa.default.atobUTF8(s):(" "+(o=s)).slice(1):s,(r=document.createElement("DIV")).id="svgc",r.innerHTML=o;var c=r.getElementsByTagName("svg"),d=[],p=[];for(r=0;r<c.length;++r){for(t=0;2>t;++t){var h=c[r].getElementsByTagName(["image","img"][t]);for(n=0;n<h.length;++n)"data:"!=h[n].href.baseVal.substring(0,5)&&d.push(h[n].href.baseVal)}for(n=c[r].getElementsByTagName("style"),t=0;t<n.length;++t){h=/@import\x20url\(\s*(.*?)\s*\);/g;for(var m=void 0;null!==(m=h.exec(n[t].innerHTML));)p.push(m[1]);p=p.filter((function(e,t,n){return n.indexOf(e)===t}))}}for(c=[],h=function(e){return new Promise((function(t,n){0<d[e].length?(0,module$src$shared$util$getImageBase64.default)(d[e]).then((function(n){o=o.replace(d[e],"data:"+n.contentType+";base64,"+n.data),t()})).catch((function(e){n(e)})):t()}))},r=0;r<d.length;++r)n=h(r),c.push(n);for(h=function(n){return new Promise((function(r,a){module$src$externals$axios.default.get(n).then((function(e){return e.data})).then((function(i){for(var s,l=[],u=/url\(\s*(.*?)\s*\)/g;null!==(s=u.exec(i));)l.push(s[1]);for(u=[],s=function(e){return new Promise((function(t,n){(0,module$src$shared$util$getImageBase64.default)(e).then((function(n){n="data:"+n.contentType+";base64,"+n.data,0<e.length&&(i=i.replace(e,n)),t()})).catch((function(){n(Error("Error converting "+e+" to base64"))}))}))},t=0;t<l.length;++t)u.push(s(l[t]));return Promise.all(u).then((function(){return i})).then((function(t){0<e.length&&(o=o.replace("@import url("+n+");",t)),r()})).catch((function(){a(Error("Error converting CSS string."))}))}))}))},r=0;r<p.length;++r)n=h(p[r]),c.push(n);return Promise.all(c).then((function(){return new Promise((function(e,t){var n="data:image/svg+xml,"+encodeURIComponent(o),r=document.createElement("canvas");r.width=2048,r.height=2048;var a=r.getContext("2d"),i=new Image;i.onload=function(){a.drawImage(i,0,0,2048,2048);var t=new module$src$externals$three.default.Texture(r);e(t)},i.onerror=function(e){t(e)},i.crossOrigin="Anonymous",i.src=n}))}))}return Promise.reject(Error("Unkonwn content-type "+i+" when downloading "+e))})),textureCache$$module$src$shared$singletons$TextureLoader[a].then((function(e){var t=e.clone();return module$src$externals$expo_three.default&&module$src$externals$expo_asset_utils.default&&e.isDataTexture&&!t.isDataTexture&&(t.isDataTexture=!0),r(t)}))}};module$src$shared$singletons$TextureLoader.default=new TextureLoader$$module$src$shared$singletons$TextureLoader;var module$src$plugins$PluginPrototype={},pluginConstants$$module$src$plugins$PluginPrototype=module$src$plugins$PluginConstants.default,GlobalUtils$$module$src$plugins$PluginPrototype=module$src$shared$util$GlobalUtils.default,GlobalMixin$$module$src$plugins$PluginPrototype=module$src$shared$mixins$GlobalMixin.default,SettingsMixin$$module$src$plugins$PluginPrototype=module$src$shared$mixins$SettingsMixin.default,LoggingMixin$$module$src$plugins$PluginPrototype=module$src$shared$mixins$LoggingMixin.default,MessagingMixin$$module$src$plugins$PluginPrototype=module$src$shared$mixins$MessagingMixin.default,MessagePrototype$$module$src$plugins$PluginPrototype=module$src$shared$messages$MessagePrototype.default,TextureLoader$$module$src$plugins$PluginPrototype=module$src$shared$singletons$TextureLoader.default,THREE$$module$src$plugins$PluginPrototype=module$src$externals$three.default;module$src$plugins$PluginPrototype.default=function(e){var t=this;return this.pluginConstants=module$src$plugins$PluginConstants.default,this.GlobalUtils=module$src$shared$util$GlobalUtils.default,this.MessagePrototype=module$src$shared$messages$MessagePrototype.default,t.TextureLoader=module$src$shared$singletons$TextureLoader.default,t.THREE=module$src$externals$three.default,module$src$shared$mixins$GlobalMixin.default.call(this),void 0!==e.runtimeId&&"string"==typeof e.runtimeId||(e.runtimeId=module$src$shared$util$GlobalUtils.default.createRandomId()),module$src$shared$mixins$SettingsMixin.default.call(this,e,t.pluginConstants.defaultSettings),this.registerHook("runtimeId",(function(){return!1})),module$src$shared$mixins$LoggingMixin.default.call(this),module$src$shared$mixins$MessagingMixin.default.call(this),this.getRuntimeId=function(){return t.getSetting("runtimeId")},this.load=function(e){return t.updateSettings(e),!0},this.getStatus=function(){},this.setStatus=function(){},(function(){var e=t.pluginConstants.pluginStatuses.READY;t.getStatus=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(e)},t.setStatus=function(n){if(e!==n){var r=t.pluginConstants.messageTopics.PLUGIN_FAILED;n===t.pluginConstants.pluginStatuses.FAILED?r=t.pluginConstants.messageTopics.PLUGIN_FAILED:n===t.pluginConstants.pluginStatuses.LOADED?r=t.pluginConstants.messageTopics.PLUGIN_LOADED:n===t.pluginConstants.pluginStatuses.ACTIVE?r=t.pluginConstants.messageTopics.PLUGIN_ACTIVE:n===t.pluginConstants.pluginStatuses.UNLOADED&&(r=t.pluginConstants.messageTopics.PLUGIN_UNLOADED);var o=new module$src$shared$messages$MessagePrototype.default(t.pluginConstants.messageDataTypes.PLUGIN_RUNTIME_ID,t.getRuntimeId());t.message(r,o),e=n}}}).call(this),this.getStatusDescription=function(){return{id:t.getRuntimeId(),status:t.getStatus(),name:t.getName(),shortName:t.getShortName()}},this};var module$src$plugins$comm$CommPlugin={},axios$$module$src$plugins$comm$CommPlugin=module$src$externals$axios.default,commPluginConstants$$module$src$plugins$comm$CommPlugin=module$src$plugins$comm$CommPluginConstants.default,pluginConstantsGlobal$$module$src$plugins$comm$CommPlugin=module$src$shared$constants$PluginConstantsGlobal.default,pluginPrototype$$module$src$plugins$comm$CommPlugin=module$src$plugins$PluginPrototype.default,messagingConstants$$module$src$plugins$comm$CommPlugin=module$src$shared$constants$MessagingConstants.default,loggingConstants$$module$src$plugins$comm$CommPlugin=module$src$shared$constants$LoggingConstants.default,GlobalUtils$$module$src$plugins$comm$CommPlugin=module$src$shared$util$GlobalUtils.default,MessagePrototype$$module$src$plugins$comm$CommPlugin=module$src$shared$messages$MessagePrototype.default;module$src$plugins$comm$CommPlugin.default=function(e){var t=this;"string"==typeof e.modelViewUrl&&0<e.modelViewUrl.length&&("eu-central-1"===e.modelViewUrl?e.modelViewUrl="https://sdeuc1.eu-central-1.shapediver.com":"us-east-1"===e.modelViewUrl?e.modelViewUrl="https://model-view.shapediver.com":"us-east-1-test"===e.modelViewUrl?e.modelViewUrl="https://sdtest.us-east-1.shapediver.com":e.modelViewUrl.startsWith("http")||(e.modelViewUrl="https://"+e.modelViewUrl)),module$src$plugins$PluginPrototype.default.call(this,module$src$shared$util$GlobalUtils.default.inject(module$src$plugins$comm$CommPluginConstants.default.defaultSettings,module$src$shared$util$GlobalUtils.default.deepCopy(e),!1));var n=module$src$externals$axios.default.create({timeout:t.getSettingShallow("ajaxTimeout")});if(t.getSettingShallow("authorization")&&(n.defaults.headers.common.Authorization=t.getSetting("authorization")),this.hasSetting("ticket")){var r={},o=[module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.SHAPEDIVER_MODEL_VIEW],a={},i=null,s=function(e,o,a,u){var c={method:o,url:e,headers:{}};return a&&(c.data=a),c.headers["X-ShapeDiver-Origin"]=module$src$shared$util$GlobalUtils.default.embeddingOrigin(),u&&(c.headers["Content-Type"]=u),t.getSettingShallow("authorization")&&(c.headers.Authorization=t.getSetting("authorization")),n(c).then((function(e){if((e=e.data).hasOwnProperty("actions")){if(e.actions.forEach((function(e){e.hasOwnProperty("method")&&e.hasOwnProperty("href")&&e.hasOwnProperty("name")&&(r[e.name]=e)})),r.hasOwnProperty("default")){var n=r.default.href.replace("/default","");n!==i&&t.debug("CommPlugin.modelViewAjax","Setting base URL to",i=n)}delete e.actions}return e.hasOwnProperty("templates")&&delete e.templates,e}),(function(n){if(n.response){var r="",c="",d=n.response.data;switch(n.response.status){case 400:r="Bad request";break;case 401:r="Unauthorized";break;case 403:r="Forbidden";break;case 410:return c=module$src$shared$util$GlobalUtils.default.deepCopy(i),l().then((function(){var t=e.replace(c,i);return s(t,o,a,u)}),(function(e){t.setStatus(module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.FAILED);var n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,{messageScope:e.serverMessage||"Session initialisation failed"});return t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_FAILED,n),Promise.reject(e)}));case 413:r="Payload too large";break;case 500:r="Internal server error";break;default:r="Communication failed with HTTP status"}var p="Request error: "+r+" ("+n.response.status+")";return r=Error(r),d&&d.message&&(r.serverMessage=d.message,p+=", "+d.message),t.error("CommPlugin.modelViewAjax",p,n),Promise.reject(r)}return n.request?(t.error("CommPlugin.modelViewAjax","Request error (no response)",n),Promise.reject(Error("Request error (no response)"))):(t.error("CommPlugin.modelViewAjax","Request error (unknown)",n),Promise.reject(Error("Request error (unknown)")))}))},l=function(){var e=t.getSettingShallow("modelViewUrl");return e?s(e+"/ticket/"+t.getSettingShallow("ticket"),"POST"):Promise.reject(Error("Base url not defined."))},u=function(e,t){return new Promise((function(n,o){r.hasOwnProperty("cache")&&r.cache.hasOwnProperty("method")&&r.cache.hasOwnProperty("href")?((o={})[e]=t,n(s(r.cache.href,r.cache.method,o,"application/json"))):o(Error('Action "cache" is missing'))}))},c=function(e,t){return new Promise((function(n,o){r.hasOwnProperty("export")&&r.export.hasOwnProperty("method")&&r.export.hasOwnProperty("href")||o(Error('Action "export" is missing')),n(s(r.export.href,r.export.method,{exports:{id:e},parameters:t},"application/json"))}))},d=function(e,t){return new Promise((function(n,o){r.hasOwnProperty("export-cache")&&r["export-cache"].hasOwnProperty("method")&&r["export-cache"].hasOwnProperty("href")?((o={})[e]=t,n(s(r["export-cache"].href,r["export-cache"].method,o,"application/json"))):o(Error('Action "export-cache" is missing'))}))},p=function(e){return new Promise((function(t,n){r.hasOwnProperty("customize")&&r.customize.hasOwnProperty("method")&&r.customize.hasOwnProperty("href")||n(Error('Action "customize" is missing')),t(s(r.customize.href,r.customize.method,e,"application/json"))}))};this.getName=function(){return"ShapeDiver Communications Plugin"},this.getShortName=function(){return"CommPlugin"},this.getCapabilities=function(){var e=module$src$shared$util$GlobalUtils.default.deepCopy(o);return r.hasOwnProperty("log")&&e.push(module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.LOGGING),r.hasOwnProperty("configure")&&e.push(module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.SETTINGS),r.hasOwnProperty("defaultparam")&&e.push(module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.DEFAULTPARAM),e},this.getMessageCallbacks=function(){return{}},this.load=function(e){return t.updateSettings(e),l().then((function(e){if(t.debug("CommPlugin.initSession","Received session init reply",e),e.hasOwnProperty("msg")){var n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,{message:e.msg,scope:"Session init",messageLevel:module$src$shared$constants$LoggingConstants.default.loggingLevels.ERROR});t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_MESSAGE,n)}e.hasOwnProperty("config")&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.APP_SETTINGS,e.config),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SETTINGS_REGISTER,n)),e.hasOwnProperty("parameters")&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_DEFINITION,e.parameters),e.hasOwnProperty("config")&&n.addPart(module$src$shared$constants$MessagingConstants.default.messageDataTypes.APP_SETTINGS,e.config),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER_REGISTER,n)),e.hasOwnProperty("exports")&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_DEFINITION,e.exports),e.hasOwnProperty("config")&&n.addPart(module$src$shared$constants$MessagingConstants.default.messageDataTypes.APP_SETTINGS,e.config),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_REGISTER,n)),t.getStatus()!==module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.ACTIVE&&t.setStatus(module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.ACTIVE)})).catch((function(e){t.error("CommPlugin.initSession","Session init failed",e),t.setStatus(module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.FAILED),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,{messageScope:e.serverMessage||"Session initialisation failed"}),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_FAILED,e)})),t.debug("CommPlugin.load",'Loaded plugin "'+t.getName()+'" with capabilities '+JSON.stringify(t.getCapabilities())+" and runtime id "+t.getRuntimeId()),t.setStatus(module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.LOADED),!0},this.logToServer=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),n=e[0]&module$src$shared$constants$LoggingConstants.default.loggingLevels.LVLBITS,o=e[1],a=e.slice(2);return 0<a.length&&"string"==typeof a[0]&&(o+=": "+a[0],a=a.slice(1)),new Promise((function(e,i){r.hasOwnProperty("log")&&r.log.hasOwnProperty("method")&&r.log.hasOwnProperty("href")||i(Error("CommPlugin.logToServer: Session did not provide log action"));var l={level:2-Math.max(Math.min(n,2),0),message:o};1===a.length?l.err=a[0]:1<a.length&&(l.err={messages:a}),s(r.log.href,r.log.method,l,"application/json").then((function(t){e(t)}),(function(e){e="CommPlugin.logToServer: Log message rejected by server "+t.jsify(e),i(Error(e))}))}))},this.setParameterValue=function(){return t.warn("CommPlugin.setParameterValue","Not supported"),module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.ERROR},this.setMultipleParameterValues=function(){return t.warn("CommPlugin.setMultipleParameterValues","Not supported"),module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.ERROR},this.setAllParameterValues=function(e,n){return t.getStatus()!==module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.ACTIVE?(e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,"Plugin not active",n),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,e),module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.ERROR):(function(e,n){return new p(e).then((function(e){if(e.hasOwnProperty("msg")){var r=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,{message:e.msg,scope:"Customization reply",messageLevel:module$src$shared$constants$LoggingConstants.default.loggingLevels.ERROR});t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_MESSAGE,r)}if(!e.hasOwnProperty("outputs"))return Promise.reject("Invalid customization reply");var o=Object.keys(e.outputs);r=[];var i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_INIT,o.length,n);t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_INIT,i),i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{state:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_INIT,progress:.25},n),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i),i={};for(var s=(o=$jscomp.makeIterator(o)).next();!s.done;i={outputId:i.outputId},s=o.next())i.outputId=s.value,s=new Promise(function(r){return function(o,i){var s=e.outputs[r.outputId];if(s.hasOwnProperty("content"))o(s);else{var l=s.version;a[r.outputId]=l;var c=function(){return u(r.outputId,l).then((function(e){if(t.getSettingShallow("ignoreSuperseded")&&a[r.outputId]!==l)e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT,"Subscene obsolete because of newer request",n),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,e),o();else{if(e.hasOwnProperty("msg")){var s=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,{message:e.msg,scope:"Cache reply",messageLevel:module$src$shared$constants$LoggingConstants.default.loggingLevels.WARN});t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_MESSAGE,s)}e.hasOwnProperty("outputs")&&e.outputs.hasOwnProperty(r.outputId)&&(e=e.outputs[r.outputId]).hasOwnProperty("version")&&e.version===l?e.hasOwnProperty("delay")?setTimeout((function(){c()}),Math.max(100,parseInt(e.delay))):e.hasOwnProperty("content")?(e.id=r.outputId,o(e)):i(Error("No content nor delay in cache reply")):i(Error("Invalid cache reply"))}}))};c()}}}(i)).then(function(e){return function(r){if(r){if(r.id=e.outputId,r.hasOwnProperty("msg")){var o=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,{message:r.msg,scope:"Output",messageLevel:module$src$shared$constants$LoggingConstants.default.loggingLevels.WARN});t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_MESSAGE,o)}return o=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_OUTPUTVERSION_JSON,r,n),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_OUTPUTVERSION,o),r}}}(i)),r.push(s);return Promise.all(r)}))}(e,n).catch((function(e){e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,e,n),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,e)})),module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.LOAD)},this.fileUpload=function(e){if(!r.hasOwnProperty("upload"))throw Error("CommPlugin.fileUpload: no upload action");return s(r.upload.href,r.upload.method,e.request,"application/json").then((function(t){var r,o={},a=[];for(r in e.data){var i=t[r];if(!i||!module$src$shared$util$GlobalUtils.default.typeCheck(i.id,"string")||!module$src$shared$util$GlobalUtils.default.typeCheck(i.href,"string"))throw Error("CommPlugin.fileUpload: invalid response");o[r]=i.id,(i={method:"PUT",url:i.href,data:e.data[r],headers:{},transformRequest:[function(e,t){return delete t.common.Authorization,delete t.Authorization,e}]}).headers["Content-Type"]=e.request[r].format,a.push(n(i))}return Promise.all(a).then((function(){return o}))}))},this.requestExport=function(e,n,r){return t.getStatus()!==module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.ACTIVE?(e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,"Plugin not active",r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,e),module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.ERROR):(function(e,n,r){var o=function(n){if(!n.hasOwnProperty("exports")||!n.exports.hasOwnProperty(e))return Promise.reject("Unexpected reply to export request");var a=n.exports[e];return a.hasOwnProperty("delay")?(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{data:a},r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,n),n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_STATUS,a,r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_STATUS,n),module$src$shared$util$GlobalUtils.default.waitForTimeout(Math.max(1e3,parseInt(a.delay))).then((function(){return d(e,a.version).then(o)}))):a};return c(e,n).then(o)}(e,n,r).then((function(e){var n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_RESULT,e,r);t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_AVAILABLE,n),(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS,"Export available",r)).addPart(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_RESULT,e),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,n)}),(function(e){e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,e,r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,e)})),t.debug("CommPlugin.requestExport","Called with export "+e+", kvps "+t.jsify(n)+", token "+t.jsify(r)),t.pluginConstants.requestExportResults.LOAD)},this.saveSettings=function(e){return r.hasOwnProperty("configure")?s(r.configure.href,r.configure.method,e,"application/json"):Promise.resolve(!1)},this.saveDefaultParameterValues=function(e){return r.hasOwnProperty("defaultparam")?s(r.defaultparam.href,r.defaultparam.method,e,"application/json").then((function(){return!0})):Promise.resolve(!1)},this.registerHook("modelViewUrl",(function(){return!1})),this.registerHook("ticket",(function(){return!1})),this.setStatus(module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.READY)}else t.error("CommPlugin.CommPlugin","Plugin was initialized without a ticket."),t.setStatus(module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.FAILED)};var module$src$api$apps$sd_controls$constants$sd_controls_constants_types={default:{}},TYPES$$module$src$api$apps$sd_controls$constants$sd_controls_constants_types;Object.defineProperty(module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,"__esModule",{value:!0}),function(e){e.SLIDER="slider",e.STRING="string",e.BOOLEAN="boolean",e.COLOR="color",e.BUTTON="button",e.DROPDOWN="dropdown",e.CHECKLIST="form",e.FILE="file",e.MULTIPLE="multiple",e.VECTOR3="vector3",e.MODAL="modal"}(TYPES$$module$src$api$apps$sd_controls$constants$sd_controls_constants_types=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES||(module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES={}));var module$src$api$apps$sd_controls$enums$enums={default:{}},LightEvents$$module$src$api$apps$sd_controls$enums$enums,SettingsGroups$$module$src$api$apps$sd_controls$enums$enums;Object.defineProperty(module$src$api$apps$sd_controls$enums$enums.default,"__esModule",{value:!0}),function(e){e.ADD="add",e.REMOVE="removed",e.CLEAR_LIGHTS="clear.lights",e.DROPDOWN_CUSTOM_UPDATE="dropdown.customUpdate"}(LightEvents$$module$src$api$apps$sd_controls$enums$enums=module$src$api$apps$sd_controls$enums$enums.default.LightEvents||(module$src$api$apps$sd_controls$enums$enums.default.LightEvents={})),function(e){e[e.WORLD=1]="WORLD",e[e.LIGHTS=2]="LIGHTS",e[e.BACKGROUND=3]="BACKGROUND",e[e.CAMERA=4]="CAMERA"}(SettingsGroups$$module$src$api$apps$sd_controls$enums$enums=module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups||(module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups={}));var module$src$api$apps$sd_controls$settings$lights$sd_controls_setting={default:{}};Object.defineProperty(module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default,"__esModule",{value:!0}),module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting=function(){function e(t,n,r,o,a,i,s,l){if(void 0===n&&(n=null),void 0===a&&(a=1),void 0===i&&(i=1),void 0===s&&(s={}),void 0===l&&(l=!1),this.api=t,this.setting=n,this.type=r,this.name=o,this.groupId=a,this.orderId=i,this.properties=s,this.custom=l,this.id=0,this.menuElements=[],this.isSaved=!1,e.resolveId(this),!this.type)throw Error("Missing type");if(!this.name)throw Error("Missing name");this.custom||(this.defval=t.getSetting(n)),this.properties&&Object.assign(this,this.properties)}return e.prototype.registerMenuElement=function(e){this.menuElements.push(e)},e.prototype.getMenuElements=function(){return this.menuElements},e.resolveId=function(t){t.id=e.id++},e.id=0,e}();var module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition={default:{}},__extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition=this&&module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition.default,"__esModule",{value:!0});var sd_controls_constants_types_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,enums_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition=module$src$api$apps$sd_controls$enums$enums.default,sd_controls_setting_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition=module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default;module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition.default.LightDefinitionSetting=function(e){function t(t,n,r,o,a,i,s){return(t=e.call(this,t,"light.definition",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.MULTIPLE,o,a,i,null,!0)||this).controlsContext=n,t.settings=r,t.lightDef=s,t.isSettingRemovable=!0,t.light=!0,t.isLightUpdateRegistered=!1,t}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition(t,e),t.prototype.onClick=function(){this.controlsContext.shapeDiverDragControls.makeLightDraggable(this.lightDef.id),this.registerLightUpdate()},t.prototype.remove=function(){this.api.scene.lights.removeLight(this.lightDef.id),this.controlsContext.controlsEvents.trigger(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.REMOVE,{name:this.lightDef.id,setting:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.MULTIPLE}),this.controlsContext.shapeDiverDragControls.clearOnLightUpdateEvents(this.lightDef.id)},t.prototype.close=function(){this.getMenuElements().forEach((function(e){return e.close()}))},t.prototype.registerLightUpdate=function(){var e=this;this.isLightUpdateRegistered||this.controlsContext.shapeDiverDragControls.onLightUpdate(this.lightDef.id,(function(t){return e.updateInputElements(t)})),this.isLightUpdateRegistered=!0},t.prototype.updateInputElements=function(e){var t=this;this.findChangedProperties(e).forEach((function(n){var r=t.settings[n];t.lightDef.properties[n]=e.properties[n],r.getMenuElements().forEach((function(t){t.update(e.properties[n],null)}))}))},t.prototype.findChangedProperties=function(e){var t=this,n=[];return Object.keys(e.properties).forEach((function(r){var o=e.properties[r];if("object"==typeof o)for(var a=Object.keys(o),i=0;i<a.length;i++){var s=a[i];if(o[s]!=t.lightDef.properties[r][s]){n.push(r);break}}else o!=t.lightDef.properties[r]&&n.push(r)})),n},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting);var module$src$api$apps$sd_controls$settings$sd_controls_settings_html_helpers={default:{}};Object.defineProperty(module$src$api$apps$sd_controls$settings$sd_controls_settings_html_helpers.default,"__esModule",{value:!0}),module$src$api$apps$sd_controls$settings$sd_controls_settings_html_helpers.default.HTMLSettingsHelper=function(){function e(){}return e.createAlert=function(e){return'<div class="uk-alert-danger" uk-alert>\n              <a class="uk-alert-close" uk-close></a>\n              <p>'+e+"</p>\n            </div>"},e}();var module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util={default:{}};module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement=function(e,t){var n,r,o;for(n in e=document.createElement(e),t){var a=t[n];if("classList"===n)if(Array.isArray(a)){var i=0;for(o=a.length;i<o;i++)e.classList.add(a[i])}else e.classList.add(a);else if("parent"===n)a.appendChild(e);else if("attributes"===n)for(r in a)e.setAttribute(r,a[r]);else null!=a&&(e[n]=a)}return e},module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener=function(e,t,n,r,o,a,i,s){var l,u,c,d=i||0;return i=function(o){e||_destroy(),n.valueConversion.update&&n.valueConversion.f?(u=r[n.valueConversion.update],c=n.valueConversion.f(n,r,o)):u=c="string"==typeof n.valueConversion?r[n.valueConversion]:n.valueConversion(n,r,o),a(u,o)&&(clearTimeout(l),l=setTimeout((function(){var r=!0;if("function"==typeof s){var a={val1:u,val2:c};r=s(a,o),u=a.val1,c=a.val2}r&&(!0===n.parameter?n.parametersQueue&&n.parametersQueue.use?n.parametersQueue.add(n,t,c):(e.parameters.updateAsync({id:t,value:c}),n.setStackToLast()):!0===n.export?e.exports.requestAsync({id:t}):"function"==typeof n.customUpdate?n.customUpdate(t,c,o,n):(e.updateSettingAsync(t,c),n.setStackToLast()))}),d))},r.addEventListener(o,i),i},module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.isMobileDevice=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(_isMobile$$module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util=!0),_isMobile$$module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util},module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.isMobileOrTabletDevice=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(_isMobileOrTable$$module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util=!0),_isMobileOrTable$$module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util},module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.isIPadOrIPhone=function(){var e=window.navigator.userAgent;return e.match(/iPad/i)||e.match(/iPhone/i)},module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.isEventSupported=function(e,t){var n={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return(n=(e="on"+e)in(t=document.createElement(t||n||"div")))||(t.setAttribute(e,"return;"),n="function"==typeof t[e]),n},module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.domSupportsHtml5Color=function(){try{return colorInput=document.createElement("input"),colorInput.type="color",colorInput.value="!","color"===colorInput.type&&"!"!==colorInput.value}catch(a){return!1}};var _isMobile$$module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util=!1,_isMobileOrTable$$module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util=!1,module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util={default:{}};module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util.default.hide=function(e,t){return t?e.classList.add("sdv-hidden"):e.classList.remove("sdv-hidden")};var module$src$api$apps$sd_controls$components$base$sd_controls_components_base={default:{}},__importDefault$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=this&&module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default,"__esModule",{value:!0});var sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=__importDefault$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base(module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util.default),sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=__importDefault$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),createDOMElement$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.createDomElement,IS_MOBILE_DEVICE$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.isMobileDevice(),IS_MOBILE_OR_TABLET_DEVICE$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.isMobileOrTabletDevice(),IS_IPAD_OR_IPHONE$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.isIPadOrIPhone(),MAX_NAME_LENGTH$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=30,_slugify$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base=function(){function e(e,n){return void 0===n&&(n=null),"string"!=typeof e&&(e+=""),n="string"==typeof n?{replacement:n}:n||{},e=e.split("").reduce((function(e,r){return e+(t[r]||r).replace(n.remove||/[^\w\s$*_+~.()''!\-:@]/g,"")}),"").replace(/^\s+|\s+$/g,"").replace(/[-\s]+/g,n.replacement||"-").replace("#{replacement}$",""),n.lower?e.toLowerCase():e}var t=JSON.parse('{"$":"dollar","&":"and","<":"less",">":"greater","|":"or","¢":"cent","£":"pound","¤":"currency","¥":"yen","©":"(c)","ª":"a","®":"(r)","º":"o","À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","þ":"th","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"DJ","đ":"dj","Ē":"E","ē":"e","Ė":"E","ė":"e","Ę":"e","ę":"e","Ě":"E","ě":"e","Ğ":"G","ğ":"g","Ģ":"G","ģ":"g","Ĩ":"I","ĩ":"i","Ī":"i","ī":"i","Į":"I","į":"i","İ":"I","ı":"i","Ķ":"k","ķ":"k","Ļ":"L","ļ":"l","Ł":"L","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ř":"R","ř":"r","Ś":"S","ś":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ũ":"U","ũ":"u","Ū":"u","ū":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","ǈ":"LJ","ǉ":"lj","ǋ":"NJ","ǌ":"nj","Ș":"S","ș":"s","Ț":"T","ț":"t","˚":"o","Ά":"A","Έ":"E","Ή":"H","Ί":"I","Ό":"O","Ύ":"Y","Ώ":"W","ΐ":"i","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ϊ":"I","Ϋ":"Y","ά":"a","έ":"e","ή":"h","ί":"i","ΰ":"y","α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","ς":"s","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ϊ":"i","ϋ":"y","ό":"o","ύ":"y","ώ":"w","Ё":"Yo","Ђ":"DJ","Є":"Ye","І":"I","Ї":"Yi","Ј":"J","Љ":"LJ","Њ":"NJ","Ћ":"C","Џ":"DZ","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"U","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"u","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","ё":"yo","ђ":"dj","є":"ye","і":"i","ї":"yi","ј":"j","љ":"lj","њ":"nj","ћ":"c","џ":"dz","Ґ":"G","ґ":"g","฿":"baht","ა":"a","ბ":"b","გ":"g","დ":"d","ე":"e","ვ":"v","ზ":"z","თ":"t","ი":"i","კ":"k","ლ":"l","მ":"m","ნ":"n","ო":"o","პ":"p","ჟ":"zh","რ":"r","ს":"s","ტ":"t","უ":"u","ფ":"f","ქ":"k","ღ":"gh","ყ":"q","შ":"sh","ჩ":"ch","ც":"ts","ძ":"dz","წ":"ts","ჭ":"ch","ხ":"kh","ჯ":"j","ჰ":"h","ẞ":"SS","Ạ":"A","ạ":"a","Ả":"A","ả":"a","Ấ":"A","ấ":"a","Ầ":"A","ầ":"a","Ẩ":"A","ẩ":"a","Ẫ":"A","ẫ":"a","Ậ":"A","ậ":"a","Ắ":"A","ắ":"a","Ằ":"A","ằ":"a","Ẳ":"A","ẳ":"a","Ẵ":"A","ẵ":"a","Ặ":"A","ặ":"a","Ẹ":"E","ẹ":"e","Ẻ":"E","ẻ":"e","Ẽ":"E","ẽ":"e","Ế":"E","ế":"e","Ề":"E","ề":"e","Ể":"E","ể":"e","Ễ":"E","ễ":"e","Ệ":"E","ệ":"e","Ỉ":"I","ỉ":"i","Ị":"I","ị":"i","Ọ":"O","ọ":"o","Ỏ":"O","ỏ":"o","Ố":"O","ố":"o","Ồ":"O","ồ":"o","Ổ":"O","ổ":"o","Ỗ":"O","ỗ":"o","Ộ":"O","ộ":"o","Ớ":"O","ớ":"o","Ờ":"O","ờ":"o","Ở":"O","ở":"o","Ỡ":"O","ỡ":"o","Ợ":"O","ợ":"o","Ụ":"U","ụ":"u","Ủ":"U","ủ":"u","Ứ":"U","ứ":"u","Ừ":"U","ừ":"u","Ử":"U","ử":"u","Ữ":"U","ữ":"u","Ự":"U","ự":"u","Ỳ":"Y","ỳ":"y","Ỵ":"Y","ỵ":"y","Ỷ":"Y","ỷ":"y","Ỹ":"Y","ỹ":"y","‘":"\'","’":"\'","“":"\\"","”":"\\"","†":"+","•":"*","…":"...","₠":"ecu","₢":"cruzeiro","₣":"french franc","₤":"lira","₥":"mill","₦":"naira","₧":"peseta","₨":"rupee","₩":"won","₪":"new shequel","₫":"dong","€":"euro","₭":"kip","₮":"tugrik","₯":"drachma","₰":"penny","₱":"peso","₲":"guarani","₳":"austral","₴":"hryvnia","₵":"cedi","₹":"indian rupee","₽":"russian ruble","℠":"sm","™":"tm","∂":"d","∆":"delta","∑":"sum","∞":"infinity","♥":"love","元":"yuan","円":"yen","﷼":"rial"}');return e.extend=function(e){for(var n in e)t[n]=e[n]},e}();module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent=function(){function e(e,t,n,r){this.type=e,this.param=t,this.controlsContext=n,this.rowParent=r,this.newName=this.customUpdate=null,this.hidden=this.inContentEditMode=this.wasEdited=!1,this.inputComponent=null,this._previousValues=[],this.currentValue=this._previousValue=null,this.isChanged=!1,this.id=t.id,this.plugin=t.plugin,this.groupId=t.groupId?t.groupId:null,this.isMobileDevice=IS_MOBILE_DEVICE$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base,this.isMobileOrTabletDevice=IS_MOBILE_OR_TABLET_DEVICE$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base,this.isIPadOrIPhone=IS_IPAD_OR_IPHONE$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base,this.order=t.order,this.name=t.name,this.newName=null,this.hidden=this.inContentEditMode=this.wasEdited=!1,this.setting=n.options&&n.options.settings?t.setting:null,this.light=!!this.param&&this.param.light,this.slugId=n.runtimeId+"_"+_slugify$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base(t.id),this.parametersQueue=n.parametersQueue,this.settingsQueue=n.settingsQueue,t.customUpdate&&(this.customUpdate=function(e,n,r,o){t.customUpdate(e,n,r,o)}),-1===n.plugins.indexOf(t.plugin)&&n.plugins.push(t.plugin),this.createRow(e,t,r)}return e.prototype.createRow=function(e,t,n){this.row=createDOMElement$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base("div",{id:this.slugId+"-controlmenu-row",name:this.slugId+"-controlmenu-row",parent:n||this.controlsContext.container,classList:["sd-max-width-1","uk-padding-small","uk-margin-remove","sdv-control-panel-row-border"],attributes:{"uk-grid":'margin: "";'}}),(n=t.name).length>MAX_NAME_LENGTH$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base-3&&n.substring(0,MAX_NAME_LENGTH$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base-3),this.label=createDOMElement$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base("label",{id:this.slugId+"-label",parent:this.row,innerHTML:t.name,classList:"uk-width-expand uk-form-label uk-text-small uk-margin-small-bottom uk-padding-remove uk-text-uppercase uk-text-truncate".split(" "),attributes:{for:"slider"==this.slugId+"-"+e?"range":e,"param-id":t.id,title:t.name}}),this.controlsContext.options&&this.controlsContext.options.editMode&&this.label.classList.add("sdv-edit-mode"),this.inputContainer=createDOMElement$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base("div",{classList:["uk-width-1-1","uk-padding-remove"],parent:this.row})},e.prototype.pushToValueStack=function(e){this._previousValues.push(e)},e.prototype.clearStack=function(){this._previousValues=[]},e.prototype.setStackToLast=function(){var e=this._previousValues.pop();void 0!==e?(this._previousValues=[e],this.currentValue=e):this._previousValues=[]},e.prototype.setToInitalValue=function(){var e=this._previousValues[0];void 0!==e&&this.update(e)},e.prototype.isCurrentValueSameAsInital=function(){return this.currentValue===this._previousValues[0]},e.prototype.update=function(e,t){if(this.inputComponent)return this.currentValue=this.inputComponent.value=e,this.pushToValueStack(e),!0;throw Error("Input component not defined. Type of: "+this.type)},e.prototype.hide=function(e){this.hidden=e,this.inputComponent&&sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.hide(this.inputComponent,e)},e.prototype.toggleHide=function(){this.hide(!this.hidden)},e.prototype.disable=function(e){e?this.inputComponent.setAttribute("disabled","true"):this.inputComponent.removeAttribute("disabled")},e.prototype.setEditable=function(e){e?(this.label.addEventListener("input",(function(e){this.wasEdited=!0,this.newName=e.target.innerText}).bind(this)),this.label.contentEditable="true"):this.label.contentEditable="false",this.inContentEditMode=e},e.prototype.onSettingUpdate=function(e){this.inputComponent.value=e},e}();var module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider={default:{}},__extends$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider=this&&module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__importDefault$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider=this&&module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default,"__esModule",{value:!0});var sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider=__importDefault$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider=__importDefault$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider(module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util.default),sd_controls_components_base_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default;module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.SliderInputMenuComponent=function(e){function t(t,n,r,o,a){var i=e.call(this,n,r,o,a)||this;return i.updateKeyUp=function(e,t){if(t.which||t.keyCode)return 13==t.which||13==t.keyCode},i.defaultVal=r.defval,i.minVal=Number(r.min),i.maxVal=Number(r.max),n=null==r.decimalplaces?0:"Even"==r.type||"Odd"==r.type?2:"Int"==r.type||"Odd"==r.type||"Even"==r.type?1:Math.pow(.1,r.decimalplaces),i.decimalPlaces=r.decimalplaces?Number(r.decimalplaces):0,i.pushToValueStack(i.defaultVal),i.currentValue=i.defaultVal,i._previousValue=i.currentValue,i.cInputRange=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.createDomElement("input",{attributes:{type:"range",name:i.slugId+"-range",min:i.minVal,max:i.maxVal,step:n,value:i.defaultVal,tabIndex:-1},id:i.slugId+"-range",parent:i.inputContainer,value:i.defaultVal,classList:["uk-range","uk-width-2-3","uk-form-small","sd-input-range"]}),i.isMobileOrTabletDevice&&i.cInputRange.classList.add("sd-input-range-mobile"),i.cInputRange.classList.add(i.isIPadOrIPhone?"ios-padding-left":"uk-padding-remove-left"),i.cInputNumber=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.createDomElement("input",{id:i.slugId+"-number",parent:i.inputContainer,value:i.defaultVal,classList:["uk-input","uk-width-1-3","uk-form-small","sd-input-number"],attributes:{type:"number",name:i.slugId+"-number",min:i.minVal,max:i.maxVal,step:n}}),i.valueConversion=r.valueConversion?r.valueConversion:"value",sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.setDomElementEventListener(o.api,t,i,i.cInputRange,"change",i.update.bind(i)),r=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.isEventSupported("input","input")?"input":"change",sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.setDomElementEventListener(o.api,t,i,i.cInputNumber,r,i.update.bind(i),1e3,i.parameterValidation.bind(i)),sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.setDomElementEventListener(o.api,t,i,i.cInputNumber,"focusout",i.update.bind(i),10,i.parameterValidation.bind(i)),sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.setDomElementEventListener(o.api,t,i,i.cInputNumber,"keyup",i.updateKeyUp.bind(i),10,i.parameterValidation.bind(i)),i.cInputRange.addEventListener("input",(function(){return i.cInputNumber.value=i.cInputRange.value})),i.param.hasOwnProperty("registerMenuElement")&&i.param.registerMenuElement(i),i}return __extends$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider(t,e),t.prototype.hide=function(t){e.prototype.hide.call(this,t),sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.hide(this.cInputRange,t),sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.hide(this.cInputNumber,t)},t.prototype.formatValue=function(e){return Number(e).toFixed(this.decimalPlaces)},t.prototype.update=function(e){return this.onSettingUpdate(e),!0},t.prototype.parameterValidation=function(e){var t=e.val1;return t=Number.isNaN(t)||""==t?this._previousValue||this.defaultVal:this.formatValue(t),this.onSettingUpdate(t),this.currentValue<this.minVal?this.currentValue=this.minVal:this.currentValue>this.maxVal&&(this.currentValue=this.maxVal),this.cInputRange.value=this.currentValue,this.cInputNumber.value=this.currentValue,this._previousValue!=this.currentValue&&(e.val1=this.currentValue,this._previousValue=e.val2=this.currentValue,!0)},t.prototype.onSettingUpdate=function(e){this.currentValue=Number(e),this.pushToValueStack(e),this.cInputNumber.value=e,this.cInputRange.value=e},t}(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent);var module$src$api$apps$sd_controls$components$component_string$sd_controls_components_string_input={default:function(e,t,n,r,o){module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.call(this,t,n,r,o),t=n.defval,o=parseInt(n.max),this.inputComponent=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("input",{id:this.slugId+"-text",parent:this.inputContainer,maxLength:o,value:t,classList:["uk-input","uk-form-small"],attributes:{type:"text",name:this.slugId+"-text"}}),this.valueConversion=n.valueConversion?n.valueConversion:"value",(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener)(r.api,e,this,this.inputComponent,"input",this.update.bind(this),1e3)}},createDOMElement$$module$src$api$apps$sd_controls$components$component_string$sd_controls_components_string_input=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement,setDomElementEventListener$$module$src$api$apps$sd_controls$components$component_string$sd_controls_components_string_input=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener,MenuComponent$$module$src$api$apps$sd_controls$components$component_string$sd_controls_components_string_input=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent;module$src$api$apps$sd_controls$components$component_string$sd_controls_components_string_input.default.prototype=Object.create(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.prototype);var module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input={default:{}},__extends$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input=this&&module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__importDefault$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input=this&&module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default,"__esModule",{value:!0});var sd_controls_components_base_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default,sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input=__importDefault$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input=__importDefault$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input(module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util.default);module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.BooleanInputMenuComponent=function(e){function t(t,n,r,o,a){var i=e.call(this,n,r,o,a)||this;i.events=[],i.disableIds=r.disableIds,i.disableOn=r.disableOn,n=null==r.strue?null:r.strue,a=null==r.sfalse?null:r.sfalse;var s="true"==r.defval||1==r.defval;return i.pushToValueStack(s),i.currentValue=s,i._previousValue=i.currentValue,null==n?(i.container=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("label",{id:i.slugId+"_-checkbox-label",parent:i.inputContainer,classList:"sdv-control-panel-control",className:"sdv-control-panel-boolean-input-checkbox-label",attributes:{for:i.slugId+"-checkbox"}}),i.cInputCheckbox=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("input",{id:i.slugId+"-checkbox",parent:i.container,checked:s,classList:["shapediver-viewer-element","sdv-control-panel-boolean-input-checkbox","sdv-control-panel-control"],attributes:{type:"checkbox",name:i.slugId+"-checkbox"}}),i.cInputCheckboxContainer=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("div",{id:i.slugId+"-checkbox-helper",parent:i.container,classList:"sdv-control-panel-boolean-input-boxhelper",attributes:{for:i.slugId+"-checkbox"}}),i.valueConversion=r.valueConversion?r.valueConversion:"checked",sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.setDomElementEventListener(o.api,t,i,i.cInputCheckbox,"change",i.update.bind(i))):(i.container=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("form",{id:i.slugId+"-form",parent:i.inputContainer,classList:["sdv-control-panel-boolean-input-form","sdv-control-panel-control"]}),i.label.setAttribute("for",i.slugId+"-form"),sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("label",{id:i.slugId+"-label-true",parent:i.container,innerHTML:n,classList:"sdv-control-panel-boolean-input-radio-label"}),i.cInputCheckboxTrue=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("input",{id:i.slugId+"-radio-true",parent:i.container,innerHTML:n,checked:s,value:"true",classList:"sdv-control-panel-boolean-input-radio",attributes:{type:"radio",name:i.slugId+"-radio-true"}}),sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("label",{id:i.slugId+"-label-false",parent:i.container,innerHTML:a,classList:"sdv-control-panel-boolean-input-radio-label"}),i.cInputCheckboxFalse=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createDomElement("input",{id:i.slugId+"-radio-false",parent:i.container,innerHTML:a,checked:!s,value:"true",classList:"sdv-control-panel-boolean-input-radio",attributes:{type:"radio",name:i.slugId+"-radio-false"}}),i.valueConversion=r.valueConversion?r.valueConversion:"checked",sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.setDomElementEventListener(i.id,i,i.cInputCheckboxTrue,"change",i.update.bind(i)),i.cInputCheckboxFalse.onchange=function(){i.cInputCheckboxTrue.checked=!i.cInputCheckboxFalse.checked,i.cInputCheckboxFalse.checked&&i.cInputCheckboxTrue.onchange(!0)},i.container.appendChild(sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.createMenuElement("br"))),i}return __extends$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input(t,e),t.prototype.update=function(e){var t=this;return this.pushToValueStack(e),this.currentValue=e,this.cInputCheckbox&&(this.cInputCheckbox.checked=e),this.cInputCheckboxTrue&&(this.cInputCheckboxTrue.checked=e),this.cInputCheckboxFalse&&(this.cInputCheckboxFalse.checked=!e),this.disableIds&&0<this.disableIds.length&&this.controlsContext.controls.filter((function(e){return t.disableIds.includes(e.id)}),this).forEach((function(n){return n.disable(e===t.disableOn)}),this),!0},t.prototype.hide=function(t){e.prototype.hide.call(this,t),this.cInputCheckbox&&sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.hide(this.cInputCheckbox,t),this.cInputCheckboxContainer&&sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.hide(this.cInputCheckboxContainer,t),this.cInputCheckboxTrue&&sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.hide(this.cInputCheckboxFalse,t),this.cInputCheckboxFalse&&sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.hide(this.cInputCheckboxTrue,t)},t.prototype.onSettingUpdate=function(e){this.pushToValueStack(e),this.cInputCheckbox&&(this.cInputCheckbox.checked=e),this.cInputCheckboxTrue&&(this.cInputCheckboxTrue.checked=e),this.cInputCheckboxFalse&&(this.cInputCheckboxFalse.checked=!e)},t}(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent);var module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input={default:{}},__extends$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input=this&&module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__importDefault$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input=this&&module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default,"__esModule",{value:!0});var sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input=__importDefault$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input=__importDefault$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input(module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util.default),sd_controls_components_base_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default,toTinyColor_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input=__importDefault$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input(module$src$shared$util$toTinyColor.default);module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.ColorInputMenuComponent=function(e){function t(t,n,r,o,a){var i=e.call(this,n,r,o,a)||this;return n=toTinyColor_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default(n=r.defval),o.useSpectrum?(i.inputComponent=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.createDomElement("input",{id:i.slugId+"-color",parent:i.inputContainer,classList:["uk-hidden"],attributes:{name:i.slugId+"-color"}}),i.inputComponent.setAttribute("type","text"),i.pushToValueStack(n.toRgbString()),$("#"+i.slugId+"-color").spectrum({color:n.toRgbString(),replacerClassName:"uk-padding-remove",showInput:!0,showInitial:!0,preferredFormat:"rgb",change:function(e){i.inputComponent.setAttribute("value",e.toHexString()),(e=document.createEvent("Event")).initEvent("change",!1,!0),i.inputComponent.dispatchEvent(e)}}),i.colorPicker=i.row.getElementsByClassName("sp-replacer")[0]):(i.inputComponent=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.createDomElement("input",{id:i.slugId+"-color",parent:i.inputContainer,classList:["uk-input","uk-form-small","uk-form-width-xsmall"],attributes:{name:i.slugId+"-color"}}),i.inputComponent.setAttribute("type","color"),i.inputComponent.value=n.toHexString(),i.pushToValueStack(i.inputComponent.value),i.colorPicker=i.inputComponent),i.valueConversion=r.valueConversion?r.valueConversion:"value",sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.setDomElementEventListener(o.api,t,i,i.inputComponent,"change",i.update.bind(i),10,null),i}return __extends$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input(t,e),t.prototype.hide=function(t){e.prototype.hide.call(this,t),this.colorPicker&&sd_controls_components_util_util_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.hide(this.colorPicker,t)},t.prototype.update=function(e){return e=toTinyColor_1$$module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default(e),"color"===this.inputComponent.type?(this.inputComponent.value=e.toHexString(),this.pushToValueStack(this.inputComponent.value),this.currentValue=this.inputComponent.value):(e=e.toRgbString(),this.pushToValueStack(e),this.currentValue=e,$("#"+this.slugId+"-color").spectrum("set",e)),!0},t.prototype.onSettingUpdate=function(e){this.update(e)},t}(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent);var module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input={default:function(e,t,n,r,o){module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.call(this,t,n,r,o),t=n.name,this.row.removeChild(this.label),this.inputComponent=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("button",{id:this.slugId+"_button",parent:this.inputContainer,innerHTML:t,classList:"uk-button uk-button-default uk-button-small uk-width-expand text-transform-none uk-padding-remove sd-control-button".split(" "),attributes:{type:"button",name:this.slugId+"_button"}}),this.valueConversion=n.valueConversion?n.valueConversion:"none",(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener)(r.api,e,this,this.inputComponent,"click",this.update.bind(this))}},MenuComponent$$module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent,createDOMElement$$module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement,setDomElementEventListener$$module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener;module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input.default.prototype=Object.create(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.prototype),module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input.default.prototype.update=function(){return!this.inContentEditMode},module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input.default.prototype.setEditable=function(e){e?(this.inputComponent.contentEditable=!0,this.inputComponent.addEventListener("input",(function(e){this.wasEdited=!0,this.newName=e.target.innerText}).bind(this))):this.inputComponent.removeAttribute("disabled"),this.inContentEditMode=e};var module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input={default:{}},__extends$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input=this&&module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__importDefault$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input=this&&module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default,"__esModule",{value:!0});var sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input=__importDefault$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_components_base_1$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default,enums_1$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input=module$src$api$apps$sd_controls$enums$enums.default;module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default.DropdownInputMenuComponent=function(e){function t(t,n,r,o,a){return(n=e.call(this,n,r,o,a)||this).choices=r.choices,a=r.defval,n.inputComponent=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default.createDomElement("select",{id:n.slugId+"-form",parent:n.inputContainer,classList:["uk-select","uk-form-small","uk-width-expand"]}),n.valueConversion=r.valueConversion?r.valueConversion:"selectedIndex",sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default.setDomElementEventListener(o.api,t,n,n.inputComponent,"change",n.update.bind(n)),n.createChoices(n.choices,n.valueConversion.i?n.valueConversion.i(n,a):a),r.registerMenuElement&&r.registerMenuElement(n),n}return __extends$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input(t,e),t.prototype.createChoices=function(e,t){this.choices=e,this.inputComponent.innerHTML="";for(var n=0;n<this.choices.length;n++)this["cOption"+n]=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default.createDomElement("option",{id:this.slugId+"-option-"+n,parent:this.inputComponent,innerHTML:e[n],value:n,classList:[],attributes:{name:this.slugId+"-option-"+n,selected:n==t}});this.inputComponent.value=t.toString()},t.prototype.onSettingUpdate=function(t){e.prototype.onSettingUpdate.call(this,t),this.customUpdate&&(this.currentValue=this.choices[t],this.controlsContext.controlsEvents.trigger(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.DROPDOWN_CUSTOM_UPDATE,this))},t.prototype.update=function(e){this.pushToValueStack(e),this.currentValue=this.inputComponent.value=e;for(var t=0;t<this.choices.length;t++)this["cOption"+t].selected=t===e;return!0},t}(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent);var module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu={default:function(e,t,n,r,o){var a,i;module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.call(this,t,n,r,o),t=n.choices,this.pushToValueStack(o=n.defval),this.cForm=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("form",{id:this.slugId+"-form",parent:this.inputContainer,classList:[STRING_SDVCP$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu+"dropdown-input-form",STRING_SDVCPC$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu]}),this.inputComponent=[];var s=0;for(i=t.length;s<i;++s){var l=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("div",{parent:this.cForm});l=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("label",{id:this.slugId+"-label-"+s,parent:l,innerHTML:t[s],classList:[STRING_SDVCP$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu+"checklist-input-checkbox-label"]});var u=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("input",{id:this.slugId+"-checkbox-"+s,parent:l,innerHTML:t[s],value:s,attributes:{type:"checkbox",name:this.slugId+"-checkbox-"+s}});(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("div",{id:this.slugId+"-checkbox-helper",parent:l,classList:STRING_SDVCP$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu+"checklist-input-boxhelper",attributes:{for:this.slugId+"-checkbox-"+s}}),u.checked=o.includes(s),this.inputComponent.push(u),this.valueConversion=n.valueConversion?n.valueConversion:function(){var e=[];for(a=0;a<this.inputComponent.length;++a)this.inputComponent[a].checked&&e.push(a);return e},(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener)(r.api,e,this,u,"change",this.update.bind(this))}}},createDOMElement$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement,setDomElementEventListener$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener,controlsUtil$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu=module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util.default,MenuComponent$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent,STRING_SDVCP$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu="sdv-control-panel-",STRING_SDVCPC$$module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu="sdv-control-panel-control";module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu.default.prototype=Object.create(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.prototype),module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu.default.prototype.hide=function(e){this.hidden=e,module$src$api$apps$sd_controls$components$util$sd_controls_components_util_util.default.hide(this.cForm,e)},module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu.default.prototype.update=function(e){this.pushToValueStack(e),this.currentValue=e;for(var t=0,n=this.inputComponent.length;t<n;++t)this.inputComponent[t].checked=e.includes(t);return!0};var module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file={default:function(e,t,n,r,o){module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.call(this,t,n,r,o),log$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.showMessage=r.options&&r.options.showMessage?r.options.showMessage:function(){},t=n.name;var a=null;this.label.innerHTML="Select file…",this.inputComponent=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("button",{id:this.slugId+"_button",parent:this.inputContainer,innerHTML:t,classList:"uk-button uk-button-default uk-button-small uk-width-expand text-transform-none uk-padding-remove sd-control-button".split(" "),attributes:{type:"button",name:this.slugId+"_button"}}),this.fileinput=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("input",{id:this.slugId+"_fileinput",parent:this.inputContainer,style:"display:none",accept:n.format.join(","),attributes:{type:"file",name:this.slugId+"_fileinput"}}),this.fileinput.style.display="none",this.inputComponent.addEventListener("click",(function(){this.fileinput.click()}).bind(this)),this.valueConversion=function(e,t){return a&&0<a.length?(e=a[0],a=null,e):0<t.files.length?t.files[0]:""},this.checkMimeType=function(e){return n.format.includes(e)},this.getParamDef=function(){return n},this.checkSize=function(e){return e<=n.max},this.clear=function(){a=null,this.pushToValueStack(null),this.currentValue=null,0<this.fileinput.files.length?this.fileinput.value=null:this.change_handler()},this.change_handler=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener)(r.api,e,this,this.fileinput,"change",this.update.bind(this)),this.inputComponent.addEventListener("dragenter",e=function(e){e.stopPropagation(),e.preventDefault()},!1),this.inputComponent.addEventListener("dragover",e,!1),this.inputComponent.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(a=e.dataTransfer.files),this.change_handler()}),!1)}},createDOMElement$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement,setDomElementEventListener$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.setDomElementEventListener,GLOBAL_UTILS$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file=module$src$shared$util$GlobalUtils.default,MenuComponent$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent,log$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file={showMessage:function(){}};module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.default.prototype=Object.create(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent.prototype),module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.default.prototype.uploadError=function(){this.label.innerHTML="upload failed",this.label.classList.add("uk-text-danger")},module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.default.prototype.removeUploadError=function(){this.label.innerHTML="",this.label.classList.remove("uk-text-danger")},module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.default.prototype.update=function(e){var t=this;if(this.inContentEditMode)return!1;if(this.pushToValueStack(e),this.currentValue=e,e instanceof File){if(e._type=0<e.type.length?e.type:module$src$shared$util$GlobalUtils.default.guessMimeTypeFromFilename(e.name),!this.checkMimeType(e._type))return this.uploadError(),log$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.showMessage("warning","Allowed file types: "+this.getParamDef().format.join(", ")),!1;if(!this.checkSize(e.size))return this.uploadError(),log$$module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.showMessage("warning","Maximum file size: "+this.getParamDef().max+" bytes"),!1;this.removeUploadError(),this.label.innerHTML='<div uk-spinner="ratio: 0.5"></div>',this.fileName=e.name}else"string"==typeof e&&0<e.length?(this.label.innerHTML=this.fileName?22<this.fileName.length?this.fileName.substr(0,20)+"... ❌":this.fileName+"  ❌":"Saved file  ❌",this.label.onclick=function(){t.clear()}):(this.label.innerHTML="Select file…",this.label.onclick=null);return!0},module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.default.prototype.setEditable=function(e){e?(this.inputComponent.contentEditable=!0,this.inputComponent.addEventListener("input",(function(e){this.wasEdited=!0,this.newName=e.target.innerText}).bind(this))):this.inputComponent.contentEditable=!1,this.inContentEditMode=e};var module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion={default:{}},__extends$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion=this&&module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion=this&&module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,s)}l((r=r.apply(e,t||[])).next())}))},__generator$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion=this&&module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3]))l.label=n[1];else if(6===n[0]&&l.label<i[1])l.label=i[1],i=n;else{if(!(i&&l.label<i[2])){i[2]&&l.ops.pop(),l.trys.pop();continue}l.label=i[2],l.ops.push(n)}}n=t.call(e,l)}catch(r){n=[6,r],a=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,i,s,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__importDefault$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion=this&&module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default,"__esModule",{value:!0});var sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion=__importDefault$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_components_base_js_1$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default;module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.AccordionInputMenuComponent=function(e){function t(t,n,r,o,a){return(t=e.call(this,n,r,o,a)||this).rows=[],t}return __extends$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(t,e),t.prototype.close=function(){return __awaiter$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(this,void 0,void 0,(function(){var e,t=this;return __generator$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(this,(function(n){switch(n.label){case 0:return[4,this.isOpen()];case 1:return e=n.sent(),[2,new Promise((function(n){e&&UIkit.accordion(t.parametersEl.parentNode).toggle(0),n()}))]}}))}))},t.prototype.createRow=function(e,t,n){var r=this;this.rowId=this.slugId+"-controlmenu-row",this.row=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.createDomElement("div",{id:this.rowId,name:this.rowId,parent:n||this.controlsContext.container,classList:["uk-margin-remove","uk-padding-remove","sd-max-width-1"],attributes:{"uk-grid":'margin: "";'}}),this.ulElem=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.createDomElement("ul",{parent:this.row,attributes:{"uk-accordion":"multiple: false"},classList:["uk-width-1-1"]}),this.parametersEl=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.createDomElement("li",{parent:this.ulElem,classList:["jq-accordion-control-li"],attributes:{"data-setting-type":t.type}}),this.ulElem.onclick=function(e){r.closeOthers(),t.onClick&&t.onClick(r)},n=this.slugId+"-multiple-remove",this.label=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.createDomElement("a",{id:this.slugId+"-a",parent:this.parametersEl,innerHTML:(this.param.isSettingRemovable?'<span id="'+n+'" uk-icon="icon: close; ratio: 0.8;"></span>':"")+" "+t.name,classList:"uk-accordion-title uk-width-expand uk-form-label uk-text-uppercase uk-text-small uk-padding-small sdv-control-panel-row-border".split(" "),attributes:{for:"slider"==this.slugId+"-"+e?"range":e,"param-id":t.id}}),this.param.isSettingRemovable&&document.getElementById(n).addEventListener("click",(function(){return r.removeDiv()})),this.accordionContent=sd_controls_components_dom_dom_util_js_1$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.createDomElement("div",{parent:this.parametersEl,classList:["uk-accordion-content","uk-margin-remove"],attributes:{"uk-grid":""}}),this.controlsContext.options&&this.controlsContext.options.editMode&&this.label.classList.remove("sdv-edit-mode"),t.registerMenuElement&&t.registerMenuElement(this)},t.prototype.createSubElements=function(e){var t=this,n=this.param;Object.keys(n.settings).forEach((function(r){r=e(n.settings[r].type,n.settings[r],t.controlsContext,t.accordionContent),t.rows.push(r),r.label.classList.add("uk-margin-small-left"),r.label.classList.remove("uk-text-uppercase"),r.inputComponent?r.inputComponent.classList.add("uk-margin-small-left"):r.container?r.container.classList.add("uk-margin-small-left"):r.inputContainer&&r.inputContainer.classList.add("uk-margin-small-left"),r.colorPicker&&r.colorPicker.classList.add("uk-margin-small-left")}))},t.prototype.closeOthers=function(){var e=this;Array.from(document.getElementsByClassName("jq-accordion-control-li")).forEach((function(t){t.getAttribute("data-setting-type")!=e.param.type||e.parametersEl.isSameNode(t)||t.classList.contains("uk-open")&&UIkit.accordion(t.parentNode).toggle(0)}))},t.prototype.isOpen=function(){return __awaiter$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(this,void 0,void 0,(function(){var e=this;return __generator$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(this,(function(t){return[2,new Promise((function(t){window.setTimeout((function(){return t(e.parametersEl.classList.contains("uk-open"))}),50)}))]}))}))},t.prototype.open=function(){return __awaiter$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(this,void 0,void 0,(function(){return __generator$$module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion(this,(function(e){switch(e.label){case 0:return this.closeOthers(),[4,this.isOpen()];case 1:return e.sent()||UIkit.accordion(this.parametersEl.parentNode).toggle(0),[2,new Promise((function(e){return e()}))]}}))}))},t.prototype.removeDiv=function(){document.getElementById(this.rowId).remove(),this.param.remove()},t}(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent);var module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input={default:{}},__extends$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input=this&&module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__importDefault$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input=this&&module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default,"__esModule",{value:!0});var sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input=__importDefault$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_components_base_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default;module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.Vector3InputMenuComponent=function(e){function t(t,n,r,o,a){return(t=e.call(this,n,r,o,a)||this).valueConversion="value",t.unitVector=r.unitVector,t.min=r.min,t.max=r.max,t.step=r.step,t.decimalPlaces=r.decimalPlaces,t.defval=n=r.defval,t.currentValue=n,t._previousValue={},Object.assign(t._previousValue,t.currentValue),t.inputContainer.setAttribute("uk-grid",""),t.xContainer=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.createDomElement("div",{classList:["uk-width-3-3","uk-padding-remove-left","vector3-container","uk-form-custom"],parent:t.inputContainer}),t.cInputNumberXLabel=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.createDomElement("label",{parent:t.xContainer,innerHTML:"X",classList:["vector3-label"],attributes:{for:t.slugId+"-number-x"}}),t.cInputNumberX=t.createMenuInputElement("x",t.xContainer),t.yContainer=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.createDomElement("div",{classList:["uk-width-3-3","uk-padding-remove-left","vector3-container","uk-form-custom"],parent:t.inputContainer}),t.cInputNumberYLabel=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.createDomElement("label",{parent:t.yContainer,innerHTML:"Y",classList:["vector3-label"],attributes:{for:t.slugId+"-number-y"}}),t.cInputNumberY=t.createMenuInputElement("y",t.yContainer),t.zContainer=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.createDomElement("div",{classList:["uk-width-3-3","uk-padding-remove-left","vector3-container","uk-form-custom"],parent:t.inputContainer}),t.cInputNumberZLabel=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.createDomElement("label",{parent:t.zContainer,innerHTML:"Z",classList:["vector3-label"],attributes:{for:t.slugId+"-number-z"}}),t.cInputNumberZ=t.createMenuInputElement("z",t.zContainer),t.cInputNumberX.value=n.x.toFixed(t.decimalPlaces),t.cInputNumberY.value=n.y.toFixed(t.decimalPlaces),t.cInputNumberZ.value=n.z.toFixed(t.decimalPlaces),t.setChangeEventListener(t.cInputNumberX),t.setFocusOutEventListener(t.cInputNumberX),t.setKeyUpEventListener(t.cInputNumberX),t.setChangeEventListener(t.cInputNumberY),t.setFocusOutEventListener(t.cInputNumberY),t.setKeyUpEventListener(t.cInputNumberY),t.setChangeEventListener(t.cInputNumberZ),t.setFocusOutEventListener(t.cInputNumberZ),t.setKeyUpEventListener(t.cInputNumberZ),r.registerMenuElement(t),t}return __extends$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input(t,e),t.prototype.update=function(e,t){var n=!0;if(t&&("number"==typeof e||"string"==typeof e)){if(Number.isNaN(e))return!1;n=!1}return e=n?e:{x:Number(this.cInputNumberX.value),y:Number(this.cInputNumberY.value),z:Number(this.cInputNumberZ.value)},this.unitVector&&this.toUnitVector(e),!(Number.isNaN(e.x)||Number.isNaN(e.x)||Number.isNaN(e.y)||(this.cInputNumberX.value=e.x.toFixed(this.decimalPlaces),this.cInputNumberY.value=e.y.toFixed(this.decimalPlaces),this.cInputNumberZ.value=e.z.toFixed(this.decimalPlaces),this.currentValue.x=e.x,this.currentValue.y=e.y,this.currentValue.z=e.z,0))},t.prototype.toUnitVector=function(e){var t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2)+Math.pow(e.z,2));e.x/=t,e.y/=t,e.z/=t},t.prototype.updateKeyUp=function(e,t){if(t.which||t.keyCode)return 13==t.which||13==t.keyCode},t.prototype.formatValue=function(e){return parseFloat(e)},t.prototype.parameterValidation=function(e,t){var n=e.val1;return n=this.formatValue(n),t=t.srcElement.getAttribute("data-component"),this.currentValue[t]=n,this["cInputNumber"+t.toUpperCase()].value=n,this._previousValue[t]!=this.currentValue[t]&&(e.val1=n,e.val2=n,this._previousValue[t]=this.currentValue[t],!0)},t.prototype.onSettingUpdate=function(e){this.cInputNumberX.value=e.x.toFixed(this.decimalPlaces),this.cInputNumberY.value=e.y.toFixed(this.decimalPlaces),this.cInputNumberZ.value=e.z.toFixed(this.decimalPlaces)},t.prototype.setChangeEventListener=function(e){var t=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.isEventSupported("input","input")?"input":"change";sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.setDomElementEventListener(this.controlsContext.api,this.id,this,e,t,this.update.bind(this),1e3,this.parameterValidation.bind(this))},t.prototype.setFocusOutEventListener=function(e){this.update.bind(this),this.parameterValidation.bind(this)},t.prototype.setKeyUpEventListener=function(e){sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.setDomElementEventListener(this.controlsContext.api,this.id,this,e,"keyup",this.updateKeyUp.bind(this),10,this.parameterValidation.bind(this))},t.prototype.createMenuInputElement=function(e,t){var n={type:"number",name:this.slugId+"-number-"+e,"data-component":e};return this.step&&(n.step=this.step),this.min&&(n.min=this.min),this.max&&(n.max=this.max),sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.createDomElement("input",{id:this.slugId+"-number-"+e,parent:t,value:this.defval[e],classList:["uk-input","uk-form-small","sd-input-number","uk-width-2-3"],attributes:n})},t}(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent);var module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal={default:{}},__extends$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal=this&&module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__importDefault$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal=this&&module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default,"__esModule",{value:!0});var sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal=__importDefault$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_components_base_js_1$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal=module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default;module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default.ModalInputMenuComponent=function(e){function t(t,n,r,o,a){var i=e.call(this,n,r,o,a)||this;if(i.registerModelConfirmClick=function(e){document.getElementById(e).onclick=function(){i.customUpdate(null,null,null,i),i.registerModelConfirmClick(e)}},!r.modalId)throw Error("Mising modal id.");if(!r.modalContent)throw Error("Missing modal content.");if(!r.modalConfirmId)throw Error("Missing modal confirm id.");return t=r.name,i.row.removeChild(i.label),i.modal=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default.createDomElement("div",{id:r.modalId,parent:document.getElementsByTagName("body")[0],innerHTML:r.modalContent,attributes:{"uk-modal":""}}),i.inputComponent=sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default.createDomElement("button",{id:i.slugId+"_button",parent:i.inputContainer,innerHTML:t,classList:"uk-button uk-button-default uk-button-small uk-width-expand text-transform-none uk-padding-remove sd-control-button".split(" "),attributes:{type:"button",name:i.slugId+"_button","uk-toggle":"target: #"+r.modalId}}),i.inputComponent.addEventListener("click",(function(){i.onModalOpen&&i.onModalOpen(i.modal),i.registerModelConfirmClick(r.modalConfirmId)})),r.registerMenuElement&&r.registerMenuElement(i),i.valueConversion=r.valueConversion?r.valueConversion:"none",i}return __extends$$module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal(t,e),t}(module$src$api$apps$sd_controls$components$base$sd_controls_components_base.default.MenuComponent);var module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory={default:{}};module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default.createMenuElement=function(e,t,n,r){if(void 0===r&&(r=null),document.getElementById("22"),!n.api)throw Error("Controls context needs to have api property.");if(!n.container)throw Error("Controls context needs to have container property.");if(!n.plugins)throw Error("Controls context needs to have plugins property.");if(!n.runtimeId)throw Error("Controls context needs to have runtimeId property.");return(e=new MenuElementConstructors$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory[e](n.options&&n.options.settings?t.setting:t.id,e,t,n,r))instanceof module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.AccordionInputMenuComponent&&e.createSubElements(module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default.createMenuElement),n.controls.push(e),e},Object.defineProperty(module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default,"__esModule",{value:!0});var sd_controls_components_slider_1$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default,StringCom$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_string$sd_controls_components_string_input.default,BooleanCom$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default,sd_controls_components_color_input_1$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default,Button$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input.default,sd_controls_components_dropdown_input_1$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default,Form$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu.default,FileCom$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.default,sd_controls_components_accordion_1$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default,sd_controls_components_vector3_input_1$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default,sd_controls_components_modal_1$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory=module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default,MenuElementConstructors$$module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory={slider:module$src$api$apps$sd_controls$components$component_slider$sd_controls_components_slider.default.SliderInputMenuComponent,string:module$src$api$apps$sd_controls$components$component_string$sd_controls_components_string_input.default,boolean:module$src$api$apps$sd_controls$components$component_boolean$sd_controls_components_boolean_input.default.BooleanInputMenuComponent,color:module$src$api$apps$sd_controls$components$component_color$sd_controls_components_color_input.default.ColorInputMenuComponent,button:module$src$api$apps$sd_controls$components$component_button$sd_controls_components_button_input.default,dropdown:module$src$api$apps$sd_controls$components$component_dropdown$sd_controls_components_dropdown_input.default.DropdownInputMenuComponent,form:module$src$api$apps$sd_controls$components$component_checklist$sd_controls_components_checklist_menu.default,file:module$src$api$apps$sd_controls$components$component_file$sd_controls_components_file.default,multiple:module$src$api$apps$sd_controls$components$component_accordion$sd_controls_components_accordion.default.AccordionInputMenuComponent,vector3:module$src$api$apps$sd_controls$components$component_vector3$sd_controls_components_vector3_input.default.Vector3InputMenuComponent,modal:module$src$api$apps$sd_controls$components$component_modal$sd_controls_components_modal.default.ModalInputMenuComponent},module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal={default:{}},__extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal=this&&module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal.default,"__esModule",{value:!0});var sd_controls_constants_types_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,enums_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal=module$src$api$apps$sd_controls$enums$enums.default,sd_controls_settings_html_helpers_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal=module$src$api$apps$sd_controls$settings$sd_controls_settings_html_helpers.default,sd_controls_menu_element_factory_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal=module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default,sd_controls_setting_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal=module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default;module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal.default.AddLightModalSetting=function(e){function t(t,n,r){return(t=e.call(this,t,"scene.add.light",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.MODAL,"Add Light",module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS,Number.POSITIVE_INFINITY,null,!0)||this).controlsContext=n,t.settingsContext=r,t.modalConfirmId="jq-add-light-modal-confirm",t.modalId="jq-add-light-modal",t.defval=!1,t.modalContent=t.createModalContent(),t}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal(t,e),t.prototype.customUpdate=function(e,t,n,r){if(e=document.getElementById("jq-add-light-name").value,t=document.getElementById("jq-add-light-alert"),e){if(t&&(t.innerHTML=""),t=document.getElementById("jq-add-light-type").value,this.api.scene.lights.getLightScene().lights[e]){for(n=1;this.settingsContext.settings[e+n];)n++;e+=n}this.api.scene.lights.updateLight({id:e,type:this.api.scene.lights.LIGHTTYPE[t],properties:{}}),e=this.api.scene.lights.getLight(e),t=this.settingsContext.createLightSetting(e),this.settingsContext.settings[e.id]=t,(t=module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default.createMenuElement(t.type,t,this.controlsContext,this.controlsContext.groups.getGroup(t.groupId))).row.parentNode.insertBefore(t.row,r.row),this.controlsContext.controlsEvents.trigger(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.ADD,t),UIkit.modal(document.getElementById("jq-add-light-modal")).hide(),this.settingsContext.settings[e.id].getMenuElements().forEach((function(e){return e.open()})),this.controlsContext.shapeDiverDragControls.makeLightDraggable(e.id)}else t&&(t.innerHTML=module$src$api$apps$sd_controls$settings$sd_controls_settings_html_helpers.default.HTMLSettingsHelper.createAlert("Please specify a name for the new light"))},t.prototype.createModalContent=function(){return'\n    <div class="uk-modal-dialog uk-modal-body">\n\n    <h2 class="uk-modal-title">Add Light</h2>\n\n      <form class="uk-form-horizontal" onsubmit="return false">\n        <div class="uk-margin">\n          <label class="uk-form-label" for="form-horizontal-text">Name:</label>\n          <div class="uk-form-controls">\n              <input id="jq-add-light-name" class="uk-input" type="text" placeholder="type name ...">\n          </div>\n        </div>\n        <div class="uk-margin">\n          <label class="uk-form-label" for="form-horizontal-select">Type:</label>\n          <div class="uk-form-controls">\n              <select class="uk-select" id="jq-add-light-type">\n                  '+Object.keys(this.api.scene.lights.LIGHTTYPE).map((function(e){return"<option>"+e+"</option>"})).join("")+'\n              </select>\n          </div>\n        </div>\n        <p class="uk-text-right">\n          <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>\n          <input id="jq-add-light-modal-confirm" class="uk-button uk-button-primary" type="submit" value="save">\n          <div id="jq-add-light-alert">\n\n          </div>\n        </p>\n      </form>\n    </div>'},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting);var module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property={default:{}},__extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property=this&&module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__importDefault$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property=this&&module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default,"__esModule",{value:!0});var sd_controls_constants_types_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,enums_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property=module$src$api$apps$sd_controls$enums$enums.default,toTinyColor_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property=__importDefault$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property(module$src$shared$util$toTinyColor.default),sd_controls_setting_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property=module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default;module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.LightPropertySetting=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.light=!0,t}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property(t,e),Object.defineProperty(t.prototype,"lightId",{get:function(){return this._lightId},set:function(e){this._lightId=e},enumerable:!0,configurable:!0}),t.prototype.fireDragControlsUpdate=function(){var e=this.getLightDef();this.controlsContext.shapeDiverDragControls.updateLight(e)},t.prototype.getLightDef=function(){return this.api.scene.lights.getLight(this.lightId)},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting),module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.SliderLightPropertySetting=function(e){function t(t,n,r,o,a,i,s,l){return void 0===a&&(a=null),void 0===l&&(l=0),(a=e.call(this,t,r.id,module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,null!=a?a:o,module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS)||this).api=t,a.controlsContext=n,a.lightProperty=o,a.min=i,a.max=s,a.decimalplaces=l,a.lightId=r.id,a.defval=r.properties[o],a}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property(t,e),t.prototype.customUpdate=function(e,t){(e=this.getLightDef()).properties[this.lightProperty]=Number(t),this.api.scene.lights.updateLight(e)},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.LightPropertySetting),module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.ColorLightPropertySetting=function(e){function t(t,n,r,o,a){return void 0===a&&(a=null),(a=e.call(this,t,r.id,module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.COLOR,null!=a?a:o,module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS)||this).api=t,a.controlsContext=n,a.lightProperty=o,a.lightId=r.id,(t=toTinyColor_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default(r.properties[o])).setAlpha(1),a.defval=t.toString(),a.valueConversion={update:"value",f:function(e,t){return t=toTinyColor_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default(t.value),"color"===e.inputComponent.type?t.toHexString()+"FF":($("#"+this.slugId+"-color").spectrum("set",t.toRgbString()),""+t.toRgbString())}},a}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property(t,e),t.prototype.customUpdate=function(e,t){(e=this.getLightDef()).properties[this.lightProperty]=t,this.api.scene.lights.updateLight(e)},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.LightPropertySetting),module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.Vector3LightPropertySetting=function(e){function t(t,n,r,o,a,i,s,l,u,c){return void 0===a&&(a=null),void 0===i&&(i=2),void 0===s&&(s=.01),void 0===c&&(c=!1),(a=e.call(this,t,r.id,module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.VECTOR3,null!=a?a:o,module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS)||this).api=t,a.controlsContext=n,a.lightProperty=o,a.decimalPlaces=i,a.step=s,a.min=l,a.max=u,a.unitVector=c,a.lightId=r.id,a.defval=r.properties[o],a}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property(t,e),t.prototype.customUpdate=function(e,t,n,r){e=n.srcElement.getAttribute("data-component"),(n=this.getLightDef()).properties[this.lightProperty][e]=t,this.api.scene.lights.updateLight(n),this.fireDragControlsUpdate(),n=this.api.scene.lights.getLight(n.id),r.onSettingUpdate(n.properties[this.lightProperty])},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.LightPropertySetting),module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.BooleanLightPropertySetting=function(e){function t(t,n,r,o,a){return void 0===a&&(a=null),(a=e.call(this,t,r.id,module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,null!=a?a:o,module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS)||this).api=t,a.controlsContext=n,a.lightProperty=o,a.lightId=r.id,a.defval=r.properties[o],a}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property(t,e),t.prototype.customUpdate=function(e,t){(e=this.getLightDef()).properties[this.lightProperty]=t,this.api.scene.lights.updateLight(e)},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.LightPropertySetting);var module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save={default:{}},__extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save=this&&module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save.default,"__esModule",{value:!0});var sd_controls_setting_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save=module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default,sd_controls_constants_types_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,enums_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save=module$src$api$apps$sd_controls$enums$enums.default,sd_controls_settings_html_helpers_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save=module$src$api$apps$sd_controls$settings$sd_controls_settings_html_helpers.default;module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save.default.CreateSaveLightSceneModalSetting=function(e){function t(t,n){return(t=e.call(this,t,"save.lights.scene",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.MODAL,"Save Light Scene",module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS,Number.POSITIVE_INFINITY)||this).settingsContext=n,t.nameContent='<div class="uk-margin">\n                        <label class="uk-form-label" for="form-horizontal-text">Name:</label>\n                        <div class="uk-form-controls">\n                            <input id="jq-add-lights-scene-name" class="uk-input" type="text" placeholder="type name ...">\n                        </div>\n                      </div>\n                      <p class="uk-text-right">\n                        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>\n                        <button id="jq-add-lights-scene-modal-confirm" class="uk-button uk-button-primary" type="button">Save</button>\n                      </p>',t.overwriteContent='<label>The scene already exists. Do you want to overwrite it?</label>\n                          <p class="uk-text-right">\n                            <button id="jq-add-lights-scene-modal-confirm" data-overwrite="true" class="uk-button uk-button-primary" type="button">Yes</button>\n                            <button id="jq-add-lights-scene-modal-overwrite-cancel" class="uk-button uk-button-default uk-modal-close" type="button">No</button>\n                          </p>',t.modalConfirmId="jq-add-lights-scene-modal-confirm",t.modalId="jq-add-lights-scene-modal",t.defval=!1,t.modalContent=t.createModalContent(t.nameContent),t}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save(t,e),t.prototype.customUpdate=function(e){var t=this;e=document.getElementById(this.modalConfirmId).getAttribute("data-overwrite");var n=this.api.scene.lights.getAllLightScenes();if(!e){var r=document.getElementById("jq-add-lights-scene-name").value,o=document.getElementById("jq-add-lights-scenes-alert");if(!r)return void(o&&(o.innerHTML=module$src$api$apps$sd_controls$settings$sd_controls_settings_html_helpers.default.HTMLSettingsHelper.createAlert("Please specify a name for the light scene")));o&&(o.innerHTML="")}e||!n.some((function(e){return e==r}))?(this.api.scene.lights.saveLightScene(r),UIkit.modal("#jq-add-lights-scene-modal").hide(),document.getElementById("jq-add-lights-scenes-content").innerHTML=this.nameContent,this.settingsContext.settings["lights.lightScene"].getMenuElements().forEach((function(e){var n,o=t.api.scene.lights.getAllLightScenes();for(n=0;n<o.length&&o[n]!==r;n++);e.createChoices(o,n)}))):(document.getElementById("jq-add-lights-scenes-content").innerHTML=this.overwriteContent,document.getElementById("jq-add-lights-scene-modal-overwrite-cancel").onclick=function(){return document.getElementById("jq-add-lights-scenes-content").innerHTML=t.nameContent})},t.prototype.onModalOpen=function(e){if("default"===(e=this.api.scene.lights.getLightScene()).id||"legacy"===e.id)document.getElementById("jq-add-lights-scene-name").value="";else{var t=document.getElementById("jq-add-lights-scene-name").value;e=this.api.scene.lights.getAllLightScenes();for(var n="";e.some((function(e){return e==t}));)"number"==typeof n?n++:n=1,t+=n}},t.prototype.createModalContent=function(e){return'<div class="uk-modal-dialog uk-modal-body">\n            <h2 class="uk-modal-title">Save Light Scene</h2>\n\n              <form id="jq-add-lights-scenes-content" class="uk-form-horizontal">\n                '+e+'\n              </form>\n              <div id="jq-add-lights-scenes-alert">\n\n              </div>\n            </div>'},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting);var module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown={default:{}},__extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown=this&&module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown.default.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown.default,"__esModule",{value:!0});var sd_controls_menu_element_factory_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown=module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default,sd_controls_constants_types_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,enums_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown=module$src$api$apps$sd_controls$enums$enums.default,sd_controls_setting_1$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown=module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default;module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown.default.LoadLightSceneDropdownSetting=function(e){function t(t,n,r){return(t=e.call(this,t,"lights.lightScene",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.DROPDOWN,"Load Light Scene",module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS,Number.POSITIVE_INFINITY)||this).controlsContext=n,t.settingsContext=r,t.createInitalLightsCalled=!1,t.valueConversion={update:"selectedIndex",f:function(e,t){return t.options[t.selectedIndex].innerHTML},i:function(e,t){return e.choices.indexOf(t)}},t.choices=t.api.scene.lights.getAllLightScenes(),t}return __extends$$module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown(t,e),t.prototype.createLightElements=function(){if(!this.createInitalLightsCalled){this.createInitalLightsCalled=!0,this.controlsContext.controlsEvents.trigger(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.CLEAR_LIGHTS),this.choices=this.api.scene.lights.getAllLightScenes();for(var e=this.api.scene.lights.getLightScene().id,t=0,n=this.getMenuElements();t<n.length;t++){var r=n[t];this.choices.includes(e)&&r.createChoices(this.choices,this.valueConversion.i(r,e))}this.createLights(e)}},t.prototype.customUpdate=function(e,t,n,r){this.controlsContext.controlsEvents.trigger(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.CLEAR_LIGHTS),this.choices=e=this.api.scene.lights.getAllLightScenes(),r.createChoices(e,this.valueConversion.i(r,t)),this.createLights(t)},t.prototype.createLights=function(e){var t=this,n=[];this.choices.includes(e)?(this.api.scene.lights.setLightSceneFromID(e),n=this.api.scene.lights.getLightScene(e).lights):n=this.api.scene.lights.getLightScene().lights,Object.keys(n).forEach((function(e){var r=t.settingsContext.createLightSetting(e=n[e]);t.settingsContext.settings[e.id]=r,(e=module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default.createMenuElement(r.type,r,t.controlsContext,t.controlsContext.groups.getGroup(r.groupId))).row.parentNode.insertBefore(e.row,t.settingsContext.settings["add.lights.scene"].getMenuElements()[0].row),t.controlsContext.controlsEvents.trigger(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.ADD,e)}))},t}(module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting);var module$src$api$apps$sd_controls$settings$sd_controls_settings={default:{}},__importDefault$$module$src$api$apps$sd_controls$settings$sd_controls_settings=this&&module$src$api$apps$sd_controls$settings$sd_controls_settings.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$sd_controls$settings$sd_controls_settings.default,"__esModule",{value:!0});var sd_controls_constants_types_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,toTinyColor_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=__importDefault$$module$src$api$apps$sd_controls$settings$sd_controls_settings(module$src$shared$util$toTinyColor.default),sd_controls_settings_light_definition_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition.default,sd_controls_settings_light_add_modal_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal.default,sd_controls_settings_light_property_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default,sd_controls_settings_light_scene_create_save_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save.default,sd_controls_settings_light_scene_load_dropdown_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown.default,sd_controls_setting_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings=module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default;module$src$api$apps$sd_controls$settings$sd_controls_settings.default.SDControlsSettings=function(){function e(e,t){this.api=e,this.controlsContext=t,this.settings={},e={"render.shadows":new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"render.shadows",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,"Shadows",1,9),"render.ambientOcclusion":new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"render.ambientOcclusion",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,"Ambient Occlusion",1,10),bumpAmplitude:new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"defaultMaterial.bumpAmplitude",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,"Bump Amplitude",1,11,{max:1.000001,decimalplaces:3,valueConversion:function(e,t){return parseFloat(t.value)}}),defaultMaterialColor:{defval:e.getSetting("defaultMaterial.color"),id:5,order:3,groupId:1,setting:"defaultMaterial.color",name:"Default Material Color",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.COLOR,valueConversion:{update:"value",f:function(e,t){return t=toTinyColor_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings.default(t.value),"color"===e.inputComponent.type?t.toHexString():($("#"+this.slugId+"-color").spectrum("set",t.toRgbString()),t.toRgbString())}}},groundPlane:{defval:e.getSetting("groundPlaneVisibility"),id:6,order:1,groupId:1,setting:"groundPlaneVisibility",name:"Ground Plane",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN},grid:{defval:e.getSetting("gridVisibility"),id:7,order:2,groupId:1,setting:"gridVisibility",name:"Grid",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN},pointSize:{defval:e.getSetting("render.pointSize"),id:14,order:4,groupId:1,setting:"render.pointSize",name:"Point Size",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:.001,max:100.000001,decimalplaces:3,valueConversion:function(e,t){return parseFloat(t.value)}},topView:{defval:e.getSetting("camera.type"),id:15,order:1,groupId:4,setting:"camera.type",name:"Top View",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,valueConversion:{update:"value",f:function(e,t){return t.checked?1:0},i:function(e,t){return 1===t}}},enableZoom:{defval:!e.getSetting("camera.enableZoom"),id:16,order:3,groupId:4,setting:"camera.enableZoom",name:"Disable Zoom",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,valueConversion:{update:"value",f:function(e,t){return!t.checked},i:function(e,t){return!t}}},"camera.zoomSpeed":{defval:e.getSetting("camera.zoomSpeed"),id:17,order:3,groupId:4,setting:"camera.zoomSpeed",name:"Zoom Speed",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:0,max:1.000001,decimalplaces:2,valueConversion:function(e,t){return parseFloat(t.value)}},enablePan:{defval:!e.getSetting("camera.enablePan"),id:18,order:4,groupId:4,setting:"camera.enablePan",name:"Disable Pan",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,valueConversion:{update:"value",f:function(e,t){return!t.checked},i:function(e,t){return!t}}},"camera.panSpeed":{defval:e.getSetting("camera.panSpeed"),id:19,order:5,groupId:4,setting:"camera.panSpeed",name:"Pan Speed",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:0,max:1.000001,decimalplaces:2,valueConversion:function(e,t){return parseFloat(t.value)}},enableRotation:{defval:!e.getSetting("camera.enableRotation"),id:20,order:6,groupId:4,setting:"camera.enableRotation",name:"Disable Rotation",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,valueConversion:{update:"value",f:function(e,t){return!t.checked},i:function(e,t){return!t}}},"camera.rotationSpeed":{defval:e.getSetting("camera.rotationSpeed"),id:21,order:7,groupId:4,setting:"camera.rotationSpeed",name:"Rotation Speed",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:0,max:1.000001,decimalplaces:2,valueConversion:function(e,t){return parseFloat(t.value)}},"camera.autoRotationSpeed":{defval:e.getSetting("camera.autoRotationSpeed"),id:22,order:8,groupId:4,setting:"camera.autoRotationSpeed",name:"Auto Rotation",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:-10,max:10.000001,decimalplaces:2,valueConversion:function(e,t){return parseFloat(t.value)}},"camera.damping":{defval:e.getSetting("camera.damping"),id:23,order:9,groupId:4,setting:"camera.damping",name:"Damping Factor",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:0,max:10.000001,decimalplaces:2,valueConversion:function(e,t){return parseFloat(t.value)}},"camera.fov":{defval:e.getSetting("camera.fov"),id:24,order:2,groupId:4,setting:"camera.fov",name:"Field of View",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:10,max:90,decimalplaces:0,valueConversion:function(e,t){return parseFloat(t.value)}},"camera.zoomExtentsFactor":{defval:e.getSetting("camera.zoomExtentsFactor"),id:25,order:11,groupId:4,setting:"camera.zoomExtentsFactor",name:"Zoom Factor",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:.1,max:10.000001,decimalplaces:2,valueConversion:function(e,t){return parseFloat(t.value)}},"camera.cameraMovementDuration":{defval:e.getSetting("camera.cameraMovementDuration"),id:26,order:12,groupId:4,setting:"camera.cameraMovementDuration",name:"Movement duration [msec]",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:0,max:2500,decimalplaces:0,valueConversion:function(e,t){return parseFloat(t.value)}},"camera.autoAdjust":{defval:e.getSetting("camera.autoAdjust"),id:27,order:13,groupId:4,setting:"camera.autoAdjust",name:"Camera adjust",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN},"camera.revertAtMouseUp":{defval:e.getSetting("camera.revertAtMouseUp"),id:28,order:14,groupId:4,setting:"camera.revertAtMouseUp",name:"Camera revert",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN},"camera.revertAtMouseUpDuration":{defval:e.getSetting("camera.revertAtMouseUpDuration"),id:29,order:15,groupId:4,setting:"camera.revertAtMouseUpDuration",name:"Revert duration [msec]",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,min:0,max:2500,decimalplaces:0,valueConversion:function(e,t){return parseFloat(t.value)}},commitParameters:{defval:e.getSetting("commitParameters"),id:31,order:8,groupId:1,setting:"commitParameters",name:"Parameter validation",type:module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN}},Object.assign(this.settings,e),this.createBackgroundSettings(),this.createLightSettings()}return e.prototype.createLightSetting=function(e){var t,n=this.api,r={},o=0;for(t in e.properties)switch(t){case"intensity":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.SliderLightPropertySetting(n,this.controlsContext,e,t,null,0,5,1);break;case"angle":case"penumbra":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.SliderLightPropertySetting(n,this.controlsContext,e,t,null,0,Math.PI/2,2);break;case"distance":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.SliderLightPropertySetting(n,this.controlsContext,e,t);break;case"decay":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.SliderLightPropertySetting(n,this.controlsContext,e,t,null,0,2,2);break;case"color":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.ColorLightPropertySetting(n,this.controlsContext,e,t);break;case"groundColor":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.ColorLightPropertySetting(n,this.controlsContext,e,t,"Ground Color");break;case"skyColor":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.ColorLightPropertySetting(n,this.controlsContext,e,t,"Sky Color");break;case"direction":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.Vector3LightPropertySetting(n,this.controlsContext,e,t,null,2,.01,-1,1,!1);break;case"position":case"target":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.Vector3LightPropertySetting(n,this.controlsContext,e,t,null,0,1);break;case"castShadow":r[t]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_property.default.BooleanLightPropertySetting(n,this.controlsContext,e,t,"Cast Shadow")}return new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_definition.default.LightDefinitionSetting(n,this.controlsContext,r,e.id,2,o++,e)},e.prototype.createBackgroundSettings=function(){var e=this.api;this.settings["render.clearColor"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"render.clearColor",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.COLOR,"Background Color",3,1,{valueConversion:{update:"value",f:function(e,t){return t=toTinyColor_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings.default(t.value),"color"===e.inputComponent.type?t.toHexString():($("#"+this.slugId+"-color").spectrum("set",t.toRgbString()),t.toRgbString())}}}),this.settings["render.clearAlpha"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"render.clearAlpha",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER,"Background Alpha",3,2,{min:0,max:1,decimalplaces:2,valueConversion:function(e,t){return parseFloat(t.value)}}),this.settings["material.environmentMapAsBackground"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"material.environmentMapAsBackground",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN,"Environment",3,3),this.settings["material.environmentMap1"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"material.environmentMap",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.DROPDOWN,"Choose Environment",3,4,{choices:"none default default_bw blurred_lights georgentor georgentor_blur georgentor_blue_blur georgentor_bw_blur levelsets lythwood_field mountains ocean piazza_san_marco residential_garden room_abstract_1 sky storage_room storm subway_entrance subway_entrance_bw_blur white yokohama".split(" "),valueConversion:{update:"selectedIndex",f:function(e,t){return t.options[t.selectedIndex].innerHTML},i:function(e,t){return e.choices.indexOf(t.toLowerCase())}}}),this.settings["material.environmentMapResolution"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"material.environmentMapResolution",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.DROPDOWN,"Environment resolution",3,5,{choices:["256","512","1024","2048"],valueConversion:{update:"selectedIndex",f:function(e,t){return t.options[t.selectedIndex].innerHTML},i:function(e,t){return e.choices.indexOf(t)}}}),this.settings["material.environmentMap2"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_setting.default.Setting(e,"material.environmentMap",module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.STRING,"Custom Environment",3,6,{max:500})},e.prototype.createLightSettings=function(){var e=this.api;this.settings["add.lights.scene"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_add_modal.default.AddLightModalSetting(e,this.controlsContext,this),this.controlsContext.options.editMode&&(this.settings["save.lights.scene"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_create_save.default.CreateSaveLightSceneModalSetting(e,this)),this.settings["lights.lightScene"]=new module$src$api$apps$sd_controls$settings$lights$sd_controls_settings_light_scene_load_dropdown.default.LoadLightSceneDropdownSetting(e,this.controlsContext,this)},e}();var module$src$api$apps$sd_controls$settings$sd_controls_settings_groups={default:{}};Object.defineProperty(module$src$api$apps$sd_controls$settings$sd_controls_settings_groups.default,"__esModule",{value:!0});var sd_controls_components_dom_dom_util_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default,enums_1$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups=module$src$api$apps$sd_controls$enums$enums.default,Icon$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups=function(){function e(e,t){void 0===t&&(t=!1),this.html=t?'<a><span style="font-size: 1.2em;"><i class="far '+e+'"></i></span></a>':'<a><span uk-icon="'+e+'"></span></a>'}return e.prototype.toString=function(){return this.html},e}(),groupSettings$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups=[{groupId:module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.WORLD,icon:new Icon$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups("world")},{groupId:module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS,icon:new Icon$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups("fa-lightbulb",!0)},{groupId:module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.BACKGROUND,icon:new Icon$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups("image")},{groupId:module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.CAMERA,icon:new Icon$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups("video-camera")}];module$src$api$apps$sd_controls$settings$sd_controls_settings_groups.default.GroupSetings=function(){function e(e,t){var n=this;this.controlsCtx=t,this.groups={};var r=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement("ul",{parent:e,classList:["uk-margin-remove","uk-width-1-1","sdv-control-panel-row-border","shapediver-settings-tabs"],attributes:{"uk-tab":"swiping: false;"}}),o=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement("ul",{parent:e,classList:["uk-switcher","uk-width-1-1","uk-margin-remove-top"]});groupSettings$$module$src$api$apps$sd_controls$settings$sd_controls_settings_groups.forEach((function(e){var t=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement("li",{parent:r,classList:["uk-padding-remove","uk-width-1-4"],innerHTML:e.icon.toString()}),a=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement("li",{parent:o,attributes:{"uk-grid":""},classList:["uk-width-1-1","uk-margin-remove"]});n.groups[e.groupId]={contentEl:a,headerEl:t,id:e.groupId}}))}return e.prototype.getGroup=function(e){return this.groups[e].contentEl},e.prototype.headersClick=function(e){var t,n=this,r=function(t){o.groups[t].headerEl.addEventListener("click",(function(){return e(n.groups[t].id)}))},o=this;for(t in this.groups)r(t)},e}();var module$src$shared$util$Sortable={};module$src$shared$util$Sortable.default=function(){function e(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(e);this.el=e,this.options=t=f({},t),e[O]=this;var n,o={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",filter:null,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1};for(n in o)n in t||(t[n]=o[n]);for(var a in B(t),this)"_"===a.charAt(0)&&(this[a]=this[a].bind(this));this.nativeDraggable=!t.forceFallback&&H,r(e,"mousedown",this._onTapStart),r(e,"touchstart",this._onTapStart),this.nativeDraggable&&(r(e,"dragover",this),r(e,"dragenter",this)),F.push(this._onDragOver),t.store&&this.sort(t.store.get(this))}function t(e){y&&y.state!==e&&(i(y,"display",e?"none":""),!e&&y.state&&_.insertBefore(y,g),y.state=e)}function n(e,t,n){if(e){n=n||U;var r=(t=t.split(".")).shift().toUpperCase(),o=new RegExp("\\s("+t.join("|")+")(?=\\s)","g");do{if(">*"===r&&e.parentNode===n||!(""!==r&&e.nodeName.toUpperCase()!=r||t.length&&((" "+e.className+" ").match(o)||[]).length!=t.length))return e}while(e!==n&&(e=e.parentNode))}return null}function r(e,t,n){e.addEventListener(t,n,!1)}function o(e,t,n){e.removeEventListener(t,n,!1)}function a(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(I," ").replace(" "+t+" "," ");e.className=(r+(n?" "+t:"")).replace(I," ")}}function i(e,t,n){var r=e&&e.style;if(r){if(void 0===n)return U.defaultView&&U.defaultView.getComputedStyle?n=U.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in r||(t="-webkit-"+t),r[t]=n+("string"==typeof n?"":"px")}}function s(e,t,n){if(e){e=e.getElementsByTagName(t),t=0;var r=e.length;if(n)for(;t<r;t++)n(e[t],t);return e}return[]}function l(e,t,n,r,o,a,i){var s=U.createEvent("Event"),l=(e||t[O]).options,u="on"+n.charAt(0).toUpperCase()+n.substr(1);s.initEvent(n,!0,!0),s.to=t,s.from=o||t,s.item=r||t,s.clone=y,s.oldIndex=a,s.newIndex=i,t.dispatchEvent(s),l[u]&&l[u].call(e,s)}function u(e,t,n,r,o,a){var i,s=e[O],l=s.options.onMove,u=U.createEvent("Event");return u.initEvent("move",!0,!0),u.to=t,u.from=e,u.dragged=n,u.draggedRect=r,u.related=o||t,u.relatedRect=a||t.getBoundingClientRect(),e.dispatchEvent(u),l&&(i=l.call(s,u)),i}function c(e){e.draggable=!1}function d(){V=!1}function p(e){for(var t=(e=e.tagName+e.className+e.src+e.href+e.textContent).length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function h(e){var t=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&t++;return t}function m(e,t){var n,r;return function(){void 0===n&&(n=arguments,r=this,setTimeout((function(){1===n.length?e.call(r,n[0]):e.apply(r,n),n=void 0}),t))}}function f(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var g,$,v,y,_,b,x,w,S,M,E,T,C,P,A,L,R,D={},I=/\s+/g,O="Sortable"+(new Date).getTime(),N=window,U=N.document,k=N.parseInt,H=!!("draggable"in U.createElement("div")),G=function(e){return(e=U.createElement("x")).style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}(),V=!1,j=Math.abs,F=[],z=m((function(e,t,n){if(n&&t.scroll){var r=t.scrollSensitivity,o=t.scrollSpeed,a=e.clientX;e=e.clientY;var i=window.innerWidth,s=window.innerHeight;if(w!==n&&(w=n,!0===(x=t.scroll))){x=n;do{if(x.offsetWidth<x.scrollWidth||x.offsetHeight<x.scrollHeight)break}while(x=x.parentNode)}if(x){var l=x;t=x.getBoundingClientRect();var u=(j(t.right-a)<=r)-(j(t.left-a)<=r),c=(j(t.bottom-e)<=r)-(j(t.top-e)<=r)}u||c||(c=(s-e<=r)-(e<=r),((u=(i-a<=r)-(a<=r))||c)&&(l=N)),D.vx===u&&D.vy===c&&D.el===l||(D.el=l,D.vx=u,D.vy=c,clearInterval(D.pid),l&&(D.pid=setInterval((function(){l===N?N.scrollTo(N.pageXOffset+u*o,N.pageYOffset+c*o):(c&&(l.scrollTop+=c*o),u&&(l.scrollLeft+=u*o))}),24)))}}),30),B=function(e){var t=e.group;t&&"object"==typeof t||(t=e.group={name:t}),["pull","put"].forEach((function(e){e in t||(t[e]=!0)})),e.groups=" "+t.name+(t.put.join?" "+t.put.join(" "):"")+" "};return e.prototype={constructor:e,_onTapStart:function(e){var t=this,r=this.el,o=this.options,a=e.touches&&e.touches[0],i=(a||e).target,s=i,u=o.filter;if(!("mousedown"===e.type&&0!==e.button||o.disabled)&&(i=n(i,o.draggable,r))){if(T=h(i),"function"==typeof u){if(u.call(this,e,i,this))return l(t,s,"filter",i,r,T),void e.preventDefault()}else if(u&&(u=u.split(",").some((function(e){if(e=n(s,e.trim(),r))return l(t,e,"filter",i,r,T),!0}))))return void e.preventDefault();o.handle&&!n(s,o.handle,r)||this._prepareDragStart(e,a,i)}},_prepareDragStart:function(e,t,n){var o=this,i=o.el,l=o.options,u=i.ownerDocument;n&&!g&&n.parentNode===i&&(A=e,_=i,$=(g=n).parentNode,b=g.nextSibling,P=l.group,e=function(){o._disableDelayedDrag(),g.draggable=!0,a(g,o.options.chosenClass,!0),o._triggerDragStart(t)},l.ignore.split(",").forEach((function(e){s(g,e.trim(),c)})),r(u,"mouseup",o._onDrop),r(u,"touchend",o._onDrop),r(u,"touchcancel",o._onDrop),l.delay?(r(u,"mouseup",o._disableDelayedDrag),r(u,"touchend",o._disableDelayedDrag),r(u,"touchcancel",o._disableDelayedDrag),r(u,"mousemove",o._disableDelayedDrag),r(u,"touchmove",o._disableDelayedDrag),o._dragStartTimer=setTimeout(e,l.delay)):e())},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),o(e,"mouseup",this._disableDelayedDrag),o(e,"touchend",this._disableDelayedDrag),o(e,"touchcancel",this._disableDelayedDrag),o(e,"mousemove",this._disableDelayedDrag),o(e,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(e){e?this._onDragStart(A={target:g,clientX:e.clientX,clientY:e.clientY},"touch"):this.nativeDraggable?(r(g,"dragend",this),r(_,"dragstart",this._onDragStart)):this._onDragStart(A,!0);try{U.selection?U.selection.empty():window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(){_&&g&&(a(g,this.options.ghostClass,!0),e.active=this,l(this,_,"start",g,_,T))},_emulateDragOver:function(){if(L&&(this._lastX!==L.clientX||this._lastY!==L.clientY)){this._lastX=L.clientX,this._lastY=L.clientY,G||i(v,"display","none");var e=U.elementFromPoint(L.clientX,L.clientY),t=e,n=" "+this.options.group.name,r=F.length;if(t)do{if(t[O]&&-1<t[O].options.groups.indexOf(n)){for(;r--;)F[r]({clientX:L.clientX,clientY:L.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);G||i(v,"display","")}},_onTouchMove:function(t){if(A){e.active||this._dragStarted(),this._appendGhost();var n=t.touches?t.touches[0]:t,r=n.clientX-A.clientX,o=n.clientY-A.clientY;R=!0,L=n,i(v,"webkitTransform",r=t.touches?"translate3d("+r+"px,"+o+"px,0)":"translate("+r+"px,"+o+"px)"),i(v,"mozTransform",r),i(v,"msTransform",r),i(v,"transform",r),t.preventDefault()}},_appendGhost:function(){if(!v){var e=g.getBoundingClientRect(),t=i(g),n=this.options;a(v=g.cloneNode(!0),n.ghostClass,!1),a(v,n.fallbackClass,!0),i(v,"top",e.top-k(t.marginTop,10)),i(v,"left",e.left-k(t.marginLeft,10)),i(v,"width",e.width),i(v,"height",e.height),i(v,"opacity","0.8"),i(v,"position","fixed"),i(v,"zIndex","100000"),i(v,"pointerEvents","none"),n.fallbackOnBody&&U.body.appendChild(v)||_.appendChild(v),t=v.getBoundingClientRect(),i(v,"width",2*e.width-t.width),i(v,"height",2*e.height-t.height)}},_onDragStart:function(e,t){e=e.dataTransfer;var n=this.options;this._offUpEvents(),"clone"==P.pull&&(i(y=g.cloneNode(!0),"display","none"),_.insertBefore(y,g)),t?("touch"===t?(r(U,"touchmove",this._onTouchMove),r(U,"touchend",this._onDrop),r(U,"touchcancel",this._onDrop)):(r(U,"mousemove",this._onTouchMove),r(U,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(e&&(e.effectAllowed="move",n.setData&&n.setData.call(this,e,g)),r(U,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(e){var r,o=this.el,a=this.options,s=a.group,l=s.put,c=P===s,p=a.sort;if(void 0!==e.preventDefault&&(e.preventDefault(),!a.dragoverBubble&&e.stopPropagation()),R=!0,P&&!a.disabled&&(c?p||(r=!_.contains(g)):P.pull&&l&&(P.name===s.name||l.indexOf&&~l.indexOf(P.name)))&&(void 0===e.rootEl||e.rootEl===this.el)&&(z(e,a,this.el),!V))if(s=n(e.target,a.draggable,o),a=g.getBoundingClientRect(),r)t(!0),y||b?_.insertBefore(g,y||b):p||_.appendChild(g);else if(!(r=0===o.children.length||o.children[0]===v)&&(r=o===e.target)&&(r=(s=o.lastElementChild).getBoundingClientRect(),r=s=(5<e.clientY-(r.top+r.height)||5<e.clientX-(r.right+r.width))&&s),r){if(s){if(s.animated)return;h=s.getBoundingClientRect()}t(c),!1!==u(_,o,g,a,s,h)&&(g.contains(o)||(o.appendChild(g),$=o),this._animate(a,g),s&&this._animate(h,s))}else if(s&&!s.animated&&s!==g&&void 0!==s.parentNode[O]){S!==s&&(S=s,M=i(s),E=i(s.parentNode));var h=s.getBoundingClientRect(),m=h.right-h.left,f=h.bottom-h.top;p=/left|right|inline/.test(M.cssFloat+M.display)||"flex"==E.display&&0===E["flex-direction"].indexOf("row"),r=s.offsetWidth>g.offsetWidth,l=s.offsetHeight>g.offsetHeight,m=.5<(p?(e.clientX-h.left)/m:(e.clientY-h.top)/f),e=s.nextElementSibling,!1!==(f=u(_,o,g,a,s,h))&&(V=!0,setTimeout(d,30),t(c),c=1===f||-1===f?1===f:p?(c=g.offsetTop)===(p=s.offsetTop)?s.previousElementSibling===g&&!r||m&&r:p>c:e!==g&&!l||m&&l,g.contains(o)||(c&&!e?o.appendChild(g):s.parentNode.insertBefore(g,c?e:s)),$=g.parentNode,this._animate(a,g),this._animate(h,s))}},_animate:function(e,t){var n=this.options.animation;if(n){var r=t.getBoundingClientRect();i(t,"transition","none"),i(t,"transform","translate3d("+(e.left-r.left)+"px,"+(e.top-r.top)+"px,0)"),i(t,"transition","all "+n+"ms"),i(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout((function(){i(t,"transition",""),i(t,"transform",""),t.animated=!1}),n)}},_offUpEvents:function(){var e=this.el.ownerDocument;o(U,"touchmove",this._onTouchMove),o(e,"mouseup",this._onDrop),o(e,"touchend",this._onDrop),o(e,"touchcancel",this._onDrop)},_onDrop:function(t){var n=this.el,r=this.options;clearInterval(this._loopId),clearInterval(D.pid),clearTimeout(this._dragStartTimer),o(U,"mousemove",this._onTouchMove),this.nativeDraggable&&(o(U,"drop",this),o(n,"dragstart",this._onDragStart)),this._offUpEvents(),t&&(R&&(t.preventDefault(),!r.dropBubble&&t.stopPropagation()),v&&v.parentNode.removeChild(v),g&&(this.nativeDraggable&&o(g,"dragend",this),c(g),a(g,this.options.ghostClass,!1),a(g,this.options.chosenClass,!1),_!==$?0<=(C=h(g))&&(l(null,$,"sort",g,_,T,C),l(this,_,"sort",g,_,T,C),l(null,$,"add",g,_,T,C),l(this,_,"remove",g,_,T,C)):(y&&y.parentNode.removeChild(y),g.nextSibling!==b&&0<=(C=h(g))&&(l(this,_,"update",g,_,T,C),l(this,_,"sort",g,_,T,C))),e.active)&&(null!==C&&-1!==C||(C=T),l(this,_,"end",g,_,T,C),this.save()),_=g=$=v=b=y=x=w=A=L=R=C=S=M=P=e.active=null)},handleEvent:function(e){var t=e.type;"dragover"===t||"dragenter"===t?g&&(this._onDragOver(e),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault()):"drop"!==t&&"dragend"!==t||this._onDrop(e)},toArray:function(){for(var e,t=[],r=this.el.children,o=0,a=r.length,i=this.options;o<a;o++)n(e=r[o],i.draggable,this.el)&&t.push(e.getAttribute(i.dataIdAttr)||p(e));return t},sort:function(e){var t={},r=this.el;this.toArray().forEach((function(e,o){n(o=r.children[o],this.options.draggable,r)&&(t[e]=o)}),this),e.forEach((function(e){t[e]&&(r.removeChild(t[e]),r.appendChild(t[e]))}))},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return n(e,t||this.options.draggable,this.el)},option:function(e,t){var n=this.options;if(void 0===t)return n[e];n[e]=t,"group"===e&&B(n)},destroy:function(){var e=this.el;e[O]=null,o(e,"mousedown",this._onTapStart),o(e,"touchstart",this._onTapStart),this.nativeDraggable&&(o(e,"dragover",this),o(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),F.splice(F.indexOf(this._onDragOver),1),this._onDrop(),this.el=e=null}},e.utils={on:r,off:o,css:i,find:s,is:function(e,t){return!!n(e,t,e)},extend:f,throttle:m,closest:n,toggleClass:a,index:h},e.create=function(t,n){return new e(t,n)},e.version="1.4.2",e}();var module$src$api$apps$sd_controls$commit_queues$SDCommitQueue={default:function(e,t,n){this.use=n&&(n.defval||1==n),this._queue={},this._api=e,this._numOfElementsForCommit=0,this.container=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("div",{parent:t,classList:["sd-commit-container","uk-margin-remove"],attributes:{"uk-grid":""}}),e="uk-button uk-button-default uk-button-small uk-width-1-2 sd-commit-button uk-padding-remove".split(" "),this._commitBtn=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("button",{parent:this.container,innerHTML:"Apply",classList:e}),this._cancelBtn=(0,module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement)("button",{parent:this.container,innerHTML:"cancel",classList:e}),this._commitBtn.onclick=(function(){this.execute()}).bind(this),this._cancelBtn.onclick=(function(){for(id in this._queue)this._queue[id].menuEl.setToInitalValue();this.clear()}).bind(this),this.setUse(this.use),this.enableDisableCommitButtons()}},createDOMElement$$module$src$api$apps$sd_controls$commit_queues$SDCommitQueue=module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default.createDomElement;module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype.add=function(e,t,n){this._queue[t]={menuEl:e,val:n},e.isCurrentValueSameAsInital()?(this.removeCommitClass(e),!0===e.isChanged&&(this._numOfElementsForCommit--,e.isChanged=!1)):(this.addCommitClass(e),!1===e.isChanged&&(e.isChanged=!0,this._numOfElementsForCommit++)),this.enableDisableCommitButtons()},module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype.clear=function(){for(id in this._queue){var e=this._queue[id].menuEl;e.isChanged=!1,this.removeCommitClass(e)}this._queue={},this._numOfElementsForCommit=0,this.enableDisableCommitButtons()},module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype.enableDisableCommitButtons=function(){0<this._numOfElementsForCommit?(this._commitBtn.removeAttribute("disabled"),this._cancelBtn.removeAttribute("disabled")):(this._commitBtn.setAttribute("disabled",!0),this._cancelBtn.setAttribute("disabled",!0))},module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype.addCommitClass=function(e){e.row.classList.add("sd-commit")},module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype.removeCommitClass=function(e){e.row.classList.remove("sd-commit")},module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype.execute=function(){throw new Exception("Needs to be overriden")},module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype.setUse=function(e){e?(this.container.removeAttribute("hidden"),this.use=!0):(this.container.setAttribute("hidden",!0),this.use=!1)};var module$src$api$apps$sd_controls$commit_queues$SDCommitParametersQueue={default:function(e,t,n){module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.call(this,e,t,n),e.addEventListener(e.EVENTTYPE.SETTINGS_UPDATE,(function(e){if("commitParameters"===e.settings.key&&(this.setUse(e.settings.valueNew),!this.use)){for(id in this._queue)this._queue[id].menuEl.setToInitalValue();this.clear()}}).bind(this))}},SDCommitQueue$$module$src$api$apps$sd_controls$commit_queues$SDCommitParametersQueue=module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default;module$src$api$apps$sd_controls$commit_queues$SDCommitParametersQueue.default.prototype=Object.create(module$src$api$apps$sd_controls$commit_queues$SDCommitQueue.default.prototype),module$src$api$apps$sd_controls$commit_queues$SDCommitParametersQueue.default.prototype.execute=function(){var e=[];for(id in this._queue){var t=this._queue[id];e.push({id:id,value:t.val}),t.menuEl.setStackToLast()}this._api.parameters.updateAsync(e),this.clear()};var module$src$modules$shapediver_utils$src$Events={default:{}};Object.defineProperty(module$src$modules$shapediver_utils$src$Events.default,"__esModule",{value:!0}),module$src$modules$shapediver_utils$src$Events.default.GenericEvent=function(){function e(e){var t=this;void 0===e&&(e=[]),this.handlers={},e.forEach((function(e){return t.handlers[e]=[]}))}return e.prototype.on=function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},e.prototype.off=function(e,t){this.handlers[e]=this.handlers[e].splice(0).filter((function(e){return e!==t}))},e.prototype.clear=function(e){this.handlers[e]=[]},e.prototype.trigger=function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].forEach((function(e){return e(t)}))},e}();var module$src$modules$shapediver_utils$app={default:{}};Object.defineProperty(module$src$modules$shapediver_utils$app.default,"__esModule",{value:!0});var Events_1$$module$src$modules$shapediver_utils$app=module$src$modules$shapediver_utils$src$Events.default;module$src$modules$shapediver_utils$app.default.ShapeDiverUtils=function(){function e(){}return e.createGenericEvent=function(e){return void 0===e&&(e=[]),new module$src$modules$shapediver_utils$src$Events.default.GenericEvent(e)},e}();var module$src$modules$shapediver_lights_drag_controls$src$enums$enums={default:{}},LightControlsEvents$$module$src$modules$shapediver_lights_drag_controls$src$enums$enums;Object.defineProperty(module$src$modules$shapediver_lights_drag_controls$src$enums$enums.default,"__esModule",{value:!0}),(LightControlsEvents$$module$src$modules$shapediver_lights_drag_controls$src$enums$enums=module$src$modules$shapediver_lights_drag_controls$src$enums$enums.default.LightControlsEvents||(module$src$modules$shapediver_lights_drag_controls$src$enums$enums.default.LightControlsEvents={})).UPDATED="updated";var module$src$modules$shapediver_lights_drag_controls$src$definitions={default:{}};Object.defineProperty(module$src$modules$shapediver_lights_drag_controls$src$definitions.default,"__esModule",{value:!0}),module$src$modules$shapediver_lights_drag_controls$src$definitions.default.CreateDefinitions=function(){function e(e){this.three=e}return e.prototype.createAnchorAssetDefinition=function(){return{id:"anchor",group:"anchor_group",content:[{format:"anchor",data:[{version:"1.0",location:{x:0,y:0,z:0},format:"light_anchor",data:{text:null}}]}]}},e.prototype.createGeometryAssetDefinition=function(){return{id:"geometry",group:"geometry_group",interactionGroup:"dragGroup",interactionMode:"global",content:[{format:"three",data:{threeObject:null}}]}},e}();var module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper={default:{}},__awaiter$$module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper=this&&module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper.default.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,s)}l((r=r.apply(e,t||[])).next())}))},__generator$$module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper=this&&module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper.default.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3]))l.label=n[1];else if(6===n[0]&&l.label<i[1])l.label=i[1],i=n;else{if(!(i&&l.label<i[2])){i[2]&&l.ops.pop(),l.trys.pop();continue}l.label=i[2],l.ops.push(n)}}n=t.call(e,l)}catch(r){n=[6,r],a=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,i,s,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper.default,"__esModule",{value:!0}),module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper.default.ApiLightHelperWrapper=function(){function e(e){this.api=e}return e.prototype.getLightHelpersVisible=function(){return this.lightHelpersVisible},e.prototype.setLightHelpers=function(e){this.api.updateSettingAsync("scene.lights.helper",e),this.lightHelpersVisible=e},e.prototype.getLight=function(e){return this.api.scene.lights.getLight(e)},e.prototype.updateLight=function(e){return this.api.scene.lights.updateLight(e)},e.prototype.createInteractionsGroup=function(){return this.api.scene.updateInteractionGroups([{id:"dragGroup",selectable:!1,draggable:!0,hoverable:!1}])},e.prototype.getSceneBoundingBox=function(){return this.api.scene.getBoundingBox("CommPlugin_1").data},e.prototype.convertTo2D=function(e){return this.api.scene.convertTo2D(e).data[0]},e.prototype.toggleGeometry=function(e){this.api.scene.toggleGeometry([],e)},e.prototype.appendElementToVieweport=function(e,t){this.api.viewports.get(e).getContainer().appendChild(t)},e.prototype.isPointLight=function(e){return e.type===this.api.scene.lights.LIGHTTYPE.POINT},e.prototype.isSpotLight=function(e){return e.type===this.api.scene.lights.LIGHTTYPE.SPOT},e.prototype.isDirectionalLight=function(e){return e.type===this.api.scene.lights.LIGHTTYPE.DIRECTIONAL},e.prototype.addAnchorAddListener=function(e){this.api.scene.addEventListener(this.api.scene.EVENTTYPE.ANCHOR_ADD,e)},e.prototype.addAnchorRemoveListener=function(e){this.api.scene.addEventListener(this.api.scene.EVENTTYPE.ANCHOR_REMOVE,e)},e.prototype.addDragStartListener=function(e){this.api.scene.addEventListener(this.api.scene.EVENTTYPE.DRAG_START,e)},e.prototype.addDragMoveListener=function(e){this.api.scene.addEventListener(this.api.scene.EVENTTYPE.DRAG_MOVE,e)},e.prototype.addDragEndListener=function(e){this.api.scene.addEventListener(this.api.scene.EVENTTYPE.DRAG_END,e)},e.prototype.updateAsync=function(e){return __awaiter$$module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper(this,void 0,void 0,(function(){return __generator$$module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper(this,(function(t){return[2,this.api.scene.updateAsync(e,"lightHelpers")]}))}))},e.prototype.removeAsync=function(e){return __awaiter$$module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper(this,void 0,void 0,(function(){return __generator$$module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper(this,(function(t){return[2,this.api.scene.removeAsync(e,"lightHelpers")]}))}))},e}();var module$src$modules$shapediver_lights_drag_controls$src$controls={default:{}};Object.defineProperty(module$src$modules$shapediver_lights_drag_controls$src$controls.default,"__esModule",{value:!0});var app_1$$module$src$modules$shapediver_lights_drag_controls$src$controls=module$src$modules$shapediver_utils$app.default,enums_1$$module$src$modules$shapediver_lights_drag_controls$src$controls=module$src$modules$shapediver_lights_drag_controls$src$enums$enums.default,definitions_1$$module$src$modules$shapediver_lights_drag_controls$src$controls=module$src$modules$shapediver_lights_drag_controls$src$definitions.default,api_lightHelper_wrapper_1$$module$src$modules$shapediver_lights_drag_controls$src$controls=module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper.default;module$src$modules$shapediver_lights_drag_controls$src$controls.default.LightControls=function(){function e(e,t){this.three=t,this.iconScaling=2e3,this.icons={},this.offsets={},this.anchorAssets=[],this.currentScale=50,this.dragging=!1,this.geometryAssets=[],this.isEnabled=!1,this.events=module$src$modules$shapediver_utils$app.default.ShapeDiverUtils.createGenericEvent(),this.apiWrapper=new module$src$modules$shapediver_lights_drag_controls$src$api_lightHelper_wrapper.default.ApiLightHelperWrapper(e),this.createDefinitions=new module$src$modules$shapediver_lights_drag_controls$src$definitions.default.CreateDefinitions(this.three),this.addEventListeners()}return e.prototype.disableDragging=function(){for(var e=0;e<this.geometryAssets.length;e++)this.apiWrapper.removeAsync({id:this.geometryAssets[e].id});for(this.geometryAssets=[],e=0;e<this.anchorAssets.length;e++)this.apiWrapper.removeAsync({id:this.anchorAssets[e].id});this.anchorAssets=[]},e.prototype.enableDragging=function(e){var t=this,n=this.apiWrapper.getLight(e);if(n){if(this.apiWrapper.isSpotLight(n)){var r=n.type+"_"+e+"_position";r=this.createAssetDefinition(r,n.properties.position),e=this.createAssetDefinition(n.type+"_"+e+"_target",n.properties.target),this.geometryAssets.push(r.geometryAssetDefinition),this.geometryAssets.push(e.geometryAssetDefinition),this.anchorAssets.push(r.anchorAssetDefinition),this.anchorAssets.push(e.anchorAssetDefinition)}else if(this.apiWrapper.isPointLight(n))r=this.createAssetDefinition(r=n.type+"_"+e+"_position",n.properties.position),this.geometryAssets.push(r.geometryAssetDefinition),this.anchorAssets.push(r.anchorAssetDefinition);else if(this.apiWrapper.isDirectionalLight(n)){var o=this.getBoundingSphere();r=o.center;var a=o.radius;(o=new this.three.Vector3(n.properties.direction.x,n.properties.direction.y,n.properties.direction.z).normalize()).multiplyScalar(2.35*a),o.add(r),r=this.createAssetDefinition(r=n.type+"_"+e+"_position",o),this.geometryAssets.push(r.geometryAssetDefinition),this.anchorAssets.push(r.anchorAssetDefinition)}this.apiWrapper.updateAsync(this.geometryAssets.concat(this.anchorAssets)).then((function(e){for(var n=[],r=0;r<t.geometryAssets.length;r++)n.push(e.data[r].scenePath);t.apiWrapper.toggleGeometry(n)}))}},e.prototype.makeLightDraggable=function(e){if(!this.isEnabled){var t=this.apiWrapper.getSceneBoundingBox();this.dist=.025*t.min.distanceTo(t.max),this.apiWrapper.createInteractionsGroup(),this.isEnabled=!0}this.disableDragging(),this.enableDragging(e)},e.prototype.update=function(e){var t=e.properties,n=null;if(this.apiWrapper.isDirectionalLight(e)){t=this.boundingSphere.center;var r=this.boundingSphere.radius,o=new this.three.Vector3(e.properties.direction.x,e.properties.direction.y,e.properties.direction.z).normalize();o.multiplyScalar(2.35*r),o.add(t),t=this.apiWrapper.convertTo2D(o),(r=this.getIcon(e,"position"))&&(r.style.left=t.clientX-this.currentScale/2-this.domRect.x+"px",r.style.top=t.clientY-this.currentScale/2-this.domRect.y+"px")}else t.hasOwnProperty("position")&&(n=new this.three.Vector3((n=t.position).x,n.y,n.z));null!==n&&(t=this.apiWrapper.convertTo2D(n),r=this.getIcon(e,"position"))&&(r.style.left=t.clientX-this.currentScale/2-this.domRect.x+"px",r.style.top=t.clientY-this.currentScale/2-this.domRect.y+"px")},e.prototype.useLightHelpers=function(e){for(var t in this.apiWrapper.setLightHelpers(e),this.icons)document.getElementById(t).style.visibility=e?"visible":"hidden";!1===e&&this.disableDragging()},e.prototype.addEventListeners=function(){var e=this;this.apiWrapper.addAnchorAddListener((function(t){for(var n=0,r=t.anchors.length;n<r;n++){var o=t.anchors[n];if("light_anchor"===o.format){var a=o.viewport+"-shapediver-lights-domElements";e.domEl=document.getElementById(a),e.domEl||(e.domEl=document.createElement("div"),e.domEl.style.pointerEvents="none",e.domEl.style.position="absolute",e.domEl.style.width="100%",e.domEl.style.height="100%",e.domEl.style.top="0",e.domEl.style.left="0",e.domEl.id=a,e.apiWrapper.appendElementToVieweport(o.viewport,e.domEl)),(a=document.createElement("i")).style.position="absolute",a.style.width="50px",a.style.fontSize="50px",a.style.color="#000000",a.className=o.data.text.includes("position")?"fab fa-diaspora":"fas fa-bullseye",a.id=o.data.text;var i=e.icons[o.data.text];i&&e.domEl.removeChild(i),e.domEl.appendChild(a),e.icons[o.data.text]=a;var s=e.offsets[o.data.text];e.domRect=e.domEl.getClientRects()[0];var l=i=void 0;s?(i=new e.three.Vector3(o.location.x,o.location.y,o.location.z),i=(s=e.apiWrapper.convertTo2D(i)).clientX,l=s.clientY):(i=o.clientX,l=o.clientY),e.setIconPositionAndScale(a,i,l),o.updateFunction((function(t){e.dragging||(e.currentScale=1/(t.distance/e.dist)*e.iconScaling,e.setIconPositionAndScale(e.icons[t.data.text],t.clientX,t.clientY))}))}}})),this.apiWrapper.addAnchorRemoveListener((function(t){for(var n=0,r=t.anchors.length;n<r;n++){var o=t.anchors[n];if("light_anchor"===o.format){var a=document.getElementById(o.viewport+"-shapediver-lights-domElements"),i=e.icons[o.data.text];delete e.icons[o.data.text],a.removeChild(i)}}})),this.apiWrapper.addDragStartListener((function(t){e.dragging=!0,t=e.apiWrapper.getSceneBoundingBox(),t=new e.three.Box3(t.min,t.max),e.boundingSphere=new e.three.Sphere,t.getBoundingSphere(e.boundingSphere)})),this.apiWrapper.addDragMoveListener((function(t){var n=t.scenePath.substring(t.scenePath.indexOf(".lightHelperGeometry_")+21),r=e.offsets[n],o=n.substring(n.indexOf("_")+1);o=o.substring(o.indexOf("_")+1);var a=e.getLightDefinitionFromItemId(n);t=t.obj.position.clone().add(r),e.handlePositionAndLightDefinitionFromDirectionalLight(t,a),r=e.apiWrapper.convertTo2D(t),e.setIconPositionAndScale(e.icons[n],r.clientX,r.clientY),a.properties[o]={x:t.x,y:t.y,z:t.z},e.apiWrapper.updateLight(a),e.events.trigger(module$src$modules$shapediver_lights_drag_controls$src$enums$enums.default.LightControlsEvents.UPDATED,a)})),this.apiWrapper.addDragEndListener((function(t){e.dragging=!1;var n=[],r=t.scenePath.substring(t.scenePath.indexOf(".lightHelperGeometry_")+21);e.apiWrapper.removeAsync({id:"lightHelperAnchor_"+r});var o=e.offsets[r];if(t=t.obj.position.clone().add(o),o=e.getLightDefinitionFromItemId(r),e.apiWrapper.isDirectionalLight(o)){e.apiWrapper.removeAsync({id:"lightHelperGeometry_"+r}),new e.three.Vector3(0,0,0);var a=e.getBoundingSphere();t=a.center,a=a.radius,(o=new e.three.Vector3(o.properties.direction.x,o.properties.direction.y,o.properties.direction.z).normalize()).multiplyScalar(2.35*a),t=o.add(t),(o=new e.three.Mesh(new e.three.SphereGeometry(e.dist,8,8),new e.three.MeshBasicMaterial({color:16776960,opacity:1,transparent:!1}))).geometry.applyMatrix((new e.three.Matrix4).makeTranslation(t.x,t.y,t.z)),(a=e.createDefinitions.createGeometryAssetDefinition()).id="lightHelperGeometry_"+r,a.content[0].data.threeObject=o,e.offsets[r]=new e.three.Vector3(t.x,t.y,t.z),n.push(a)}(o=e.createDefinitions.createAnchorAssetDefinition()).id="lightHelperAnchor_"+r,o.content[0].data[0].location={x:t.x,y:t.y,z:t.z},o.content[0].data[0].data.text=r,n.push(o),e.apiWrapper.updateAsync(n)}))},e.prototype.createAssetDefinition=function(e,t){var n=new this.three.Mesh(new this.three.SphereGeometry(this.dist,8,8),new this.three.MeshBasicMaterial({color:16776960,opacity:1,transparent:!1}));n.geometry.applyMatrix((new this.three.Matrix4).makeTranslation(t.x,t.y,t.z)),this.offsets[e]=new this.three.Vector3(t.x,t.y,t.z);var r=this.createDefinitions.createGeometryAssetDefinition();return r.id="lightHelperGeometry_"+e,r.content[0].data.threeObject=n,(n=this.createDefinitions.createAnchorAssetDefinition()).id="lightHelperAnchor_"+e,n.content[0].data[0].location=t,n.content[0].data[0].data.text=e,{geometryAssetDefinition:r,anchorAssetDefinition:n}},e.prototype.getBoundingSphere=function(e){return void 0===e&&(e=!1),this.boundingSphere&&!e||(e=this.apiWrapper.getSceneBoundingBox(),e=new this.three.Box3(e.min,e.max),this.boundingSphere=new this.three.Sphere,e.getBoundingSphere(this.boundingSphere)),this.boundingSphere},e.prototype.getIcon=function(e,t){return this.icons[e.type+"_"+e.id+"_"+t]},e.prototype.getLightDefinitionFromItemId=function(e){return e=(e=e.substring(e.indexOf("_")+1)).substring(0,e.indexOf("_")),this.apiWrapper.getLight(e)},e.prototype.handlePositionAndLightDefinitionFromDirectionalLight=function(e,t){if(this.apiWrapper.isDirectionalLight(t)){var n=this.getBoundingSphere(),r=n.center;n=n.radius,t.properties.direction=new this.three.Vector3(e.x,e.y,e.z).sub(new this.three.Vector3(r.x,r.y,r.z)).normalize(),(t=t.properties.direction.clone()).multiplyScalar(2.35*n),r=new this.three.Vector3(r.x,r.y,r.z).add(t),e.x=r.x,e.y=r.y,e.z=r.z}},e.prototype.setIconPositionAndScale=function(e,t,n){n=n-this.currentScale/2-this.domRect.y;var r=this.domEl.clientWidth-e.clientWidth;r=!(0>(t=t-this.currentScale/2-this.domRect.x)||t>r||0>n||n>this.domEl.clientHeight-e.clientHeight),this.apiWrapper.getLightHelpersVisible()&&r?(e.style.visibility="visible",e.style.left=t+"px",e.style.top=n+"px",e.style.width=this.currentScale+"px",e.style.fontSize=this.currentScale+"px"):e.style.visibility="hidden"},e}();var module$src$modules$shapediver_lights_drag_controls$app={default:{}};Object.defineProperty(module$src$modules$shapediver_lights_drag_controls$app.default,"__esModule",{value:!0});var controls_1$$module$src$modules$shapediver_lights_drag_controls$app=module$src$modules$shapediver_lights_drag_controls$src$controls.default,enums_1$$module$src$modules$shapediver_lights_drag_controls$app=module$src$modules$shapediver_lights_drag_controls$src$enums$enums.default;module$src$modules$shapediver_lights_drag_controls$app.default.ShapeDiverDragControls=function(){function e(e,t){var n=this;this.api=e,this.three=t,this.registeredLightEvents={},this.controls=new module$src$modules$shapediver_lights_drag_controls$src$controls.default.LightControls(e,t),this.controls.events.on(module$src$modules$shapediver_lights_drag_controls$src$enums$enums.default.LightControlsEvents.UPDATED,(function(e){n.registeredLightEvents[e.id]&&n.registeredLightEvents[e.id](e)}))}return e.prototype.makeLightDraggable=function(e){this.controls.makeLightDraggable(e)},e.prototype.onLightUpdate=function(e,t){this.registeredLightEvents[e]=t},e.prototype.updateLight=function(e){this.controls.update(e)},e.prototype.clearOnLightUpdateEvents=function(e){delete this.registeredLightEvents[e]},e.prototype.useLightHelpers=function(e){this.controls.useLightHelpers(e)},e}();var module$src$api$apps$SDControls={default:{}};module$src$api$apps$SDControls.default.default=function(e,t,n,r){function o(){var e,t="landscape"===(_&&_.detail?_.detail.mode:"landscape")&&!g.isMobileDevice,r=((e={})[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.SLIDER]=2,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.STRING]=2,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BOOLEAN]=1,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.COLOR]=1,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BUTTON]=1,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.DROPDOWN]=2,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.CHECKLIST]=2,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.FILE]=1,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.MULTIPLE]=4,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.VECTOR3]=2,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.MODAL]=1,e[module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.VECTOR3]=2,e),o="uk-width-1-1 uk-width-1-2 uk-width-1-4 uk-width-expand sd-max-width-1 sd-max-width-2 sd-max-width-4".split(" "),a=function(e){for(var i=0,s=[],l=function(){var e=0,t=function(t,n){s.filter((function(e){return e.spaceReq===t})).forEach((function(r){o.forEach((function(e){return r.domEl.classList.remove(e)})),r.domEl.classList.add("uk-width-1-"+n),r.domEl.classList.add("sd-max-width-"+t),e+=r.spaceReq}))};for(t(4,1),t(2,2),t(1,4),4>e&&(t=s.find((function(e){return e.domEl.classList.contains("uk-width-1-4")}))||s.find((function(e){return e.domEl.classList.contains("uk-width-1-2")})))&&((t=t.domEl.classList).contains("uk-width-1-2")&&!t.contains("uk-width-1-4")&&(t.remove("uk-width-1-2"),t.remove("sd-max-width-2"),t.add("uk-width-expand"),t.add("uk-max-width-expand")),t.contains("uk-width-1-4")&&(t.remove("uk-width-1-4"),t.remove("sd-max-width-1")),t.add(2<e?"uk-width-1-2":"uk-width-expand"),t.add(2<e?"sd-max-width-2":"sd-max-width-expand"));0<s.length;)s.pop();i=0},u={},c=0;c<e.length;c++){var d=e[c],p="defaultKey";d.groupId&&(p=d.groupId),u[p]||(u[p]=[]),u[p].push(d)}Object.keys(u).forEach((function(e){var c=u[e],d=c.length;e=function(e){var u=c[e];if(u.hidden&&!n.editMode)return"continue";var p=u.row;if(t)o.forEach((function(e){p.classList.remove(e),p.classList.add("uk-width-1-1"),p.classList.add("sd-max-width-1")}));else{var h=r[u.type];4>=(i+=h)?(s.push({domEl:p,spaceReq:h}),e===d-1&&l()):4<i&&(l(),s.push({domEl:p,spaceReq:h}),i=h,e===d-1&&l())}u.rows&&a(u.rows)};for(var p=0;p<d;p++)e(p)}))};a(M),P.setAttribute("uk-height-match","")}function a(){for(;x.firstChild;)x.removeChild(x.firstChild);S.length=0,M.length=0,E.length=0}function i(){null!=C&&window.clearTimeout(C),C=window.setTimeout((function(){var e;M.sort((function(e,t){return e.order-t.order}));var t=0;for(e=M.length;t<e;t++)(n&&n.editMode||!M[t].hidden)&&P.appendChild(M[t].row)}),1e3)}function s(e,t){if(e[t]){var r=Object.keys(e[t])[0],o=e[t][r];if(S.includes(r))l(e,t);else if((e=w[t+"."+o.type+"."+o.visualization])||(e=w[t+"."+o.type]),e||(e=w[t]),e){o.menuElementType=e,o.hidden=void 0!==o.hidden&&o.hidden,o.order=void 0===o.order?Number.MAX_SAFE_INTEGER:o.order,o.isParameter="parameter"===t;var a=module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default.createMenuElement(o.menuElementType,o,g);a[t]=!0,M.push(a),S.push(r),n&&n.editMode&&(a.hideIcon=y("i",{id:a.slugId+"-hide-icon",attributes:{"uk-icon":"icon: ban; ratio: 0.6;"},classList:["uk-float-right","uk-margin-remove","uk-padding-remove-right","sdv-control-brand-color"]}),a.sortIcon=y("i",{id:a.slugId+"-sort-icon",attributes:{"uk-icon":"icon: move; ratio: 0.8;"},classList:["sdv-control-brand-color","uk-padding-remove-left","uk-margin-small-right","jq-sdv-sort-bars","uk-width-auto"]}),a.hideIcon.onclick=function(){a.toggleHide()},a.inputContainer.classList.remove("uk-width-1-1"),a.inputContainer.classList.add("uk-width-expand"),a.type===module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BUTTON?((t=y("div",{classList:"uk-width-1-1"})).appendChild(a.hideIcon),a.row.insertBefore(t,a.row.childNodes[0])):((t=y("div",{classList:"uk-width-1-1"})).appendChild(a.hideIcon),a.row.insertBefore(t,a.label)),a.row.insertBefore(a.sortIcon,a.inputContainer),x.classList.add("sdv-control-panel-edit-mode")),a.row.parentNode===P&&P.removeChild(a.row),i()}}}function l(e,t){if(e[t]){var n=Object.keys(e[t])[0],r=e[t][n];if(S.includes(n)){for(e=0,t=M.length;e<t;e++){var o=M[e];if(o.id===n){void 0!==r.hidden&&o.hide(r.hidden),void 0!==r.order&&(o.order=r.order),void 0!==r.name&&o.name!==r.name&&(o.name=r.name,o.type===module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.BUTTON||o.type===module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default.TYPES.FILE?o.inputComponent.innerHTML="<span>"+o.name+"</span>":o.label.innerHTML=o.name);break}}i()}else s(e,t)}}function u(e){var t,n,r,o;if(e.parameter){var a=0;for(r=E.length;a<r;a++){var i=E[a];if(t=e.parameter[i])for(n in t){var s=0;for(o=M.length;s<o;s++){var l=M[s];l.plugin===i&&l.id===n&&l.update(t[n])}}}}}function c(){r&&"function"==typeof r.onElementCreated&&r.onElementCreated()}function d(e){if(e.settings){var t=e.settings.key;e=e.settings.valueNew;for(var n=0;n<M.length;n++){var r=M[n];r.setting===t&&r.onSettingUpdate(r.valueConversion&&r.valueConversion.i?r.valueConversion.i(r,e):e)}}}function p(){return __awaiter$$module$src$api$apps$SDControls(this,void 0,void 0,(function(){return __generator$$module$src$api$apps$SDControls(this,(function(e){return[2,new Promise((function(e){document.getElementById("sdv-font-awesome")&&e();var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.media="all",n.integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ",n.crossOrigin="anonymous",n.addEventListener("load",(function(){return e()})),t.appendChild(n),n.href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"}))]}))}))}function h(){return __awaiter$$module$src$api$apps$SDControls(this,void 0,void 0,(function(){return __generator$$module$src$api$apps$SDControls(this,(function(e){return[2,new Promise((function(e){var t=document.getElementById("sdv-spectrum");null==t?((t=document.createElement("script")).setAttribute("id","sdv-spectrum"),t.setAttribute("crossorigin","anonymous"),t.addEventListener("load",(function(){t.setAttribute("loaded","true"),e()})),document.head.appendChild(t),t.src="https://viewer.shapediver.com/external/spectrum.js?v=1908130856"):"true"==t.getAttribute("loaded")?e():t.addEventListener("load",(function(){t.setAttribute("loaded","true"),e()}))}))]}))}))}function m(){return __awaiter$$module$src$api$apps$SDControls(this,void 0,void 0,(function(){return __generator$$module$src$api$apps$SDControls(this,(function(e){return[2,new Promise((function(e){var t=document.getElementById("sdv-jquery");null==t?((t=document.createElement("script")).setAttribute("id","sdv-jquery"),t.setAttribute("integrity","sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="),t.setAttribute("crossorigin","anonymous"),t.addEventListener("load",(function(){t.setAttribute("loaded","true"),e()})),document.head.appendChild(t),t.src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"):"true"==t.getAttribute("loaded")?e():t.addEventListener("load",(function(){t.setAttribute("loaded","true"),e()}))}))]}))}))}function f(){return __awaiter$$module$src$api$apps$SDControls(this,void 0,void 0,(function(){var e=this;return __generator$$module$src$api$apps$SDControls(this,(function(t){return null==$&&($=new Promise((function(t){return __awaiter$$module$src$api$apps$SDControls(e,void 0,void 0,(function(){return __generator$$module$src$api$apps$SDControls(this,(function(e){switch(e.label){case 0:return[4,p()];case 1:return e.sent(),g.useSpectrum?[4,m()]:[3,4];case 2:return e.sent(),[4,h()];case 3:e.sent(),e.label=4;case 4:return t(!0),[2]}}))}))}))),[2,$]}))}))}var g={controlsEvents:module$src$modules$shapediver_utils$app.default.ShapeDiverUtils.createGenericEvent([module$src$api$apps$sd_controls$enums$enums.default.LightEvents.ADD,module$src$api$apps$sd_controls$enums$enums.default.LightEvents.CLEAR_LIGHTS,module$src$api$apps$sd_controls$enums$enums.default.LightEvents.REMOVE,module$src$api$apps$sd_controls$enums$enums.default.LightEvents.DROPDOWN_CUSTOM_UPDATE]),useSpectrum:!(sd_controls_components_dom_dom_util_1$$module$src$api$apps$SDControls.default.domSupportsHtml5Color()&&sd_controls_components_dom_dom_util_1$$module$src$api$apps$SDControls.default.isMobileDevice()),isMobileDevice:sd_controls_components_dom_dom_util_1$$module$src$api$apps$SDControls.default.isMobileDevice(),controls:[],shapeDiverDragControls:null,api:e,container:null,plugins:null,runtimeId:null,options:n,groups:null,parametersQueue:null},$=null;g.options||(g.options={editMode:!1});var v={"uk-grid":"","uk-height-match":""},y=sd_controls_components_dom_dom_util_1$$module$src$api$apps$SDControls.default.createDomElement,_=null;t.addEventListener("viewer-resized",(function(e){_=e,o()}));var b,x=t,w={"parameter.Int":"slider","parameter.Odd":"slider","parameter.Even":"slider","parameter.Float":"slider","parameter.String":"string","parameter.Bool":"boolean","parameter.Color":"color","parameter.StringList.checklist":"form","parameter.StringList.sequence":"dropdown","parameter.StringList.cycle":"dropdown","parameter.StringList.dropdown":"dropdown","parameter.File":"file",export:"button"},S=[],M=[],E=[],T=g.api.getRuntimeId();g.controlsEvents.on(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.REMOVE,(function(e){var t=M.find((function(t){return t.setting==e.setting&&t.name==e.name}));t&&(t.row.remove(),t=M.indexOf((function(t){return t.setting==e.setting&&t.name==e.name})),M=M.splice(t,1)),o()})),g.controlsEvents.on(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.ADD,(function(e){var t=M.find((function(t){return t.setting==e.setting&&t.name==e.name}));t&&(t.row.remove(),M=M.filter((function(t){return!(t.setting==e.setting&&t.name==e.name)}))),M.push(e),o()})),g.controlsEvents.on(module$src$api$apps$sd_controls$enums$enums.default.LightEvents.CLEAR_LIGHTS,(function(){M.forEach((function(e){e.light&&e.row.remove()})),M=M.filter((function(e){return!e.light}))}));var C=null,P=document.createElement("div");return Object.keys(v).forEach((function(e){P.setAttribute(e,v[e])})),["sdv-control-panel-row-container","uk-child-width-1-1","uk-margin-remove"].forEach((function(e){P.classList.add(e)})),g.container=P,g.plugins=E,g.runtimeId=T,function(){__awaiter$$module$src$api$apps$SDControls(this,void 0,void 0,(function(){var t,r,o,i,p,h,m,$,v,_,w;return __generator$$module$src$api$apps$SDControls(this,(function(S){switch(S.label){case 0:return n&&n.settings?(t=new module$src$api$apps$sd_controls$settings$sd_controls_settings.default.SDControlsSettings(g.api,g).settings,r=[],o=!1,f().then((function(){return o=!0})),g.api.addEventListener("settings.update",(function(e){o?d(e):r.push(new Promise((function(t){f().then((function(){t(e)}))})))})),[4,f()]):[3,2];case 1:for(h in S.sent(),b=y("button",{id:T+"_sd-control-panel-main-accordion-settings",parent:x,classList:"sd-control-panel-accordion"}),y("div",{id:T+"_settings-text",parent:b,innerHTML:"VIEWER SETTINGS",classList:["shapediver-viewer-element","sd-control-panel-accordion-text"]}),x.appendChild(P),g.api.addEventListener&&g.api.addEventListener(g.api.EVENTTYPE.DESTROYED,(function(e){"destroyed"===e.type&&a()})),i=new module$src$api$apps$sd_controls$settings$sd_controls_settings_groups.default.GroupSetings(g.container,g),g.groups=i,g.shapeDiverDragControls=new module$src$modules$shapediver_lights_drag_controls$app.default.ShapeDiverDragControls(g.api,THREE),p={},t)p[(m=t[h]).groupId]||(p[m.groupId]=[]),p[m.groupId].push(m);for(h in p)p[h].sort((function(e,t){return e.order-t.order})).forEach((function(e){M.push(module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default.createMenuElement(e.type,e,g,i.getGroup(e.groupId)))}));for($ in i.headersClick((function(e){for(var n in t){var r=t[n];"function"==typeof r.close&&r.close(),e===module$src$api$apps$sd_controls$enums$enums.default.SettingsGroups.LIGHTS?(g.shapeDiverDragControls.useLightHelpers(!0),"function"==typeof r.createLightElements&&r.createLightElements()):g.shapeDiverDragControls.useLightHelpers(!1)}})),c(),r)r[$].then((function(e){d(e)}));return[3,3];case 2:b=y("button",{id:T+"_sd-control-panel-main-accordion-parameters",parent:x,classList:"sd-control-panel-accordion"}),v=y("div",{id:T+"_settings-text",parent:b,innerHTML:"MODEL PARAMETERS",classList:["shapediver-viewer-element","sd-control-panel-accordion-text"]}),x.appendChild(P),n&&n.editMode&&(v.style.width="80%"),n&&n.editMode&&function(){var e=y("i",{classList:["sdv-control-brand-color","uk-margin-left"],attributes:{"uk-icon":"icon: file-edit; ratio: 0.7;"}});e.edit=!0,b.firstChild.appendChild(e),e.onclick=function(){if(e.edit){e.edit=!e.edit,e.setAttribute("uk-icon","icon: check; ratio: 0.7;");for(var t=0,n=M.length;t<n;t++){var r=M[t];r.setEditable(!0)}}else for(e.edit=!e.edit,e.setAttribute("uk-icon","icon: file-edit; ratio: 0.7;"),t=0,n=M.length;t<n;t++)(r=M[t]).setEditable(!1)},Sortable_1$$module$src$api$apps$SDControls.default.create(P,{handle:".jq-sdv-sort-bars",onEnd:function(e){var t=e.oldIndex;e=e.newIndex,null!=t&&null!=e&&t!=e&&M.splice(e,0,M.splice(t,1)[0])}})}(),g.parametersQueue=new SDCommitParametersQueue_1$$module$src$api$apps$SDControls.default(e,x,n.commitParameters),_=null,w=function(){window.clearTimeout(_),_=window.setTimeout((function(){c()}),1e3)},g.api.parameters.addEventListener(g.api.parameters.EVENTTYPE.REGISTERED,(function(e){f().then((function(){s(e,"parameter"),w()}))})),g.api.parameters.addEventListener(g.api.parameters.EVENTTYPE.UPDATE,(function(e){f().then((function(){l(e,"parameter")}))})),g.api.parameters.addEventListener(g.api.parameters.EVENTTYPE.VALUE_UPDATE,u),g.api.exports.addEventListener(g.api.exports.EVENTTYPE.REGISTERED,(function(e){f().then((function(){s(e,"export"),w()}))})),g.api.exports.addEventListener(g.api.exports.EVENTTYPE.UPDATE,(function(e){f().then((function(){l(e,"export")}))})),g.api.exports.addEventListener(g.api.exports.EVENTTYPE.VALUE_UPDATE,u),S.label=3;case 3:return[2]}}))}))}(),{destroy:a,save:function(){if(n&&!0===n.editMode)for(var e=0,t=M.length;e<t;e++){var r=M[e],o={id:r.id,hidden:r.hidden,name:null,order:null};r.wasEdited&&null!==r.newName&&r.newName!==r.name&&(o.name=r.newName),r.order!==e&&(o.order=e),1<Object.keys(o).length&&(!0===r.parameter?g.api.parameters.updateProperties(o):!0===r.export&&g.api.exports.updateProperties(o)),r.name=r.label.innerHTML,r.order=e}}}};var __awaiter$$module$src$api$apps$SDControls=this&&module$src$api$apps$SDControls.default.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,s)}l((r=r.apply(e,t||[])).next())}))},__generator$$module$src$api$apps$SDControls=this&&module$src$api$apps$SDControls.default.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3]))l.label=n[1];else if(6===n[0]&&l.label<i[1])l.label=i[1],i=n;else{if(!(i&&l.label<i[2])){i[2]&&l.ops.pop(),l.trys.pop();continue}l.label=i[2],l.ops.push(n)}}n=t.call(e,l)}catch(r){n=[6,r],a=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,a,i,s,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__importDefault$$module$src$api$apps$SDControls=this&&module$src$api$apps$SDControls.default.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(module$src$api$apps$SDControls.default,"__esModule",{value:!0});var sd_controls_settings_1$$module$src$api$apps$SDControls=module$src$api$apps$sd_controls$settings$sd_controls_settings.default,sd_controls_components_dom_dom_util_1$$module$src$api$apps$SDControls=__importDefault$$module$src$api$apps$SDControls(module$src$api$apps$sd_controls$components$dom$sd_controls_components_dom_dom_util.default),sd_controls_menu_element_factory_1$$module$src$api$apps$SDControls=module$src$api$apps$sd_controls$components$util$sd_controls_menu_element_factory.default,sd_controls_settings_groups_1$$module$src$api$apps$SDControls=module$src$api$apps$sd_controls$settings$sd_controls_settings_groups.default,Sortable_1$$module$src$api$apps$SDControls=__importDefault$$module$src$api$apps$SDControls(module$src$shared$util$Sortable.default),SDCommitParametersQueue_1$$module$src$api$apps$SDControls=__importDefault$$module$src$api$apps$SDControls(module$src$api$apps$sd_controls$commit_queues$SDCommitParametersQueue.default),app_1$$module$src$api$apps$SDControls=module$src$modules$shapediver_lights_drag_controls$app.default,sd_controls_constants_types_1$$module$src$api$apps$SDControls=module$src$api$apps$sd_controls$constants$sd_controls_constants_types.default,enums_1$$module$src$api$apps$SDControls=module$src$api$apps$sd_controls$enums$enums.default,app_2$$module$src$api$apps$SDControls=module$src$modules$shapediver_utils$app.default,ShapeDiverControls$$module$src$api$apps$SDControls=function(e,t,n,r){},module$src$api$apps$DomElementManager={default:function(e){var t={},n={};e.scene.addEventListener(e.scene.EVENTTYPE.ANCHOR_ADD,(function(e){if(e.anchors)for(var t=0,n=e.anchors.length;t<n;t++)r(e.anchors[t])})),e.scene.addEventListener(e.scene.EVENTTYPE.ANCHOR_REMOVE,(function(e){if(e.anchors)for(var t=0,n=e.anchors.length;t<n;t++)o(e.anchors[t])}));var r=function(r){if(!r.format||!n[r.format])return null;var o=document.getElementById(r.viewport+"-shapediver-domElements");o||((o=document.createElement("div")).id=r.viewport+"-shapediver-domElements",o.classList.add("shapediver-domElements"),e.viewports.get(r.viewport).getContainer().appendChild(o));var a=n[r.format];return o=a.add(o,r),t[r.scenePath]=o,r.updateFunction(a.update),o},o=function(e){if(!t[e.scenePath]||!e.format||!n[e.format])return null;n[e.format].remove(e)},a=function(t,n){var r=n.data,o=(0,module$src$shared$util$toTinyColor.default)(r.color,"black"),a=document.createElement("div");if(a.type="text/css",a.style.display="none",a.classList.add("shapediver-domElement"),t.appendChild(a),(t=document.createElement("span")).style.color=o.toHexString(),t.style.opacity=o.getAlpha(),t.innerHTML=r.text,t.classList.add("shapediver-domElement-span"),a.appendChild(t),r.textAlign)var i=r.textAlign;return t.style.textAlign="right"===i||"center"===i?i:"left",{domElement:a,api:e.viewports.get(n.viewport)}},i=function(e){var n=t[e.scenePath].domElement,r=e.data;if(e.hidden&&!1!==r.hidden)n.style.display="none";else{if(n.style.display="",r.positioning)var o=r.positioning.horizontal,a=r.positioning.vertical;r="right"===o?e.containerX-n.offsetWidth:"left"===o?e.containerX:e.containerX-n.offsetWidth/2,e="bottom"===a?e.containerY-n.offsetHeight:"top"===a?e.containerY:e.containerY-n.offsetHeight/2,n.style.left=r+"px",n.style.top=e+"px"}},s=function(e){var n=t[e.scenePath].domElement;n.style.display="none",document.getElementById(t[e.scenePath].api.getRuntimeId()+"-shapediver-domElements").removeChild(n)};n={tag2d:{add:a,remove:s,update:i},text:{add:a,remove:s,update:i},image:{add:function(t,n){var r=n.data,o=document.createElement("div");return o.type="text/css",o.style.display="none",o.classList.add("shapediver-domElement"),t.appendChild(o),t=document.createElement("img"),o.appendChild(t),t.src=r.src,r.height&&(t.height=r.height),r.width&&(t.width=r.width),r.alt&&(t.alt=r.alt),{domElement:o,api:e.viewports.get(n.viewport)}},remove:function(e){var n=t[e.scenePath].domElement;n.style.display="none",document.getElementById(t[e.scenePath].api.getRuntimeId()+"-shapediver-domElements").removeChild(n)},update:function(e){var n=t[e.scenePath].domElement,r=e.data;if(e.hidden&&!1!==r.hidden)n.style.display="none";else{if(n.style.display="",r.positioning)var o=r.positioning.horizontal,a=r.positioning.vertical;r="right"===o?e.containerX-n.offsetWidth:"left"===o?e.containerX:e.containerX-n.offsetWidth/2,e="bottom"===a?e.containerY-n.offsetHeight:"top"===a?e.containerY:e.containerY-n.offsetHeight/2,n.style.left=r+"px",n.style.top=e+"px"}}}}}},module$src$api$apps$UIkitViewportOverlays={},GLOBAL_UTILS$$module$src$api$apps$UIkitViewportOverlays=module$src$shared$util$GlobalUtils.default;module$src$api$apps$UIkitViewportOverlays.default=function(e,t){if(!window.UIkit)return null;if((t=t||{}).domElementIdPrefix=t.domElementIdPrefix||"sdv-container",t.hasOwnProperty("containerViewport")||(t.containerViewport=document.getElementById(t.domElementIdPrefix+"-viewport")),!t.containerViewport)return null;t.hasOwnProperty("containerControls")||(t.containerControls=document.getElementById(t.domElementIdPrefix+"-controls")),t.hasOwnProperty("containerSettings")||(t.containerSettings=document.getElementById(t.domElementIdPrefix+"-settings")),t.resizeHandler=t.resizeHandler||function(){};var n={},r=t.containerViewport,o=t.containerControls,a=t.containerSettings,i=[];"brandedMode createButtons showControlsButton showSettingsButton showZoomButton showFullscreenButton showInitialSpinner showBusySpinner".split(" ").forEach((function(e){"boolean"!=typeof t[e]&&(t[e]=module$src$shared$util$GlobalUtils.default.getBooleanNodeAttribute(t.container,e.toLowerCase(),!0))}));var s=document.createElement("ul");s.classList.add("uk-iconnav"),s.classList.add("shapediver-iconnav");var l=document.createElement("div");if(l.appendChild(s),r.appendChild(l),t.createButtons){var u=function(e,t,n){var r=document.createElement("li"),o=document.createElement("a");return o.href="#",o.setAttribute("uk-icon","icon: "+e),"function"==typeof n&&(o.onclick=n),t||(r.style.display="none"),r.appendChild(o),s.appendChild(r),{li:r,a:o,onclick:n}};if(a&&(n.settings=u("pencil",t.showSettingsButton,(function(n){"function"==typeof n.preventDefault&&n.preventDefault(),a.style.display="boolean"==typeof n?n?"":"none":"none"===a.style.display?"":"none",e&&e.scene&&"function"==typeof e.scene.render&&e.scene.render(),t.resizeHandler()})),t.showSettingsInitial&&(a.style.display="",t.resizeHandler())),o&&(n.controls=u("settings",t.showControlsButton,(function(n){"function"==typeof n.preventDefault&&n.preventDefault(),o.style.display="boolean"==typeof n?n?"":"none":"none"===o.style.display?"":"none",e&&e.scene&&"function"==typeof e.scene.render&&e.scene.render(),t.resizeHandler()})),t.showControlsInitial&&(o.style.display="",t.resizeHandler())),e&&e.scene&&e.scene.camera&&"function"==typeof e.scene.camera.resetAsync){var c=0;n.zoom=u("camera",t.showZoomButton,(function(n){"function"==typeof n.preventDefault&&n.preventDefault(),t.zoomButtonResetsCamera?e.scene.camera.resetAsync({coordinates:"spherical"}):0!==c?(e.scene.camera.resetAsync({coordinates:"spherical"}),clearTimeout(c),c=0):(e.scene.camera.zoomAsync(),c=setTimeout((function(){c=0}),500))})),0===e.getSetting("scene.camera.cameraMovementDuration")&&e.updateSettingAsync("scene.camera.cameraMovementDuration",1e3)}if(e&&"function"==typeof e.getSetting&&"function"==typeof e.updateSettingAsync){n.fullscreen=u("expand",t.showFullscreenButton,(function(t){"function"==typeof t.preventDefault&&t.preventDefault(),t=e.getSetting("scene.fullscreen"),e.updateSettingAsync("scene.fullscreen",!t)}));var d=function(){document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement?n.fullscreen.a.setAttribute("uk-icon","icon: shrink"):n.fullscreen.a.setAttribute("uk-icon","icon: expand")};document.addEventListener("webkitfullscreenchange",d),document.addEventListener("mozfullscreenchange",d),document.addEventListener("fullscreenchange",d)}}var p=function(e){e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translateX(-50%) translateY(-50%)",e.style["-webkit-transform"]=e.style.transform};if(e&&e.scene&&t.showInitialSpinner){if(t.brandedMode){var h=document.createElement("img");h.style.maxWidth="66%",h.style.maxHeight="66%",h.style.backgroundColor="none",h.src="https://viewer.shapediver.com/v2/img/logo_color.png"}else(h=document.createElement("div")).setAttribute("uk-spinner","ratio: 2");p(h),r.parentNode.appendChild(h);var m=function(){h&&(r.parentNode.removeChild(h),h=null),f&&(e.scene.removeEventListener(f.data),f=null)},f=e.scene.addEventListener(e.scene.EVENTTYPE.VISIBILITY_ON,m)}if(e&&e.state&&t.showBusySpinner){var g,$=function(e){e.classList.add("shapediver-spinner-busy"),e.setAttribute("uk-spinner","ratio: 1")},v=document.createElement("div");$(v),l.appendChild(v),(u=e.state.addEventListener(e.state.EVENTTYPE.BUSY,(function(){v.style.display=""}))).data&&i.push(u.data),(u=e.state.addEventListener(e.state.EVENTTYPE.IDLE,(function(){v.style.display="none"}))).data&&i.push(u.data);var y=function(e,t){g?v.removeChild(g):(v.removeAttribute("uk-spinner"),v.classList.remove("uk-spinner","uk-icon")),e?((g=document.createElement("img")).src=e,t&&(t=Array.isArray(t)||[t]).forEach((function(e){v.classList.add(e)})),p(v),v.appendChild(g)):$(v)},_=function(){}}var b=function(e,t){window.UIkit.notification({message:t,status:e||"primary",pos:"top-center"})};(u=e.state.addEventListener(e.state.EVENTTYPE.MESSAGE,(function(t){if(e.getSetting("showMessages")&&t.message){var n,r=t.messageLevel;"number"==typeof r&&((r&=7)===window.SDVApp.constants.loggingLevels.WARN?n="warning":r>window.SDVApp.constants.loggingLevels.WARN?n="danger":r<window.SDVApp.constants.loggingLevels.WARN&&(n="primary")),b(n,t.message)}}))).data&&i.push(u.data),u=function(t){"function"==typeof m&&m(),e.updateSettingAsync("scene.show",!1);var n=document.createElement("div");p(n),n.classList.add("uk-text-middle"),n.classList.add("uk-text-break"),n.classList.add("uk-text-center"),r.parentNode.appendChild(n);var o='<h1 class="uk-text-lead">We are sorry</h1>';t.messageScope&&(o+=t.messageScope),n.innerHTML=o};var x=e.state.get().data.failedStatusMessages;return 0<x.length?u(x[0]):(u=e.state.addEventListener(e.state.EVENTTYPE.FAILED,u)).data&&i.push(u.data),{destroy:function(){l&&(r.removeChild(l),l=null),"function"==typeof m&&m(),d&&(document.removeEventListener("webkitfullscreenchange",d),document.removeEventListener("mozfullscreenchange",d),document.removeEventListener("fullscreenchange",d)),i.forEach((function(t){return e.removeEventListener(t)})),l=null},toggleVisibility:function(e,t){n[e]&&(n[e].li.style.display=t?"":"none")},buttonOnClick:function(e,t){n[e]&&n[e].onclick(t)},setBusyGraphic:y,setBusyGraphicPosition:_,showMessage:b}};var module$src$api$apps$UIkitExportModal={default:function(e,t){if(!e)return null;if((t=t||{}).domElementIdPrefix||(t.domElementIdPrefix="sdv-container-modal-export"),t.parentElement||(t.parentElement=document.getElementById("sdv-container")?document.getElementById("sdv-container"):document.body),t.UIkitOpts||(t.UIkitOpts={escClose:!0,bgClose:!1,container:!!document.getElementById("sdv-container")&&"#sdv-container"}),!window.UIkit)return null;var n,r,o,a,i,s,l,u=0,c=[],d=!1,p=t.parentElement,h=t.domElementIdPrefix,m=[];!function(e){(n=document.createElement("div")).id=e;var t=document.createElement("div");t.classList.add("uk-modal-dialog"),t.classList.add("uk-modal-body"),n.appendChild(t),(r=document.createElement("h2")).id=e+"-title",r.classList.add("uk-modal-title"),t.appendChild(r),(o=document.createElement("p")).id=e+"-prompt",t.appendChild(o);var s=document.createElement("p");s.classList.add("uk-text-right"),t.appendChild(s),(a=document.createElement("h2")).id=e+"-button-cancel",a.type="button",a.classList.add("uk-button"),a.classList.add("uk-button-default"),a.classList.add("uk-modal-close"),s.appendChild(a),(i=document.createElement("h2")).id=e+"-button-ok",i.type="button",i.classList.add("uk-button"),i.classList.add("uk-button-primary"),s.appendChild(i),p.appendChild(n)}(h);var f=window.UIkit.modal("#"+h,t.UIkitOpts),g=function(e){if(!e.export)return!1;var t=e.export;if(!e.token||!e.token.id||c.includes(e.token.id)||e.token.attributes&&e.token.attributes.silent||d&&s!==e.token.id)return!1;if(s=e.token.id,r.innerHTML=t.name?'Export "'+t.name+'"':"Export",t.content||t.result)"download"===t.type?(o.innerHTML=t.filename&&0<t.content.length&&t.content[0].href?'File "'+t.filename+'" is available for download.':t.msg?t.msg:"File is available for download.",t.content&&0<t.content.length&&((e=t.content[0]).size&&(o.innerHTML+="<br/>Download size: "+e.size+" bytes"),e.format&&(o.innerHTML+="<br/>File format: "+e.format))):o.innerHTML="email"===t.type?t.result.err?t.result.err:t.result.msg?t.result.msg:"Export has been finished.":"shapeways"===t.type?t.result.err?t.result.err:t.result.msg?t.result.msg:"Export to ShapeWays has been finished.":"Export has been finished.";else{e="Processing, please wait...",t.msg&&(e=t.msg);for(var n=1;n<=u;n++)e+=".";o.innerHTML=e,u=(u+1)%4}return t.content||t.result?(a.innerHTML="Cancel","download"===t.type?0<t.content.length&&t.content[0].href&&(i.innerHTML="Download",l=t.content[0].href):"shapeways"===t.type?t.result.err?i.innerHTML="Ok":t.result.href&&(i.innerHTML="Go to ShapeWays",l=t.result.href):i.innerHTML="Ok",i.hidden=!(i.innerHTML&&0<i.innerHTML.length)):(a.innerHTML="Cancel",l="",i.innerHTML="",i.hidden=!0),!0};return(t=e.exports.addEventListener(e.exports.EVENTTYPE.STATUS,(function(e){g(e)&&(f.show(),d=!0)}))).data&&m.push(t.data),(t=e.exports.addEventListener(e.exports.EVENTTYPE.AVAILABLE,(function(e){g(e)&&(f.show(),d=!0)}))).data&&m.push(t.data),a.onclick=function(){s&&c.push(s),s=null,f.hide(),d=!1},i.onclick=function(){s&&c.push(s),s=null,l&&(window.open(l,"_blank"),l=""),f.hide(),d=!1},{destroy:function(){i.onclick=null,a.onclick=null,p.removeChild(n),m.forEach((function(t){return e.export.removeEventListener(t)}))}}}},module$src$shared$pubsub$PubSub={default:function(e){function t(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}function n(e,t,n){try{e(t,n)}catch(r){setTimeout(function(e){return function(){throw e}}(r),0)}}function r(e,t,n){e(t,n)}function o(e,t,o,a){var i,l=s[t];if(a=a?r:n,s.hasOwnProperty(t))for(i in l)l.hasOwnProperty(i)&&a(l[i],e,o)}function a(e,t,n){return function(){var r=String(e),a=r.lastIndexOf(".");for(o(e,e,t,n);-1!==a;)a=(r=r.substr(0,a)).lastIndexOf("."),o(e,r,t,n)}}function i(e,n,r,o){n=a(e,n,o),e=String(e),o=!(!s.hasOwnProperty(e)||!t(s[e]));for(var i=e.lastIndexOf(".");!o&&-1!==i;)i=(e=e.substr(0,i)).lastIndexOf("."),o=!(!s.hasOwnProperty(e)||!t(s[e]));return!!o&&(!0===r?n():setTimeout(n,0),!0)}var s={},l=-1,u=this;"boolean"!=typeof(e=e||{}).immediateExceptions&&(e.immediateExceptions=!1),u.publish=function(t,n){return i(t,n,!1,e.immediateExceptions)},u.publishSync=function(t,n){return i(t,n,!0,e.immediateExceptions)},u.subscribe=function(e,t){if("function"!=typeof t)return!1;s.hasOwnProperty(e)||(s[e]={});var n="uid_"+String(++l);return s[e][n]=t,n},u.subscribeOnce=function(e,t){var n=u.subscribe(e,(function(){u.unsubscribe(n),t.apply(this,arguments)}));return u},u.clearAllSubscriptions=function(){s={}},u.clearSubscriptions=function(e){for(var t in s)s.hasOwnProperty(t)&&0===t.indexOf(e)&&delete s[t]},u.unsubscribe=function(e){var t;if((t="string"==typeof e)&&!(t=s.hasOwnProperty(e)))e:{for(var n in s)if(s.hasOwnProperty(n)&&0===n.indexOf(e)){t=!0;break e}t=!1}var r=t;n=!r&&"string"==typeof e,t="function"==typeof e;var o,a,i=!1;if(!r){for(o in s)if(s.hasOwnProperty(o)){if(r=s[o],n&&r[e]){delete r[e],i=e;break}if(t)for(a in r)r.hasOwnProperty(a)&&r[a]===e&&(delete r[a],i=!0)}return i}u.clearSubscriptions(e)}}},module$src$app$partials$ViewerAppLoggingPartial={},VIEWERAPPCONSTANTS$$module$src$app$partials$ViewerAppLoggingPartial=module$src$app$ViewerAppConstants.default,PUBSUB$$module$src$app$partials$ViewerAppLoggingPartial=module$src$shared$pubsub$PubSub.default;module$src$app$partials$ViewerAppLoggingPartial.default=function(){var e=this,t=new module$src$shared$pubsub$PubSub.default;this.subscribeToLogStream=function(e,n,r){if(!Array.isArray(e)){for(var o=[],a=0;a<=e;a++)o.push(a);e=o}Array.isArray(n)||(n=[n]);var i=[];return e.forEach((function(e){n.forEach((function(n){var o=e.toString();0<n.length&&(o+="."+n),i.push(t.subscribe(o,r))}))})),i},this.unsubscribeFromLogStream=function(e){e.forEach((function(e){t.unsubscribe(e)}))};var n=function(t,n){var r=Number(t.slice(0,1));t=t.slice(2),e.logToConsole.apply(e,[r,t].concat($jscomp.arrayFromIterable(n)))},r=this.subscribeToLogStream(e.getSetting("loggingLevel"),"",n);this.log=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),n=e[0],r=e[1];e=e.slice(2),n=n.toString(),"string"==typeof r&&0<r.length&&(n+="."+r),t.publish(n,[].concat($jscomp.arrayFromIterable(e)))},this.registerHook("loggingLevel",(function(t){return e.unsubscribeFromLogStream(r),r=e.subscribeToLogStream(t,"",n),e.log(module$src$app$ViewerAppConstants.default.loggingLevels.DEBUG,"ViewerApp.loggingLevelUpdateHook","loggingLevel set from "+e.getLoggingLevelName(e.getSetting("loggingLevel"))+" to "+e.getLoggingLevelName(t)),!0}))};var module$src$app$partials$ViewerAppMessagingPartial={},GLOBALUTILS$$module$src$app$partials$ViewerAppMessagingPartial=module$src$shared$util$GlobalUtils.default,MESSAGINGCONSTANTS$$module$src$app$partials$ViewerAppMessagingPartial=module$src$shared$constants$MessagingConstants.default,PUBSUB$$module$src$app$partials$ViewerAppMessagingPartial=module$src$shared$pubsub$PubSub.default;module$src$app$partials$ViewerAppMessagingPartial.default=function(){var e=this,t=new module$src$shared$pubsub$PubSub.default;this.message=function(n,r){e.messageToPubSub(n=n===module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS&&r.token&&r.token.id?n+"."+r.token.id:n,r,t,{}),e.messageToLog(n,r)},this.subscribeToMessageStream=function(e,n){Array.isArray(e)||(e=[e]);var r=[];return e.forEach((function(e){r.push(t.subscribe(e,n))})),r},this.unsubscribeFromMessageStream=function(e){Array.isArray(e)||(e=[e]);var n=!0;return e.forEach((function(e){t.unsubscribe(e)||(n=!1)})),n},this.setupDispatching=function(t){var n=[];return Object.keys(t).forEach((function(r){var o=t[r].partListeners;r=e.subscribeToMessageStream(r,(function(t,n){Array.isArray(n.parts)||(n.parts=[],e.warn("ViewerAppMessagingPartial.setupDispatching","Message without data parts: "+JSON.stringify(n,null,0))),n.parts.forEach((function(r){o.forEach((function(o){if(r.type===o.type){var a,i=o.cb;"string"==typeof i&&0<i.length&&(i=module$src$shared$util$GlobalUtils.default.getAt(e,i.split("."))),"function"==typeof i&&(a=Array.isArray(o.params)?o.params.map((function(e){return"type"===e?r.type:"data"===e?r.data:"token"===e?n.token:"origin"===e?n.origin:"topic"===e?t:"plugin"===e?n.origin.plugin:void 0})):[n.token,r.data,r.type,n.origin],(i=Promise.resolve(i.apply(e,a))).then((function(t){!1===t&&e.debug("ViewerAppMessagingPartial.setupDispatching","Message callback returned false",o,a)})),i.catch((function(t){e.error("ViewerAppMessagingPartial.setupDispatching","Error in message callback: "+t.message,t,o,a)})))}}))}))})),n=n.concat(r)})),n};var n=[];this.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_FAILED,(function(e,t){(e=t.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE))&&e.data&&n.push(e.data)})),this.getFailedStatusMessages=function(){return n}};var module$src$app$partials$ViewerAppPluginManager={},pluginConstants$$module$src$app$partials$ViewerAppPluginManager=module$src$plugins$PluginConstants.default,MessagePrototype$$module$src$app$partials$ViewerAppPluginManager=module$src$shared$messages$MessagePrototype.default;module$src$app$partials$ViewerAppPluginManager.default=function(){var e=this,t={},n=[],r=[];t.getStatusDescription=function(){var e=[];return n.forEach((function(t){e.push(t.getStatusDescription())})),e},t.registerPlugin=function(o){if(o.getStatus()!==module$src$plugins$PluginConstants.default.pluginStatuses.READY)e.error("ViewerAppPluginManager.registerPlugin","Unexpected plugin status before loading: "+o.getStatus());else{var a=o.getRuntimeId();if(void 0!==t.getPluginByRuntimeId(a))e.error("ViewerAppPluginManager.registerPlugin","Plugin with runtime id "+a+" already loaded");else{o.log=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),n=t[0],r=t[1];t=t.slice(2),r=o.getShortName()+"."+a+"."+r,e.log.apply(e,[n,r].concat($jscomp.arrayFromIterable(t)))},o.message=function(t,n){void 0!==n.origin&&"object"==typeof n.origin||(n.origin={}),n.origin.plugin=a,void 0!==n.token&&"object"==typeof n.token&&void 0===n.token.creator&&(n.token.creator={plugin:a}),e.message(t,n)},o.app={api:e.api},o.app.getContainer=e.getContainer;var i=o.getCapabilities();i.includes(module$src$plugins$PluginConstants.default.pluginCapabilities.INTERACTIVE)&&(o.app.sceneGeometryManager=e.sceneGeometryManager,o.app.viewportManager=e.viewportManager),i.includes(module$src$plugins$PluginConstants.default.pluginCapabilities.DRAGANDDROP)&&(o.app.sceneGeometryManager=e.sceneGeometryManager,o.app.viewportManager=e.viewportManager);var s=[];if(i.includes(module$src$plugins$PluginConstants.default.pluginCapabilities.MESSAGECALLBACKS)&&e.subscribeToMessageStream)for(var l in i=o.getMessageCallbacks()){var u=e.subscribeToMessageStream(l,i[l]);s=s.concat(u)}if(o.load({loggingLevel:e.getSetting("loggingLevel")})){if(o.getStatus()===module$src$plugins$PluginConstants.default.pluginStatuses.LOADED||o.getStatus()===module$src$plugins$PluginConstants.default.pluginStatuses.ACTIVE)return e.message(module$src$plugins$PluginConstants.default.messageTopics.PLUGIN_REGISTERED,new module$src$shared$messages$MessagePrototype.default(module$src$plugins$PluginConstants.default.messageDataTypes.PLUGIN_RUNTIME_ID,a)),e.info("ViewerAppPluginManager.registerPlugin",'Registered plugin "'+o.getName()+'" with capabilities '+JSON.stringify(o.getCapabilities())+" and runtime id "+o.getRuntimeId()),n.push(o),r.push(s),a;e.error("ViewerAppPluginManager.registerPlugin","Unexpected plugin status after loading: "+o.getStatus())}else e.error("ViewerAppPluginManager.registerPlugin",'Failed to load plugin "'+o.getName()+'" with runtime id '+a)}}},t.deregisterPlugin=function(t){var o=n.findIndex((function(e){return e.getRuntimeId()===t}));if(-1===o)return e.error("ViewerAppPluginManager.deregisterPlugin","Plugin with runtimeId "+t+" not found"),!1;e.unsubscribeFromMessageStream&&e.unsubscribeFromMessageStream(r[o]);var a=n.splice(o,1)[0];return r.splice(o,1),e.info("ViewerAppPluginManager.deregisterPlugin",'Deregistered plugin "'+a.getName()+'" with capabilities '+JSON.stringify(a.getCapabilities())+" and runtime id "+a.getRuntimeId()),!0},t.getRuntimeIds=function(){for(var e=n.length,t=Array(n.length),r=0;r<e;r++)t[r]=n[r].getRuntimeId();return t},t.getPluginByRuntimeId=function(e){return n.find((function(t){return t.getRuntimeId()===e}))},t.getPluginByName=function(e){return n.find((function(t){return t.getName()===e}))},t.getPluginByShortName=function(e){return n.find((function(t){return t.getShortName()===e}))},t.getPluginByCapabilities=function(e){return e||(e=[]),Array.isArray(e)||(e=[e]),n.find((function(t){var n=t.getCapabilities();return e.every((function(e){return n.includes(e)}))}))};var o=999,a=Promise.resolve(),i=function(t,r){var s=t.indexOf("."),l=Number(t.slice(0,s))&module$src$plugins$PluginConstants.default.loggingLevels.LVLBITS,u=t.slice(s+1),c=n.find((function(e){return e.getCapabilities().includes(module$src$plugins$PluginConstants.default.pluginCapabilities.LOGGING)}));c?a=a.finally((function(){e.debug("ViewerAppPluginManager._logToServer","Logging to server",{loggingLevel:l,scope:u,data:r}),Array.isArray(r)||(r=[r]),c.logToServer.apply(c,[l,u].concat($jscomp.arrayFromIterable(r))).catch((function(t){e.warn("ViewerAppPluginManager._logToServer",t)})),o=999})).finally((function(){return new Promise((function(e){setTimeout(e,9999)}))})):(e.debug("ViewerAppPluginManager._logToServer","Delaying logging to server by "+o+"msec",{loggingLevel:l,scope:u,data:r}),setTimeout(i,o,t,r),o*=2)};return"function"==typeof e.subscribeToLogStream&&e.subscribeToLogStream([module$src$plugins$PluginConstants.default.loggingLevels.ERROR_S,module$src$plugins$PluginConstants.default.loggingLevels.WARN_S,module$src$plugins$PluginConstants.default.loggingLevels.INFO_S,module$src$plugins$PluginConstants.default.loggingLevels.DEBUG_S],"",i),t};var module$src$shared$exceptions$MissingImplementationException={default:function(){}};module$src$shared$exceptions$MissingImplementationException.default.prototype.toString=function(){return"Missing implementation"};var module$src$shared$interfaces$ParameterInterface={},MissingImplementationException$$module$src$shared$interfaces$ParameterInterface=module$src$shared$exceptions$MissingImplementationException.default;module$src$shared$interfaces$ParameterInterface.default=function(){this.setValue=function(){throw new module$src$shared$exceptions$MissingImplementationException.default},this.parseValue=function(){throw new module$src$shared$exceptions$MissingImplementationException.default},this.getValue=function(){throw new module$src$shared$exceptions$MissingImplementationException.default},this.getValueString=function(){throw new module$src$shared$exceptions$MissingImplementationException.default},this.checkValue=function(){throw new module$src$shared$exceptions$MissingImplementationException.default},this.isValid=function(){throw new module$src$shared$exceptions$MissingImplementationException.default},this.getDefinition=function(){throw new module$src$shared$exceptions$MissingImplementationException.default}};var module$src$shared$types$ShapeDiverParameters={default:{}},GlobalUtils$$module$src$shared$types$ShapeDiverParameters=module$src$shared$util$GlobalUtils.default,toTinyColor$$module$src$shared$types$ShapeDiverParameters=module$src$shared$util$toTinyColor.default,uuidv4Regex$$module$src$shared$types$ShapeDiverParameters=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,defaultSettings$$module$src$shared$types$ShapeDiverParameters={strictMode:!0},CommonParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this;module$src$shared$mixins$GlobalMixin.default.call(this),module$src$shared$interfaces$ParameterInterface.default.call(this);var n=function(e,t){return!!(Array.isArray(e)&&"array"===t||typeof e===t)};return void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Generic parameter"),void 0!==e.valuetype&&"string"==typeof e.valuetype&&0!==e.valuetype.length||(void 0!==e.defval?e.valuetype=Array.isArray(e.defval)?"array":typeof e.defval:(e.valuetype="number",e.isValid=!1)),void 0!==e.defval&&n(e.defval,e.valuetype)||(e.defval=0,e.isValid=!1),void 0===e.value?e.value=e.defval:n(e.value,e.valuetype)||(e.isValid=!1),module$src$shared$mixins$SettingsMixin.default.call(this,e),this.registerHook("valuetype",(function(){return!1})),this.registerHook("defval",(function(e){return t.checkValue(e)})),this.registerHook("value",(function(e){return t.checkValue(e)})),this.registerHook("isValid",(function(){return!1})),module$src$shared$mixins$LoggingMixin.default.call(this),this.isValid=function(){return t.getSetting("isValid")},this.checkValue=function(e){return n(e,t.getSettingShallow("valuetype"))},this.setValue=function(e){return t.updateSetting("value",e)},this.getValue=function(){return t.getSetting("value")},this.getValueString=function(){return t.getValue().toString()},this.parseValue=function(e){if("string"!=typeof e)return!1;var n=t.getSettingShallow("valuetype");if("string"===n)return t.setValue(e);if("number"===n)return t.setValue(parseFloat(e));if("boolean"===n)return"false"===e.toLowerCase()?t.setValue(!1):t.setValue(!!e);if("object"!==n&&"array"!==n)return!1;try{return t.setValue(JSON.Parse(e))}catch(r){return t.debug("CommonParameter.parseValue",r),!1}},this.isValueDifferent=function(e){var n=t.getSettingShallow("valuetype"),r=t.getSettingShallow("value");return"array"===n||"object"===n?(n=JSON.stringify(r,null,0))!==(e=JSON.stringify(e,null,0)):r!==e},t.toString=function(){return'Parameter "'+t.getSetting("name")+'"\n\tsettings: '+JSON.stringify(t.getSettings(),null,0)},this.acceptsBlobs=function(){return!1},this.checkBlob=function(e){return!(!(t.acceptsBlobs()&&e instanceof Blob)||e.size>t.getSettingShallow("max")||(e._type=0<e.type.length?e.type:module$src$shared$util$GlobalUtils.default.guessMimeTypeFromFilename(e.name),!t.getSettingShallow("format").includes(e._type)))},this};module$src$shared$types$ShapeDiverParameters.default.CommonParameter=CommonParameter$$module$src$shared$types$ShapeDiverParameters;var FloatParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this;void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0),"boolean"!=typeof e.strictMode||e.strictMode||(["decimalplaces"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseInt(e[t]))})),["min","max","defval","value"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseFloat(e[t]))}))),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Float parameter"),e.valuetype="number",(void 0===e.decimalplaces||"number"!=typeof e.decimalplaces||0>e.decimalplaces)&&(e.decimalplaces=20),void 0!==e.min&&"number"==typeof e.min||(e.min=-Number.MAX_VALUE),void 0!==e.max&&"number"==typeof e.max||(e.max=Number.MAX_VALUE),e.min>e.max&&(e.min=e.max,e.isValid=!1),(void 0===e.defval||"number"!=typeof e.defval||e.defval<e.min||e.defval>e.max)&&(e.defval=e.min,e.isValid=!1),(void 0===e.value||"number"!=typeof e.value||e.value<e.min||e.value>e.max)&&(e.value=e.defval),CommonParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e),this.registerHook("decimalplaces",(function(){return!1})),this.registerHook("min",(function(e){return t.getSettingShallow("value")>=e})),this.registerHook("max",(function(e){return t.getSettingShallow("value")<=e}));var n=this.setValue;this.setValue=function(e){if("string"!=typeof e||t.getSettingShallow("strictMode")||(e=parseFloat(e)),"number"!=typeof e)return!1;var r=e,o=t.getSettingShallow("decimalplaces");return o<Number.MAX_SAFE_INTEGER&&(r=parseFloat(e.toFixed(o))),n(r)},this.getValueString=function(){var e=t.getSettingShallow("decimalplaces");return e<Number.MAX_SAFE_INTEGER?t.getValue().toFixed(e):t.getValue()};var r=this.checkValue;return this.checkValue=function(e){return"string"!=typeof e||t.getSettingShallow("strictMode")||(e=parseFloat(e)),!!r(e)&&e>=t.getSettingShallow("min")&&e<=t.getSettingShallow("max")},this.getDefinition=function(){return t.getSettings("id name plugin note type decimalplaces defval group max min visualization _name order hidden".split(" "))},this};module$src$shared$types$ShapeDiverParameters.default.FloatParameter=FloatParameter$$module$src$shared$types$ShapeDiverParameters;var IntegerParameter$$module$src$shared$types$ShapeDiverParameters=function(e){return void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0),"boolean"!=typeof e.strictMode||e.strictMode||["decimalplaces","min","max","defval","value"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseInt(e[t]))})),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Integer parameter"),void 0===e.decimalplaces&&(e.decimalplaces=0),"number"==typeof e.decimalplaces&&0===e.decimalplaces||(e.decimalplaces=0,e.isValid=!1),void 0!==e.min&&"number"==typeof e.min||(e.min=Number.MIN_SAFE_INTEGER),void 0!==e.max&&"number"==typeof e.max||(e.max=Number.MAX_SAFE_INTEGER),e.min>e.max&&(e.min=e.max,e.isValid=!1),(void 0===e.defval||"number"!=typeof e.defval||e.defval<e.min||e.defval>e.max||Math.round(e.defval)!==e.defval)&&(e.defval=e.min,e.isValid=!1),(void 0===e.value||"number"!=typeof e.value||e.value<e.min||e.value>e.max||Math.round(e.value)!==e.value)&&(e.value=e.defval),FloatParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e),this};module$src$shared$types$ShapeDiverParameters.default.IntegerParameter=IntegerParameter$$module$src$shared$types$ShapeDiverParameters;var EvenIntegerParameter$$module$src$shared$types$ShapeDiverParameters=function(e){void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0),"boolean"!=typeof e.strictMode||e.strictMode||["decimalplaces","min","max","defval","value"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseInt(e[t]))})),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Even integer parameter"),void 0!==e.min&&"number"==typeof e.min||(e.min=Number.MIN_SAFE_INTEGER),void 0!==e.max&&"number"==typeof e.max||(e.max=Number.MAX_SAFE_INTEGER),e.min>e.max&&(e.min=e.max,e.isValid=!1),(void 0===e.defval||"number"!=typeof e.defval||e.defval<e.min||e.defval>e.max||0!=e.defval%2)&&(e.defval=e.min,e.isValid=!1),(void 0===e.value||"number"!=typeof e.value||e.value<e.min||e.value>e.max||0!=e.value%2)&&(e.value=e.defval),IntegerParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e);var t=this.checkValue;return this.checkValue=function(e){return!!t(e)&&0==e%2},this};module$src$shared$types$ShapeDiverParameters.default.EvenIntegerParameter=EvenIntegerParameter$$module$src$shared$types$ShapeDiverParameters;var OddIntegerParameter$$module$src$shared$types$ShapeDiverParameters=function(e){void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0),"boolean"!=typeof e.strictMode||e.strictMode||["decimalplaces","min","max","defval","value"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseInt(e[t]))})),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Even integer parameter"),void 0!==e.min&&"number"==typeof e.min||(e.min=Number.MIN_SAFE_INTEGER),void 0!==e.max&&"number"==typeof e.max||(e.max=Number.MAX_SAFE_INTEGER),e.min>e.max&&(e.min=e.max,e.isValid=!1),(void 0===e.defval||"number"!=typeof e.defval||e.defval<e.min||e.defval>e.max||1!==Math.abs(e.defval%2))&&(e.defval=e.min,e.isValid=!1),(void 0===e.value||"number"!=typeof e.value||e.value<e.min||e.value>e.max||1!==Math.abs(e.value%2))&&(e.value=e.defval),IntegerParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e);var t=this.checkValue;return this.checkValue=function(e){return!!t(e)&&1===Math.abs(e%2)},this};module$src$shared$types$ShapeDiverParameters.default.OddIntegerParameter=OddIntegerParameter$$module$src$shared$types$ShapeDiverParameters;var ValueListParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this;return void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0),"boolean"!=typeof e.strictMode||e.strictMode||["defval"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseInt(e[t]))})),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Value list parameter"),void 0!==e.choices&&Array.isArray(e.choices)||(e.choices=[],e.isValid=!1),e.min=0,e.max=e.choices.length-1,(void 0===e.defval||"number"!=typeof e.defval||e.defval<e.min||e.defval>e.max)&&(e.defval=e.min,e.isValid=!1),IntegerParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e),this.registerHook("min",(function(){return!1})),this.registerHook("max",(function(){return!1})),this.registerHook("choices",(function(){return!1})),this.getChoices=function(){return t.getSetting("choices")},this.getSelectedChoice=function(){return t.getSetting("choices")[t.getSettingShallow("value")]},this.getDefinition=function(){return t.getSettings("id name plugin note type choices defval group visualization _name order hidden".split(" "))},this};module$src$shared$types$ShapeDiverParameters.default.ValueListParameter=ValueListParameter$$module$src$shared$types$ShapeDiverParameters;var MultipleChoiceParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this,n=function(e,n,r){if(void 0===r&&(r=!0),"string"==typeof e&&!r)if(!e.startsWith("[")&&e.includes(","))try{e=JSON.parse("["+e+"]")}catch(a){return void t.debug("MultipleChoiceParameter._checkValue",a)}else if(e=parseInt(e),isNaN(e))return;if("number"==typeof e){if(0<=e&&e<=n)return[e]}else if(Array.isArray(e)){var o=[];if(e.every((function(t,a){if("string"==typeof t&&!r){if(t=parseInt(t),!isNaN(t))return!1;e[a]=t}return"number"==typeof t&&0<=t&&t<=n&&-1===o.indexOf(t)&&(o.push(t),!0)})))return o}};void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0);var r=!0;"boolean"!=typeof e.strictMode||e.strictMode||(r=!1),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Multiple value list parameter"),void 0!==e.choices&&Array.isArray(e.choices)||(e.choices=[],e.isValid=!1),e.min=0,e.max=e.choices.length-1,"string"==typeof e.defval&&!r||void 0!==e.defval&&("number"==typeof e.defval||Array.isArray(e.defval))?(e.defval=n(e.defval,e.max,r),void 0===e.defval&&(e.defval=[],e.isValid=!1)):(e.defval=[],e.isValid=!1),void 0===e.value&&(e.value=e.defval),"number"==typeof e.value||Array.isArray(e.value)?(e.value=n(e.value,e.max,r),void 0===e.value&&(e.value=e.defval,e.isValid=!1)):(e.value=e.defval,e.isValid=!1),CommonParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e),this.registerHook("min",(function(){return!1})),this.registerHook("max",(function(){return!1})),this.registerHook("choices",(function(){return!1})),this.getChoices=function(){return t.getSetting("choices")},this.getSelectedChoices=function(){var e=t.getSetting("choices"),n=[];return t.getSettingShallow("value").forEach((function(t){n.push(e[t])})),n},this.checkValue=function(e){return void 0!==n(e,t.getSettingShallow("max"),t.getSettingShallow("strictMode"))},this.getValueString=function(){var e=JSON.stringify(t.getValue(),null,0);return(e=e.replace("[","")).replace("]","")};var o=this.setValue;return this.setValue=function(e){return void 0!==(e=n(e,t.getSettingShallow("max"),t.getSettingShallow("strictMode")))&&o(e)},this.parseValue=function(e){return e=n(e,t.getSettingShallow("max"),!1),t.setValue(e)},this.getDefinition=function(){return t.getSettings("id name plugin note type choices defval group visualization _name order hidden".split(" "))},this};module$src$shared$types$ShapeDiverParameters.default.MultipleChoiceParameter=MultipleChoiceParameter$$module$src$shared$types$ShapeDiverParameters;var StringParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this;void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),e.valuetype="string",void 0===e.isValid&&(e.isValid=!0),"boolean"!=typeof e.strictMode||e.strictMode||["max"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseInt(e[t]))})),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="String parameter"),void 0!==e.max&&"number"==typeof e.max||(e.max=Number.MAX_SAFE_INTEGER,e.isValid=!1),void 0!==e.defval&&"string"==typeof e.defval||(e.defval="",e.isValid=!1),e.defval.length>e.max&&(e.defval=e.defval.slice(0,e.max),e.isValid=!1),void 0!==e.value&&"string"!=typeof e.value&&(e.value=e.defval,e.isValid=!1),void 0!==e.value&&e.value.length>e.max&&(e.value=e.value.slice(0,e.max),e.isValid=!1),CommonParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e);var n=this.checkValue;return this.checkValue=function(e){return!!n(e)&&e.length<=t.getSettingShallow("max")},this.getDefinition=function(){return t.getSettings("id name plugin note type defval group max _name order hidden".split(" "))},this};module$src$shared$types$ShapeDiverParameters.default.StringParameter=StringParameter$$module$src$shared$types$ShapeDiverParameters;var BooleanParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this;void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),e.valuetype="boolean",void 0===e.isValid&&(e.isValid=!0),"boolean"!=typeof e.strictMode||e.strictMode||"string"!=typeof e.defval||("false"===e.defval.toLowerCase()?e.defval=!1:"true"===e.defval.toLowerCase()?e.defval=!0:0>=parseInt(e.defval)?e.defval=!1:0<parseInt(e.defval)&&(e.defval=!0)),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Boolean parameter"),void 0!==e.defval&&"boolean"==typeof e.defval||(e.defval=!1,e.isValid=!1),CommonParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e);var n=this.checkValue;this.checkValue=function(e){if("string"==typeof e&&!t.getSettingShallow("strictMode"))if("true"===e.toLowerCase())e=!0;else{if("false"!==e.toLowerCase())return!1;e=!1}return n(e)};var r=this.setValue;return this.setValue=function(e){if("string"==typeof e&&!t.getSettingShallow("strictMode"))if("true"===e.toLowerCase())e=!0;else{if("false"!==e.toLowerCase())return!1;e=!1}return r(e)},this.getDefinition=function(){return t.getSettings("id name plugin note type defval group _name order hidden".split(" "))},this};module$src$shared$types$ShapeDiverParameters.default.BooleanParameter=BooleanParameter$$module$src$shared$types$ShapeDiverParameters;var ColorParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this,n=function(e){return e.toString("hex8").replace("#","0x")};void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),e.max=Number.MAX_SAFE_INTEGER,void 0===e.isValid&&(e.isValid=!0),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="Color parameter"),void 0===e.defval&&(e.defval="white");var r=(0,module$src$shared$util$toTinyColor.default)(e.defval);null===r?(e.defval=(0,module$src$shared$util$toTinyColor.default)("white"),e.isValid=!1):e.defval=r,e.defval=n(e.defval),void 0===e.value?e.value=e.defval:null===(r=(0,module$src$shared$util$toTinyColor.default)(e.defval))?(e.value=(0,module$src$shared$util$toTinyColor.default)("white"),e.isValid=!1):e.value=r,e.value=n(e.value),StringParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e);var o=this.setValue;return this.setValue=function(e){return null!==(e=(0,module$src$shared$util$toTinyColor.default)(e))&&o(n(e))},this.getValue=function(){return n((0,module$src$shared$util$toTinyColor.default)(t.getSettingShallow("value")))},this.getValueTinyColor=function(){return(0,module$src$shared$util$toTinyColor.default)(t.getSettingShallow("value"))},this.getValueString=function(){return t.getValue()},this.parseValue=function(e){return t.setValue(e)},this.getDefinition=function(){return t.getSettings("id name plugin note type defval group _name order hidden".split(" "))},this};module$src$shared$types$ShapeDiverParameters.default.ColorParameter=ColorParameter$$module$src$shared$types$ShapeDiverParameters;var FileParameter$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this;void 0===e||"object"!=typeof e?e=defaultSettings$$module$src$shared$types$ShapeDiverParameters:(e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.defaults(e,defaultSettings$$module$src$shared$types$ShapeDiverParameters)),void 0===e.isValid&&(e.isValid=!0),void 0!==e.name&&"string"==typeof e.name&&0!==e.name.length||(e.name="File parameter"),"boolean"!=typeof e.strictMode||e.strictMode||["max"].forEach((function(t){"string"==typeof e[t]&&(e[t]=parseInt(e[t]))})),void 0===e.defval&&(e.defval=""),"string"!=typeof e.defval&&(e.defval="",e.isValid=!1),void 0===e.value&&(e.value=e.defval),"string"!=typeof e.value&&(e.value="",e.isValid=!1),void 0!==e.max&&"number"==typeof e.max||(e.max=0,e.isValid=!1),module$src$shared$util$GlobalUtils.default.isArrayOfType(e.format,"string")||(e.format=[],e.isValid=!1),StringParameter$$module$src$shared$types$ShapeDiverParameters.call(this,e);var n=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&!!(""===e||uuidv4Regex$$module$src$shared$types$ShapeDiverParameters.test(e)||e.startsWith("http://")||e.startsWith("https://"))};this.checkValue=function(e){return n(e)};var r=this.setValue;return this.setValue=function(e){return!!n(e)&&r(e)},this.acceptsBlobs=function(){return!0},this.getDefinition=function(){return t.getSettings("id name plugin note type defval group _name order hidden max format".split(" "))},this};module$src$shared$types$ShapeDiverParameters.default.FileParameter=FileParameter$$module$src$shared$types$ShapeDiverParameters;var ParameterFactory$$module$src$shared$types$ShapeDiverParameters=function(e){var t=this;module$src$shared$mixins$GlobalMixin.default.call(this),module$src$shared$mixins$SettingsMixin.default.call(this,e),module$src$shared$mixins$LoggingMixin.default.call(this);var n=module$src$shared$util$GlobalUtils.default.deepCopy(e),r={float:FloatParameter$$module$src$shared$types$ShapeDiverParameters,int:IntegerParameter$$module$src$shared$types$ShapeDiverParameters,even:EvenIntegerParameter$$module$src$shared$types$ShapeDiverParameters,odd:OddIntegerParameter$$module$src$shared$types$ShapeDiverParameters,string:StringParameter$$module$src$shared$types$ShapeDiverParameters,color:ColorParameter$$module$src$shared$types$ShapeDiverParameters,"stringlist:sequence":ValueListParameter$$module$src$shared$types$ShapeDiverParameters,"stringlist:cycle":ValueListParameter$$module$src$shared$types$ShapeDiverParameters,"stringlist:dropdown":ValueListParameter$$module$src$shared$types$ShapeDiverParameters,"stringlist:checklist":MultipleChoiceParameter$$module$src$shared$types$ShapeDiverParameters,bool:BooleanParameter$$module$src$shared$types$ShapeDiverParameters,file:FileParameter$$module$src$shared$types$ShapeDiverParameters};return this.produce=function(e){if(void 0===(e=module$src$shared$util$GlobalUtils.default.deepCopy(e)).type||"string"!=typeof e.type)t.debug("ShapeDiverParameters~factory","type not defined");else{var o=r[(e.type+":"+e.visualization).toLowerCase()];if(void 0===o&&void 0===(o=r[e.type.toLowerCase()]))return void t.debug("ShapeDiverParameters~factory","type not known: "+e.type.toLowerCase());try{e.hasOwnProperty("hidden")||(e.hidden=!1),module$src$shared$util$GlobalUtils.default.inject(n,e);var a=new o(e);if(a.isValid())return a;t.debug("ShapeDiverParameters~factory","created parameter not valid for "+t.jsify(e)+": "+t.jsify(a.getSettings())+", try to set strictMode to false")}catch(i){t.debug("ShapeDiverParameters~factory","exception creating parameter",e,i)}}},this};module$src$shared$types$ShapeDiverParameters.default.ParameterFactory=ParameterFactory$$module$src$shared$types$ShapeDiverParameters;var module$src$app$partials$ViewerAppParameterManager={},GlobalUtils$$module$src$app$partials$ViewerAppParameterManager=module$src$shared$util$GlobalUtils.default,pluginConstants$$module$src$app$partials$ViewerAppParameterManager=module$src$shared$constants$PluginConstantsGlobal.default,messagingConstants$$module$src$app$partials$ViewerAppParameterManager=module$src$shared$constants$MessagingConstants.default,MessagePrototype$$module$src$app$partials$ViewerAppParameterManager=module$src$shared$messages$MessagePrototype.default;module$src$app$partials$ViewerAppParameterManager.default=function(e){var t=this,n={},r=[],o=new module$src$shared$types$ShapeDiverParameters.default.ParameterFactory(t.getSettings());if(e&&e.hasOwnProperty("pluginManager")&&e.pluginManager.hasOwnProperty("getPluginByRuntimeId"))var a=e.pluginManager;var i=[],s=[],l=function(e){if(i.length!==s.length){for(var t=[],r=[],o=s.length,a=Math.max(0,o-50),l=a;l<o;l++)t.push(i[s[l]]),r.push(l-a);s=r,i=t}e||(e=n.getParameterState()),i.push(e),s.push(i.length-1)};n.canGoBackInHistory=function(){return!(0>=i.length||0>=s[s.length-1])},n.canGoForwardInHistory=function(){return!(0>=i.length||s[s.length-1]>=i.length-1)},n.goBackInHistory=function(e){if(!n.canGoBackInHistory())return!1;var t=s[s.length-1]-1;return s.push(t),n.setMultipleParameterValues(i[t],e,!1,!0),!0},n.goForwardInHistory=function(e){if(!n.canGoForwardInHistory())return!1;var t=s[s.length-1]+1;return s.push(t),n.setMultipleParameterValues(i[t],e,!1,!0),!0},n.registerMultipleParameters=function(e,t){var r=[];return Object.keys(e).forEach((function(o){var a=module$src$shared$util$GlobalUtils.default.deepCopy(e[o]);a.id=o,"time"!==a.type.toLowerCase()&&void 0!==(o=n.registerParameter(a,t))&&r.push(o)})),r},n.registerParameter=function(e,a){if(void 0===a||"string"!=typeof a)t.debug("ViewerAppParameterManager.registerParameter","No plugin specified");else if(e&&"object"==typeof e)if(e.plugin=a,void 0!==e.id&&"string"==typeof e.id||(e.id=module$src$shared$util$GlobalUtils.default.createRandomId(),t.debug("ViewerAppParameterManager.registerParameter","No id was specified, using "+e.id)),void 0!==n.getUniqueParameterBySettings({id:e.id,plugin:a}))t.debug("ViewerAppParameterManager.registerParameter","Parameter with id "+e.id+" and plugin "+a+" already exists");else{if(void 0!==(a=o.produce(e)))return r.push(a),(a={})[e.id]=e,t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER_REGISTERED,new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_DEFINITION,a)),e.id;t.debug("ViewerAppParameterManager.registerParameter","Parameter factory failed for definition",e)}else t.debug("ViewerAppParameterManager.registerParameter","Definition of parameter missing")},n.updateParameter=function(e){if(!e||"object"!=typeof e)return t.debug("ViewerAppParameterManager.updateParameter","Definition of parameter missing"),!1;var n=c(e);if(void 0===n)return t.debug("ViewerAppParameterManager.updateParameter","Parameter not found",e),!1;var o=(n=r[n]).getSetting("name");return"string"==typeof e.name&&0<e.name.length&&e.name!==o&&(n.getSetting("_name")||n.updateSetting("_name",o),n.updateSetting("name",e.name)),"number"==typeof e.order&&n.updateSetting("order",e.order),"boolean"==typeof e.hidden&&n.updateSetting("hidden",e.hidden),n.getDefinition(),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER_UPDATE,new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_DEFINITION,n.getDefinition())),!0},n.updateMultipleParameters=function(e){return Array.isArray(e)||(e=[e]),e.every((function(e){return n.updateParameter(e)}))},n.registerConfig=function(e,r){var o={};if(e.controlNames&&"object"==typeof e.controlNames){var a=e.controlNames;Object.keys(a).forEach((function(e){var t=n.getUniqueParameterBySettings({id:e,plugin:r});t&&(t.getSetting("_name")||t.updateSetting("_name",t.getSetting("name")),t.updateSetting("name",a[e]),o[t.getSettingShallow("id")]=t)}))}if(e.controlOrder&&Array.isArray(e.controlOrder))for(var i=e.controlOrder,s=0;s<i.length;s++){var l=n.getUniqueParameterBySettings({id:i[s],plugin:r});l&&(l.updateSetting("order",s),o[l.getSettingShallow("id")]=l)}if(e.parametersHidden&&Array.isArray(e.parametersHidden))for(e=e.parametersHidden,i=0;i<e.length;i++)(s=n.getUniqueParameterBySettings({id:e[i],plugin:r}))&&(s.updateSetting("hidden",!0),o[s.getSettingShallow("id")]=s);return Object.keys(o).forEach((function(e){var n={};n[(e=o[e].getDefinition()).id]=e,t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER_UPDATE,new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_DEFINITION,n))})),!0},n.getConfig=function(e){if(e=n.getParameterDefinitionsAndValues({plugin:e}),Array.isArray(e)){if(0===e.length)return{};var t={};return e.forEach((function(e){module$src$shared$util$GlobalUtils.default.typeCheck(e.name,"string")&&module$src$shared$util$GlobalUtils.default.typeCheck(e._name,"string")&&(t.controlNames=t.controlNames||[],t.controlNames.push({id:e.id,name:e.name})),module$src$shared$util$GlobalUtils.default.typeCheck(e.hidden,"boolean")&&e.hidden&&(t.parametersHidden=t.parametersHidden||[],t.parametersHidden.push(e.id)),module$src$shared$util$GlobalUtils.default.typeCheck(e.order,"number")&&(t.controlOrder=t.controlOrder||[],t.controlOrder.push({id:e.id,order:e.order}))})),t}},n.deregisterParameter=function(e,n){var o={};return o.id=e,void 0!==n&&(o.plugin=n),void 0===(o=u(o))?(t.error("ViewerAppParameterManager.deregisterParameter","Parameter with id "+e+" and plugin "+n+" not found"),!1):(n=r.splice(o,1)[0],t.info("ViewerAppParameterManager.deregisterParameter",'Deregistered parameter "'+n.getSetting("name")+'" with id '+e),!0)},n.getParameterById=function(e,t){var r={};return r.id=e,void 0!==t&&(r.plugin=t),n.getUniqueParameterBySettings(r)},n.getParameterByName=function(e,t){var r={};return r.name=e,void 0!==t&&(r.plugin=t),n.getUniqueParameterBySettings(r)},n.getParameterByIdOrName=function(e,t){var r={};return r.id=e,void 0!==t&&(r.plugin=t),void 0!==(t=n.getUniqueParameterBySettings(r))?t:(delete r.id,r.name=e,n.getUniqueParameterBySettings(r))},n.getParametersBySettings=function(e){return r.filter((function(t){return Object.keys(e).every((function(n){return!(!t.hasSetting(n)||t.getSettingShallow(n)!==e[n])}))}))},n.idsUnique=function(){var e=[];return r.every((function(t){return t=t.getSetting("id"),!e.includes(t)&&(e.push(t),!0)}))},n.namesUnique=function(){var e=[];return r.every((function(t){return t=t.getSetting("name"),!e.includes(t)&&(e.push(t),!0)}))};var u=function(e){if(1===(e=function(e){var t=[];return r.forEach((function(n,r){Object.keys(e).every((function(t){return!(!n.hasSetting(t)||n.getSettingShallow(t)!==e[t])}))&&t.push(r)})),t}(e)).length)return e[0]};n.getUniqueParameterBySettings=function(e){if(1===(e=n.getParametersBySettings(e)).length)return e[0]},n.getParameterDefinitions=function(e){var o={};return(void 0!==e&&"object"==typeof e?n.getParametersBySettings(e):r).forEach((function(e,r){var a=e.getDefinition();a&&"object"==typeof a?(r=e.getSetting("id"),1<n.getParametersBySettings({id:r}).length&&(r=r+"__"+e.getSetting("plugin")),o[r]=a):t.debug("ViewerAppParameterManager.getParameterDefinitions","Could not get definition of parameter "+r)})),o},n.getParameterDefinitionsAndValues=function(e){e=void 0!==e&&"object"==typeof e?n.getParametersBySettings(e):r;var o=[];return e.forEach((function(e,n){var r=e.getDefinition();r&&"object"==typeof r?(r.value=e.getValue(),o.push(r)):t.debug("ViewerAppParameterManager.getParameterDefinitionsAndValues","Could not get definition of parameter "+n)})),o.sort((function(e,t){var n=e.plugin,r=t.plugin;return"number"==typeof e.order&&"number"==typeof t.order?(n+=Math.floor(1e3*e.order).toString().padStart(8,"0"),r+=Math.floor(1e3*t.order).toString().padStart(8,"0")):(n+=e.name,r+=t.name),n<r?-1:n>r?1:0})),o};var c=function(e){if(e&&"object"==typeof e){var t={};if(void 0!==e.plugin&&"string"==typeof e.plugin&&(t.plugin=e.plugin),void 0!==e.id&&"string"==typeof e.id){t.id=e.id;var n=u(t);if(void 0!==n)return n;delete t.id}if(void 0!==e.idOrName&&"string"==typeof e.idOrName){if(t.id=e.idOrName,void 0!==(n=u(t)))return n;if(delete t.id,t.name=e.idOrName,void 0!==(n=u(t)))return n;delete t.name}if(void 0!==e._name&&"string"==typeof e._name&&(t._name=e._name,void 0!==(n=u(t)))||void 0!==e.name&&"string"==typeof e.name&&(t.name=e.name,void 0!==(n=u(t))))return n}};return n.updateRequiresPriorUpload=function(e){Array.isArray(e)||(e=[e]);for(var t=!1,n=0,o=e.length;n<o;n++){var a=e[n];if(a.value instanceof Blob){if(void 0===(a=c(a)))return;r[a].acceptsBlobs()&&(t=!0)}}return t},n.priorUpload=function(e){var n={params:[],plugins:{}},o=function(e,t,r){n.err||(n.err=[]),n.err.push({code:e,msg:t,data:r})};if(!Array.isArray(e))return o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.ERROR,"Not an array"),Promise.resolve(n);if(void 0===a)return o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,"Plugin functionality not found"),t.debug("ViewerAppParameterManager.priorUpload","Plugin functionality not found"),Promise.resolve(n);for(var i={},s=0,l=e.length;s<l;s++){var u=e[s];if(u.value instanceof Blob){var d=c(u);if(void 0===d)return o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PARAM_NOT_FOUND,"Could not find parameter",u),t.debug("ViewerAppParameterManager.priorUpload","Could not find parameter",u),Promise.resolve(n);if(u.id=(d=r[d]).getSetting("id"),u.plugin=d.getSetting("plugin"),!d.checkBlob(u.value))return o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_REJECT,"Blob size or type rejected",u),n.params.push({id:u.id,plugin:u.plugin,result:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_REJECT}),t.debug("ViewerAppParameterManager.priorUpload","Blob size or type rejected"),Promise.resolve(n);i.hasOwnProperty(u.plugin)||(i[u.plugin]={request:{},data:{}}),i[u.plugin].request[u.id]={format:u.value._type,size:u.value.size},i[u.plugin].data[u.id]=u.value,n.params.push({id:u.id,plugin:u.plugin,result:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_OK})}}s=[];var p,h=[];for(p in i){if(!(l=a.getPluginByRuntimeId(p)))return o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,"Plugin not found",p),t.debug("ViewerAppParameterManager.priorUpload","Plugin "+p+" not found"),n.plugins[p]=module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,Promise.resolve(n);s.push(l.fileUpload(i[p])),h.push(p)}return Promise.all(s).then((function(t){for(var r={},o=0,a=t.length;o<a;r={plugin$119:r.plugin$119},o++){r.plugin$119=h[o];var i,s=t[o],l={};for(i in s){l.id$120=i;var u=e.find(function(e,t){return function(n){return n.plugin===e.plugin$119&&n.id===t.id$120}}(r,l));if(!u)throw Error("ViewerAppParameterManager.priorUpload: internal error, parameter not found");u.value=s[l.id$120],l={id$120:l.id$120}}}return n}),(function(e){return o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.UPLOAD_FAILED,"Upload failed",e),n}))},n.setParameterValue=function(e,t){return n.setMultipleParameterValues([e],t)},n.setMultipleParameterValues=function(e,o,i,u){void 0===i&&(i=!1);var d=n.getParameterState(),p={params:[],plugins:{}};o=module$src$shared$constants$MessagingConstants.default.makeMessageToken(o),p.token=o;var h=function(e,t,n){p.err||(p.err=[]),p.err.push({code:e,msg:t,data:n})},m=[];if(e.forEach((function(e){var n=c(e);void 0===n?(h(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PARAM_NOT_FOUND,"Could not find parameter",e),t.debug("ViewerAppParameterManager.setMultipleParameterValues","Could not find parameter",e)):(e.idx=n,e.id=(n=r[n]).getSetting("id"),e.plugin=n.getSetting("plugin"),m.includes(e.plugin)||m.push(e.plugin),void 0===e.value?(h(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.NO_VALUE,"Parameter value not set",e.value),p.params.push({id:e.id,plugin:e.plugin,result:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.NO_VALUE}),t.debug("ViewerAppParameterManager.setMultipleParameterValues","Parameter value not set",e,n)):n.checkValue(e.value)||(h(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_REJECT,"Parameter value rejected",e.value),p.params.push({id:e.id,plugin:e.plugin,result:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_REJECT}),t.debug("ViewerAppParameterManager.setMultipleParameterValues","Parameter value rejected",e,n)))})),p.err||p.warn)return p;var f=!0,g=[];if(e.forEach((function(e){var n=r[e.idx];n.isValueDifferent(e.value)?(g.includes(e.plugin)||g.push(e.plugin),f=!1,n.setValue(e.value)?p.params.push({id:e.id,plugin:e.plugin,result:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_OK}):(h(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_REJECT,"Parameter value rejected",e.value),p.params.push({id:e.id,plugin:e.plugin,result:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_REJECT}),t.debug("ViewerAppParameterManager.setMultipleParameterValues","Parameter value rejected",e,n))):p.params.push({id:e.id,plugin:e.plugin,result:module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.VALUE_EXISTS})})),p.err)return i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,p.err,o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i),p;i&&(g=m);var $=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{busy:!1,progress:0},o);if(t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,$),f&&!i)return i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS,"All parameter values up to date",o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i),p;0===s.length&&l(d),u||f||l(),i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{busy:!0,progress:0},o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i);var v={};if(1<g.length){for(i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_FORK,[],o),u=(g.length+"").length,d=0;d<g.length;d++)($=module$src$shared$util$GlobalUtils.default.deepCopy(o)).id=o.id+"."+(Array(u).join("0")+d).slice(-u),v[g[d]]=$,i.parts[0].data.push($.id);t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i)}else g.forEach((function(e){v[e]=module$src$shared$util$GlobalUtils.default.deepCopy(o)}));var y={};return g.forEach((function(n){var o=e.filter((function(e){return e.plugin===n}));y[n]={};var i,s=y[n];if(o.forEach((function(e){s[e.id]=r[e.idx].getValue()})),void 0===a)(function(e,t,n){p.warn||(p.warn=[]),p.warn.push({code:e,msg:"Plugin functionality not found",data:n})})(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,0,n),t.warn("ViewerAppParameterManager.setMultipleParameterValues","Plugin functionality not found"),p.plugins[n]=module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND;else if(i=a.getPluginByRuntimeId(n)){var l={};i.getCapabilities().includes(module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.PARTIAL_UPDATES)?(o.forEach((function(e){l[e.id]=r[e.idx].getValueString()})),o=i.setMultipleParameterValues(l,v[n]),p.plugins[n]=o):(o.forEach((function(e){l[e.id]=r[e.idx].getValueString()})),r.forEach((function(e){var t=e.getSetting("id");n!==e.getSetting("plugin")||l.hasOwnProperty(t)||(l[t]=e.getValueString())})),o=i.setAllParameterValues(l,v[n]),p.plugins[n]=o)}else h(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,"Plugin not found",n),t.debug("ViewerAppParameterManager.setMultipleParameterValues","Plugin "+n+" not found"),p.plugins[n]=module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND})),i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_UPDATE,y,o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER_VALUE_UPDATE,i),(p.err||p.warn)&&(i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,p.err,o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i)),p},n.getParameterValuesForPlugin=function(e,t){var r={};return n.getParametersBySettings({plugin:e}).forEach((function(e){r[e.getSetting("id")]=t?e.getValueString():e.getSetting("value")})),r},n.refreshPluginInitial=function(e,t){var r={plugins:{}};t=module$src$shared$constants$MessagingConstants.default.makeMessageToken(t),r.token=t;var o=function(e,t,n){r.err||(r.err=[]),r.err.push({code:e,msg:t,data:n})};if(void 0===a)return o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,"Plugin functionality not found",e),r.plugins[e]=module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,r;var i=a.getPluginByRuntimeId(e);return i?i.hasSetting("deferGeometryLoading")&&i.getSettingShallow("deferGeometryLoading")?(r.plugins[e]=module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.ABORT,r):n.refreshPlugin(e,t):(o(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,"Plugin not found",e),r.plugins[e]=module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,r)},n.refreshPlugin=function(e,r){var o={plugins:{}};r=module$src$shared$constants$MessagingConstants.default.makeMessageToken(r),o.token=r;var i=function(e,t,n){o.err||(o.err=[]),o.err.push({code:e,msg:t,data:n})},s=[];if(n.getParametersBySettings({plugin:e}).forEach((function(t){s.push({id:t.getSetting("id"),value:t.getSetting("value"),plugin:e})})),0>=s.length&&a){var l=a.getPluginByRuntimeId(e);return l?(i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{busy:!0,progress:0},r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i),o.plugins[e]=l.setAllParameterValues({},r),o):(i(module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,"Plugin not found",e),o.plugins[e]=module$src$shared$constants$PluginConstantsGlobal.default.setParameterResults.PLUGIN_NOT_FOUND,o)}return n.setMultipleParameterValues(s,r,!0)},n.getParameterValuesCompat=function(){var e={};return r.forEach((function(t){e[t.getSettingShallow("id")]=t.getSetting("value")})),e},n.getParameterState=function(){var e=[];return r.forEach((function(t){e.push({id:t.getSettingShallow("id"),plugin:t.getSettingShallow("plugin"),value:t.getSettingShallow("value")})})),e},n};var module$src$app$partials$ViewerAppExportManager={},GlobalUtils$$module$src$app$partials$ViewerAppExportManager=module$src$shared$util$GlobalUtils.default,pluginConstants$$module$src$app$partials$ViewerAppExportManager=module$src$shared$constants$PluginConstantsGlobal.default,messagingConstants$$module$src$app$partials$ViewerAppExportManager=module$src$shared$constants$MessagingConstants.default,MessagePrototype$$module$src$app$partials$ViewerAppExportManager=module$src$shared$messages$MessagePrototype.default;module$src$app$partials$ViewerAppExportManager.default=function(e){var t=this,n=e.pluginManager,r=e.parameterManager,o={},a=[];o.registerMultipleExports=function(e,t){return Object.keys(e).forEach((function(n){var r=module$src$shared$util$GlobalUtils.default.deepCopy(e[n]);r.id=n,o.registerExport(r,t)})),[]},o.registerExport=function(e,n){if(void 0!==n&&module$src$shared$util$GlobalUtils.default.typeCheck(n,"string"))if(void 0===e||"object"!=typeof e)t.debug("ViewerAppExportManager.registerExport","Definition of export missing");else{if(e.plugin=n,void 0!==e.id&&module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")||(e.id=module$src$shared$util$GlobalUtils.default.createRandomId(),t.debug("ViewerAppExportManager.registerExport","No id was specified, using "+e.id)),void 0===o.getUniqueExportByProperties({id:e.id,plugin:n}))return e.hasOwnProperty("hidden")||(e.hidden=!1),void 0===e.name&&t.warn("ViewerAppExportManager.registerExport","Export without name:",e),a.push(e),(n={})[e.id]=module$src$shared$util$GlobalUtils.default.deepCopy(e),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_REGISTERED,new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_DEFINITION,n)),e.id;t.debug("ViewerAppExportManager.registerExport","Export with id "+e.id+" and plugin "+n+" already exists")}else t.debug("ViewerAppExportManager.registerExport","No plugin specified")},o.registerConfig=function(e,n){var r={};if(void 0!==e.controlNames&&"object"==typeof e.controlNames){var a=e.controlNames;Object.keys(a).forEach((function(e){var t=o.getUniqueExportByProperties({id:e,plugin:n});t&&(void 0===t._name&&(t._name=module$src$shared$util$GlobalUtils.default.deepCopy(t.name)),t.name=module$src$shared$util$GlobalUtils.default.deepCopy(a[e]),r[t.id]=t)}))}if(void 0!==e.controlOrder&&Array.isArray(e.controlOrder))for(var i=e.controlOrder,s=0;s<i.length;s++){var l=o.getUniqueExportByProperties({id:i[s],plugin:n});l&&(l.order=s,r[l.id]=l)}if(void 0!==e.parametersHidden&&Array.isArray(e.parametersHidden))for(e=e.parametersHidden,i=0;i<e.length;i++)(s=o.getUniqueExportByProperties({id:e[i],plugin:n}))&&(s.hidden=!0,r[s.id]=s);return Object.keys(r).forEach((function(e){var n={};n[(e=module$src$shared$util$GlobalUtils.default.deepCopy(r[e])).id]=e,t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_UPDATE,new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_DEFINITION,n))})),!0},o.getConfig=function(e){var t=o.getExportDefinitions();if(Array.isArray(t)){if(0===(t=t.filter((function(t){return void 0===t.plugin||t.plugin===e}))).length)return{};var n={};return t.forEach((function(e){module$src$shared$util$GlobalUtils.default.typeCheck(e.name,"string")&&module$src$shared$util$GlobalUtils.default.typeCheck(e._name,"string")&&(n.controlNames=n.controlNames||[],n.controlNames.push({id:e.id,name:e.name})),module$src$shared$util$GlobalUtils.default.typeCheck(e.hidden,"boolean")&&e.hidden&&(n.parametersHidden=n.parametersHidden||[],n.parametersHidden.push(e.id)),module$src$shared$util$GlobalUtils.default.typeCheck(e.order,"number")&&(n.controlOrder=n.controlOrder||[],n.controlOrder.push({id:e.id,order:e.order}))})),n}},o.updateExport=function(e){if(!e||"object"!=typeof e)return t.debug("ViewerAppExportManager.updateExport","Definition of export missing"),!1;var n=s(e);return void 0===n?(t.debug("ViewerAppExportManager.updateExport","Export not found",e),!1):(n=a[n],"string"==typeof e.name&&0<e.name.length&&e.name!==n.name&&(void 0===n._name&&(n._name=module$src$shared$util$GlobalUtils.default.deepCopy(n.name)),n.name=module$src$shared$util$GlobalUtils.default.deepCopy(e.name)),"number"==typeof e.order&&(n.order=e.order),"boolean"==typeof e.hidden&&(n.hidden=e.hidden),e=module$src$shared$util$GlobalUtils.default.deepCopy(n),(n={})[e.id]=e,t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_UPDATE,new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_DEFINITION,n)),!0)},o.updateMultipleExports=function(e){return Array.isArray(e)||(e=[e]),e.every((function(e){return o.updateExport(e)}))},o.deregisterExport=function(e,n){var r={};return r.id=e,void 0!==n&&(r.plugin=n),void 0===(r=i(r))?(t.error("ViewerAppExportManager.deregisterExport","Export with id "+e+" and plugin "+n+" not found"),!1):(n=a.splice(r,1)[0],t.info("ViewerAppExportManager.deregisterExport",'Deregistered export "'+n.name+'" with id '+e),!0)},o.getExportById=function(e,t){var n={};return n.id=e,void 0!==t&&(n.plugin=t),o.getUniqueExportByProperties(n)},o.getExportByName=function(e,t){var n={};return n.name=e,void 0!==t&&(n.plugin=t),o.getUniqueExportByProperties(n)},o.getExportByIdOrName=function(e,t){var n={};return n.id=e,void 0!==t&&(n.plugin=t),void 0!==(t=o.getUniqueExportByProperties(n))?t:(delete n.id,n.name=e,o.getUniqueExportByProperties(n))},o.getExportsByProperties=function(e){return a.filter((function(t){return Object.keys(e).every((function(n){return!(!t.hasOwnProperty(n)||t[n]!==e[n])}))}))};var i=function(e){if(1===(e=function(e){var t=[];return a.forEach((function(n,r){Object.keys(e).every((function(t){return!(!n.hasOwnProperty(t)||n[t]!==e[t])}))&&t.push(r)})),t}(e)).length)return e[0]};o.getUniqueExportByProperties=function(e){if(1===(e=o.getExportsByProperties(e)).length)return e[0]},o.getExportDefinitions=function(){var e=[];return a.forEach((function(t){t=module$src$shared$util$GlobalUtils.default.deepCopy({id:t.id,name:t.name,type:t.type,plugin:t.plugin,group:t.group,hidden:t.hidden,order:t.order,_name:t._name}),e.push(t)})),e.sort((function(e,t){var n=e.plugin,r=t.plugin;return"number"==typeof e.order&&"number"==typeof t.order?(n+=Math.floor(1e3*e.order).toString().padStart(8,"0"),r+=Math.floor(1e3*t.order).toString().padStart(8,"0")):(n+=e.name,r+=t.name),n<r?-1:n>r?1:0})),e};var s=function(e){if(void 0!==e&&"object"==typeof e){var t={};if(void 0!==e.plugin&&"string"==typeof e.plugin&&(t.plugin=e.plugin),void 0!==e.id&&"string"==typeof e.id){t.id=e.id;var n=i(t);if(void 0!==n)return n;delete t.id}if(void 0!==e.idOrName&&"string"==typeof e.idOrName){if(t.id=e.idOrName,void 0!==(n=i(t)))return n;if(delete t.id,t.name=e.idOrName,void 0!==(n=i(t)))return n;delete t.name}if(void 0!==e._name&&"string"==typeof e._name&&(t._name=e._name,void 0!==(n=i(t)))||void 0!==e.name&&"string"==typeof e.name&&(t.name=e.name,void 0!==(n=i(t))))return n}};return o.getUniqueExportByRequestObject=function(e){if(void 0!==(e=s(e)))return module$src$shared$util$GlobalUtils.default.deepCopy(a[e])},o.requestExport=function(e,o){o=module$src$shared$constants$MessagingConstants.default.makeMessageToken(o);var i=function(e,n){return o&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,n,o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,n)),e},l=s(e);if(void 0===l)return t.error("ViewerAppExportManager.requestExport","Export not found",e),i(module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults.EXPORT_NOT_FOUND,"Export not found");if(l=r.getParameterValuesForPlugin((e=a[l]).plugin,!0),void 0===n||void 0===n.getPluginByRuntimeId)return t.error("ViewerAppExportManager.requestExport","Plugin manager not found"),i(module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults.PLUGIN_NOT_FOUND,"Plugin manager not found");var u=n.getPluginByRuntimeId(e.plugin);return u?(o&&(i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{progress:0},o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,i),i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_STATUS,e,o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_STATUS,i)),u.requestExport(e.id,l,o)):(t.error("ViewerAppExportManager.requestExport",e="Plugin "+e.plugin+" not found"),i(module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults.PLUGIN_NOT_FOUND,e))},o};var module$src$3d$viewports$default$defaults$DefaultHighlights={default:[{apply:function(e,t){e.material&&(e.material.opacity*=t.opacity,e.material.transparent=!0)},remove:function(e,t){e.material&&(e.material.opacity*=1/t.opacity,e.material.transparent=!1)}},{apply:function(e,t){e.material&&(e.material.color.r+=t.color.r,e.material.color.g+=t.color.g,e.material.color.b+=t.color.b)},remove:function(e,t){e.material&&(e.material.color.r-=t.color.r,e.material.color.g-=t.color.g,e.material.color.b-=t.color.b)}}]},module$src$3d$InteractionGroupManager={default:function(){var e,t=[],n=function(){e=this};return n.prototype.InteractionGroup=function(e){var t={},n=e.name,r=e.selectable||!1,o=e.draggable||!1,a=e.hoverable||!1,i=e.selectionMode||"single",s=function(e){return e?"function"==typeof e.apply&&"function"==typeof e.remove?e:(e.name||(e.name="opacityHighlight"),"opacityHighlight"==e.name?(e.apply=module$src$3d$viewports$default$defaults$DefaultHighlights.default[0].apply,e.remove=module$src$3d$viewports$default$defaults$DefaultHighlights.default[0].remove,e.options?e.options.opacity||(e.options.opacity=.5):e.options={opacity:.5}):"colorHighlight"==e.name&&(e.apply=module$src$3d$viewports$default$defaults$DefaultHighlights.default[1].apply,e.remove=module$src$3d$viewports$default$defaults$DefaultHighlights.default[1].remove,e.options?e.options.color=e.options.color?(0,module$src$shared$util$toTinyColor.default)(e.options.color,"red").toThreeColor():new module$src$externals$three.default.Color(1,0,0):e.options={color:new module$src$externals$three.default.Color(1,0,0)}),e.apply&&e.remove?e:null):null},l={active:e.selectableHighlight&&e.selectableHighlight.active?s(e.selectableHighlight.active):null,passive:e.selectableHighlight&&e.selectableHighlight.passive?s(e.selectableHighlight.passive):null},u={active:e.draggableHighlight&&e.draggableHighlight.active?s(e.draggableHighlight.active):null,passive:e.draggableHighlight&&e.draggableHighlight.passive?s(e.draggableHighlight.passive):null},c={active:e.hoverableHighlight&&e.hoverableHighlight.active?s(e.hoverableHighlight.active):null,passive:e.hoverableHighlight&&e.hoverableHighlight.passive?s(e.hoverableHighlight.passive):null};return t.getName=function(){return n},t.isSelectable=function(){return r},t.isDraggable=function(){return o},t.isHoverable=function(){return a},t.getSelectionMode=function(){return i},t.getSelectableHighlight=function(){return l},t.getDraggableHighlight=function(){return u},t.getHoverableHighlight=function(){return c},t},n.prototype.addInteractionGroup=function(n){return!(!n.name||e.isInteractionGroup(n.name)||(t.push(new e.InteractionGroup(n)),0))},n.prototype.addOrReplaceInteractionGroup=function(n){return t=t.filter((function(e){return e.getName()!==n.name})),e.addInteractionGroup(n)},n.prototype.isInteractionGroup=function(t){return null!=e.getGroup(t)},n.prototype.getGroup=function(e){for(var n=0,r=t.length;n<r;n++)if(t[n].getName()==e)return t[n];return null},n.prototype.getGroups=function(){return t},new n}},module$src$3d$interfaces$ThreeDManagerInterface={default:function(e){this.lightHandler=this.materialHandler=this.cameraHandler=this.renderingHandler=null,this.success=!0,module$src$shared$mixins$GlobalMixin.default.call(this),module$src$shared$util$GlobalUtils.default.inject(e.loggingHandler,this),module$src$shared$util$GlobalUtils.default.inject(e.messagingHandler,this)}};module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.init=function(e){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.adjustScene=function(){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.computeBoundingBox=function(e){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.pause=function(){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.resume=function(){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.destroy=function(){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.addMesh=function(e,t,n){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.removeMesh=function(e){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.addAnchor=function(e,t){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.removeAnchor=function(e){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.fadeIn=function(e,t){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.fadeOut=function(e,t){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.setLiveTransformation=function(e,t,n,r,o){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.updateInteractions=function(e,t){},module$src$3d$interfaces$ThreeDManagerInterface.default.prototype.removeFromInteractions=function(e){};var module$src$3d$viewports$simple$ThreeDManagerConstants={},threeDManagerConstants$$module$src$3d$viewports$simple$ThreeDManagerConstants,_convert=function(e,t){for(var n in e){if("value"===n)return _hasSubValue(e[n])?_convert(e[n],t):e[n];"setting"!==n&&"desc"!==n&&"type"!==n&&(t[n]={},t[n]=_convert(e[n],t[n]))}return t},_hasSubValue=function(e){if("object"==typeof e)for(var t in e)if("value"===t||_hasSubValue(e[t]))return!0;return!1},GLOBAL_UTILS=module$src$shared$util$GlobalUtils.default,LOGGING_CONSTANTS=module$src$shared$constants$LoggingConstants.default,LOGGING_LEVELS=module$src$shared$constants$LoggingConstants.default.loggingLevels,_settingsDefinition={show:{value:!1,setting:"show",desc:"Show / hide the scene",type:"boolean"},showTransition:{value:"1s"},groundPlaneVisibility:{value:!0,setting:"groundPlaneVisibility",desc:"Show / hide the ground plane",type:"boolean"},render:{devicePixelRatio:{value:1},clearColor:{value:"#ffffff",setting:"render.clearColor",desc:"Set background color",type:function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color")}}},camera:{far:{value:100},fov:{value:45,setting:"camera.fov",desc:"Camera frustum vertical field of view angle, unit degree",type:function(e){return"number"==typeof e&&0<e&&180>e}},near:{value:.01}},material:{defaultColor:{value:"#00aaaa",setting:"material.defaultColor",desc:"The default color of the material",type:function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color")}}}},_defaultSettings={};_convert(_settingsDefinition,_defaultSettings),threeDManagerConstants$$module$src$3d$viewports$simple$ThreeDManagerConstants={settingsDefinition:_settingsDefinition,defaultSettings:_defaultSettings,loggingLevels:LOGGING_LEVELS},module$src$3d$viewports$simple$ThreeDManagerConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(threeDManagerConstants$$module$src$3d$viewports$simple$ThreeDManagerConstants);var module$node_modules$$tweenjs$tween_js$src$Tween={},_Group$$module$node_modules$$tweenjs$tween_js$src$Tween=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group$$module$node_modules$$tweenjs$tween_js$src$Tween.prototype={getAll:function(){return Object.keys(this._tweens).map((function(e){return this._tweens[e]}).bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(e=void 0!==e?e:module$node_modules$$tweenjs$tween_js$src$Tween.default.now();0<n.length;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var o=this._tweens[n[r]];o&&!1===o.update(e)&&(o._isPlaying=!1,t||delete this._tweens[n[r]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}},module$node_modules$$tweenjs$tween_js$src$Tween.default=new _Group$$module$node_modules$$tweenjs$tween_js$src$Tween,module$node_modules$$tweenjs$tween_js$src$Tween.default.Group=_Group$$module$node_modules$$tweenjs$tween_js$src$Tween,module$node_modules$$tweenjs$tween_js$src$Tween.default._nextId=0,module$node_modules$$tweenjs$tween_js$src$Tween.default.nextId=function(){return module$node_modules$$tweenjs$tween_js$src$Tween.default._nextId++},module$node_modules$$tweenjs$tween_js$src$Tween.default.now="undefined"==typeof window&&"undefined"!=typeof process?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now.bind(window.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._reversed=this._isPlaying=this._yoyo=!1,this._delayTime=0,this._startTime=null,this._easingFunction=module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Linear.None,this._interpolationFunction=module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onStopCallback=this._onCompleteCallback=this._onUpdateCallback=null,this._group=t||module$node_modules$$tweenjs$tween_js$src$Tween.default,this._id=module$node_modules$$tweenjs$tween_js$src$Tween.default.nextId()},module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=e,void 0!==t&&(this._duration=t),this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?module$node_modules$$tweenjs$tween_js$src$Tween.default.now()+parseFloat(e):e:module$node_modules$$tweenjs$tween_js$src$Tween.default.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],0==this._valuesStart[t]instanceof Array&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t;if(e<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0);var n=(e-this._startTime)/this._duration,r=this._easingFunction(n=0===this._duration||1<n?1:n);for(t in this._valuesEnd)if(void 0!==this._valuesStart[t]){var o=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,r):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?o+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=o+(a-o)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1===n){if(!(0<this._repeat)){for(null!==this._onCompleteCallback&&this._onCompleteCallback(this._object),e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].start(this._startTime+this._duration);return!1}for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)"string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]+=parseFloat(this._valuesEnd[t])),this._yoyo&&(n=this._valuesStartRepeat[t],this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=n),this._valuesStart[t]=this._valuesStartRepeat[t];this._yoyo&&(this._reversed=!this._reversed),this._startTime=void 0!==this._repeatDelayTime?e+this._repeatDelayTime:e+this._delayTime}return!0}},module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return 1>(e*=2)?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return 1>(e*=2)?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return 1>(e*=2)?.5*e*e*(3.5949095*e-2.5949095):.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Bounce.In(2*e):.5*module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Bounce.Out(2*e-1)+.5}}},module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation.Utils.Linear;return 0>t?a(e[0],e[1],r):1<t?a(e[n],e[n-1],n-r):a(e[o],e[o+1>n?n:o+1],r-o)},Bezier:function(e,t){for(var n=0,r=e.length-1,o=Math.pow,a=module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation.Utils.Bernstein,i=0;i<=r;i++)n+=o(1-t,r-i)*o(t,i)*e[i]*a(r,i);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(0>t&&(o=Math.floor(r=n*(1+t))),a(e[(o-1+n)%n],e[o],e[(o+1)%n],e[(o+2)%n],r-o)):0>t?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):1<t?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[o?o-1:0],e[o],e[n<o+1?n:o+1],e[n<o+2?n:o+2],r-o)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var r=t;1<r;r--)n*=r;return e[t]=n}}(),CatmullRom:function(e,t,n,r,o){var a=o*o;return(2*t-2*n+(e=.5*(n-e))+(r=.5*(r-t)))*o*a+(-3*t+3*n-2*e-r)*a+e*o+t}}};var module$src$3d$helpers$ThreeDManagerHelpers={default:function(e,t){var n,r=e.pathUtils,o=e.scene,a=e.geometryNode,i=new module$src$externals$three.default.Object3D,s=new module$src$externals$three.default.Object3D,l=[],u=[],c=[],d=[],p=!1,h=!0,m=!0,f=!0;return(e=function(){n=this,i.visible=!1,o.add(i),s.visible=!1,o.add(s)}).prototype._createTransformationObject=function(e,t){if(t.pivot=t.pivot?new module$src$externals$three.default.Vector3(t.pivot.x,t.pivot.y,t.pivot.z):null,"rotation"===t.type){var n={degree:0},o=new module$src$externals$three.default.Vector3(t.rotationAxis.x,t.rotationAxis.y,t.rotationAxis.z).normalize(),i=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(n,e).to({degree:t.rotationDegree*Math.PI/180},t.duration);i.onUpdate(t.parent&&t.pivot?function(){var e=new module$src$externals$three.default.Matrix4,s=new module$src$externals$three.default.Matrix4,l=new module$src$externals$three.default.Matrix4,u=r.getPathObject(a,t.parent);u&&(u.updateMatrix(!0),u.updateMatrixWorld(!0),s=u.matrixWorld),l.makeTranslation(t.pivot.x,t.pivot.y,t.pivot.z),e.multiply(l),e.multiply((new module$src$externals$three.default.Matrix4).makeRotationAxis(o,n.degree)),e.multiply((new module$src$externals$three.default.Matrix4).getInverse(l)),i.transformationMatrix=s.multiply(e)}:t.parent?function(){var e=new module$src$externals$three.default.Matrix4,s=new module$src$externals$three.default.Matrix4,l=r.getPathObject(a,t.parent);l&&(l.updateMatrix(!0),l.updateMatrixWorld(!0),s=l.matrixWorld),e.multiply((new module$src$externals$three.default.Matrix4).makeRotationAxis(o,n.degree)),i.transformationMatrix=s.multiply(e)}:t.pivot?function(){var e=new module$src$externals$three.default.Matrix4,r=new module$src$externals$three.default.Matrix4;r.makeTranslation(t.pivot.x,t.pivot.y,t.pivot.z),e.multiply(r),e.multiply((new module$src$externals$three.default.Matrix4).makeRotationAxis(o,n.degree)),e.multiply((new module$src$externals$three.default.Matrix4).getInverse(r)),i.transformationMatrix=e}:function(){var e=new module$src$externals$three.default.Matrix4;e.multiply((new module$src$externals$three.default.Matrix4).makeRotationAxis(o,n.degree)),i.transformationMatrix=e})}else if("translation"===t.type){var s={x:0,y:0,z:0};(i=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(s,e).to({x:t.translationVector.x,y:t.translationVector.y,z:t.translationVector.z},t.duration)).onUpdate(t.parent?function(){var e=new module$src$externals$three.default.Matrix4,n=new module$src$externals$three.default.Matrix4,o=r.getPathObject(a,t.parent);o&&(o.updateMatrix(!0),o.updateMatrixWorld(!0),n=o.matrixWorld),e.makeTranslation(s.x,s.y,s.z),i.transformationMatrix=n.multiply(e)}:function(){var e=new module$src$externals$three.default.Matrix4;e.makeTranslation(s.x,s.y,s.z),i.transformationMatrix=e})}else if("scaling"===t.type){var l={x:1,y:1,z:1};(i=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(l,e).to({x:t.scalingVector.x,y:t.scalingVector.y,z:t.scalingVector.z},t.duration)).onUpdate(t.parent&&t.pivot?function(){var e=new module$src$externals$three.default.Matrix4,n=new module$src$externals$three.default.Matrix4,o=new module$src$externals$three.default.Matrix4,s=r.getPathObject(a,t.parent);s&&(s.updateMatrix(!0),s.updateMatrixWorld(!0),n=s.matrixWorld),o.makeTranslation(t.pivot.x,t.pivot.y,t.pivot.z),e.multiply(o),e.multiply((new module$src$externals$three.default.Matrix4).makeScale(l.x,l.y,l.z)),e.multiply((new module$src$externals$three.default.Matrix4).getInverse(o)),i.transformationMatrix=n.multiply(e)}:t.parent?function(){var e=new module$src$externals$three.default.Matrix4,n=new module$src$externals$three.default.Matrix4,o=r.getPathObject(a,t.parent);o&&(o.updateMatrix(!0),o.updateMatrixWorld(!0),n=o.matrixWorld),e.multiply((new module$src$externals$three.default.Matrix4).makeScale(l.x,l.y,l.z)),i.transformationMatrix=n.multiply(e)}:t.pivot?function(){var e=new module$src$externals$three.default.Matrix4,n=new module$src$externals$three.default.Matrix4;n.makeTranslation(t.pivot.x,t.pivot.y,t.pivot.z),e.multiply(n),e.multiply((new module$src$externals$three.default.Matrix4).makeScale(l.x,l.y,l.z)),e.multiply((new module$src$externals$three.default.Matrix4).getInverse(n)),i.transformationMatrix=e}:function(){var e=new module$src$externals$three.default.Matrix4;e.multiply((new module$src$externals$three.default.Matrix4).makeScale(l.x,l.y,l.z)),i.transformationMatrix=e})}return i.transformationMatrix=new module$src$externals$three.default.Matrix4,i.hasParent=!1,t.parent&&(i.hasParent=!0),i.gloablDuration=t.delay+t.duration,t.repeat&&(i.gloablDuration+=i.gloablDuration*t.repeat),t.repeat&&i.repeat(t.repeat),t.repeat&&t.yoyo&&i.yoyo(!0),i.onComplete((function(){i.stop()})),i.delay(t.delay),i.easing(t.easing),i},e.prototype.dispatchEvent=function(e){for(var n=new CustomEvent(e.type),r=$jscomp.makeIterator(e),o=r.next();!o.done;o=r.next())n[o=o.value]=e[o];return t.renderingHandler.getDomElement().dispatchEvent(n),n},e.prototype.initialize=function(){p=!0},e.prototype.isInitialized=function(){return p},e.prototype.addMesh=function(e,t,n){u.push(e),c.push(t),l.push({mesh:e,material:t,properties:n})},e.prototype.removeMesh=function(e){for(var t={},n=0,r=l.length;n<r;t={mat:t.mat},n++)if(e===l[n].mesh){t.mat=c[n],u.splice(n,1),c.splice(n,1),l.splice(n,1),t.mat&&("alphaMap aoMap bumpMap displacementMap emissiveMap lightMap map metalnessMap normalMap roughnessMap rgbMap additionalMaps0 additionalMaps1 additionalMaps2 additionalMaps3 additionalMaps4 reflectionNormalMap dispersionMap reflectionMap".split(" ").forEach(function(e){return function(t){e.mat[t]&&e.mat[t].dispose&&e.mat[t].dispose()}}(t)),t.mat.dispose());break}},e.prototype.addAnchor=function(e,r){var a={object:e,properties:Object.assign({lastPos:new module$src$externals$three.default.Vector2},r)};d.push(a);var i={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_ANCHOR_ADD,anchors:[]},s=t.renderingHandler.getSize().width,l=t.renderingHandler.getSize().height,u=t.cameraHandler.getCamera(),c=t.renderingHandler.getCanvas().getBoundingClientRect(),p=!1,h=new module$src$externals$three.default.Vector3,m=new module$src$externals$three.default.Vector3,f=new module$src$externals$three.default.Raycaster;e.updateMatrixWorld(!0),h.setFromMatrixPosition(e.matrixWorld),m.set(h.x,h.y,h.z),m.project(u),m.x=s/2*m.x+s/2,m.y=-l/2*m.y+l/2,m.x=0>m.x?Math.ceil(m.x):Math.floor(m.x),m.y=0>m.y?Math.ceil(m.y):Math.floor(m.y),(1>=m.x||m.x>=s-1||1>=m.y||m.y>=l-1)&&(p=!0),m.xPixel=m.x/devicePixelRatio,m.yPixel=m.y/devicePixelRatio,f.ray.direction.copy(h),f.ray.origin.set(0,0,0),u.localToWorld(f.ray.origin),f.ray.direction.sub(f.ray.origin);var g=f.ray.direction.length();f.ray.direction.normalize();var $=Number.MAX_VALUE;o.traverseVisible((function(e){e instanceof module$src$externals$three.default.Mesh&&(e=f.intersectObject(e)).length&&e[0].distance<$&&($=e[0].distance)})),u.getWorldDirection(h),u=f.ray.direction.dot(h),i.anchors.push(Object.assign({location:{x:e.position.x,y:e.position.y,z:e.position.z},containerX:m.xPixel,containerY:m.yPixel,containerWidth:s/devicePixelRatio,containerHeight:l/devicePixelRatio,clientX:m.xPixel+c.left,clientY:m.yPixel+c.top,pageX:m.xPixel+c.left+window.pageXOffset,pageY:m.yPixel+c.top+window.pageYOffset,viewport:t.threeDManager.runtimeId,hidden:$<g,overflow:p,distance:g,viewingAngle:u,scenePath:r.path,format:r.format,data:r.data},{updateFunction:function(e){return a.properties.update=e}})),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_ANCHORDATA,i),t.threeDManager.message(i.type,e),n.dispatchEvent(i)},e.prototype.removeAnchor=function(e){var r,a={},i=0;for(r=d.length;i<r;a={raycaster:a.raycaster,closestIntersectionDistance:a.closestIntersectionDistance},i++)if(e===d[i].object){var s=(r=d[i]).properties;r={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_ANCHOR_REMOVE,anchors:[]};var l=t.renderingHandler.getSize().width,u=t.renderingHandler.getSize().height,c=t.cameraHandler.getCamera(),p=t.renderingHandler.getCanvas().getBoundingClientRect(),h=!1,m=new module$src$externals$three.default.Vector3,f=new module$src$externals$three.default.Vector3;a.raycaster=new module$src$externals$three.default.Raycaster,e.updateMatrixWorld(!0),m.setFromMatrixPosition(e.matrixWorld),f.set(m.x,m.y,m.z),f.project(c),f.x=l/2*f.x+l/2,f.y=-u/2*f.y+u/2,f.x=0>f.x?Math.ceil(f.x):Math.floor(f.x),f.y=0>f.y?Math.ceil(f.y):Math.floor(f.y),(1>=f.x||f.x>=l-1||1>=f.y||f.y>=u-1)&&(h=!0),f.xPixel=f.x/devicePixelRatio,f.yPixel=f.y/devicePixelRatio,a.raycaster.ray.direction.copy(m),a.raycaster.ray.origin.set(0,0,0),c.localToWorld(a.raycaster.ray.origin),a.raycaster.ray.direction.sub(a.raycaster.ray.origin);var g=a.raycaster.ray.direction.length();a.raycaster.ray.direction.normalize(),a.closestIntersectionDistance=Number.MAX_VALUE,o.traverseVisible(function(e){return function(t){t instanceof module$src$externals$three.default.Mesh&&(t=e.raycaster.intersectObject(t)).length&&t[0].distance<e.closestIntersectionDistance&&(e.closestIntersectionDistance=t[0].distance)}}(a)),c.getWorldDirection(m),c=a.raycaster.ray.direction.dot(m),r.anchors.push({location:{x:e.position.x,y:e.position.y,z:e.position.z},containerX:f.xPixel,containerY:f.yPixel,containerWidth:l/devicePixelRatio,containerHeight:u/devicePixelRatio,clientX:f.xPixel+p.left,clientY:f.yPixel+p.top,pageX:f.xPixel+p.left+window.pageXOffset,pageY:f.yPixel+p.top+window.pageYOffset,viewport:t.threeDManager.runtimeId,hidden:a.closestIntersectionDistance<g,overflow:h,distance:g,viewingAngle:c,scenePath:s.path,format:s.format,data:s.data}),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_ANCHORDATA,r),t.threeDManager.message(r.type,e),n.dispatchEvent(r),d.splice(i,1);break}},e.prototype.getMeshes=function(){return u},e.prototype.getMaterials=function(){return c},e.prototype.getMeshMaterialObjects=function(){return l},e.prototype.getAnchors=function(){return d},e.prototype.toggleMeshes=function(e){for(var t=0,n=l.length;t<n;t++)e&&(l[t].mesh.material=l[t].material)},e.prototype.toggleGeometry=function(e){f=e},e.prototype.addSceneObject=function(e){i.add(e)},e.prototype.removeSceneObject=function(e){i.remove(e)},e.prototype.setLiveTransformation=function(e,o,i,s,l){var u={};u.reset=s,u.duration=l,s=[],l=0;for(var c=o.length;l<c;l++){var d=r.getPathObject(a,o[l]);d&&s.push(d)}u.sceneObjects=s,u.sceneObjectPaths=o;var p=[];for(u.maxDuration=0,u.hasParent=!1,o=0,s=i.length;o<s;o++)l=n._createTransformationObject(e,i[o]),u.maxDuration=Math.max(u.maxDuration,l.gloablDuration),u.hasParent=u.hasParent||l.hasParent,p.push(l);return u.maxDuration===u.duration&&(u.duration=1/0),u.tweens=p,u.start=function(){for(var e=0,t=p.length;e<t;e++)p[e].start()},u.prev=new module$src$externals$three.default.Matrix4,u.promise=new Promise((function(e,n){u.stopTransformation=function(){t.renderingHandler.unregisterForContinuousRendering("liveTransformationEvent"),!1===t.renderingHandler.containsContinuousRendering("liveTransformationEvent")&&(t.renderingHandler.stopUpdatingShadowMap(),t.renderingHandler.updateShadowMap()),u.stopped=!0,e(!0)}})),u.stopCalled=!1,u.stopAndReset=!1,u.stop=function(e){u.stopCalled=!0,u.stopAndReset=e},t.renderingHandler.keepUpdatingShadowMap(),t.renderingHandler.registerForContinuousRendering("liveTransformationEvent"),t.threeDManager.transformationGroups.push(u),u},e.prototype.toggleSceneObjects=function(e){h=e,e||(i.visible=e)},e.prototype.addViewportObject=function(e){s.add(e)},e.prototype.removeViewportObject=function(e){s.remove(e)},e.prototype.toggleViewportObjects=function(e){m=e,e||(s.visible=e)},e.prototype.toggleSceneBackground=function(e){t.materialHandler.getSceneBackground&&(o.background=e?t.materialHandler.getSceneBackground():null)},e.prototype.toggleViewportMatrix=function(e){a.applyMatrix(e?t.threeDManager.transformationMatrix:(new module$src$externals$three.default.Matrix4).getInverse(t.threeDManager.transformationMatrix,!0)),s.applyMatrix(e?t.threeDManager.transformationMatrix:(new module$src$externals$three.default.Matrix4).getInverse(t.threeDManager.transformationMatrix,!0))},e.prototype.toggleLiveTransformations=function(e,n){var o=[];if(e)for(var i=0;i<t.threeDManager.transformationGroups.length;i++){var s=t.threeDManager.transformationGroups[i];if(!s.stopped){s.initTime||(s.initTime=n);var l=s.tweens,u=s.sceneObjects,c=new module$src$externals$three.default.Matrix4,d=!1,p=0;for(e=l.length;p<e;p++){var h=l[p];h.update(n),c.multiply(h.transformationMatrix),h.isPlaying()&&(d=!0)}for(s.active=!s.stopCalled&&d&&!(n>s.duration+s.initTime),l=0,e=u.length;l<e;l++)u[l]&&(u[l].parent||(d=r.getPathObject(a,s.sceneObjectPaths[l]),u[l]=d),u[l].applyMatrix(c),o.includes(u[l])||o.push(u[l]));s.prev.getInverse(c)}}else for(i=0;i<t.threeDManager.transformationGroups.length;i++)if(!(s=t.threeDManager.transformationGroups[i]).stopped){if(u=s.sceneObjects,e=!1,!1===s.active)for(c=0;c<t.threeDManager.transformationGroups.length;c++)t.threeDManager.transformationGroups[c].maxDuration===s.maxDuration&&t.threeDManager.transformationGroups[c].initTime===s.initTime&&c<i&&!0!==t.threeDManager.transformationGroups[c].stopped&&(e=!0);if(!1===s.active&&!1===e){if(n>s.duration+s.initTime||s.stopCalled)for(l=0,e=(c=s.tweens).length;l<e;l++)c[l].stop();for(c=0,e=u.length;c<e;c++)if(u[c]){if(l=new module$src$externals$three.default.Matrix4,!0===s.reset&&!0!==s.stopCalled||!0===s.stopAndReset)u[c].applyMatrix(s.prev);else{for(u[c].updateMatrix(!0),u[c].updateMatrixWorld(!0),d=!0,p=0;16>p;p++)l.elements[p]-.001<u[c].matrix.elements[p]&&u[c].matrix.elements[p]<l.elements[p]+.001||(d=!1);d&&(u[c].matrix.identity(),u[c].matrixWorld.identity(),u[c].updateMatrix(!0),u[c].updateMatrixWorld(!0))}o.includes(u[c])||o.push(u[c])}s.stopTransformation()}else for(c=0,e=u.length;c<e;c++)u[c]&&(u[c].applyMatrix(s.prev),o.includes(u[c])||o.push(u[c]))}return o},e.prototype.toggleViewport=function(e,t){f||(a.visible=!e),m&&(s.visible=e),h&&(i.visible=e),this.toggleMeshes(e),this.toggleSceneBackground(e),this.toggleViewportMatrix(e),t&&this.toggleLiveTransformations(e,t)},e.prototype.destroyViewport=function(){u.length=0,c.length=0,l.length=0,d.length=0,o.remove(i),o.remove(s)},new e}},module$src$3d$interfaces$handlers$RenderingHandlerInterface={default:function(){}};module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.render=function(e){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.renderHidden=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.onResize=function(e,t){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.getSize=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.start=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.pause=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.resume=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.destroy=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.getScreenshot=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.getDomElement=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.getCanvas=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.getRendererInfo=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.setBlur=function(e,t){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.registerForContinuousRendering=function(e,t){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.unregisterForContinuousRendering=function(e){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.containsContinuousRendering=function(e){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.updateShadowMap=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.keepUpdatingShadowMap=function(){},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.prototype.stopUpdatingShadowMap=function(){};var module$src$3d$helpers$handlers$RenderingHandlerHelpers={default:function(e){var t,n,r,o,a,i,s,l,u=function(){t=this,i=new module$src$externals$three.default.Vector3,s=new module$src$externals$three.default.Vector3,l=new module$src$externals$three.default.Raycaster};return u.prototype.createWebGLRenderer=function(e,i){var s={success:!0,message:"",messageLevel:module$src$shared$constants$LoggingConstants.default.loggingLevels.INFO};a=Object.assign({},i),r=e;try{var l=a.canvas;l||((l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).id=("string"==typeof r.id&&0<r.id.length?r.id:"sdv-container-viewport")+"-canvas",r.appendChild(l),a.canvas=l),s.containerId=r.id,l.addEventListener("webglcontextlost",t.onContextLost,!1),l.addEventListener("webglcontextrestored",t.onContextRestore,!1);var u={alpha:a.alpha,depth:a.depth,stencil:a.stencil,antialias:a.antialias,premultipliedAlpha:a.premultipliedAlpha,preserveDrawingBuffer:a.preserveDrawingBuffer,powerPreference:a.powerPreference};if(null===(n=l.getContext("webgl",u)||l.getContext("experimental-webgl",u))){if(null===(n=l.getContext("webgl")||l.getContext("experimental-webgl")))throw Error("We were unable to get a WebGL context.");s.message="We were unable to get a WebGL context using the requested attributes, falling back to default attributes.",s.messageLevel=module$src$shared$constants$LoggingConstants.default.loggingLevels.WARN}void 0===n.getShaderPrecisionFormat&&(n.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),a.context=n,o=new module$src$externals$three.default.WebGLRenderer(a),s.renderer=o}catch(c){a.canvas&&((e=a.canvas.parentNode)&&e.removeChild(a.canvas),delete a.canvas),s.success=!1,s.message=c.message,s.messageLevel=module$src$shared$constants$LoggingConstants.default.loggingLevels.ERROR}return s},u.prototype.getWebGLContext=function(){return n},u.prototype.handleCreateWebGLRendererResponse=function(t,n,r,o){return(r=!0===n.success?r:o)&&(n.messageScope=r),!1===n.success&&(o=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,n),e.threeDManager.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_FAILED,o)),e.threeDManager.log(n.messageLevel,t,r,n.message),e.threeDManager.log(n.messageLevel|module$src$shared$constants$LoggingConstants.default.loggingLevels.LOG_TO_SERVER,t,{success:n.success,message:n.message,messageLevel:n.messageLevel,messageScope:n.messageScope,webglreport:n.webglreport}),!0===n.success},u.prototype.onContextLost=function(n){n.preventDefault(),n.stopImmediatePropagation(),e.threeDManager&&(a.canvas&&(a.canvas.removeEventListener("webglcontextlost",t.onContextLost,!1),a.canvas.removeEventListener("webglcontextrestored",t.onContextRestore,!1),(n=a.canvas.parentNode)&&n.removeChild(a.canvas),delete a.canvas),n=t.createWebGLRenderer(r,a),t.handleCreateWebGLRendererResponse("onContextLost",n,"WebGL context was lost and could be restored","WebGL context was lost and could not be restored"),!1!==n.success&&e.threeDManager.api.reload())},u.prototype.onContextRestore=function(e){e.preventDefault(),e.stopImmediatePropagation()},u.prototype.processAnchors=function(t,n,r,o){var a,u=window.devicePixelRatio;if(0<o.length)var c=t.context.canvas,d=c.width,p=c.height;var h={};for(t=0,a=o.length;t<a;h={closestIntersectionDistance:h.closestIntersectionDistance},t++){var m=o[t],f=m.object;if((m=m.properties).update){f.updateMatrixWorld(!0),i.setFromMatrixPosition(f.matrixWorld),s.set(i.x,i.y,i.z),s.project(r),s.x=d/2*s.x+d/2,s.y=-p/2*s.y+p/2,s.x=0>s.x?Math.ceil(s.x):Math.floor(s.x),s.y=0>s.y?Math.ceil(s.y):Math.floor(s.y);var g=c.getBoundingClientRect(),$=!1;(1>=s.x||s.x>=d-1||1>=s.y||s.y>=p-1)&&($=!0),s.xPixel=s.x/u,s.yPixel=s.y/u,l.ray.direction.copy(i),l.ray.origin.set(0,0,0),r.localToWorld(l.ray.origin),l.ray.direction.sub(l.ray.origin);var v=l.ray.direction.length();l.ray.direction.normalize(),h.closestIntersectionDistance=Number.MAX_VALUE,n.traverseVisible(function(e){return function(t){t instanceof module$src$externals$three.default.Mesh&&(t=l.intersectObject(t)).length&&t[0].distance<e.closestIntersectionDistance&&(e.closestIntersectionDistance=t[0].distance)}}(h)),r.getWorldDirection(i);var y=l.ray.direction.dot(i);f={location:{x:f.position.x,y:f.position.y,z:f.position.z},containerX:s.xPixel,containerY:s.yPixel,containerWidth:d/u,containerHeight:p/u,clientX:s.xPixel+g.left,clientY:s.yPixel+g.top,pageX:s.xPixel+g.left+window.pageXOffset,pageY:s.yPixel+g.top+window.pageYOffset,viewport:e.threeDManager.runtimeId,hidden:h.closestIntersectionDistance<v,overflow:$,distance:v,viewingAngle:y,scenePath:m.path,format:m.format,data:m.data},m.lastPos.x=s.x,m.lastPos.y=s.y,m.update(f)}}},new u}},module$src$3d$viewports$simple$handlers$RenderingHandler={default:function(e,t){var n,r,o,a,i=e.settings,s=e.scene,l=e.container,u=l.offsetWidth,c=l.offsetHeight,d=!0,p=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color",t.threeDManager.warn,"RenderingHandler.Hook->clearColor")&&(o.setClearColor((0,module$src$shared$util$toTinyColor.default)(e).toThreeColor()),n.render(),!0)};return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.call(this),n=this;var e=(r=new module$src$3d$helpers$handlers$RenderingHandlerHelpers.default(t)).createWebGLRenderer(l,{antialias:!0,alpha:!0,preserveDrawingBuffer:!0});if(t.threeDManager.success=e.success,!1===e.success)return t.threeDManager.warn(e.message),t.threeDManager.errorResponse=e,null;""!==e.message&&t.threeDManager.warn(e.message),(o=e.renderer).setPixelRatio(window.devicePixelRatio),o.setSize(u,c,!1),o.setClearColor((0,module$src$shared$util$toTinyColor.default)(i.getSetting("clearColor"),"white").toThreeColor(),1),(a=new module$src$externals$three.default.WebGLRenderTarget(u,c,{minFilter:module$src$externals$three.default.LinearFilter,magFilter:module$src$externals$three.default.LinearFilter,format:module$src$externals$three.default.RGBAFormat,stencilBuffer:!1})).texture.name="hidden.rt",i.registerHook("clearColor",p)},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default),e.prototype._beforeRender=function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement)var e=screen.width,n=screen.height;else e=l.offsetWidth,n=l.offsetHeight;e===u&&n===c||(o.setSize(u=e,c=n,!1),t.cameraHandler.onResize(u,c))},e.prototype.render=function(){o&&t.threeDManager&&requestAnimationFrame(n.render),t.threeDManager&&d&&!1!==t.threeDManager.getSetting("show")&&t.cameraHandler&&t.cameraHandler.getCamera()&&(n._beforeRender(),t.threeDManager.helpers.toggleViewport(!0),o.render(s,t.cameraHandler.getCamera()),r.processAnchors(o,s,t.cameraHandler.getCamera(),t.threeDManager.helpers.getAnchors()),t.threeDManager.helpers.toggleViewport(!1))},e.prototype.renderHidden=function(){t.threeDManager&&t.cameraHandler&&t.cameraHandler.getCamera()&&(t.threeDManager.helpers.toggleViewport(!0),o.render(s,t.cameraHandler.getCamera(),a),t.threeDManager.helpers.toggleViewport(!1))},e.prototype.onResize=function(e,t){o.setSize(e,t)},e.prototype.getSize=function(){return o.getSize()},e.prototype.pause=function(){d=!1},e.prototype.resume=function(){d=!0},e.prototype.destroy=function(){o.dispose();try{o.forceContextLoss()}catch(e){}},e.prototype.getScreenshot=function(){return o.domElement.toDataURL("image/png")},e.prototype.getDomElement=function(){return o.domElement},e.prototype.getCanvas=function(){return o.context.canvas},e.prototype.getRendererInfo=function(){return o.info},e.prototype.setBlur=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.registerForContinuousRendering=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.unregisterForContinuousRendering=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.containsContinuousRendering=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.updateShadowMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.keepUpdatingShadowMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.stopUpdatingShadowMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},new e}},module$src$3d$interfaces$handlers$MaterialHandlerInterface={default:function(){}};module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.pause=function(){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.resume=function(){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.destroy=function(){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.getMaterial=function(e){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.getSimpleMaterial=function(e){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.compile=function(){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.adjustToBoundingSphere=function(e){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.getEnvironmentMap=function(){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.setSceneBackground=function(e){},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.prototype.getSceneBackground=function(){};var module$src$3d$helpers$handlers$MaterialHandlerHelpers={default:function(e,t){var n=t.nameSimple;return(t=function(){}).prototype.checkMaterials=function(){var t=e.renderingHandler.getRendererInfo();if(t&&t.programs)for(var r=0,o=(t=t.programs).length;r<o;r++){var a=t[r];if(a.diagnostics&&!1===a.diagnostics.runnable){if(a.name===n){var i={message:a,messageLevel:module$src$shared$constants$LoggingConstants.default.loggingLevels.ERROR,messageScope:"Shader program could not be created"},s=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE,i);e.threeDManager.message(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS_FAILED,s),e.threeDManager.log(i.messageLevel,i.messageScope,i),e.threeDManager.log(i.messageLevel|module$src$shared$constants$LoggingConstants.default.loggingLevels.LOG_TO_SERVER,i.messageScope,i),e.renderingHandler.api.destroy()}else for(var l=0,u=(i=e.threeDManager.helpers.getMeshMaterialObjects()).length;l<u;l++)if((s=i[l]).material.program&&s.material.program.id===a.id){s.material=e.materialHandler.getSimpleMaterial(s.properties);break}delete a.diagnostics}}},new t}},module$src$3d$viewports$simple$handlers$MaterialHandler={default:function(e,t){var n;return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.call(this),n=new module$src$3d$helpers$handlers$MaterialHandlerHelpers.default(t,{nameStandard:"MeshPhongMaterial",nameSimple:"MeshBasicMaterial"})},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default),e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.destroy=function(){},e.prototype.getMaterial=function(e){return new module$src$externals$three.default.MeshPhongMaterial(Object.assign({shininess:e.metalness?128*e.metalness:0},e))},e.prototype.getSimpleMaterial=function(e){return new module$src$externals$three.default.MeshBasicMaterial(e)},e.prototype.compile=function(){t.renderingHandler.renderHidden(),n.checkMaterials()},e.prototype.adjustToBoundingSphere=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getEnvironmentMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.setSceneBackground=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getSceneBackground=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},new e}},module$src$3d$interfaces$handlers$CameraHandlerInterface={default:function(){}};module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.pause=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.resume=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.destroy=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.setPosition=function(e){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.resetPosition=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.getPosition=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.setTarget=function(e){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.resetTarget=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.getTarget=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.setPositionAndTarget=function(e,t,n){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.resetPositionAndTarget=function(e){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.getPositionAndTarget=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.setViewAndProjectionMatrix=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.zoomExtents=function(e,t){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.setCameraPath=function(e,t,n){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.getCamera=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.isCameraMoving=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.updateOrbitControls=function(){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.adjustToBoundingSphere=function(e){},module$src$3d$interfaces$handlers$CameraHandlerInterface.default.prototype.onResize=function(e,t){};var module$src$3d$interfaces$OrbitControlsProxyInterface={default:function(){}};module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.getClientSize=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onStateChange=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onStateChangeNone=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.dispose=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.initialize=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onContextMenu=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onMouseDown=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onMouseWheel=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onTouchStart=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onTouchEnd=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onTouchMove=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onMouseMove=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onMouseUp=function(){},module$src$3d$interfaces$OrbitControlsProxyInterface.default.prototype.onKeyDown=function(){};var module$src$3d$helpers$OrbitControlsProxyStandardImplementation={default:function(e){var t,n=function(){module$src$3d$interfaces$OrbitControlsProxyInterface.default.call(this),t=this};return $jscomp.inherits(n,module$src$3d$interfaces$OrbitControlsProxyInterface.default),n.prototype.getClientSize=function(){return{width:e.renderingHandler.getDomElement().clientWidth,height:e.renderingHandler.getDomElement().clientHeight}},n.prototype.onStateChange=function(){document.addEventListener("mousemove",t.onMouseMove,{passive:!1},!1),document.addEventListener("mouseup",t.onMouseUp,{passive:!1},!1),document.addEventListener("mouseout",t.onMouseUp,{passive:!1},!1)},n.prototype.onStateChangeNone=function(){document.removeEventListener("mousemove",t.onMouseMove,!1),document.removeEventListener("mouseup",t.onMouseUp,!1),document.removeEventListener("mouseout",t.onMouseUp,!1)},n.prototype.dispose=function(){e.renderingHandler.getDomElement().removeEventListener("contextmenu",t.onContextMenu,!1),e.renderingHandler.getDomElement().removeEventListener("mousedown",t.onMouseDown,!1),e.renderingHandler.getDomElement().removeEventListener("mousewheel",t.onMouseWheel,!1),e.renderingHandler.getDomElement().removeEventListener("MozMousePixelScroll",t.onMouseWheel,!1),e.renderingHandler.getDomElement().removeEventListener("touchstart",t.onTouchStart,!1),e.renderingHandler.getDomElement().removeEventListener("touchend",t.onTouchEnd,!1),e.renderingHandler.getDomElement().removeEventListener("touchmove",t.onTouchMove,!1),document.removeEventListener("mousemove",t.onMouseMove,!1),document.removeEventListener("mouseup",t.onMouseUp,!1),document.removeEventListener("mouseout",t.onMouseUp,!1),window.removeEventListener("keydown",t.onKeyDown,!1)},n.prototype.initialize=function(){e.renderingHandler.getDomElement().addEventListener("contextmenu",t.onContextMenu,{passive:!1},!1),e.renderingHandler.getDomElement().addEventListener("mousedown",t.onMouseDown,{passive:!1},!1),e.renderingHandler.getDomElement().addEventListener("mousewheel",t.onMouseWheel,{passive:!1},!1),e.renderingHandler.getDomElement().addEventListener("MozMousePixelScroll",t.onMouseWheel,{passive:!1},!1),e.renderingHandler.getDomElement().addEventListener("touchstart",t.onTouchStart,{passive:!1},!1),e.renderingHandler.getDomElement().addEventListener("touchend",t.onTouchEnd,{passive:!1},!1),e.renderingHandler.getDomElement().addEventListener("touchmove",t.onTouchMove,{passive:!1},!1),window.addEventListener("keydown",t.onKeyDown,{passive:!1},!1)},new n}},module$src$3d$viewports$simple$handlers$CameraHandler={default:function(e,t){var n,r,o,a=e.settings,i=e.container;return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$CameraHandlerInterface.default.call(this),n=this,(r=new module$src$externals$three.default.PerspectiveCamera(a.getSetting("fov"),i.offsetWidth/i.offsetHeight,a.getSetting("near"),a.getSetting("far"))).position.set(5,5,5),r.up.set(0,0,1),t.threeDManager.helpers.addSceneObject(r);var e=new module$src$3d$helpers$OrbitControlsProxyStandardImplementation.default(t);o=new module$src$externals$three.default.OrbitControls(r,e),e.initialize(),o.target.set(0,0,0)},module$src$3d$interfaces$handlers$CameraHandlerInterface.default),e.prototype.pause=function(){o.enabled=!1,o.resetState()},e.prototype.resume=function(){o.enabled=!0},e.prototype.destroy=function(){},e.prototype.setPosition=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.resetPosition=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getPosition=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(o.object.position)},e.prototype.setTarget=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.resetTarget=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getTarget=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(o.target)},e.prototype.setPositionAndTarget=function(e,n,r){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.resetPositionAndTarget=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getPositionAndTarget=function(){return{position:n.getPosition(),target:n.getTarget()}},e.prototype.zoomExtents=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.setCameraPath=function(e,n,r){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getCamera=function(){return r},e.prototype.isCameraMoving=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.updateOrbitControls=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.adjustToBoundingSphere=function(e){r.far=100*e.radius,r.near=.01*e.radius,r.updateProjectionMatrix()},e.prototype.onResize=function(e,t){r.aspect=e/t,r.setViewOffset(e,t,0,0,e,t),r.updateProjectionMatrix()},new e}},module$src$3d$interfaces$handlers$LightHandlerInterface={default:function(){}};module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.pause=function(){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.resume=function(){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.destroy=function(){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.updateLight=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.removeLight=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.getLight=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.setLightSceneFromID=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.setLightSceneFromDefinition=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.getLightScene=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.getAllLightScene=function(){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.saveLightScene=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.adjustToBoundingSphere=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.setToggleLightShadows=function(e){},module$src$3d$interfaces$handlers$LightHandlerInterface.default.prototype.toggleLights=function(e){};var module$src$3d$viewports$simple$handlers$LightHandler={default:function(e,t){var n;return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$LightHandlerInterface.default.call(this),(n=new module$src$externals$three.default.Object3D).add(new module$src$externals$three.default.AmbientLight(16777215,1)),t.threeDManager.helpers.addSceneObject(n)},module$src$3d$interfaces$handlers$LightHandlerInterface.default),e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.destroy=function(){},e.prototype.adjustToBoundingSphere=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.setToggleLightShadows=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.toggleLights=function(e){n.visible=e},new e}},module$src$3d$viewports$simple$ThreeDManager={default:function(e,t){var n,r,o,a=t.pathUtils,i=t.settings,s=t.scene,l=t.geometryNode,u=t.container,c={},d=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean")&&(u&&(u.style.opacity=e?1:0),!0)},p=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&(u&&(u.style.transition=0<e.length?"opacity "+e:"none"),!0)},h=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->groundPlaneVisibility")&&(o&&(o.visible=e),c.renderingHandler.render(),!0)},m=function(e,t){module$src$3d$interfaces$ThreeDManagerInterface.default.call(this,t,module$src$shared$util$GlobalUtils.default),(n=this).constants=module$src$3d$viewports$simple$ThreeDManagerConstants.default,c.threeDManager=n,n.viewerApi=e,r=new module$src$3d$helpers$ThreeDManagerHelpers.default({scene:s,geometryNode:l,pathUtils:a},c),c.threeDManager.helpers=r,module$src$shared$mixins$SettingsMixin.default.call(n,i,module$src$3d$viewports$simple$ThreeDManagerConstants.default.defaultSettings,t.runtimeId),this.renderingHandler=new module$src$3d$viewports$simple$handlers$RenderingHandler.default({settings:n.getSection("render"),scene:s,container:u},c),c.renderingHandler=this.renderingHandler,!1!==n.success&&(this.materialHandler=new module$src$3d$viewports$simple$handlers$MaterialHandler.default({settings:n.getSection("material")},c),c.materialHandler=this.materialHandler,!1!==n.success&&(this.cameraHandler=new module$src$3d$viewports$simple$handlers$CameraHandler.default({settings:n.getSection("camera"),container:u},c),c.cameraHandler=this.cameraHandler,!1!==n.success&&(this.lightHandler=new module$src$3d$viewports$simple$handlers$LightHandler.default({settings:n.getSection("lights"),container:u},c),c.lightHandler=this.lightHandler,!1!==n.success&&(this.registerHook("show",d),this.registerHook("showTransition",p),this.registerHook("groundPlaneVisibility",h)))))};return $jscomp.inherits(m,module$src$3d$interfaces$ThreeDManagerInterface.default),m.prototype.init=function(e){var t=e.min.distanceTo(e.max);if(1<t)e=(e=(e=parseInt(t)).toString()).length,e=Math.pow(10,e-1),t=Math.max(Math.ceil(t/e)*e,1);else{e=1-Math.floor(Math.log(t)/Math.log(10))-2,t=t.toFixed(e+1);var a=parseInt(t.substr(t.length-1))+1;t="0.";for(var i=0;i<e;++i)t+="0";t=parseFloat(t+a)}e=new module$src$externals$three.default.PlaneGeometry(2*t,2*t,2,2),(o=new module$src$externals$three.default.Mesh(e,c.materialHandler.getMaterial({color:13882323,side:module$src$externals$three.default.FrontSide,roughness:1,metalness:0}))).receiveShadow=!0,o.visible=n.getSetting("groundPlaneVisibility"),(e=new module$src$externals$three.default.Object3D).SDLocalPath="groundplane",e.add(o),r.addSceneObject(e),r.initialize(),n.adjustScene()},m.prototype.adjustScene=function(){if(r.isInitialized()){var e=l.computeSceneBoundingBox(),t=new module$src$externals$three.default.Sphere;e.getBoundingSphere(t),o.position.set(0,0,e.min.z),c.cameraHandler.adjustToBoundingSphere(t),c.materialHandler.compile()}},m.prototype.computeBoundingBox=function(e){return l.computeBoundingBox(e)},m.prototype.pause=function(){c.renderingHandler.pause(),c.cameraHandler.pause(),c.lightHandler.pause(),c.materialHandler.pause()},m.prototype.resume=function(){c.renderingHandler.resume(),c.cameraHandler.resume(),c.lightHandler.resume(),c.materialHandler.resume()},m.prototype.destroy=function(){for(delete c.threeDManager,r.destroyViewport(),c.renderingHandler&&c.renderingHandler.destroy(),c.cameraHandler&&c.cameraHandler.destroy(),c.lightHandler&&c.lightHandler.destroy(),c.materialHandler&&c.materialHandler.destroy(),n.deregisterAllHooks(),n.deregisterAllNotifiers();u.firstChild;)u.removeChild(u.firstChild);for(var e in c)delete c[e]},m.prototype.addMesh=function(e,t,n){r.addMesh(e,t,n)},m.prototype.removeMesh=function(e){r.removeMesh(e)},m.prototype.addAnchor=function(e,t){r.addAnchor(e,t)},m.prototype.removeAnchor=function(e){r.removeAnchor(e)},m.prototype.fadeIn=function(e,t){n.debug("This method is not implemented in this viewport.")},m.prototype.fadeOut=function(e,t){n.debug("This method is not implemented in this viewport.")},m.prototype.setLiveTransformation=function(e,t,r,o,a){n.debug("This method is not implemented in this viewport.")},m.prototype.updateInteractions=function(e,t){n.debug("This method is not implemented in this viewport.")},m.prototype.removeFromInteractions=function(e){n.debug("This method is not implemented in this viewport.")},new m(e,t)}},module$src$3d$interfaces$api$ViewportApiInterface={default:function(){this.lights=this.camera=null}};module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getRuntimeId=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getContainer=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getScreenshot=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.render=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.convertTo2D=function(e){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.onResize=function(e,t){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getSize=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.pause=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.resume=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.reload=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.destroy=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.addEventListener=function(e,t){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.removeEventListener=function(e){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getSettingDefinitions=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getSettings=function(e){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getSetting=function(e){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.updateSettingAsync=function(e,t){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.updateSettingsAsync=function(e){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.setTransformation=function(e){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getTransformation=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.applyTransformation=function(e){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.resetTransformation=function(){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.setLiveTransformation=function(e,t){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.updateSelected=function(e,t){},module$src$3d$interfaces$api$ViewportApiInterface.default.prototype.getSelected=function(){};var module$src$3d$interfaces$api$CameraApiInterface={default:function(){}};module$src$3d$interfaces$api$CameraApiInterface.default.prototype.get=function(){},module$src$3d$interfaces$api$CameraApiInterface.default.prototype.updateAsync=function(e,t){},module$src$3d$interfaces$api$CameraApiInterface.default.prototype.animateAsync=function(e,t){},module$src$3d$interfaces$api$CameraApiInterface.default.prototype.zoomAsync=function(e,t){},module$src$3d$interfaces$api$CameraApiInterface.default.prototype.resetAsync=function(e){},module$src$3d$interfaces$api$CameraApiInterface.default.prototype.updateMatrices=function(){};var module$src$3d$viewports$simple$api$CameraApi={default:function(e,t){var n=t.threeDManager,r=t.apiResponse;return $jscomp.inherits(e=function(){module$src$3d$interfaces$api$CameraApiInterface.default.call(this),this.get=this.get.bind(this),this.updateAsync=this.updateAsync.bind(this),this.animateAsync=this.animateAsync.bind(this),this.zoomAsync=this.zoomAsync.bind(this),this.resetAsync=this.resetAsync.bind(this)},module$src$3d$interfaces$api$CameraApiInterface.default),e.prototype.get=function(){return r(null,n.cameraHandler.getPositionAndTarget())},e.prototype.updateAsync=function(e,t){throw Error("This API function is not implemented by this viewport.")},e.prototype.animateAsync=function(e,t){throw Error("This API function is not implemented by this viewport.")},e.prototype.zoomAsync=function(e,t){throw Error("This API function is not implemented by this viewport.")},e.prototype.resetAsync=function(e){throw Error("This API function is not implemented by this viewport.")},new e}},module$src$3d$interfaces$api$LightApiInterface={default:function(){this.LIGHTTYPE={AMBIENT:"ambient",DIRECTIONAL:"directional",HEMISPHERE:"hemisphere",POINT:"point",SPOT:"spot",FLASH:"flash"},this.LIGHTSCENE={DEFAULT:"default",LEGACY:"legacy"}}};module$src$3d$interfaces$api$LightApiInterface.default.prototype.updateLight=function(e){},module$src$3d$interfaces$api$LightApiInterface.default.prototype.removeLight=function(e){},module$src$3d$interfaces$api$LightApiInterface.default.prototype.getLight=function(e){},module$src$3d$interfaces$api$LightApiInterface.default.prototype.setLightSceneFromID=function(e){},module$src$3d$interfaces$api$LightApiInterface.default.prototype.setLightSceneFromDefinition=function(e){},module$src$3d$interfaces$api$LightApiInterface.default.prototype.getLightScene=function(e){},module$src$3d$interfaces$api$LightApiInterface.default.prototype.getAllLightScenes=function(){},module$src$3d$interfaces$api$LightApiInterface.default.prototype.saveLightScene=function(e){};var module$src$3d$viewports$simple$api$LightApi={default:function(e,t){return $jscomp.inherits(e=function(){module$src$3d$interfaces$api$LightApiInterface.default.call(this)},module$src$3d$interfaces$api$LightApiInterface.default),new e}},module$src$3d$helpers$api$ViewportApiHelpers={};module$src$3d$helpers$api$ViewportApiHelpers.default=function(){var e,t,n,r,o,a,i,s,l,u,c=new module$src$externals$three.default.Matrix4,d=new module$src$externals$three.default.Matrix4,p=[],h=function(){s=function(e){t=e.THREE_D_MANAGER_CONSTANTS,n=e.EVENTTYPE,r=e.threeDManager,o=e.viewportManager,a=e.apiResponse,i=e.listeners},l=function(e,t,n){if(n||(n=""),"object"==typeof e)for(var r in e){var o=e[r];if(o.desc){var a={description:o.desc};o.type&&(a.type=o.type),a=module$src$shared$util$GlobalUtils.default.deepCopy(a),t[n.split(".value").join("")+r]=a}l(o,t,n+r+".")}},u=function(e,t){if(-1===t.indexOf("."))return e[t];var n,r=$jscomp.makeIterator((n=t.indexOf("."),function(e){return[e.slice(0,n),e.slice(n+1)]})(t));return t=r.next().value,r=r.next().value,(e=e[t])?(e.value&&(e=e.value),u(e,r)):void 0}};return h.prototype.convertTo2D=function(e,t){s(e),e=new module$src$externals$three.default.Object3D;var n=new module$src$externals$three.default.Vector3,o=r.renderingHandler.getDomElement(),a=o.getBoundingClientRect(),i=o.width;return o=o.height,e.position.set(t.x,t.y,t.z),e.updateMatrixWorld(),n.setFromMatrixPosition(e.matrixWorld),n.project(r.cameraHandler.getCamera()),n.x=i/2*n.x+i/2,n.y=-o/2*n.y+o/2,n.xPixel=n.x/devicePixelRatio,n.yPixel=n.y/devicePixelRatio,{containerX:n.xPixel,containerY:n.yPixel,clientX:n.xPixel+a.left,clientY:n.yPixel+a.top,pageX:n.xPixel+a.left+window.pageXOffset,pageY:n.yPixel+a.top+window.pageYOffset}},h.prototype.reload=function(e){return s(e),o.reloadThreeDManager(r.runtimeId)},h.prototype.destroy=function(e){s(e),e=n.DESTROYED;var t,a=o.removeThreeDManager(r.runtimeId);for(t in i){var l=new CustomEvent(e);i[t](l)}return a},h.prototype.addEventListener=function(e,t,r){return s(e),Object.keys(n).find((function(e){return n[e]===t}))?(e=module$src$shared$util$GlobalUtils.default.createRandomId(),i[e]=r,a(null,e)):a("Unsupported event type")},h.prototype.removeEventListener=function(e,t){return s(e),!!i[t]&&(delete i[t],!0)},h.prototype.getSettingDefinitions=function(e){return s(e),l(t.settingsDefinition,e={},""),e},h.prototype.getSettings=function(e,t){s(e),Array.isArray(t)||(t=Object.keys(this.getSettingDefinitions(e)));var n={};return t.forEach((function(e){if(r.hasSetting(e)){var t=r.getSetting(e);module$src$shared$util$GlobalUtils.default.forceAtPath(n,e,t)}})),n},h.prototype.getSetting=function(e,t){if(s(e),r.hasSetting(t))return r.getSetting(t)},h.prototype.updateSettingAsync=function(e,n,o){if(s(e),void 0===(e=u(t.settingsDefinition,n)))return Promise.resolve(a("Setting does not exist",!1));if(null!=e.type)if(module$src$shared$util$GlobalUtils.default.typeCheck(e.type,"string")){if(module$src$shared$util$GlobalUtils.default.typeCheck(o,"m.type"))return Promise.resolve(a("Setting has wrong value type",!1))}else if("function"==typeof e.type&&!e.type(o))return Promise.resolve(a("Setting has wrong value type",!1));return e.hasOwnProperty("transform")&&"function"==typeof e.transform&&(o=e.transform(o)),r.updateSettingAsync(n,o).then((function(e){return Promise.resolve(e?a(null,!0):a("Update of setting failed",!1))}),(function(){return Promise.resolve(a("Update of setting failed",!1))}))},h.prototype.updateSettingsAsync=function(e,t){s(e);var n=[];module$src$shared$util$GlobalUtils.default.getPaths(t,n);for(var r={},o=Promise.resolve(),i={},l=(n=$jscomp.makeIterator(n)).next();!l.done;i={path:i.path},l=n.next())i.path=l.value,o=(o=o.then(function(n){return function(){return this.updateSettingAsync(e,n.path,module$src$shared$util$GlobalUtils.default.getAtPath(t,n.path))}}(i))).then(function(e){return function(t){module$src$shared$util$GlobalUtils.default.forceAtPath(r,e.path,!t.err)}}(i),function(e){return function(){module$src$shared$util$GlobalUtils.default.forceAtPath(r,e.path,!1)}}(i));return o.then((function(){return a(null,r)}))},h.prototype.setTransformation=function(e,t){s(e),r.transformationMatrices||(r.transformationMatrices=[]),("number"==typeof t[0]||t.isMatrix4)&&(t=[t]),c.identity(),e=0;for(var n=t.length>r.transformationMatrices.length?t.length:r.transformationMatrices.length;e<n;e++){var o;t[e]?r.transformationMatrices[e]=t[e].isMatrix4?t[e]:(o=d.clone()).set.apply(o,$jscomp.arrayFromIterable(t[e])):r.transformationMatrices[e]||(r.transformationMatrices[e]=d.clone()),c.premultiply(r.transformationMatrices[e])}return r.transformationMatrix.identity(),r.transformationMatrix.multiply(c),r.renderingHandler.updateShadowMap(),r.renderingHandler.render(),a(null,!0)},h.prototype.applyTransformation=function(e,t){s(e),r.transformationMatrices||(r.transformationMatrices=[]),("number"==typeof t[0]||t.isMatrix4)&&(t=[t]),c.identity(),e=0;for(var n=t.length>r.transformationMatrices.length?t.length:r.transformationMatrices.length;e<n;e++){var o;null!=t[e]&&(p[e]=t[e].isMatrix4?t[e]:(o=d.clone()).set.apply(o,$jscomp.arrayFromIterable(t[e]))),r.transformationMatrices[e]?t[e]&&r.transformationMatrices[e].multiply(p[e]):r.transformationMatrices[e]=t[e]?p[e]:d.clone(),c.premultiply(r.transformationMatrices[e])}return r.transformationMatrix.identity(),r.transformationMatrix.premultiply(c),r.renderingHandler.updateShadowMap(),r.renderingHandler.render(),a(null,!0)},h.prototype.resetTransformation=function(e){return s(e),r.transformationMatrix=d.clone(),r.transformationMatrices=[],r.renderingHandler.updateShadowMap(),r.renderingHandler.render(),a(null,!0)},h.prototype.getTransformation=function(e){if(s(e),r.transformationMatrices&&0<r.transformationMatrices.length){e=[];for(var t=0,n=r.transformationMatrices.length;t<n;t++)e[t]=r.transformationMatrices[t].clone();return e}return[r.transformationMatrix.clone()]},h.prototype.setLiveTransformation=function(e,t,n){s(e);var o=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Group;e=[];for(var a=0,i=t.length;a<i;a++)e.push(r.setLiveTransformation(o,t[a].scenePaths,t[a].transformations,t[a].reset,n));for(t=0,i=e.length;t<i;t++)e[t].start();return e},{getInstance:function(){return e||(e=new h),e}}}();var module$src$3d$viewports$simple$api$ViewportApi={default:function(e,t){var n,r,o=t.threeDManager,a=t.viewportManager,i={};return $jscomp.inherits(t=function(){module$src$3d$interfaces$api$ViewportApiInterface.default.call(this),this.utils=e.utils,this.EVENTTYPE=e.viewports.EVENTTYPE,this.camera=new module$src$3d$viewports$simple$api$CameraApi.default(e,{threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse}),this.lights=new module$src$3d$viewports$simple$api$LightApi.default(e,{threeDManager:o,apiResponse:this.utils.APIResponse}),n=module$src$3d$helpers$api$ViewportApiHelpers.default.getInstance(),r={THREE_D_MANAGER_CONSTANTS:module$src$3d$viewports$simple$ThreeDManagerConstants.default,EVENTTYPE:this.EVENTTYPE,threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse,listeners:i},this.getRuntimeId=this.getRuntimeId.bind(this),this.getContainer=this.getContainer.bind(this),this.getScreenshot=this.getScreenshot.bind(this),this.render=this.render.bind(this),this.convertTo2D=this.convertTo2D.bind(this),this.onResize=this.onResize.bind(this),this.getSize=this.getSize.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.reload=this.reload.bind(this),this.destroy=this.destroy.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.getSettingDefinitions=this.getSettingDefinitions.bind(this),this.getSettings=this.getSettings.bind(this),this.getSetting=this.getSetting.bind(this),this.updateSettingAsync=this.updateSettingAsync.bind(this),this.updateSettingsAsync=this.updateSettingsAsync.bind(this),this.setTransformation=this.setTransformation.bind(this),this.getTransformation=this.getTransformation.bind(this),this.applyTransformation=this.applyTransformation.bind(this),this.resetTransformation=this.resetTransformation.bind(this),this.setLiveTransformation=this.setLiveTransformation.bind(this),this.updateSelected=this.updateSelected.bind(this),this.getSelected=this.getSelected.bind(this)},module$src$3d$interfaces$api$ViewportApiInterface.default),t.prototype.getRuntimeId=function(){return o.runtimeId},t.prototype.getContainer=function(){return o.container},t.prototype.getScreenshot=function(){return o.renderingHandler.getScreenshot()},t.prototype.render=function(){o.renderingHandler.render()},t.prototype.convertTo2D=function(e){return n.convertTo2D(r,e)},t.prototype.onResize=function(e,t){o.cameraHandler.onResize(e,t),o.renderingHandler.onResize(e,t)},t.prototype.getSize=function(){return o.renderingHandler.getSize()},t.prototype.pause=function(){o.pause()},t.prototype.resume=function(){o.resume()},t.prototype.reload=function(){return n.reload(r)},t.prototype.destroy=function(){return n.destroy(r)},t.prototype.addEventListener=function(e,t){return n.addEventListener(r,e,t)},t.prototype.removeEventListener=function(e){return n.removeEventListener(r,e)},t.prototype.getSettingDefinitions=function(){return n.getSettingDefinitions(r)},t.prototype.getSettings=function(e){return n.getSettings(r,e)},t.prototype.getSetting=function(e){return n.getSetting(r,e)},t.prototype.updateSettingAsync=function(e,t){return n.updateSettingAsync(r,e,t)},t.prototype.updateSettingsAsync=function(e){return n.updateSettingsAsync(r,e)},t.prototype.setTransformation=function(e){return n.setTransformation(r,e)},t.prototype.getTransformation=function(){return o.transformationMatrix.clone()},t.prototype.applyTransformation=function(e){return n.applyTransformation(r,e)},t.prototype.resetTransformation=function(){return n.getTransformation(r)},t.prototype.setLiveTransformation=function(e,t){return n.setLiveTransformation(r,e,t)},t.prototype.updateSelected=function(e,t){throw Error("This API function is not implemented by this viewport.")},t.prototype.getSelected=function(){throw Error("This API function is not implemented by this viewport.")},new t}},module$src$3d$viewports$expo$default$ThreeDManagerConstants={},threeDManagerConstants$$module$src$3d$viewports$expo$default$ThreeDManagerConstants,_convert$145=function(e,t){for(var n in e){if("value"===n)return _hasSubValue$146(e[n])?_convert$145(e[n],t):e[n];"setting"!==n&&"desc"!==n&&"type"!==n&&(t[n]={},t[n]=_convert$145(e[n],t[n]))}return t},_hasSubValue$146=function(e){if("object"==typeof e)for(var t in e)if("value"===t||_hasSubValue$146(e[t]))return!0;return!1},GLOBAL_UTILS$147=module$src$shared$util$GlobalUtils.default,LOGGING_CONSTANTS$148=module$src$shared$constants$LoggingConstants.default,LOGGING_LEVELS$149=module$src$shared$constants$LoggingConstants.default.loggingLevels,_settingsDefinition$150={show:{value:!1,setting:"show",desc:"Show / hide the scene",type:"boolean"},showTransition:{value:"1s"},gridVisibility:{value:!0,setting:"gridVisibility",desc:"Show / hide the grid",type:"boolean"},groundPlaneVisibility:{value:!0,setting:"groundPlaneVisibility",desc:"Show / hide the ground plane",type:"boolean"},render:{clearColor:{value:"#ffffff",setting:"render.clearColor",desc:"Set background color",type:function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color")}},clearAlpha:{value:1,setting:"render.clearAlpha",desc:"Set background alpha value",type:function(e){return"number"==typeof e&&0<=e&&1>=e}},devicePixelRatio:{value:1},shadows:{value:!0,setting:"render.shadows",desc:"Enable / disable shadows for rendering",type:"boolean"}},camera:{autoRotationSpeed:{value:0,setting:"camera.autoRotationSpeed",desc:"Speed of autoration, can be negative, also refer to enableAutoRotation",type:"number"},cameraMovementDuration:{value:0,setting:"camera.cameraMovementDuration",desc:"Default duration of camera movements",type:"notnegative"},damping:{value:.1,setting:"camera.damping",desc:"How much to damp camera movements by the user",type:"notnegative"},defaults:{perspective:{value:{position:{value:{x:5,y:5,z:5},setting:"camera.defaults.perspective.position",desc:"Default position for the perspective camera",type:"vector3any",transform:function(e){return module$src$shared$util$GlobalUtils.default.toVector3(e)}},target:{value:{x:0,y:0,z:0},setting:"camera.defaults.perspective.target",desc:"Default target for the perspective camera",type:"vector3any",transform:function(e){return module$src$shared$util$GlobalUtils.default.toVector3(e)}}},setting:"camera.defaults.perspective",desc:"Default position and target for the perspective camera",type:function(e){return e&&module$src$shared$util$GlobalUtils.default.typeCheck(e.position,"vector3obj")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.target,"vector3obj")}}},enableAutoRotation:{value:!1,setting:"camera.enableAutoRotation",desc:"Enable / disable automatic rotation of the camera, also refer to autoRotationSpeed",type:"boolean"},enableKeyPan:{value:!1,setting:"camera.enableKeyPan",desc:"Enable / disable panning using the keyboard, also refer to enablePan",type:"boolean"},enableOrbitControls:{value:!0,setting:"camera.enableOrbitControls",desc:"Enable / disable orbit controls",type:"boolean"},enablePan:{value:!0,setting:"camera.enablePan",desc:"Enable / disable panning in general, also refer to enableKeyPan",type:"boolean"},enableRotation:{value:!0,setting:"camera.enableRotation",desc:"Enable / disable camera rotation",type:"boolean"},enableZoom:{value:!0,setting:"camera.enableZoom",desc:"Enable / disable zooming",type:"boolean"},far:{value:100},fov:{value:45,setting:"camera.fov",desc:"Camera frustum vertical field of view angle, unit degree, interval [0,180]",type:function(e){return"number"==typeof e&&0<e&&180>e}},keyPanSpeed:{value:1,setting:"camera.keyPanSpeed",desc:"Speed of panning when using the keyboard",type:"number"},near:{value:.01},restrictions:{position:{cube:{value:{min:{value:{x:-1/0,y:-1/0,z:-1/0},setting:"camera.restrictions.position.cube.min",desc:"Restriction of the camera position inside a cube, minimum corner of the cube",type:"vector3any"},max:{value:{x:1/0,y:1/0,z:1/0},setting:"camera.restrictions.position.cube.max",desc:"Restriction of the camera position inside a cube, maximum corner of the cube",type:"vector3any"}},setting:"camera.restrictions.position.cube",desc:"Restriction of the camera position inside a cube, minimum and maximum corner of the cube"},sphere:{value:{center:{value:{x:0,y:0,z:0},setting:"camera.restrictions.position.sphere.center",desc:"Restriction of the camera position inside a sphere, center of the sphere",type:"vector3any"},radius:{value:1/0,setting:"camera.restrictions.position.sphere.radius",desc:"Restriction of the camera position inside a sphere, radius of the sphere",type:"notnegative"}},setting:"camera.restrictions.position.sphere",desc:"Restriction of the camera position inside a sphere, center and radius of the sphere"}},target:{cube:{value:{min:{value:{x:-1/0,y:-1/0,z:-1/0},setting:"camera.restrictions.target.cube.min",desc:"Restriction of the camera target inside a cube, minimum corner of the cube",type:"vector3any"},max:{value:{x:1/0,y:1/0,z:1/0},setting:"camera.restrictions.target.cube.max",desc:"Restriction of the camera target inside a cube, maximum corner of the cube",type:"vector3any"}},setting:"camera.restrictions.target.cube",desc:"Restriction of the camera target inside a cube, minimum and maximum corner of the cube"},sphere:{value:{center:{value:{x:0,y:0,z:0},setting:"camera.restrictions.target.sphere.center",desc:"Restriction of the camera target inside a sphere, center of the sphere",type:"vector3any"},radius:{value:1/0,setting:"camera.restrictions.target.sphere.radius",desc:"Restriction of the camera target inside a sphere, radius of the sphere",type:"notnegative"}},setting:"camera.restrictions.target.sphere",desc:"Restriction of the camera target inside a sphere, center and radius of the sphere"}},rotation:{value:{minPolarAngle:{value:0,setting:"camera.restrictions.rotation.minPolarAngle",desc:"Minimum polar angle of the camera position with respect to the camera target, unit degree, interval [0,180]",type:function(e){return"number"==typeof e&&0<=e&&180>=e}},maxPolarAngle:{value:180,setting:"camera.restrictions.rotation.maxPolarAngle",desc:"Maximum polar angle of the camera position with respect to the camera target, unit degree, interval [0,180]",type:function(e){return"number"==typeof e&&0<=e&&180>=e}},minAzimuthAngle:{value:-1/0,setting:"camera.restrictions.rotation.minAzimuthAngle",desc:"Minimum azimuth angle of the camera position with respect to the camera target, unit degree, interval [-180,180]",type:"number"},maxAzimuthAngle:{value:1/0,setting:"camera.restrictions.rotation.maxAzimuthAngle",desc:"Maximum azimuth angle of the camera position with respect to the camera target, unit degree, interval [-180,180]",type:"number"}},setting:"camera.restrictions.rotation",desc:"Minimum and maximum polar and azimuth angle of the camera position with respect to the camera target, unit degree",type:function(e){return e&&Object.keys(e).every((function(t){return"number"==typeof e[t]}))}},zoom:{value:{minDistance:{value:0,setting:"camera.restrictions.zoom.minDistance",desc:"Minimum distance between camera position and target",type:"notnegative"},maxDistance:{value:1/0,setting:"camera.restrictions.zoom.maxDistance",desc:"Maximum distance between camera position and target",type:"notnegative"}},setting:"camera.restrictions.zoom",desc:"Minimum and maximum distance between camera position and target",type:function(e){return e&&module$src$shared$util$GlobalUtils.default.typeCheck(e.minDistance,"notnegative")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.maxDistance,"notnegative")}}},rotationSpeed:{value:.25,setting:"camera.rotationSpeed",desc:"Speed of camera rotation",type:"number"},panSpeed:{value:.5,setting:"camera.panSpeed",desc:"Speed of panning",type:"number"},zoomExtentsFactor:{value:1,setting:"camera.zoomExtentsFactor",desc:"Factor to apply to the bounding box before zooming to extents",type:"number"},zoomSpeed:{value:1,setting:"camera.zoomSpeed",desc:"Speed of zooming",type:"notnegative"}},material:{environmentMapAsBackground:{value:!1,setting:"material.environmentMapAsBackground",desc:"Show / hide the environment map in the background",type:"boolean"},environmentMap:{value:"default",setting:"material.environmentMap",desc:"Name of the environment map to use, or an array of 6 URLs making up the cube mapped environment map (px, nx, pz, nz, py, ny)",type:function(e){return"string"==typeof e||module$src$shared$util$GlobalUtils.default.isArrayOfType(e,"string")&&6===e.length}}}},_defaultSettings$151={};_convert$145(_settingsDefinition$150,_defaultSettings$151),threeDManagerConstants$$module$src$3d$viewports$expo$default$ThreeDManagerConstants={settingsDefinition:_settingsDefinition$150,defaultSettings:_defaultSettings$151,loggingLevels:LOGGING_LEVELS$149},module$src$3d$viewports$expo$default$ThreeDManagerConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(threeDManagerConstants$$module$src$3d$viewports$expo$default$ThreeDManagerConstants);var module$src$3d$viewports$expo$default$handlers$RenderingHandler={default:function(e,t){var n,r,o=e.externalLibraries.ExpoTHREE,a=e.settings,i=e.scene,s=e.container,l=s.width,u=s.height,c=!0,d=!0,p=null,h=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"RenderingHandler.Hook->shadows")&&(t.lightHandler.setToggleLightShadows(e),!0)},m=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color",t.threeDManager.warn,"RenderingHandler.Hook->clearColor")&&(e=(0,module$src$shared$util$toTinyColor.default)(e),null!==p?n.setClearColor(e.toThreeColor(),p):n.setClearColor(e.toThreeColor()),!0)},f=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"RenderingHandler.Hook->clearAlpha")&&(p=e,n.setClearAlpha(e),!0)};return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.call(this),n=new o.Renderer({gl:s.gl,pixelRatio:s.pixelRatio,width:s.width,height:s.height}),i.background=null,n.setSize(l,u),n.setPixelRatio(window.devicePixelRatio),n.setClearColor((0,module$src$shared$util$toTinyColor.default)(a.getSetting("clearColor"),"white").toThreeColor(),a.getSetting("clearAlpha")),n.gammaInput=!0,n.gammaOutput=!0,n.shadowMap.enabled=!0,n.shadowMap.autoUpdate=!1,n.shadowMap.needsUpdate=!0,n.physicallyCorrectLights=!0,n.toneMapping=module$src$externals$three.default.ReinhardToneMapping,n.setClearColor(new module$src$externals$three.default.Color(16711935)),(r=new module$src$externals$three.default.WebGLRenderTarget(l,u,{minFilter:module$src$externals$three.default.LinearFilter,magFilter:module$src$externals$three.default.LinearFilter,format:module$src$externals$three.default.RGBAFormat,stencilBuffer:!1})).texture.name="hidden.rt",a.registerHook("shadows",h),a.registerHook("clearColor",m),a.registerHook("clearAlpha",f)},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default),e.prototype.render=function(e){c&&"expoRenderCall"===e&&t.threeDManager&&!1!==t.threeDManager.getSettingShallow("show")&&t.cameraHandler&&t.cameraHandler.getCamera()&&(1==d&&(d=!1,n.shadowMap.needsUpdate=!0),t.cameraHandler.updateOrbitControls(),t.threeDManager.helpers.toggleViewport(!0),n.render(i,t.cameraHandler.getCamera()),t.threeDManager.helpers.toggleViewport(!1))},e.prototype.renderHidden=function(){t.threeDManager&&t.cameraHandler&&t.cameraHandler.getCamera()&&(1==d&&(d=!1,n.shadowMap.needsUpdate=!0),t.cameraHandler.updateOrbitControls(),t.threeDManager.helpers.toggleViewport(!0),n.render(i,t.cameraHandler.getCamera(),r),t.threeDManager.helpers.toggleViewport(!1))},e.prototype.onResize=function(e,t,r){n.setPixelRatio(r),n.setSize(e,t)},e.prototype.getSize=function(){return{width:l,height:u}},e.prototype.pause=function(){c=!1},e.prototype.resume=function(){c=!0},e.prototype.destroy=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getScreenshot=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getDomElement=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getCanvas=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getRendererInfo=function(){return n.info},e.prototype.setBlur=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.registerForContinuousRendering=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.unregisterForContinuousRendering=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.containsContinuousRendering=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.updateShadowMap=function(){d=!0},e.prototype.keepUpdatingShadowMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.stopUpdatingShadowMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},new e}},module$src$3d$viewports$expo$default$handlers$MaterialHandler={default:function(e,t){var n,r,o,a=e.externalLibraries.ExpoTHREE,i="default default_bw blurred_lights georgentor georgentor_blur georgentor_blue_blur georgentor_bw_blur levelsets lythwood_field mountains ocean piazza_san_marco residential_garden room_abstract_1 sky storage_room storm subway_entrance subway_entrance_bw_blur white yokohama".split(" "),s=[],l="px nx pz nz py ny".split(" "),u=e.settings,c=null,d=[],p=new module$src$externals$three.default.MeshStandardMaterial,h=function(e){if(void 0===e)return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","No input was provided, the environment map was not set."),Promise.resolve(!1);if(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&e.startsWith('["https')&&e.endsWith('"]')){var r=e;try{e=JSON.parse(r)}catch(c){e=r}}if(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string"))var o=e.toLowerCase().replace(/ /g,"_");else if(Array.isArray(e)){var a=e;if(6!==a.length)return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","The number of URLs was not 6, the environment map was not set."),Promise.resolve(!1);o=JSON.stringify(a,null,0)}for(var u=(r=$jscomp.makeIterator(d)).next();!u.done;u=r.next())if((u=u.value).name===o)return n._assignEnvironmentMap(u),Promise.resolve(!0);if(void 0===a)if(a=[],0<=i.indexOf(o))for(r=0;r<l.length;r++)a.push("https://viewer.shapediver.com/v2/envmaps/"+o+"/"+l[r]+".jpg");else if(0<=s.indexOf(o))for(r=0;r<l.length;r++)a.push("https://viewer.shapediver.com/v2/envmaps/"+o+"/"+l[r]+".png");else{if(!e.startsWith("https://")&&!e.startsWith("http://"))return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","Environment map name not found, and not a base URL"),Promise.resolve(!1);for(e.endsWith("/")||(e+="/"),r=0;r<l.length;r++)a.push(e+l[r]+".jpg")}return n._loadEnvironmentMap(o,a).then((function(e){return d.push(e),n._assignEnvironmentMap(e),!0}),(function(){return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","Was not able to load the environment map, the environment map was not set."),!1}))},m=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"MaterialHandler.Hook->environmentMapAsBackground")&&(t.threeDManager.getSetting("groundPlaneReflectionVisibility")&&e?(t.threeDManager.warn("MaterialHandler.Hook->environmentMapAsBackground","The ground plane reflection and the environment as background do not work together right now."),!1):(o=e?c:null,!0))};return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.call(this),n=this,r=new module$src$3d$helpers$handlers$MaterialHandlerHelpers.default(t,{nameStandard:"MeshStandardMaterial",nameSimple:"MeshPhongMaterial"}),u.registerHook("environmentMap",h),u.updateSettingAsync("environmentMap",u.getSetting("environmentMap")),u.registerHook("environmentMapAsBackground",m)},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default),e.prototype._loadEnvironmentMap=function(e,t){var n={px:t[0],nx:t[1],pz:t[2],nz:t[3],py:t[4],ny:t[5]};t=[];var r,o={};for(r in n)o.x=r,o.opt={fileName:"envMap"+o.x+".jpg"},t.push(new Promise(function(e){return function(t,r){module$src$externals$expo_asset_utils.default.resolveAsync(n[e.x],e.opt).then((function(r){n[e.x]=r.localUri,t(r)}),(function(e){r(e)}))}}(o))),o={x:o.x,opt:o.opt};return Promise.all(t).then((function(){return a.loadCubeTextureAsync({assetForDirection:n,directions:"px nx pz nz py ny".split(" ")}).then((function(t){return{name:e,map:t}}))}))},e.prototype._assignEnvironmentMap=function(e){c=e.map,u.getSetting("environmentMapAsBackground")&&(o=c);for(var n=0,r=(e=t.threeDManager.helpers.getMaterials()).length;n<r;n++){var a=e[n];"MeshStandardMaterial"==a.type&&a.envMap&&(a.envMap=c)}},e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.destroy=function(){},e.prototype.getMaterial=function(e){var t={};for(var n in e=Object.assign({envMap:c},e))p.hasOwnProperty(n)&&(t[n]=e[n]);return new module$src$externals$three.default.MeshStandardMaterial(t)},e.prototype.getSimpleMaterial=function(e){return new module$src$externals$three.default.MeshPhongMaterial(e)},e.prototype.compile=function(){t.renderingHandler.renderHidden(),r.checkMaterials()},e.prototype.adjustToBoundingSphere=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getEnvironmentMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.setSceneBackground=function(e){o=e},e.prototype.getSceneBackground=function(){return o},new e}},module$src$3d$viewports$expo$default$helpers$OrbitControlsProxyExpoImplementation={default:function(e){var t;return $jscomp.inherits(e=function(){module$src$3d$interfaces$OrbitControlsProxyInterface.default.call(this),t=this,this.height=this.width=0},module$src$3d$interfaces$OrbitControlsProxyInterface.default),e.prototype.setClientSize=function(e,n){t.width=e,t.height=n},e.prototype.getClientSize=function(){return{width:t.width,height:t.height}},e.prototype.onStateChange=function(){},e.prototype.onStateChangeNone=function(){},e.prototype.dispose=function(){},e.prototype.initialize=function(){},e.prototype.onTouchesBegan=function(e){t.onTouchStart(e)},e.prototype.onTouchesMoved=function(e){t.onTouchMove(e)},e.prototype.onTouchesEnded=function(e){t.onTouchEnd(e)},new e}},module$src$3d$viewports$expo$default$handlers$CameraHandler={default:function(e,t){var n,r,o,a,i=e.settings,s=e.container,l=e.geometryNode,u=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->fov")&&(10<r.fov&&10>e?(r.near=100*r.near*e,r.far=100*r.far*e):10>r.fov&&10<e&&(r.near/=100*r.fov,r.far/=100*r.fov),r.fov=e,r.updateProjectionMatrix(),!0)},c=function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e.position,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.perspective")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.target,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.perspective")?r instanceof module$src$externals$three.default.PerspectiveCamera?n.setPositionAndTarget(e.position,e.target,{duration:i.getSetting("cameraMovementDuration")}):Promise.resolve(!0):Promise.resolve(!1)},d=function(e){return e.perspective&&module$src$shared$util$GlobalUtils.default.typeCheck(e.perspective.position,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.perspective.target,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults")?Promise.resolve(!0):Promise.resolve(!1)},p=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableOrbitControls")&&(o.enabled=e,!0)},h=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->damping")&&(e=Math.min(Math.max(.05,e),.25),o.dampingFactor=e,o.panDampingFactor=e,o.zoomDampingFactor=e,o.rotateDampingFactor=e,!0)},m=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableRotation")&&(o.enableRotation=e,!0)},f=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"float",t.threeDManager.warn,"CameraHandler.Hook->rotationSpeed")&&(o.rotationSpeed=e,!0)},g=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableAutoRotation")&&(o.enableAutoRotation=e,!0)},$=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"float",t.threeDManager.warn,"CameraHandler.Hook->autoRotationSpeed")&&(o.autoRotationSpeed=e,i.updateSetting("enableAutoRotation",0!==e),!0)},v=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableZoom")&&(o.enableZoom=e,!0)},y=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->zoomSpeed")&&(o.zoomSpeed=e,!0)},_=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enablePan")&&(o.enablePan=e,!0)},b=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"number",t.threeDManager.warn,"CameraHandler.Hook->panSpeed")&&(o.panSpeed=e,!0)},x=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableKeyPan")&&(o.enableKeyPan=e,!0)},w=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"number",t.threeDManager.warn,"CameraHandler.Hook->keyPanSpeed")&&(o.keyPanSpeed=7*e,!0)},S=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.min,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.cube")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.max,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.cube")||(o.minPosition=module$src$shared$util$GlobalUtils.default.toVector3(e.min),o.maxPosition=module$src$shared$util$GlobalUtils.default.toVector3(e.max),0))},M=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.center,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.sphere")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.radius,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.sphere")||(o.positionSphereCenter=module$src$shared$util$GlobalUtils.default.toVector3(e.center),o.positionSphereRadius=e.radius,0))},E=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.min,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.cube")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.max,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.cube")||(o.minTarget=module$src$shared$util$GlobalUtils.default.toVector3(e.min),o.maxTarget=module$src$shared$util$GlobalUtils.default.toVector3(e.max),0))},T=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.center,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.sphere")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.radius,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.sphere")||(o.targetSphereCenter=module$src$shared$util$GlobalUtils.default.toVector3(e.center),o.targetSphereRadius=e.radius,0))},C=function(e){return!!(module$src$shared$util$GlobalUtils.default.typeCheck(e.minPolarAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.maxPolarAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.minAzimuthAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.maxAzimuthAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation"))&&(o.minPolarAngle=e.minPolarAngle*Math.PI/180,o.maxPolarAngle=e.maxPolarAngle*Math.PI/180,o.minAzimuthAngle=e.minAzimuthAngle*Math.PI/180,o.maxAzimuthAngle=e.maxAzimuthAngle*Math.PI/180,!0)},P=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.minDistance,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.zoom")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.maxDistance,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.zoom")||(o.minDistance=e.minDistance,o.maxDistance=e.maxDistance,0))},A=function(){n.zoomExtents()};return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$CameraHandlerInterface.default.call(this),n=this,r=new module$src$externals$three.default.PerspectiveCamera(45,s.width/s.height,.01,1e3);var e=i.getSetting("defaults.perspective.position");r.position.set(e.x,e.y,e.z),r.up.set(0,0,1),t.threeDManager.helpers.addSceneObject(r),a=new module$src$3d$viewports$expo$default$helpers$OrbitControlsProxyExpoImplementation.default(t),o=new module$src$externals$three.default.OrbitControls(r,a),a.initialize(),o.enableDamping=!0,o.dampingFactor=i.getSetting("damping"),o.panDampingFactor=i.getSetting("damping"),o.zoomDampingFactor=i.getSetting("damping"),o.rotateDampingFactor=i.getSetting("damping"),o.enableRotation=i.getSetting("enableRotation"),o.rotationSpeed=i.getSetting("rotationSpeed"),o.enableAutoRotation=i.getSetting("enableAutoRotation"),o.autoRotationSpeed=i.getSetting("autoRotationSpeed"),o.enableZoom=i.getSetting("enableZoom"),o.zoomSpeed=i.getSetting("zoomSpeed"),o.enablePan=i.getSetting("enablePan"),o.panSpeed=i.getSetting("panSpeed"),o.enableKeyPan=i.getSetting("enableKeyPan"),o.keyPanSpeed=7*i.getSetting("keyPanSpeed"),e=i.getSetting("defaults.perspective.target"),o.target.set(e.x,e.y,e.z),i.registerHook("fov",u),i.registerHook("defaults.perspective",c),i.registerHook("defaults",d),i.registerHook("enableOrbitControls",p),i.registerHook("damping",h),i.registerHook("enableRotation",m),i.registerHook("rotationSpeed",f),i.registerHook("enableAutoRotation",g),i.registerHook("autoRotationSpeed",$),i.registerHook("enableZoom",v),i.registerHook("zoomSpeed",y),i.registerHook("enablePan",_),i.registerHook("panSpeed",b),i.registerHook("enableKeyPan",x),i.registerHook("keyPanSpeed",w),i.registerHook("restrictions.position.cube",S),i.registerHook("restrictions.position.cube.min",(function(e){var t=i.getSetting("restrictions.position.cube");return t.min=e,S(t)})),i.registerHook("restrictions.position.cube.max",(function(e){var t=i.getSetting("restrictions.position.cube");return t.max=e,S(t)})),i.registerHook("restrictions.position.sphere",M),i.registerHook("restrictions.position.sphere.center",(function(e){var t=i.getSetting("restrictions.position.sphere");return t.center=e,M(t)})),i.registerHook("restrictions.position.sphere.radius",(function(e){var t=i.getSetting("restrictions.position.sphere");return t.radius=e,M(t)})),i.registerHook("restrictions.target.cube",E),i.registerHook("restrictions.target.cube.min",(function(e){var t=i.getSetting("restrictions.target.cube");return t.min=e,E(t)})),i.registerHook("restrictions.target.cube.max",(function(e){var t=i.getSetting("restrictions.target.cube");return t.max=e,E(t)})),i.registerHook("restrictions.target.sphere",T),i.registerHook("restrictions.target.sphere.center",(function(e){var t=i.getSetting("restrictions.target.sphere");return t.center=e,T(t)})),i.registerHook("restrictions.target.sphere.radius",(function(e){var t=i.getSetting("restrictions.target.sphere");return t.radius=e,T(t)})),i.registerHook("restrictions.rotation",C),i.registerHook("restrictions.rotation.minPolarAngle",(function(e){var t=i.getSetting("restrictions.rotation");return t.minPolarAngle=e,C(t)})),i.registerHook("restrictions.rotation.maxPolarAngle",(function(e){var t=i.getSetting("restrictions.rotation");return t.maxPolarAngle=e,C(t)})),i.registerHook("restrictions.rotation.minAzimuthAngle",(function(e){var t=i.getSetting("restrictions.rotation");return t.minAzimuthAngle=e,C(t)})),i.registerHook("restrictions.rotation.maxAzimuthAngle",(function(e){var t=i.getSetting("restrictions.rotation");return t.maxAzimuthAngle=e,C(t)})),i.registerHook("restrictions.zoom",P),i.registerHook("restrictions.zoom.minDistance",(function(e){var t=i.getSetting("restrictions.zoom");return t.minDistance=e,P(t)})),i.registerHook("restrictions.zoom.maxDistance",(function(e){var t=i.getSetting("restrictions.zoom");return t.maxDistance=e,P(t)})),i.registerNotifier("zoomExtentsFactor",A)},module$src$3d$interfaces$handlers$CameraHandlerInterface.default),e.prototype._onTouchesBegan=function(e){a.onTouchesBegan(e)},e.prototype._onTouchesMoved=function(e){a.onTouchesMoved(e)},e.prototype._onTouchesEnded=function(e){a.onTouchesEnded(e)},e.prototype.pause=function(){o.enabled=!1,o.resetState()},e.prototype.resume=function(){o.enabled=!0},e.prototype.destroy=function(){},e.prototype.setPosition=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.setPosition")&&(o.object.position.set(e.x,e.y,e.z),!0)},e.prototype.resetPosition=function(){return n.setPosition(i.getSetting("defaults.perspective.position"))},e.prototype.getPosition=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(o.object.position)},e.prototype.setTarget=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.setTarget")&&(o.target.set(e.x,e.y,e.z),!0)},e.prototype.resetTarget=function(){return n.setTarget(i.getSetting("defaults.perspective.target"))},e.prototype.getTarget=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(o.target)},e.prototype.setPositionAndTarget=function(e,n,r){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3any",t.threeDManager.warn,"CameraHandler.setPositionAndTarget")&&module$src$shared$util$GlobalUtils.default.typeCheck(n,"vector3any",t.threeDManager.warn,"CameraHandler.setPositionAndTarget")?(o.object.position.copy(module$src$shared$util$GlobalUtils.default.toVector3(e)),o.target.copy(module$src$shared$util$GlobalUtils.default.toVector3(n)),t.renderingHandler.renderHidden(),Promise.resolve(!0)):Promise.resolve(!1)},e.prototype.resetPositionAndTarget=function(e){return n.setPositionAndTarget(i.getSetting("defaults.perspective.position"),i.getSetting("defaults.perspective.target"),e)},e.prototype.getPositionAndTarget=function(){return{position:n.getPosition(),target:n.getTarget()}},e.prototype.zoomExtents=function(e,t){if(!(t&&t instanceof module$src$externals$three.default.Box3)&&0==(t=l.computeSceneBoundingBox()).min.distanceTo(t.max)){var r=Number.MIN_VALUE;t=new module$src$externals$three.default.Box3(new module$src$externals$three.default.Vector3(-r,-r,-r),new module$src$externals$three.default.Vector3(r,r,r))}if(r=new module$src$externals$three.default.Vector3,t.getCenter(r),i.hasSetting("zoomExtentsFactor")){var a=new module$src$externals$three.default.Vector3;a.subVectors(t.max,r),a.multiplyScalar(i.getSetting("zoomExtentsFactor")),t=new module$src$externals$three.default.Box3((new module$src$externals$three.default.Vector3).subVectors(r,a),(new module$src$externals$three.default.Vector3).addVectors(r,a))}(a=[]).push(t.min),a.push(t.max),a.push(new module$src$externals$three.default.Vector3(t.max.x,t.min.y,t.min.z)),a.push(new module$src$externals$three.default.Vector3(t.max.x,t.max.y,t.min.z)),a.push(new module$src$externals$three.default.Vector3(t.max.x,t.min.y,t.max.z)),a.push(new module$src$externals$three.default.Vector3(t.min.x,t.max.y,t.max.z)),a.push(new module$src$externals$three.default.Vector3(t.min.x,t.min.y,t.max.z)),a.push(new module$src$externals$three.default.Vector3(t.min.x,t.max.y,t.min.z));var s=0;t=new module$src$externals$three.default.Vector3,o.object.getWorldDirection(t),t.normalize();var u=new module$src$externals$three.default.Line3(r.clone().addScaledVector(t,-100),r.clone()),c=new module$src$externals$three.default.Vector3;c.crossVectors(t,o.object.up),c.normalize();var d=new module$src$externals$three.default.Vector3;d.crossVectors(c,t),d.normalize();for(var p=0,h=a.length;p<h;p++){var m=new module$src$externals$three.default.Vector3;u.closestPointToPoint(a[p],!1,m);var f=a[p].clone();f.sub(m);var g=f.dot(c);f=f.dot(d);var $=Math.tan(Math.PI/180*o.object.fov*.5);g=Math.max(Math.abs(g/(o.object.aspect*$)),Math.abs(f/$)),m=m.clone().sub(r).dot(t),s=Math.max(s,g-m)}return t.multiplyScalar(-1*s),(a=new module$src$externals$three.default.Vector3).addVectors(r,t),n.setPositionAndTarget(a,r,e)},e.prototype.setCameraPath=function(e,n,r){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getCamera=function(){return r},e.prototype.isCameraMoving=function(){return o.isMoving},e.prototype.updateOrbitControls=function(){o.update()},e.prototype.adjustToBoundingSphere=function(e){r.far=100*e.radius,r.near=.01*e.radius,r.updateProjectionMatrix()},e.prototype.onResize=function(e,t){a.setClientSize(e,t),r.aspect=e/t,r.setViewOffset(e,t,0,0,e,t),r.updateProjectionMatrix()},new e}},module$src$3d$viewports$expo$default$handlers$LightHandler={default:function(e,t){var n,r,o,a,i,s,l=new module$src$externals$three.default.Sphere;return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$LightHandlerInterface.default.call(this),n=new module$src$externals$three.default.Object3D,t.threeDManager.helpers.addViewportObject(n),r=new module$src$externals$three.default.AmbientLight(4210752),n.add(r),o=new module$src$externals$three.default.DirectionalLight(16777215,1),n.add(o),o.direction={x:.5774,y:-.5774,z:.5774},o.castShadow=!0,o.shadow.mapSize.width=1024,o.shadow.mapSize.height=1024,o.shadow.camera.near=.1,o.shadow.camera.far=8*l.radius,o.shadow.camera.right=1.5*l.radius,o.shadow.camera.left=-1.5*l.radius,o.shadow.camera.top=1.5*l.radius,o.shadow.camera.bottom=-1.5*l.radius,o.shadow.radius=2,o.shadow.bias=-175e-6,o.shadow.camera.updateProjectionMatrix(),a=new module$src$externals$three.default.Object3D,n.add(a),o.target=a,o.position.set(l.center.x+2.35*l.radius*o.direction.x,l.center.y+2.35*l.radius*o.direction.y,l.center.z+2.35*l.radius*o.direction.z),o.target.position.set(l.center.x,l.center.y,l.center.x),i=new module$src$externals$three.default.DirectionalLight(16777215,1),n.add(i),i.direction={x:.5774,y:.5774,z:.5774},s=new module$src$externals$three.default.Object3D,n.add(s),i.target=s,i.position.set(l.center.x+2.35*l.radius*i.direction.x,l.center.y+2.35*l.radius*i.direction.y,l.center.z+2.35*l.radius*i.direction.z),i.target.position.set(l.center.x,l.center.y,l.center.x)},module$src$3d$interfaces$handlers$LightHandlerInterface.default),e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.destroy=function(){},e.prototype.adjustToBoundingSphere=function(e){l=e.clone(),n&&(o.position.set(l.center.x+2.35*l.radius*o.direction.x,l.center.y+2.35*l.radius*o.direction.y,l.center.z+2.35*l.radius*o.direction.z),o.target.position.set(l.center.x,l.center.y,l.center.x),o.shadow.camera.far=8*e.radius,o.shadow.camera.right=1.5*e.radius,o.shadow.camera.left=-1.5*e.radius,o.shadow.camera.top=1.5*e.radius,o.shadow.camera.bottom=-1.5*e.radius,o.shadow.camera.updateProjectionMatrix(),i.position.set(l.center.x+2.35*l.radius*i.direction.x,l.center.y+2.35*l.radius*i.direction.y,l.center.z+2.35*l.radius*i.direction.z),i.target.position.set(l.center.x,l.center.y,l.center.x))},e.prototype.setToggleLightShadows=function(e){o.castShadow=e},e.prototype.toggleLights=function(e){o.visible=e,i.visible=e},new e}},module$src$3d$viewports$expo$default$ThreeDManager={default:function(e,t){var n,r,o,a,i=t.pathUtils,s=t.ExpoTHREE,l=t.settings,u=t.scene,c=t.geometryNode,d=t.container,p={},h=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->groundPlaneVisibility")&&(o&&(o.visible=e),!0)},m=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->gridVisibility")&&(a&&(a.visible=e),!0)},f=function(e,t){module$src$3d$interfaces$ThreeDManagerInterface.default.call(this,t,module$src$shared$util$GlobalUtils.default),(n=this).constants=module$src$3d$viewports$expo$default$ThreeDManagerConstants.default,p.threeDManager=n,n.viewerApi=e,r=new module$src$3d$helpers$ThreeDManagerHelpers.default({scene:u,geometryNode:c,pathUtils:i},p),p.threeDManager.helpers=r,module$src$shared$mixins$SettingsMixin.default.call(n,l,module$src$3d$viewports$expo$default$ThreeDManagerConstants.default.defaultSettings,t.runtimeId),this.renderingHandler=new module$src$3d$viewports$expo$default$handlers$RenderingHandler.default({settings:n.getSection("render"),scene:u,container:d,externalLibraries:{ExpoTHREE:s}},p),p.renderingHandler=this.renderingHandler,!1!==n.success&&(this.materialHandler=new module$src$3d$viewports$expo$default$handlers$MaterialHandler.default({settings:n.getSection("material"),externalLibraries:{ExpoTHREE:s}},p),p.materialHandler=this.materialHandler,!1!==n.success&&(this.cameraHandler=new module$src$3d$viewports$expo$default$handlers$CameraHandler.default({settings:n.getSection("camera"),container:d,geometryNode:c,externalLibraries:{ExpoTHREE:s}},p),p.cameraHandler=this.cameraHandler,!1!==n.success&&(this.lightHandler=new module$src$3d$viewports$expo$default$handlers$LightHandler.default({externalLibraries:{ExpoTHREE:s}},p),p.lightHandler=this.lightHandler,!1!==n.success&&(this.registerHook("groundPlaneVisibility",h),this.registerHook("gridVisibility",m)))))};return $jscomp.inherits(f,module$src$3d$interfaces$ThreeDManagerInterface.default),f.prototype.init=function(e){var t=e.min.distanceTo(e.max);if(1<t){var i=parseInt(t);i=(i=i.toString()).length,i=Math.pow(10,i-1),i=(t=Math.max(Math.ceil(t/i)*i,1))/(i/10)}else{i=1-Math.floor(Math.log(t)/Math.log(10))-2,t=t.toFixed(i+1);var s=parseInt(t.substr(t.length-1))+1;t="0.";for(var l=0;l<i;++l)t+="0";t=parseFloat(t+s),i=10*s}(a=new module$src$externals$three.default.GridHelper(2*t,i)).material.opacity=.15,a.material.transparent=!0,a.isSelectable=!1,a.rotateX(Math.PI/2),a.visible=n.getSetting("gridVisibility"),a.position.set(0,0,e.min.z-.005),r.addViewportObject(a),t=new module$src$externals$three.default.PlaneGeometry(2*t,2*t,2,2),(o=new module$src$externals$three.default.Mesh(t,p.materialHandler.getMaterial({color:13882323,side:module$src$externals$three.default.FrontSide,roughness:1,metalness:0}))).receiveShadow=!0,o.visible=n.getSetting("groundPlaneVisibility"),o.position.set(0,0,e.min.z-.005),r.addViewportObject(o),r.initialize(),n.adjustScene(),p.renderingHandler.render()},f.prototype.adjustScene=function(){if(r.isInitialized()){var e=c.computeSceneBoundingBox(),t=new module$src$externals$three.default.Sphere;e.getBoundingSphere(t),a.position.set(0,0,e.min.z-.005),o.position.set(0,0,e.min.z-.005),p.lightHandler.adjustToBoundingSphere(t),p.cameraHandler.adjustToBoundingSphere(t),p.renderingHandler.updateShadowMap(),p.materialHandler.compile()}},f.prototype.computeBoundingBox=function(e){return c.computeBoundingBox(e)},f.prototype.pause=function(){p.renderingHandler.pause(),p.cameraHandler.pause(),p.lightHandler.pause(),p.materialHandler.pause()},f.prototype.resume=function(){p.renderingHandler.resume(),p.cameraHandler.resume(),p.lightHandler.resume(),p.materialHandler.resume()},f.prototype.destroy=function(){for(var e in r.destroyViewport(),p.renderingHandler&&p.renderingHandler.destroy(),p.cameraHandler&&p.cameraHandler.destroy(),p.lightHandler&&p.lightHandler.destroy(),p.materialHandler&&p.materialHandler.destroy(),n.deregisterAllHooks(),n.deregisterAllNotifiers(),p)delete p[e];for(var t in n)n[t]=void 0},f.prototype.addMesh=function(e,t,n){r.addMesh(e,t,n)},f.prototype.removeMesh=function(e){r.removeMesh(e)},f.prototype.addAnchor=function(e,t){n.debug("This method is not implemented in this viewport.")},f.prototype.removeAnchor=function(e){n.debug("This method is not implemented in this viewport.")},f.prototype.fadeIn=function(e,t){n.debug("This method is not implemented in this viewport.")},f.prototype.fadeOut=function(e,t){n.debug("This method is not implemented in this viewport.")},f.prototype.setLiveTransformation=function(e,t,r,o,a){n.debug("This method is not implemented in this viewport.")},f.prototype.updateInteractions=function(e,t){n.debug("This method is not implemented in this viewport.")},f.prototype.removeFromInteractions=function(e){n.debug("This method is not implemented in this viewport.")},new f(e,t)}},module$src$3d$viewports$expo$default$api$CameraApi={default:function(e,t){var n=t.threeDManager,r=t.apiResponse;return $jscomp.inherits(e=function(){module$src$3d$interfaces$api$CameraApiInterface.default.call(this),this.get=this.get.bind(this),this.updateAsync=this.updateAsync.bind(this),this.animateAsync=this.animateAsync.bind(this),this.zoomAsync=this.zoomAsync.bind(this),this.resetAsync=this.resetAsync.bind(this)},module$src$3d$interfaces$api$CameraApiInterface.default),e.prototype.get=function(){return r(null,n.cameraHandler.getPositionAndTarget())},e.prototype.updateAsync=function(e,t){return n.cameraHandler.setPositionAndTarget(e.position,e.target,t).then((function(e){return r(e?null:"Setting new camera target and position failed",n.cameraHandler.getPositionAndTarget())}))},e.prototype.animateAsync=function(e,t){if(!Array.isArray(e))return Promise.resolve(r("First parameter must be an array of CameraDefinitions"));var o=[],a=[];return e.forEach((function(e){o.push(e.position),a.push(e.target)})),n.cameraHandler.setCameraPath(o,a,t).then((function(e){return r(e?null:"Camera path animation failed",n.cameraHandler.getPositionAndTarget())}))},e.prototype.zoomAsync=function(e,t){return n.cameraHandler.zoomExtents(t,n.computeBoundingBox(e)).then((function(e){return r(e?null:"Zooming to extents failed",n.cameraHandler.getPositionAndTarget())}))},e.prototype.resetAsync=function(e){return n.cameraHandler.resetPositionAndTarget(e).then((function(e){return r(e?null:"Resetting camera position or target failed",n.cameraHandler.getPositionAndTarget())}))},new e}},module$src$3d$viewports$expo$default$api$LightApi={default:function(e,t){return $jscomp.inherits(e=function(){module$src$3d$interfaces$api$LightApiInterface.default.call(this)},module$src$3d$interfaces$api$LightApiInterface.default),new e}},module$src$3d$viewports$expo$default$api$ViewportApi={default:function(e,t){var n,r,o=t.threeDManager,a=t.viewportManager,i={};return $jscomp.inherits(t=function(){module$src$3d$interfaces$api$ViewportApiInterface.default.call(this),this.utils=e.utils,this.EVENTTYPE=e.viewports.EVENTTYPE,this.camera=new module$src$3d$viewports$expo$default$api$CameraApi.default(e,{threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse}),this.lights=new module$src$3d$viewports$expo$default$api$LightApi.default(e,{threeDManager:o,apiResponse:this.utils.APIResponse}),n=module$src$3d$helpers$api$ViewportApiHelpers.default.getInstance(),r={THREE_D_MANAGER_CONSTANTS:module$src$3d$viewports$expo$default$ThreeDManagerConstants.default,EVENTTYPE:this.EVENTTYPE,threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse,listeners:i},this.onTouchesBegan=this.onTouchesBegan.bind(this),this.onTouchesMoved=this.onTouchesMoved.bind(this),this.onTouchesEnded=this.onTouchesEnded.bind(this),this.getRuntimeId=this.getRuntimeId.bind(this),this.getContainer=this.getContainer.bind(this),this.getScreenshot=this.getScreenshot.bind(this),this.render=this.render.bind(this),this.convertTo2D=this.convertTo2D.bind(this),this.onResize=this.onResize.bind(this),this.getSize=this.getSize.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.reload=this.reload.bind(this),this.destroy=this.destroy.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.getSettingDefinitions=this.getSettingDefinitions.bind(this),this.getSettings=this.getSettings.bind(this),this.getSetting=this.getSetting.bind(this),this.updateSettingAsync=this.updateSettingAsync.bind(this),this.updateSettingsAsync=this.updateSettingsAsync.bind(this),this.setTransformation=this.setTransformation.bind(this),this.getTransformation=this.getTransformation.bind(this),this.applyTransformation=this.applyTransformation.bind(this),this.resetTransformation=this.resetTransformation.bind(this),this.setLiveTransformation=this.setLiveTransformation.bind(this),this.updateSelected=this.updateSelected.bind(this),this.getSelected=this.getSelected.bind(this)},module$src$3d$interfaces$api$ViewportApiInterface.default),t.prototype.onTouchesBegan=function(e){o.cameraHandler._onTouchesBegan(e)},t.prototype.onTouchesMoved=function(e){o.cameraHandler._onTouchesMoved(e)},t.prototype.onTouchesEnded=function(e){o.cameraHandler._onTouchesEnded(e)},t.prototype.getRuntimeId=function(){return o.runtimeId},t.prototype.getContainer=function(){throw Error("This API function is not implemented by this viewport.")},t.prototype.getScreenshot=function(){return o.renderingHandler.getScreenshot()},t.prototype.render=function(e){o.renderingHandler.render(e)},t.prototype.convertTo2D=function(e){throw Error("This API function is not implemented by this viewport.")},t.prototype.onResize=function(e,t,n,r,a){o.cameraHandler.onResize(r,a),o.renderingHandler.onResize(r,a,n)},t.prototype.getSize=function(){return o.renderingHandler.getSize()},t.prototype.pause=function(){o.pause()},t.prototype.resume=function(){o.resume()},t.prototype.reload=function(){return n.reload(r)},t.prototype.destroy=function(){return n.destroy(r)},t.prototype.addEventListener=function(e,t){return n.addEventListener(r,e,t)},t.prototype.removeEventListener=function(e){return n.removeEventListener(r,e)},t.prototype.getSettingDefinitions=function(){return n.getSettingDefinitions(r)},t.prototype.getSettings=function(e){return n.getSettings(r,e)},t.prototype.getSetting=function(e){return n.getSetting(r,e)},t.prototype.updateSettingAsync=function(e,t){return n.updateSettingAsync(r,e,t)},t.prototype.updateSettingsAsync=function(e){return n.updateSettingsAsync(r,e)},t.prototype.setTransformation=function(e){return n.setTransformation(r,e)},t.prototype.getTransformation=function(){return n.getTransformation(r)},t.prototype.applyTransformation=function(e){return n.applyTransformation(r,e)},t.prototype.resetTransformation=function(){return n.resetTransformation(r)},t.prototype.setLiveTransformation=function(e,t){return n.setLiveTransformation(r,e,t)},t.prototype.updateSelected=function(e,t){throw Error("This API function is not implemented by this viewport.")},t.prototype.getSelected=function(){throw Error("This API function is not implemented by this viewport.")},new t}},module$src$3d$viewports$expo$ar$ThreeDManagerConstants={},threeDManagerConstants$$module$src$3d$viewports$expo$ar$ThreeDManagerConstants,_convert$154=function(e,t){for(var n in e){if("value"===n)return _hasSubValue$155(e[n])?_convert$154(e[n],t):e[n];"setting"!==n&&"desc"!==n&&"type"!==n&&(t[n]={},t[n]=_convert$154(e[n],t[n]))}return t},_hasSubValue$155=function(e){if("object"==typeof e)for(var t in e)if("value"===t||_hasSubValue$155(e[t]))return!0;return!1},GLOBAL_UTILS$156=module$src$shared$util$GlobalUtils.default,LOGGING_CONSTANTS$157=module$src$shared$constants$LoggingConstants.default,LOGGING_LEVELS$158=module$src$shared$constants$LoggingConstants.default.loggingLevels,_settingsDefinition$159={show:{value:!1,setting:"show",desc:"Show / hide the scene",type:"boolean"},showTransition:{value:"1s"},groundPlaneVisibility:{value:!1,setting:"groundPlaneVisibility",desc:"Show / hide the ground plane",type:"boolean"},render:{devicePixelRatio:{value:1},shadows:{value:!1,setting:"render.shadows",desc:"Enable / disable shadows for rendering",type:"boolean"}},camera:{far:{value:100},fov:{value:45},near:{value:.01}},material:{environmentMap:{value:"default",setting:"material.environmentMap",desc:"Name of the environment map to use, or an array of 6 URLs making up the cube mapped environment map (px, nx, pz, nz, py, ny)",type:function(e){return"string"==typeof e||module$src$shared$util$GlobalUtils.default.isArrayOfType(e,"string")&&6===e.length}}}},_defaultSettings$160={};_convert$154(_settingsDefinition$159,_defaultSettings$160),threeDManagerConstants$$module$src$3d$viewports$expo$ar$ThreeDManagerConstants={settingsDefinition:_settingsDefinition$159,defaultSettings:_defaultSettings$160,loggingLevels:LOGGING_LEVELS$158},module$src$3d$viewports$expo$ar$ThreeDManagerConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(threeDManagerConstants$$module$src$3d$viewports$expo$ar$ThreeDManagerConstants);var module$src$3d$viewports$expo$ar$handlers$RenderingHandler={default:function(e,t){var n,r,o=e.externalLibraries.ExpoTHREE,a=e.settings,i=e.scene,s=e.container,l=s.width,u=s.height,c=!0,d=!0,p=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"RenderingHandler.Hook->shadows")&&(t.lightHandler.setToggleLightShadows(e),!0)};return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.call(this),(n=new o.Renderer({gl:s.gl,pixelRatio:s.pixelRatio,width:s.width,height:s.height})).setSize(l,u),n.setPixelRatio(window.devicePixelRatio),n.gammaInput=!0,n.gammaOutput=!0,n.shadowMap.enabled=!0,n.shadowMap.autoUpdate=!1,n.shadowMap.needsUpdate=!0,n.physicallyCorrectLights=!0,n.toneMapping=module$src$externals$three.default.ReinhardToneMapping,(r=new module$src$externals$three.default.WebGLRenderTarget(l,u,{minFilter:module$src$externals$three.default.LinearFilter,magFilter:module$src$externals$three.default.LinearFilter,format:module$src$externals$three.default.RGBAFormat,stencilBuffer:!1})).texture.name="hidden.rt",a.registerHook("shadows",p)},module$src$3d$interfaces$handlers$RenderingHandlerInterface.default),e.prototype._getRenderer=function(){return n},e.prototype.render=function(e){c&&"expoRenderCall"===e&&t.threeDManager&&!1!==t.threeDManager.getSettingShallow("show")&&t.cameraHandler&&t.cameraHandler.getCamera()&&(1==d&&(d=!1,n.shadowMap.needsUpdate=!0),t.threeDManager.helpers.toggleViewport(!0),t.interactionHandler.update(),n.render(i,t.cameraHandler.getCamera()),t.threeDManager.helpers.toggleViewport(!1))},e.prototype.renderHidden=function(){t.threeDManager&&t.cameraHandler&&t.cameraHandler.getCamera()&&(1==d&&(d=!1,n.shadowMap.needsUpdate=!0),t.threeDManager.helpers.toggleViewport(!0),t.interactionHandler.isInitialized()||(t.threeDManager.helpers.toggleGeometry(!0),t.threeDManager.helpers.toggleViewportObjects(!0)),n.render(i,t.cameraHandler.getCamera(),r),t.interactionHandler.isInitialized()||(t.threeDManager.helpers.toggleGeometry(!1),t.threeDManager.helpers.toggleViewportObjects(!1)),t.threeDManager.helpers.toggleViewport(!1))},e.prototype.onResize=function(e,t,r){n.setPixelRatio(r),n.setSize(e,t)},e.prototype.getSize=function(){return n.getSize()},e.prototype.pause=function(){c=!1},e.prototype.resume=function(){c=!0},e.prototype.destroy=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getScreenshot=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getDomElement=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getCanvas=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getRendererInfo=function(){return n.info},e.prototype.setBlur=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.registerForContinuousRendering=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.unregisterForContinuousRendering=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.containsContinuousRendering=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.updateShadowMap=function(){d=!0},e.prototype.keepUpdatingShadowMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.stopUpdatingShadowMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},new e}},module$src$3d$viewports$expo$ar$handlers$MaterialHandler={default:function(e,t){var n,r,o=e.externalLibraries.ExpoTHREE,a="default default_bw blurred_lights georgentor georgentor_blur georgentor_blue_blur georgentor_bw_blur levelsets lythwood_field mountains ocean piazza_san_marco residential_garden room_abstract_1 sky storage_room storm subway_entrance subway_entrance_bw_blur white yokohama".split(" "),i=[],s="px nx pz nz py ny".split(" "),l=e.settings,u=null,c=null,d=[],p=new module$src$externals$three.default.MeshStandardMaterial,h=function(e){if(void 0===e)return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","No input was provided, the environment map was not set."),Promise.resolve(!1);if(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&e.startsWith('["https')&&e.endsWith('"]')){var r=e;try{e=JSON.parse(r)}catch(c){e=r}}if(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string"))var o=e.toLowerCase().replace(/ /g,"_");else if(Array.isArray(e)){var l=e;if(6!==l.length)return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","The number of URLs was not 6, the environment map was not set."),Promise.resolve(!1);o=JSON.stringify(l,null,0)}for(var u=(r=$jscomp.makeIterator(d)).next();!u.done;u=r.next())if((u=u.value).name===o)return n._assignEnvironmentMap(u),Promise.resolve(!0);if(void 0===l)if(l=[],0<=a.indexOf(o))for(r=0;r<s.length;r++)l.push("https://viewer.shapediver.com/v2/envmaps/"+o+"/"+s[r]+".jpg");else if(0<=i.indexOf(o))for(r=0;r<s.length;r++)l.push("https://viewer.shapediver.com/v2/envmaps/"+o+"/"+s[r]+".png");else{if(!e.startsWith("https://")&&!e.startsWith("http://"))return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","Environment map name not found, and not a base URL"),Promise.resolve(!1);for(e.endsWith("/")||(e+="/"),r=0;r<s.length;r++)l.push(e+s[r]+".jpg")}return n._loadEnvironmentMap(o,l).then((function(e){return d.push(e),n._assignEnvironmentMap(e),!0}),(function(){return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","Was not able to load the environment map, the environment map was not set."),!1}))};return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.call(this),n=this,r=new module$src$3d$helpers$handlers$MaterialHandlerHelpers.default(t,{nameStandard:"MeshStandardMaterial",nameSimple:"MeshPhongMaterial"}),l.registerHook("environmentMap",h),l.updateSettingAsync("environmentMap",l.getSetting("environmentMap")),u=new o.AR.BackgroundTexture(t.renderingHandler._getRenderer())},module$src$3d$interfaces$handlers$MaterialHandlerInterface.default),e.prototype._loadEnvironmentMap=function(e,t){var n={px:t[0],nx:t[1],pz:t[2],nz:t[3],py:t[4],ny:t[5]};t=[];var r,a={};for(r in n)a.x=r,a.opt={fileName:"envMap"+a.x+".jpg"},t.push(new Promise(function(e){return function(t,r){module$src$externals$expo_asset_utils.default.resolveAsync(n[e.x],e.opt).then((function(r){n[e.x]=r.localUri,t(r)}),(function(e){r(e)}))}}(a))),a={x:a.x,opt:a.opt};return Promise.all(t).then((function(){return o.loadCubeTextureAsync({assetForDirection:n,directions:"px nx pz nz py ny".split(" ")}).then((function(t){return{name:e,map:t}}))}))},e.prototype._assignEnvironmentMap=function(e){c=e.map;for(var n=0,r=(e=t.threeDManager.helpers.getMaterials()).length;n<r;n++){var o=e[n];"MeshStandardMaterial"==o.type&&o.envMap&&(o.envMap=c)}},e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.destroy=function(){},e.prototype.getMaterial=function(e){var t={};for(var n in e=Object.assign({envMap:c},e))p.hasOwnProperty(n)&&(t[n]=e[n]);return new module$src$externals$three.default.MeshStandardMaterial(t)},e.prototype.getSimpleMaterial=function(e){return new module$src$externals$three.default.MeshPhongMaterial(e)},e.prototype.compile=function(){t.renderingHandler.renderHidden(),r.checkMaterials()},e.prototype.adjustToBoundingSphere=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getEnvironmentMap=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.setSceneBackground=function(e){u=e},e.prototype.getSceneBackground=function(){return u},new e}},module$src$3d$viewports$expo$ar$handlers$CameraHandler={default:function(e,t){var n,r,o=e.externalLibraries.ExpoTHREE,a=e.container;return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$CameraHandlerInterface.default.call(this),n=this,r=new o.AR.Camera(a.width,a.height,.01,1e3),t.threeDManager.helpers.addSceneObject(r)},module$src$3d$interfaces$handlers$CameraHandlerInterface.default),e.prototype.pause=function(){(void 0).resetState()},e.prototype.resume=function(){},e.prototype.destroy=function(){},e.prototype.setPosition=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.resetPosition=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getPosition=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(r.position)},e.prototype.setTarget=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.resetTarget=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getTarget=function(){return module$src$shared$util$GlobalUtils.default.deepCopy((void 0).target)},e.prototype.setPositionAndTarget=function(e,n,r){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.resetPositionAndTarget=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getPositionAndTarget=function(){return{position:n.getPosition(),target:n.getTarget()}},e.prototype.zoomExtents=function(e,n){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.setCameraPath=function(e,n,r){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.getCamera=function(){return r},e.prototype.isCameraMoving=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.updateOrbitControls=function(){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.adjustToBoundingSphere=function(e){t.threeDManager.debug("This method is not implemented in this viewport.")},e.prototype.onResize=function(e,t){r.aspect=e/t,r.setViewOffset(e,t,0,0,e,t),r.updateProjectionMatrix()},new e}},module$src$3d$viewports$expo$ar$handlers$InteractionHandler={default:function(e,t){var n,r,o,a,i=e.externalLibraries.ExpoTHREE,s=e.externalLibraries.AR,l=0,u=null,c=!1,d=new module$src$externals$three.default.Matrix4,p=new module$src$externals$three.default.Matrix4,h=new module$src$externals$three.default.Matrix4;return(e=function(){n=this,o=new i.AR.Planes,t.threeDManager.helpers.addSceneObject(o),a=new i.AR.Points,t.threeDManager.helpers.addSceneObject(a),d.makeRotationX(Math.PI/180*-90),t.threeDManager.helpers.toggleGeometry(!1),t.threeDManager.helpers.toggleViewportObjects(!1)}).prototype._updateViewportMatrix=function(){if(c){var e=new module$src$externals$three.default.Matrix4;e.multiply(p),e.multiply(h),e.multiply(d),t.threeDManager.api.resetTransformation(),t.threeDManager.api.applyTransformation(e),t.renderingHandler.updateShadowMap()}},e.prototype.update=function(){c||(o.update(),a.update())},e.prototype.isInitialized=function(){return c},e.prototype.onTouchesBegan=function(e){var i=t.renderingHandler.getSize();if(1==e.touches.length)for(u=null,e=s.performHitTest({x:e.locationX/i.width,y:e.locationY/i.height},s.HitTestResultTypes.HorizontalPlane).hitTest,i=(e=$jscomp.makeIterator(e)).next();!i.done&&(r=i=i.value,!c);i=e.next())p.fromArray(i.worldTransform),c=!0,n._updateViewportMatrix(),t.threeDManager.helpers.toggleGeometry(!0),t.threeDManager.helpers.toggleViewportObjects(!0),t.threeDManager.helpers.removeSceneObject(o),t.threeDManager.helpers.removeSceneObject(a);else 2==e.touches.length&&(u=Math.atan2(e.touches[1].locationY/i.height-e.touches[0].locationY/i.height,e.touches[1].locationX/i.width-e.touches[0].locationX/i.width))},e.prototype.onTouchesMoved=function(e){var o=t.renderingHandler.getSize();if(1==e.touches.length){if(2==l)return;o=s.performHitTest({x:e.locationX/o.width,y:e.locationY/o.height},s.HitTestResultTypes.HorizontalPlane).hitTest;for(var a=(o=$jscomp.makeIterator(o)).next();!a.done;a=o.next()){a=a.value;var i=r.worldTransform,c=new module$src$externals$three.default.Matrix4;c.fromArray(i),i=a.worldTransform;var d=new module$src$externals$three.default.Matrix4;d.fromArray(i),(i=new module$src$externals$three.default.Vector3).setFromMatrixPosition(c),(c=new module$src$externals$three.default.Vector3).setFromMatrixPosition(d),d=c.sub(i),(c=new module$src$externals$three.default.Matrix4).makeTranslation(d.x,0,d.z),p.multiply(c),n._updateViewportMatrix(),r=a}}else 2==e.touches.length&&(a=Math.atan2(e.touches[1].locationY/o.height-e.touches[0].locationY/o.height,e.touches[1].locationX/o.width-e.touches[0].locationX/o.width),null===u&&(u=a),o=a-u,u=a,(a=new module$src$externals$three.default.Matrix4).makeRotationY(-o),h.multiply(a),n._updateViewportMatrix());l=e.touches.length},e.prototype.onTouchesEnded=function(e){l=0},new e}},module$src$3d$viewports$expo$ar$handlers$LightHandler={default:function(e,t){var n,r,o,a,i,s,l=new module$src$externals$three.default.Sphere;return $jscomp.inherits(e=function(){module$src$3d$interfaces$handlers$LightHandlerInterface.default.call(this),n=new module$src$externals$three.default.Object3D,t.threeDManager.helpers.addViewportObject(n),r=new module$src$externals$three.default.AmbientLight(4210752),n.add(r),o=new module$src$externals$three.default.DirectionalLight(16777215,1),n.add(o),o.direction={x:.5774,y:-.5774,z:.5774},o.castShadow=!0,o.shadow.mapSize.width=1024,o.shadow.mapSize.height=1024,o.shadow.camera.near=.1,o.shadow.camera.far=8*l.radius,o.shadow.camera.right=1.5*l.radius,o.shadow.camera.left=-1.5*l.radius,o.shadow.camera.top=1.5*l.radius,o.shadow.camera.bottom=-1.5*l.radius,o.shadow.radius=2,o.shadow.bias=-175e-6,o.shadow.camera.updateProjectionMatrix(),a=new module$src$externals$three.default.Object3D,n.add(a),o.target=a,o.position.set(l.center.x+2.35*l.radius*o.direction.x,l.center.y+2.35*l.radius*o.direction.y,l.center.z+2.35*l.radius*o.direction.z),o.target.position.set(l.center.x,l.center.y,l.center.x),i=new module$src$externals$three.default.DirectionalLight(16777215,1),n.add(i),i.direction={x:.5774,y:.5774,z:.5774},s=new module$src$externals$three.default.Object3D,n.add(s),i.target=s,i.position.set(l.center.x+2.35*l.radius*i.direction.x,l.center.y+2.35*l.radius*i.direction.y,l.center.z+2.35*l.radius*i.direction.z),i.target.position.set(l.center.x,l.center.y,l.center.x)},module$src$3d$interfaces$handlers$LightHandlerInterface.default),e.prototype.pause=function(){},e.prototype.resume=function(){},e.prototype.destroy=function(){},e.prototype.adjustToBoundingSphere=function(e){l=e.clone(),n&&(o.position.set(l.center.x+2.35*l.radius*o.direction.x,l.center.y+2.35*l.radius*o.direction.y,l.center.z+2.35*l.radius*o.direction.z),o.target.position.set(l.center.x,l.center.y,l.center.x),o.shadow.camera.far=8*e.radius,o.shadow.camera.right=1.5*e.radius,o.shadow.camera.left=-1.5*e.radius,o.shadow.camera.top=1.5*e.radius,o.shadow.camera.bottom=-1.5*e.radius,o.shadow.camera.updateProjectionMatrix(),i.position.set(l.center.x+2.35*l.radius*i.direction.x,l.center.y+2.35*l.radius*i.direction.y,l.center.z+2.35*l.radius*i.direction.z),i.target.position.set(l.center.x,l.center.y,l.center.x))},e.prototype.setToggleLightShadows=function(e){o.castShadow=e},e.prototype.toggleLights=function(e){o.visible=e,i.visible=e},new e}},module$src$3d$viewports$expo$ar$ThreeDManager={default:function(e,t){var n,r,o,a=t.pathUtils,i=t.ExpoTHREE,s=t.AR,l=t.settings,u=t.scene,c=t.geometryNode,d=t.container,p={},h=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->groundPlaneVisibility")&&(o&&(o.visible=e),!0)},m=function(e,t){module$src$3d$interfaces$ThreeDManagerInterface.default.call(this,t,module$src$shared$util$GlobalUtils.default),(n=this).constants=module$src$3d$viewports$expo$ar$ThreeDManagerConstants.default,p.threeDManager=n,n.viewerApi=e,r=new module$src$3d$helpers$ThreeDManagerHelpers.default({scene:u,geometryNode:c,pathUtils:a},p),p.threeDManager.helpers=r,module$src$shared$mixins$SettingsMixin.default.call(n,l,module$src$3d$viewports$expo$ar$ThreeDManagerConstants.default.defaultSettings,t.runtimeId),this.renderingHandler=new module$src$3d$viewports$expo$ar$handlers$RenderingHandler.default({settings:n.getSection("render"),scene:u,container:d,externalLibraries:{ExpoTHREE:i,AR:s}},p),p.renderingHandler=this.renderingHandler,!1!==n.success&&(this.materialHandler=new module$src$3d$viewports$expo$ar$handlers$MaterialHandler.default({settings:n.getSection("material"),externalLibraries:{ExpoTHREE:i,AR:s}},p),p.materialHandler=this.materialHandler,!1!==n.success&&(this.cameraHandler=new module$src$3d$viewports$expo$ar$handlers$CameraHandler.default({settings:n.getSection("camera"),container:d,externalLibraries:{ExpoTHREE:i,AR:s}},p),p.cameraHandler=this.cameraHandler,!1!==n.success&&(this.interactionHandler=new module$src$3d$viewports$expo$ar$handlers$InteractionHandler.default({geometryNode:c,externalLibraries:{ExpoTHREE:i,AR:s}},p),p.interactionHandler=this.interactionHandler,!1!==n.success&&(this.lightHandler=new module$src$3d$viewports$expo$ar$handlers$LightHandler.default({externalLibraries:{ExpoTHREE:i,AR:s}},p),p.lightHandler=this.lightHandler,!1!==n.success&&this.registerHook("groundPlaneVisibility",h)))))};return $jscomp.inherits(m,module$src$3d$interfaces$ThreeDManagerInterface.default),m.prototype.init=function(e){var t=e.min.distanceTo(e.max);if(1<t){var a=parseInt(t);a=(a=a.toString()).length,a=Math.pow(10,a-1),t=Math.max(Math.ceil(t/a)*a,1)}else{a=1-Math.floor(Math.log(t)/Math.log(10))-2,t=t.toFixed(a+1);var i=parseInt(t.substr(t.length-1))+1;t="0.";for(var l=0;l<a;++l)t+="0";t=parseFloat(t+i)}a=new module$src$externals$three.default.PlaneGeometry(2*t,2*t,2,2),(t=new module$src$externals$three.default.ShadowMaterial).opacity=.5,(o=new module$src$externals$three.default.Mesh(a,t)).receiveShadow=!0,o.visible=n.getSetting("groundPlaneVisibility"),o.position.set(0,0,e.min.z-.005),r.addViewportObject(o),r.initialize(),n.adjustScene(),s.setPlaneDetection(s.PlaneDetectionTypes.Horizontal),p.interactionHandler._updateViewportMatrix()},m.prototype.adjustScene=function(){if(r.isInitialized()){var e=c.computeSceneBoundingBox(),t=new module$src$externals$three.default.Sphere;e.getBoundingSphere(t),o.position.set(0,0,e.min.z-.005),p.lightHandler.adjustToBoundingSphere(t),p.cameraHandler.adjustToBoundingSphere(t),p.renderingHandler.updateShadowMap(),p.materialHandler.compile()}},m.prototype.computeBoundingBox=function(e){return c.computeBoundingBox(e)},m.prototype.pause=function(){p.renderingHandler.pause(),p.cameraHandler.pause(),p.lightHandler.pause(),p.materialHandler.pause(),s.pause()},m.prototype.resume=function(){p.renderingHandler.resume(),p.cameraHandler.resume(),p.lightHandler.resume(),p.materialHandler.resume(),s.resume()},m.prototype.destroy=function(){for(var e in r.destroyViewport(),p.renderingHandler&&p.renderingHandler.destroy(),p.cameraHandler&&p.cameraHandler.destroy(),p.lightHandler&&p.lightHandler.destroy(),p.materialHandler&&p.materialHandler.destroy(),n.deregisterAllHooks(),n.deregisterAllNotifiers(),p)delete p[e];for(var t in n)n[t]=void 0},m.prototype.addMesh=function(e,t,n){r.addMesh(e,t,n)},m.prototype.removeMesh=function(e){r.removeMesh(e)},m.prototype.addAnchor=function(e,t){n.debug("This method is not implemented in this viewport.")},m.prototype.removeAnchor=function(e){n.debug("This method is not implemented in this viewport.")},m.prototype.fadeIn=function(e,t){n.debug("This method is not implemented in this viewport.")},m.prototype.fadeOut=function(e,t){n.debug("This method is not implemented in this viewport.")},m.prototype.setLiveTransformation=function(e,t,r,o,a){n.debug("This method is not implemented in this viewport.")},m.prototype.updateInteractions=function(e,t){n.debug("This method is not implemented in this viewport.")},m.prototype.removeFromInteractions=function(e){n.debug("This method is not implemented in this viewport.")},new m(e,t)}},module$src$3d$viewports$expo$ar$api$CameraApi={default:function(e,t){var n=t.threeDManager,r=t.apiResponse;return $jscomp.inherits(e=function(){module$src$3d$interfaces$api$CameraApiInterface.default.call(this),this.get=this.get.bind(this),this.updateAsync=this.updateAsync.bind(this),this.animateAsync=this.animateAsync.bind(this),this.zoomAsync=this.zoomAsync.bind(this),this.resetAsync=this.resetAsync.bind(this)},module$src$3d$interfaces$api$CameraApiInterface.default),e.prototype.get=function(){return r(null,n.cameraHandler.getPositionAndTarget())},e.prototype.updateAsync=function(e,t){throw Error("This API function is not implemented by this viewport.")},e.prototype.animateAsync=function(e,t){throw Error("This API function is not implemented by this viewport.")},e.prototype.zoomAsync=function(e,t){throw Error("This API function is not implemented by this viewport.")},e.prototype.resetAsync=function(e){throw Error("This API function is not implemented by this viewport.")},new e}},module$src$3d$viewports$expo$ar$api$LightApi={default:function(e,t){return $jscomp.inherits(e=function(){module$src$3d$interfaces$api$LightApiInterface.default.call(this)},module$src$3d$interfaces$api$LightApiInterface.default),new e}},module$src$3d$viewports$expo$ar$api$ViewportApi={default:function(e,t){var n,r,o=t.threeDManager,a=t.viewportManager,i={};return $jscomp.inherits(t=function(){module$src$3d$interfaces$api$ViewportApiInterface.default.call(this),this.utils=e.utils,this.EVENTTYPE=e.viewports.EVENTTYPE,this.camera=new module$src$3d$viewports$expo$ar$api$CameraApi.default(e,{threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse}),this.lights=new module$src$3d$viewports$expo$ar$api$LightApi.default(e,{threeDManager:o,apiResponse:this.utils.APIResponse}),n=module$src$3d$helpers$api$ViewportApiHelpers.default.getInstance(),r={THREE_D_MANAGER_CONSTANTS:module$src$3d$viewports$expo$ar$ThreeDManagerConstants.default,EVENTTYPE:this.EVENTTYPE,threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse,listeners:i},this.onTouchesBegan=this.onTouchesBegan.bind(this),this.onTouchesMoved=this.onTouchesMoved.bind(this),this.onTouchesEnded=this.onTouchesEnded.bind(this),this.getRuntimeId=this.getRuntimeId.bind(this),this.getContainer=this.getContainer.bind(this),this.getScreenshot=this.getScreenshot.bind(this),this.render=this.render.bind(this),this.convertTo2D=this.convertTo2D.bind(this),this.onResize=this.onResize.bind(this),this.getSize=this.getSize.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.reload=this.reload.bind(this),this.destroy=this.destroy.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.getSettingDefinitions=this.getSettingDefinitions.bind(this),this.getSettings=this.getSettings.bind(this),this.getSetting=this.getSetting.bind(this),this.updateSettingAsync=this.updateSettingAsync.bind(this),this.updateSettingsAsync=this.updateSettingsAsync.bind(this),this.setTransformation=this.setTransformation.bind(this),this.getTransformation=this.getTransformation.bind(this),this.applyTransformation=this.applyTransformation.bind(this),this.resetTransformation=this.resetTransformation.bind(this),this.setLiveTransformation=this.setLiveTransformation.bind(this),this.updateSelected=this.updateSelected.bind(this),this.getSelected=this.getSelected.bind(this)},module$src$3d$interfaces$api$ViewportApiInterface.default),t.prototype.onTouchesBegan=function(e){o.cameraHandler._onTouchesBegan(e)},t.prototype.onTouchesMoved=function(e){o.cameraHandler._onTouchesMoved(e)},t.prototype.onTouchesEnded=function(e){o.cameraHandler._onTouchesEnded(e)},t.prototype.getRuntimeId=function(){return o.runtimeId},t.prototype.getContainer=function(){throw Error("This API function is not implemented by this viewport.")},t.prototype.getScreenshot=function(){return o.renderingHandler.getScreenshot()},t.prototype.render=function(e){o.renderingHandler.render(e)},t.prototype.convertTo2D=function(e){throw Error("This API function is not implemented by this viewport.")},t.prototype.onResize=function(e,t,n,r,a){o.cameraHandler.onResize(r,a),o.renderingHandler.onResize(r,a,n)},t.prototype.getSize=function(){return o.renderingHandler.getSize()},t.prototype.pause=function(){o.pause()},t.prototype.resume=function(){o.resume()},t.prototype.reload=function(){return n.reload(r)},t.prototype.destroy=function(){return n.destroy(r)},t.prototype.addEventListener=function(e,t){return n.addEventListener(r,e,t)},t.prototype.removeEventListener=function(e){return n.removeEventListener(r,e)},t.prototype.getSettingDefinitions=function(){return n.getSettingDefinitions(r)},t.prototype.getSettings=function(e){return n.getSettings(r,e)},t.prototype.getSetting=function(e){return n.getSetting(r,e)},t.prototype.updateSettingAsync=function(e,t){return n.updateSettingAsync(r,e,t)},t.prototype.updateSettingsAsync=function(e){return n.updateSettingsAsync(r,e)},t.prototype.setTransformation=function(e){return n.setTransformation(r,e)},t.prototype.getTransformation=function(){return n.getTransformation(r)},t.prototype.applyTransformation=function(e){return n.applyTransformation(r,e)},t.prototype.resetTransformation=function(){return n.resetTransformation(r)},t.prototype.setLiveTransformation=function(e,t){return n.setLiveTransformation(r,e,t)},t.prototype.updateSelected=function(e,t){throw Error("This API function is not implemented by this viewport.")},t.prototype.getSelected=function(){throw Error("This API function is not implemented by this viewport.")},new t}},module$src$3d$viewports$default$ThreeDManagerConstants={},threeDManagerConstants$$module$src$3d$viewports$default$ThreeDManagerConstants,_convert$163=function(e,t){for(var n in e){if("value"===n)return _hasSubValue$164(e[n])?_convert$163(e[n],t):e[n];"desc"!==n&&(t[n]={},t[n]=_convert$163(e[n],t[n]))}return t},_hasSubValue$164=function(e){if("object"==typeof e)for(var t in e)if("value"===t||_hasSubValue$164(e[t]))return!0;return!1},GLOBAL_UTILS$165=module$src$shared$util$GlobalUtils.default,LOGGING_CONSTANTS$166=module$src$shared$constants$LoggingConstants.default,LOGGING_LEVELS$167=module$src$shared$constants$LoggingConstants.default.loggingLevels,cameraViewTypes={MIN:0,PERSPECTIVE:0,TOP:1,BOTTOM:2,RIGHT:3,LEFT:4,BACK:5,FRONT:6,AR:7,MAX:7},settingsDefinition={show:{value:!1,setting:"show",desc:"Show / hide the scene",type:"boolean"},showTransition:{value:"1s"},duration:{value:0,setting:"duration",desc:"Set fade in / fade out duration",type:"number"},fullscreen:{value:!1,setting:"fullscreen",desc:"Enable / disable fullscreen mode",type:"boolean"},gridVisibility:{value:!0,setting:"gridVisibility",desc:"Show / hide the grid",type:"boolean"},groundPlaneVisibility:{value:!0,setting:"groundPlaneVisibility",desc:"Show / hide the ground plane",type:"boolean"},groundPlaneReflectionVisibility:{value:!1,setting:"groundPlaneReflectionVisibility",desc:"Enable / disable the reflectivity of the groundplane ",type:"boolean"},groundPlaneReflectionThreshold:{value:.01,setting:"groundPlaneReflectionThreshold",desc:"Allows to control the distance to objects that are still reflected by the groundplane ",type:function(e){return"number"==typeof e&&0<=e}},ignorePointerEvents:{value:!1,setting:"ignorePointerEvents",desc:"Ignore pointer events",type:"boolean"},render:{ambientOcclusion:{value:!0,setting:"render.ambientOcclusion",desc:"Enable / disable ambient occlusion for rendering",type:"boolean"},beautyRenderDelay:{value:50,setting:"beautyRenderDelay",desc:"Amount of which the beauty rendering is delayed",type:"number"},clearColor:{value:"#ffffff",setting:"render.clearColor",desc:"Set background color",type:function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color")}},clearAlpha:{value:1,setting:"render.clearAlpha",desc:"Set background alpha value",type:function(e){return"number"==typeof e&&0<=e&&1>=e}},devicePixelRatio:{value:1},pointSize:{value:1,setting:"render.pointSize",desc:"Set size of point objects",type:function(e){return"number"==typeof e&&0<=e}},sao:{samples:{value:8},intensity:{value:.1},kernelRadius:{value:8},standardDev:{value:25}},shadows:{value:!0,setting:"render.shadows",desc:"Enable / disable shadows for rendering",type:"boolean"}},camera:{autoAdjust:{value:!1,setting:"camera.autoAdjust",desc:"Enable / disable that the camera adjusts to geometry updates",type:"boolean"},autoRotationSpeed:{value:0,setting:"camera.autoRotationSpeed",desc:"Speed of autoration, can be negative, also refer to enableAutoRotation",type:"number"},cameraMovementDuration:{value:0,setting:"camera.cameraMovementDuration",desc:"Default duration of camera movements",type:"notnegative"},damping:{value:.1,setting:"camera.damping",desc:"How much to damp camera movements by the user",type:"notnegative"},defaults:{perspective:{value:{position:{value:{x:5,y:5,z:5},setting:"camera.defaults.perspective.position",desc:"Default position for the perspective camera",type:"vector3any",transform:function(e){return module$src$shared$util$GlobalUtils.default.toVector3(e)}},target:{value:{x:0,y:0,z:0},setting:"camera.defaults.perspective.target",desc:"Default target for the perspective camera",type:"vector3any",transform:function(e){return module$src$shared$util$GlobalUtils.default.toVector3(e)}}},setting:"camera.defaults.perspective",desc:"Default position and target for the perspective camera",type:function(e){return e&&module$src$shared$util$GlobalUtils.default.typeCheck(e.position,"vector3obj")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.target,"vector3obj")}},orthographic:{value:{position:{value:{x:5,y:5,z:5},setting:"camera.defaults.orthographic.position",desc:"Default position for the orthographic camera",type:"vector3any",transform:function(e){return module$src$shared$util$GlobalUtils.default.toVector3(e)}},target:{value:{x:0,y:0,z:0},setting:"camera.defaults.orthographic.target",desc:"Default target for the orthographic camera",type:"vector3any",transform:function(e){return module$src$shared$util$GlobalUtils.default.toVector3(e)}}},setting:"camera.defaults.orthographic",desc:"Default position and target for the orthographic camera",type:function(e){return e&&module$src$shared$util$GlobalUtils.default.typeCheck(e.position,"vector3obj")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.target,"vector3obj")}}},enableAutoRotation:{value:!1,setting:"camera.enableAutoRotation",desc:"Enable / disable automatic rotation of the camera, also refer to autoRotationSpeed",type:"boolean"},enableKeyPan:{value:!1,setting:"camera.enableKeyPan",desc:"Enable / disable panning using the keyboard, also refer to enablePan",type:"boolean"},enableOrbitControls:{value:!0,setting:"camera.enableOrbitControls",desc:"Enable / disable orbit controls",type:"boolean"},enablePan:{value:!0,setting:"camera.enablePan",desc:"Enable / disable panning in general, also refer to enableKeyPan",type:"boolean"},enableRotation:{value:!0,setting:"camera.enableRotation",desc:"Enable / disable camera rotation",type:"boolean"},enableZoom:{value:!0,setting:"camera.enableZoom",desc:"Enable / disable zooming",type:"boolean"},far:{value:100},fov:{value:45,setting:"camera.fov",desc:"Camera frustum vertical field of view angle, unit degree, interval [0,180]",type:function(e){return"number"==typeof e&&0<e&&180>e}},keyPanSpeed:{value:1,setting:"camera.keyPanSpeed",desc:"Speed of panning when using the keyboard",type:"number"},near:{value:.01},restrictions:{position:{cube:{value:{min:{value:{x:-1/0,y:-1/0,z:-1/0},setting:"camera.restrictions.position.cube.min",desc:"Restriction of the camera position inside a cube, minimum corner of the cube",type:"vector3any"},max:{value:{x:1/0,y:1/0,z:1/0},setting:"camera.restrictions.position.cube.max",desc:"Restriction of the camera position inside a cube, maximum corner of the cube",type:"vector3any"}},setting:"camera.restrictions.position.cube",desc:"Restriction of the camera position inside a cube, minimum and maximum corner of the cube"},sphere:{value:{center:{value:{x:0,y:0,z:0},setting:"camera.restrictions.position.sphere.center",desc:"Restriction of the camera position inside a sphere, center of the sphere",type:"vector3any"},radius:{value:1/0,setting:"camera.restrictions.position.sphere.radius",desc:"Restriction of the camera position inside a sphere, radius of the sphere",type:"notnegative"}},setting:"camera.restrictions.position.sphere",desc:"Restriction of the camera position inside a sphere, center and radius of the sphere"}},target:{cube:{value:{min:{value:{x:-1/0,y:-1/0,z:-1/0},setting:"camera.restrictions.target.cube.min",desc:"Restriction of the camera target inside a cube, minimum corner of the cube",type:"vector3any"},max:{value:{x:1/0,y:1/0,z:1/0},setting:"camera.restrictions.target.cube.max",desc:"Restriction of the camera target inside a cube, maximum corner of the cube",type:"vector3any"}},setting:"camera.restrictions.target.cube",desc:"Restriction of the camera target inside a cube, minimum and maximum corner of the cube"},sphere:{value:{center:{value:{x:0,y:0,z:0},setting:"camera.restrictions.target.sphere.center",desc:"Restriction of the camera target inside a sphere, center of the sphere",type:"vector3any"},radius:{value:1/0,setting:"camera.restrictions.target.sphere.radius",desc:"Restriction of the camera target inside a sphere, radius of the sphere",type:"notnegative"}},setting:"camera.restrictions.target.sphere",desc:"Restriction of the camera target inside a sphere, center and radius of the sphere"}},rotation:{value:{minPolarAngle:{value:0,setting:"camera.restrictions.rotation.minPolarAngle",desc:"Minimum polar angle of the camera position with respect to the camera target, unit degree, interval [0,180]",type:function(e){return"number"==typeof e&&0<=e&&180>=e}},maxPolarAngle:{value:180,setting:"camera.restrictions.rotation.maxPolarAngle",desc:"Maximum polar angle of the camera position with respect to the camera target, unit degree, interval [0,180]",type:function(e){return"number"==typeof e&&0<=e&&180>=e}},minAzimuthAngle:{value:-1/0,setting:"camera.restrictions.rotation.minAzimuthAngle",desc:"Minimum azimuth angle of the camera position with respect to the camera target, unit degree, interval [-180,180]",type:"number"},maxAzimuthAngle:{value:1/0,setting:"camera.restrictions.rotation.maxAzimuthAngle",desc:"Maximum azimuth angle of the camera position with respect to the camera target, unit degree, interval [-180,180]",type:"number"}},setting:"camera.restrictions.rotation",desc:"Minimum and maximum polar and azimuth angle of the camera position with respect to the camera target, unit degree",type:function(e){return e&&Object.keys(e).every((function(t){return"number"==typeof e[t]}))}},zoom:{value:{minDistance:{value:0,setting:"camera.restrictions.zoom.minDistance",desc:"Minimum distance between camera position and target",type:"notnegative"},maxDistance:{value:1/0,setting:"camera.restrictions.zoom.maxDistance",desc:"Maximum distance between camera position and target",type:"notnegative"}},setting:"camera.restrictions.zoom",desc:"Minimum and maximum distance between camera position and target",type:function(e){return e&&module$src$shared$util$GlobalUtils.default.typeCheck(e.minDistance,"notnegative")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.maxDistance,"notnegative")}}},revertAtMouseUp:{value:!1,setting:"camera.revertAtMouseUp ",desc:"Enable / disable if the mouse should reset on mouse up",type:"boolean"},revertAtMouseUpDuration:{value:800,setting:"camera.revertAtMouseUpDuration",desc:"The duration of the transition of the revertAtMouseUp",type:"notnegative"},rotationSpeed:{value:.25,setting:"camera.rotationSpeed",desc:"Speed of camera rotation",type:"number"},panSpeed:{value:.5,setting:"camera.panSpeed",desc:"Speed of panning",type:"number"},type:{value:cameraViewTypes.PERSPECTIVE,setting:"camera.type",desc:"Set camera type",type:function(e){return"number"==typeof e&&e>=cameraViewTypes.PERSPECTIVE&&e<=cameraViewTypes.AR}},zoomExtentsFactor:{value:1,setting:"camera.zoomExtentsFactor",desc:"Factor to apply to the bounding box before zooming to extents",type:"number"},zoomSpeed:{value:1,setting:"camera.zoomSpeed",desc:"Speed of zooming",type:"notnegative"}},lights:{helper:{value:!1,setting:"lights.helpers",desc:"Show / hide the light helpers",type:"boolean"},lightScene:{value:"default",setting:"lights.lightScene"},lightScenes:{value:{},setting:"lights.lightScenes"}},material:{environmentMapAsBackground:{value:!1,setting:"material.environmentMapAsBackground",desc:"Show / hide the environment map in the background",type:"boolean"},environmentMap:{value:"none",setting:"material.environmentMap",desc:"Name of the environment map to use, or an array of 6 image URLs making up the cube mapped environment map (px, nx, pz, nz, py, ny)",type:function(e){return"string"==typeof e||module$src$shared$util$GlobalUtils.default.isArrayOfType(e,"string")&&6===e.length}},environmentMapResolution:{value:"1024",setting:"material.environmentMapResolution",desc:"Image resolution to be used for the named environment maps (available resolutions: 256, 512, 1024)",type:function(e){return["256","512","1024","2048"].includes(e)}}}},defaultSettings={};_convert$163(settingsDefinition,defaultSettings),threeDManagerConstants$$module$src$3d$viewports$default$ThreeDManagerConstants={settingsDefinition:settingsDefinition,defaultSettings:defaultSettings,loggingLevels:LOGGING_LEVELS$167,cameraViewTypes:cameraViewTypes},module$src$3d$viewports$default$ThreeDManagerConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(threeDManagerConstants$$module$src$3d$viewports$default$ThreeDManagerConstants);var module$src$3d$viewports$default$shaders$ShaderFile={default:{}};module$src$3d$viewports$default$shaders$ShaderFile.default.basic_vert="\nvarying vec2 vUv;\n\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.blend_frag="\nuniform sampler2D tStandard;\nuniform sampler2D tBeauty;\t\t\nuniform vec2 size;\nuniform float amount;\n\nvarying vec2 vUv;\n\nvoid main() {\n\tgl_FragColor =  texture2D(tStandard, vUv) * (1.0-amount) + texture2D(tBeauty, vUv) * amount;\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.blur_frag="\n#include <common>\n#include <packing>\n\nuniform sampler2D tAO;\nuniform sampler2D tDiffuse;\n\nuniform sampler2D tDepth;\n\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform int orientation;\n\nuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\n\nvarying vec2 vUv;\n\t\t\nconst float depthCutoff = 1.0;\n\nvoid main() {\n\tfloat depth = unpackRGBAToDepth( texture2D( tDepth, vUv ) );\n\tif( depth >= ( 1.0 - EPSILON ) ) {\n\t\tgl_FragColor = texture2D(tDiffuse, vUv);\n\t\treturn;\n\t}\n\n\tfloat centerViewZ = -perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\tvec2 size = 1.0 / size;\n\n\tfloat weightSum = sampleWeights[0];\n\tvec4 sum = texture2D(tAO, vUv) * sampleWeights[0];\n\n\tvec2 position;\n\tfor(int i = 1; i <= KERNEL_RADIUS; i++){\n\t\tif(orientation == 0){\n\t\t\tposition = vec2(vUv.x - size.x*float(i), vUv.y);\n\t\t}else if(orientation == 1){\n\t\t\tposition = vec2(vUv.x, vUv.y - size.y*float(i));\n\t\t}\n\t\tfloat positionDepth = unpackRGBAToDepth( texture2D( tDepth, position ) );\n\t\tfloat viewZ = -perspectiveDepthToViewZ( positionDepth, cameraNear, cameraFar );\n\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) break;\n\t\tfloat weight = sampleWeights[i];\n\t\tsum += texture2D( tAO, position ) * weight;\n\t\tweightSum += weight;\n\t}\n\n\tfor(int i = 1; i <= KERNEL_RADIUS; i++){\n\t\tif(orientation == 0){\n\t\t\tposition = vec2(vUv.x + size.x*float(i), vUv.y);\n\t\t}else if(orientation == 1){\n\t\t\tposition = vec2(vUv.x, vUv.y + size.y*float(i));\n\t\t}\n\t\tfloat positionDepth = unpackRGBAToDepth( texture2D( tDepth, position ) );\n\t\tfloat viewZ = -perspectiveDepthToViewZ( positionDepth, cameraNear, cameraFar );\n\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) break;\n\t\tfloat weight = sampleWeights[i];\n\t\tsum += texture2D( tAO, position ) * weight;\n\t\tweightSum += weight;\n\t}\n\n\tif(orientation == 1){\n\t\tvec4 texel = texture2D(tDiffuse, vUv);\n\t\tgl_FragColor = (sum / weightSum) * texel;\n\t}else{\n\t\tgl_FragColor = (sum / weightSum);\n\t}\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.copy_frag="\nuniform float opacity;\nuniform sampler2D tDiffuse;\n\nvarying vec2 vUv;\n\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.gem_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec4 initialPosition;\nvarying vec3 initialNormal;\n\nvarying vec3 frag_position;\nvarying vec3 frag_normal;\n\nuniform vec3 center;\nuniform float radius;\nuniform samplerCube sphericalNormalMap;\nuniform mat3 normalMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 inverseModelMatrix;\nuniform mat3 inverseTransposeModelMatrix;\n\nuniform samplerCube impurityMap;\nuniform float impurityScale;\nuniform vec3 colorTransferBegin;\nuniform vec3 colorTransferEnd;\nuniform float refractionIndex;\nuniform float gamma;\nuniform float contrast;\nuniform float brightness;\nuniform float dispersion;\nuniform float tracingOpacity;\n\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradianceTemp( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * geometry.normal.x, geometry.normal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * geometry.normal.x, geometry.normal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevelTemp( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadianceTemp( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\tfloat specularMIPLevel = getSpecularMIPLevelTemp( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n\nvec3 calculateReflectedLight(vec3 position, vec3 normal, vec3 viewDir, PhysicalMaterial material, int depth) {\n\t\n\tGeometricContext currentGeometry;\n\tcurrentGeometry.position = (modelMatrix * vec4(position, 1.0)).xyz;\n\tcurrentGeometry.normal = normalize(inverseTransposeModelMatrix * normal);\n\tcurrentGeometry.viewDir = normalize(inverseTransposeModelMatrix * -viewDir);\n\n\tReflectedLight rLight;\n\tIncidentLight dLight;\n\n\tfloat temp = material.specularRoughness;\n\tmaterial.specularRoughness = 0.5;\n\n\t#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\t\tPointLight pointLight;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\tpointLight = pointLights[ i ];\n\t\t\tgetPointDirectLightIrradiance( pointLight, currentGeometry, dLight );\n\t\t\t#ifdef USE_SHADOWMAP\n\t\t\tdLight.color *= all( bvec2( pointLight.shadow, dLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t\t#endif\n\t\t\tRE_Direct( dLight, currentGeometry, material, rLight );\n\t\t}\n\t#endif\n\t#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\t\tSpotLight spotLight;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\tspotLight = spotLights[ i ];\n\t\t\tgetSpotDirectLightIrradiance( spotLight, currentGeometry, dLight );\n\t\t\t#ifdef USE_SHADOWMAP\n\t\t\tdLight.color *= all( bvec2( spotLight.shadow, dLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t\t#endif\n\t\t\tRE_Direct( dLight, currentGeometry, material, rLight );\n\t\t}\n\t#endif\n\t#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\t\tDirectionalLight directionalLight;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\tdirectionalLight = directionalLights[ i ];\n\t\t\tgetDirectionalDirectLightIrradiance( directionalLight, currentGeometry, dLight );\n\t\t\t#ifdef USE_SHADOWMAP\n\t\t\tdLight.color *= all( bvec2( directionalLight.shadow, dLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t\t#endif\n\t\t\tRE_Direct( dLight, currentGeometry, material, rLight );\n\t\t}\n\t#endif\n\tmaterial.specularRoughness = temp;\n\t\n\t#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\t\tRectAreaLight rectAreaLight;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\t\trectAreaLight = rectAreaLights[ i ];\n\t\t\tRE_Direct_RectArea( rectAreaLight, currentGeometry, material, rLight );\n\t\t}\n\t#endif\n\n\t#if defined( RE_IndirectDiffuse )\n\t\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t\t#pragma unroll_loop\n\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], currentGeometry );\n\t\t\t}\n\t\t#endif\n\t#endif\n\t#if defined( RE_IndirectSpecular )\n\t\tvec3 radiance = vec3( 0.0 );\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\n\n\t#if defined( RE_IndirectDiffuse )\n\t\t#ifdef USE_LIGHTMAP\n\t\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\t\tlightMapIrradiance *= PI;\n\t\t\t#endif\n\t\t\tirradiance += lightMapIrradiance;\n\t\t#endif\n\t\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tirradiance += getLightProbeIndirectIrradianceTemp( currentGeometry, maxMipLevel );\n\t\t#endif\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t\tradiance += getLightProbeIndirectRadianceTemp( currentGeometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t\t#ifndef STANDARD\n\t\t\tclearCoatRadiance += getLightProbeIndirectRadianceTemp( currentGeometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t\t#endif\n\t#endif\n\n\n\n\t#if defined( RE_IndirectDiffuse )\n\t\tRE_IndirectDiffuse( irradiance, currentGeometry, material, rLight );\n\t#endif\n\t#if defined( RE_IndirectSpecular )\n\t\tRE_IndirectSpecular( radiance, clearCoatRadiance, currentGeometry, material, rLight );\n\t#endif\n\n\tif(depth >= 0) {\n\t\tfloat frac = float(depth) / float(DEPTH);\n\t\trLight.indirectSpecular *= (1.0-frac) * colorTransferBegin + frac * colorTransferEnd;\n\t}\n\n\tvec3 color = rLight.indirectSpecular + rLight.directSpecular + rLight.indirectDiffuse + rLight.directDiffuse;\n\tcolor = pow(color, vec3(1.0/gamma)); // gamma\n\tcolor.rgb = ((color.rgb - 0.5) * max(contrast, 0.0)) + 0.5; // contrast\n\tcolor += vec3(brightness, brightness, brightness); // brightness\n\treturn color;\n}\n\nvec3 normalLookUp(vec3 dir) {\n\tvec4 s = textureCube(sphericalNormalMap, dir);\n\tif(s.a < 1.0/256.0) {\n\t\treturn normalize(vec3(-s.x, -s.y, -s.z));\n\t} else if(s.a < 3.0/256.0) {\n\t\treturn normalize(vec3(-s.x, -s.y, s.z));\n\t} else if(s.a < 5.0/256.0) {\n\t\treturn normalize(vec3(-s.x, s.y, -s.z));\n\t} else if(s.a < 7.0/256.0) {\n\t\treturn normalize(vec3(s.x, -s.y, -s.z));\n\t} else if(s.a < 9.0/256.0) {\n\t\treturn normalize(vec3(-s.x, s.y, s.z));\n\t} else if(s.a < 11.0/256.0) {\n\t\treturn normalize(vec3(s.x, -s.y, s.z));\n\t} else if(s.a < 13.0/256.0) {\n\t\treturn normalize(vec3(s.x, s.y, -s.z));\n\t} else {\n\t\treturn normalize(s.xyz);\n\t}\n}\n\n#ifdef USE_IMPURITY_MAP\n\tfloat impurityLookUp(vec3 dir) {\n\t\tvec3 c = textureCube(impurityMap, dir).rgb;\n\t\treturn (c.x + c.y + c.z) / 3.0;\n\t}\n#endif\n\nvec3 raySphereIntersection(vec3 o, vec3 d) {\n\n\tvec3 oc = o - center;\nfloat a = dot(d, d);\nfloat b = 2.0 * dot(oc, d);\nfloat c = dot(oc,oc) - radius*radius;\nfloat discriminant = b*b - 4.0*a*c;\nif(discriminant < 0.0){\nreturn vec3(0.0);\n}\nelse{\nreturn o +( (-b + sqrt(discriminant)) / (2.0*a)) * d;\n}\n}\n\nvec3 hueToSaturatedColor(float hue) {\nfloat r,g,b;\nif (hue < 0.25){\n\t\tfloat t = 1.0 - (hue / 0.25);\nr = 1.0;\ng = 1.0;\nb = t;\n\t} else if (hue < 0.5){\n\tfloat t = 1.0 - (hue - 0.25 / 0.25);\n\t\tr = 1.0;\ng = t;\nb = 0.0;\n\t} else if (hue < 0.75){\n\tfloat t = 1.0 - (hue - 0.5 / 0.25);\n\t\tr = t;\ng = 0.0;\nb = 1.0 - t;\n} else {\n\tfloat t = hue - 0.75 / 0.25;\nr = t;\ng = t;\nb = 1.0;\n}\nreturn vec3(r, g, b) / 0.5 + 0.5;\n}\n\nvoid main() {\n\tvec3 frag_normal_normalized = frag_normal;\n\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\n\tvec3 initialDirection = normalize( frag_position - (inverseModelMatrix*vec4(cameraPosition,1.0)).xyz );\n\n\n\tvec4 outgoingLight;\n\tfloat r_0 = (1.0-refractionIndex)/(1.0+refractionIndex);\n\tr_0 = r_0*r_0;\n\n\tfloat cos_theta_0 = -dot(initialDirection, frag_normal_normalized);\n\tfloat r_0_outside = (refractionIndex-1.0)/(refractionIndex+1.0);\n\tr_0_outside = r_0_outside*r_0_outside;\n\tfloat initialProbability = r_0_outside + (1.0 - r_0_outside)*pow(1.0 - cos_theta_0, 5.0);\n\n\t\t\t\t\n\toutgoingLight = vec4(calculateReflectedLight(frag_position, frag_normal_normalized, initialDirection, material, -1), 1.0);\n\tif(DEPTH > 0)\n\t\toutgoingLight *= initialProbability;\n\t\t\n\tvec3 tempColor;\n\n\t#ifdef DISPERSION\n\t\tconst int loop = 3;\n\t\tvec3 dispersionColor;\n\t#else\n\t\tconst int loop = 1;\n\t#endif\n\t\tfor(int j = 0; j < loop; j++){\n\t\t\tvec3 refractedDirection = refract(initialDirection, frag_normal_normalized, 1.0/refractionIndex + float(j)*dispersion);\n\t\t\tvec3 newPosition = raySphereIntersection(frag_position, refractedDirection);\n\t\t\tvec3 lookUpVector = normalize(newPosition - center);\n\t\t\tvec3 newNormal = normalLookUp(lookUpVector);\n\t\t\tvec3 newDirection = reflect(refractedDirection, newNormal);\n\n\t\t\tfloat currentProbability = 1.0;\n\n\t\t\t#ifdef USE_IMPURITY_MAP\n\t\t\t\tfloat impurityProbability = impurityLookUp(lookUpVector);\n\t\t\t\tcurrentProbability -= impurityProbability * impurityScale;\n\t\t\t\t//gl_FragColor = vec4(vec3(impurityProbability), 1.0);\n\t\t\t\t//return;\n\t\t\t#endif\n\t\t\t\n\t\t\t// if(0 == DEPTH) {\n\t\t\t// \tgl_FragColor = vec4(0.5 * newNormal + 0.5, 1.0);\n\t\t\t// \treturn;\n\t\t\t// }\n\n\t\t\ttempColor = vec3(0.0);\n\t\t\tfor(int i = 0; i < DEPTH; i++) {\n\t\t\t\t// small position correction to avoid artefacts\n\t\t\t\tnewPosition = newPosition - lookUpVector * 1e-6;\n\t\t\t\tnewPosition = raySphereIntersection(newPosition, newDirection);\n\t\t\t\tlookUpVector = normalize(newPosition - center);\n\t\t\t\tnewNormal = normalLookUp(lookUpVector);\n\t\t\t\n\t\t\t\tfloat cos_theta = dot(newDirection, newNormal);\n\t\t\t\tfloat ratio;\n\t\t\t\tif(cos_theta > 0.0) {\n\t\t\t\t\tratio = refractionIndex;\n\t\t\t\t} else {\n\t\t\t\t\tcos_theta = -cos_theta;\n\t\t\t\t\tratio = 1.0 / refractionIndex;\n\t\t\t\t}\n\t\t\t\tfloat cos_theta_2 = 1.0 - ratio*ratio * (1.0 - cos_theta*cos_theta);\n\t\t\t\tfloat probability = r_0 + (1.0 - r_0)*pow(1.0 - cos_theta, 5.0);\n\t\t\t\tif(cos_theta_2 < 0.0) probability = 0.0;\n\n\t\t\t\tvec3 refracted = refract(newDirection, newNormal*-1.0, 1.0/refractionIndex);\n\t\t\t\ttempColor += probability * currentProbability * calculateReflectedLight(newPosition, newNormal*-1.0, reflect(refracted, newNormal), material, i);\n\t\t\t\tif(i+1 == DEPTH)\n\t\t\t\t\ttempColor += (1.0 - probability) * currentProbability * calculateReflectedLight(newPosition, newNormal, newDirection, material, i);\n\n\t\t\t\tnewDirection = reflect(newDirection, newNormal);\n\n\t\t\t\t// if(i+1 == DEPTH) {\n\t\t\t\t// \tgl_FragColor = vec4(0.5 * newNormal + 0.5, 1.0);\n\t\t\t\t// \treturn;\n\t\t\t\t// }\n\n\t\t\t\tcurrentProbability *= (1.0 - probability);\n\t\t\t}\n\n\t\t\t#ifdef DISPERSION\n\t\t\t\tif(j == 0) {\n\t\t\t\t\tdispersionColor.r = tempColor.r;\t\n\t\t\t\t} else if(j == 1) {\n\t\t\t\t\tdispersionColor.g = tempColor.g;\t\n\t\t\t\t} else if(j == 2) {\n\t\t\t\t\tdispersionColor.b = tempColor.b;\t\n\t\t\t\t}\n\t\t\t\ttempColor = dispersionColor;\n\t\t\t#endif\n\t\t}\t\n\n\tif(DEPTH > 0)\n\t\toutgoingLight.rgb += (1.0 - initialProbability) * tempColor;\n\n\tfloat alpha = (1.0 - initialProbability) + initialProbability*tracingOpacity;\n\tgl_FragColor = vec4(outgoingLight.rgb, alpha*diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.gem_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvarying vec3 frag_position;\nvarying vec3 frag_normal;\n\nvoid main() {\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\nvNormal = normalize( transformedNormal );\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = - mvPosition.xyz;\nvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#include <shadowmap_vertex>\n#include <fog_vertex>\n\nfrag_position = position;\nfrag_normal = objectNormal;\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.normal_frag="varying highp vec3 vNormal;\n\nfloat decodeFloat(float f) {\n\tfloat r = mod(f, 1.0/255.0);\n\treturn /*r > 0.5/256.0 ? f + (1.0/256.0) - r : */f - r;\n}\n\nvec3 decodeVec3(vec3 v) {\n\treturn vec3(decodeFloat(v.x), decodeFloat(v.y), decodeFloat(v.z));\n}\n\nfloat signEncoding(vec3 v) {\n\tfloat code = 1.0;\n\t if(v.x < 0.0 && v.y < 0.0 && v.z < 0.0) {\n\t\tcode = 0.0;\n\t} else if (v.x < 0.0 && v.y < 0.0) {\n\t\tcode = 2.0/256.0;\n\t} else if (v.x < 0.0 && v.z < 0.0) {\n\t\tcode = 4.0/256.0;\n\t} else if (v.y < 0.0 && v.z < 0.0) {\n\t\tcode = 6.0/256.0;\n\t} else if (v.x < 0.0) {\n\t\tcode = 8.0/256.0;\n\t} else if (v.y < 0.0) {\n\t\tcode = 10.0/256.0;\n\t} else if (v.z < 0.0) {\n\t\tcode = 12.0/256.0;\n\t}\n\treturn code;\n}\n\nvoid main() {\n\tvec3 n = normalize(vNormal);\n\tgl_FragColor = vec4(decodeVec3(abs(n)), signEncoding(n));\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.normal_vert="varying vec3 vNormal;\n\nvoid main() {\nvNormal = normal;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.refl_frag="uniform vec3 color;\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform vec3 worldPosition;\nuniform float far;\nuniform mat4 viewMatrixInv;\nvarying vec4 vUv;\nuniform float threshold;\n\nfloat blendOverlay( float base, float blend ) {\nreturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n}\n\nvec3 blendOverlay( vec3 base, vec3 blend ) {\nreturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n}\n\nfloat decompress(float a){\nreturn a < .5 ? -a * (far * 2.0) : (a-.5) * (far * 2.0);\n}\n\nvoid main() {\nfloat depth = ((decompress(texture2DProj(tDepth, vUv).a) - worldPosition.z) / far) * (1.0/threshold);\ngl_FragColor = vec4( blendOverlay( texture2DProj( tDiffuse, vUv ).rgb, color ), 1.0 - max(0.0, min(1.0, depth)) );\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.refl_vert="uniform mat4 textureMatrix;\nvarying vec4 vUv;\n\nvoid main() {\n\tvUv = textureMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.sao_frag="\n#include <common>\n#include <packing>\n\nvarying vec2 vUv;\n\nuniform sampler2D tDepth;\nuniform sampler2D tNormal;\n\nuniform float cameraNear;\nuniform float cameraFar;\nuniform mat4 cameraProjectionMatrix;\nuniform mat4 cameraInverseProjectionMatrix;\n\nuniform vec2 size;\nuniform float intensity;\nuniform float scale;\nuniform float kernelRadius;\n\nvec3 getViewPosition(const in vec2 screenPosition, const in float depth, const in float viewZ) {\n\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\tvec4 clipPosition = vec4((vec3(screenPosition, depth) - 0.5) * 2.0, 1.0);\n\tclipPosition *= clipW; // unprojection\n\n\treturn (cameraInverseProjectionMatrix * clipPosition).xyz;\n}\n\nfloat getOcclusion(const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition) {\n\tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n\tfloat viewDistance = length(viewDelta);\n\tfloat scaledScreenDistance = scale * viewDistance;\n\treturn max(0.0, (dot(centerViewNormal, viewDelta))/scaledScreenDistance)/(1.0 + pow2(scaledScreenDistance));\n}\n\nfloat getAmbientOcclusion(const in vec3 centerViewPosition) {\n\tvec3 centerViewNormal = unpackRGBToNormal(texture2D(tNormal, vUv).xyz);\n\n\tfloat angle = rand(vUv) * PI2;\n\tvec2 radius = vec2(kernelRadius * (1.0/float(SAMPLES)))/size;\n\tvec2 radiusStep = radius;\n\tfloat occlusionSum = 0.0;\n\tfloat weightSum = 0.0;\n\tfloat angleStep = PI2 * 3.0/float(SAMPLES);\n\n\tfor(int i = 0; i < SAMPLES; i ++) {\n\t\tvec2 sampleUv = vUv + vec2(cos(angle), sin(angle)) * radius;\n\t\tradius += radiusStep;\n\t\tangle += PI2 * 3.0/float(SAMPLES);\n\n\t\tfloat sampleDepth = unpackRGBAToDepth(texture2D(tDepth, sampleUv));\n\t\tif(sampleDepth >= (1.0 - EPSILON)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfloat sampleViewZ = perspectiveDepthToViewZ(sampleDepth, cameraNear, cameraFar);\n\t\tvec3 sampleViewPosition = getViewPosition(sampleUv, sampleDepth, sampleViewZ);\n\t\tocclusionSum += getOcclusion(centerViewPosition, centerViewNormal, sampleViewPosition);\n\t\tweightSum += 1.0;\n\t}\n\n\tif(weightSum == 0.0) discard;\n\n\treturn occlusionSum * (intensity/weightSum);\n}\n\nvoid main() {\n\tfloat centerDepth = unpackRGBAToDepth(texture2D(tDepth, vUv));\n\tif(centerDepth >= (1.0 - EPSILON)) {\n\t\tdiscard;\n\t}\n\tfloat centerViewZ = perspectiveDepthToViewZ(centerDepth, cameraNear, cameraFar);\n\tvec3 viewPosition = getViewPosition(vUv, centerDepth, centerViewZ);\n\tfloat ao = 1.0 - getAmbientOcclusion(viewPosition);\n\tgl_FragColor = vec4(ao, ao, ao, 1);\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.simple_blur_frag="\nuniform sampler2D tDiffuse;\nuniform sampler2D tAO;\t\t\nuniform vec2 size;\nuniform int orientation;\n\nvarying vec2 vUv;\n\nvoid main() {\n\tvec4 sum = vec4( 0.0 );\n\tvec2 or = vec2(0,0);\n\n\tif(orientation==0){\n\t\tor = vec2(1,0);\n\t}else{\n\t\tor = vec2(0,1);\n\t}\n\tvec2 off = vec2(3.2307692308) * or;\n\tsum += texture2D(tAO, vUv) * 0.29411764705882354;\n\tsum += texture2D(tAO, vUv + (off / size)) * 0.35294117647058826;\n\tsum += texture2D(tAO, vUv - (off / size)) * 0.35294117647058826;\n\t\n\tif(orientation == 1){\n\t\tgl_FragColor =  texture2D( tDiffuse, vUv );\n\t\tgl_FragColor.xyz *= sum.x;\n\t}else{\n\t\tgl_FragColor = sum;\n\t}\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.standard_frag="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\nuniform float clearCoat;\nuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\nvarying vec4 worldPos;\n\nuniform float shadowOpacity;\nuniform float lightReflectivity;\n\nuniform float threeDNoiseScale;\nuniform float threeDNoiseDistanceFade;\nuniform float threeDNoiseOpacity;\nfloat threeDAmbient = 1.0;\n\n#if NUM_ADD_MAPS > 0\nuniform int mapsSize;\nuniform sampler2D additionalMaps0;\n#if NUM_ADD_MAPS > 1\nuniform sampler2D additionalMaps1;\n#endif\n#if NUM_ADD_MAPS > 2\nuniform sampler2D additionalMaps2;\n#endif\n#if NUM_ADD_MAPS > 3\nuniform sampler2D additionalMaps3;\n#endif\n#if NUM_ADD_MAPS > 4\nuniform sampler2D additionalMaps4;\n#endif\nuniform int mapPropertyType[NUM_ADD_MAPS];\nuniform vec3 mapPropertyColor[NUM_ADD_MAPS];\nuniform mat3 uvTransformAddMap[NUM_ADD_MAPS];\nvarying vec2 vUvOriginal;\n#endif\n\n#ifdef USE_RGBMAP\nuniform sampler2D rgbMap;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#if defined( USE_MAP )\nvarying vec2 vUvMap;\n#endif\n#if defined( USE_BUMPMAP )\nvarying vec2 vUvBumpMap;\n#endif\n#if defined( USE_NORMALMAP )\nvarying vec2 vUvNormalMap;\n#endif\n#if defined( USE_SPECULARMAP )\nvarying vec2 vUvSpecularMap;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlphaMap;\n#endif\n#if defined( USE_EMISSIVEMAP )\nvarying vec2 vUvEmissiveMap;\n#endif\n#if defined( USE_ROUGHNESSMAP )\nvarying vec2 vUvRoughnessMap;\n#endif\n#if defined( USE_METALNESSMAP )\nvarying vec2 vUvMetalnessMap;\n#endif\n\n\n\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\nvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\nvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n#ifdef ENVMAP_TYPE_CUBE\nvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n#ifdef LOD_BLACK_LIST\nvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n#else\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n#else\nvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n#endif\n#endif\nenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\nvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\nvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n#else\nvec4 envMapColor = vec4( 0.0 );\n#endif\nreturn PI * envMapColor.rgb * envMapIntensity;\n}\nfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\nfloat maxMIPLevelScalar = float( maxMIPLevel );\nfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\nreturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n}\nvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n#ifdef ENVMAP_MODE_REFLECTION\nvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n#else\nvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n#endif\nreflectVec = inverseTransformDirection( reflectVec, viewMatrix );\nfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n#ifdef ENVMAP_TYPE_CUBE\nvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n#ifdef LOD_BLACK_LIST\nvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n#else\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n#else\nvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n#endif\n#endif\nenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\nvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\nvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n#elif defined( ENVMAP_TYPE_EQUIREC )\nvec2 sampleUV;\nsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\nsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n#ifdef LOD_BLACK_LIST\nvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n#else\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n#else\nvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n#endif\n#endif\n\nenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n#elif defined( ENVMAP_TYPE_SPHERE )\nvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n#ifdef LOD_BLACK_LIST\nvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n#else\n#ifdef TEXTURE_LOD_EXT\nvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n#else\nvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n#endif\n#endif\nenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n#endif\nreturn envMapColor.rgb * envMapIntensity;\n}\n#endif\n\n\n\n#include <fog_pars_fragment>\n#ifdef USE_3D_NOISE\n\tvec3 random3(vec3 c) {\n\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\tvec3 r;\n\t\tr.z = fract(512.0*j);\n\t\tj *= .125;\n\t\tr.x = fract(512.0*j);\n\t\tj *= .125;\n\t\tr.y = fract(512.0*j);\n\t\treturn r-0.5;\n\t}\n\n\tconst float F3 =  0.3333333;\n\tconst float G3 =  0.1666667;\n\tfloat snoise(vec3 p) {\n\t\tvec3 s = floor(p + dot(p, vec3(F3)));\n\t\tvec3 x = p - s + dot(s, vec3(G3));\n\t\t\n\t\tvec3 e = step(vec3(0.0), x - x.yzx);\n\t\tvec3 i1 = e*(1.0 - e.zxy);\n\t\tvec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\n\t\tvec3 x1 = x - i1 + G3;\n\t\tvec3 x2 = x - i2 + 2.0*G3;\n\t\tvec3 x3 = x - 1.0 + 3.0*G3;\n\n\t\tvec4 w = vec4(dot(x, x), dot(x1, x1), dot(x2, x2), dot(x3, x3));\t\t\n\t\tw = max(0.6 - w, 0.0);\n\t\tw = w*w*w;\n\n\t\tvec4 d = vec4(dot(random3(s), x), dot(random3(s + i1), x1), dot(random3(s + i2), x2), dot(random3(s + 1.0), x3)) * w;\n\t\treturn dot(d, vec4(52.0));\n\t}\n#endif\n\n#ifdef USE_3D_NOISE_F999\n\tvec3 noise(vec3 m) { return vec3(0); }\n#endif\n\n#ifdef USE_3D_NOISE_F0\n\tvec3 noise(vec3 m) {\n\t\tvec3 i, n;\n\t\ti = m.xzx + m.y;\n\t\tn.x = snoise(i);\n\t\ti = m.yzy + m.x;\n\t\tn.y = snoise(i);\n\t\ti = m.zxy;\n\t\tn.z = snoise(i);\n\t\treturn normalize(n);\n\t}\n#endif\n\n#ifdef USE_3D_NOISE_F1\n\tvec3 noise(vec3 m) {\n\t\tvec3 i = m;\n\t\tm.x = snoise(i);\n\t\ti = vec3(m.yzx);\n\t\tm.y = snoise(i);\n\t\tm.z = cos(m.z*5.0);\n\t\treturn normalize(m);\n\t}\n#endif\n\n#ifdef USE_3D_NOISE_F2\n\tvec3 noise(vec3 m) {\n\t\tm.x = 0.3333333* cos(m.z);\n\t\tm.y = 0.3333333* sin(m.z)+snoise(vec3(m.z));\n\t\tm.z = 0.3333333* cos(m.z*5.0);\n\t\treturn normalize(m);\n\t}\n#endif\n\n#ifdef USE_3D_NOISE_F3\n\tvec3 noise(vec3 m) {\n\t\tvec3 i = vec3( m.z);\n\t\tm.x = 0.1333333* snoise(4.0*i);\n\t\ti = vec3(m.yzx);\n\t\tm.y = 0.05333333* snoise(4.0*i);\n\t\ti = vec3(m.zxy);\n\t\tm.z = 0.1333333* snoise(4.0*i);\n\t\treturn normalize(m);\n\t}\n#endif\n\n\n\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\nuniform float lightWorldSize;\nuniform float lightFrustum;\n\n#if defined(USE_SHADOWMAP)\n#ifdef USE_PCSS_SHADOW\n#define softShadowSamples 20\n#define near 25.0\nvec2 poissonDisk[softShadowSamples];\n\nvoid initPoissonSamples(const in vec2 randomSeed) {\nfloat angleStep = PI2 * 11.0/float(softShadowSamples);\nfloat angle = rand(randomSeed) * PI2;\nfloat radius = 1.0/float(softShadowSamples);\n\nfor(int i = 0; i < softShadowSamples; i ++) {\npoissonDisk[i] = vec2(cos(angle), sin(angle)) * pow(radius, 0.75);\nradius += 1.0/float(softShadowSamples);\nangle += angleStep;\n}\n}\n\nfloat penumbraSize(const in float zReceiver, const in float zBlocker) {\nreturn (zReceiver - zBlocker)/zBlocker;\n}\n\nfloat findBlocker(sampler2D shadowMap, const in vec2 uv, const in float zReceiver) {\nfloat searchRadius = (lightWorldSize/lightFrustum) * (zReceiver - near)/zReceiver;\nfloat blockerDepthSum = 0.0;\nint numBlockers = 0;\n\nfor(int i = 0; i < softShadowSamples; i++) {\nfloat shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\nif (shadowMapDepth < zReceiver) {\nblockerDepthSum += shadowMapDepth;\nnumBlockers ++;\n}\n}\n\nif(numBlockers == 0) return -1.0;\nreturn blockerDepthSum/float(numBlockers);\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius) {\nfloat sum = 0.0;\nfor(int i = 0; i < softShadowSamples; i ++) {\nfloat depth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[ i ] * filterRadius));\nif(zReceiver <= depth) sum += 1.0;\n}\nfor(int i = 0; i < softShadowSamples; i ++) {\nfloat depth = unpackRGBAToDepth(texture2D(shadowMap, uv + -poissonDisk[ i ].yx * filterRadius));\nif(zReceiver <= depth) sum += 1.0;\n}\nreturn sum/(2.0 * float(softShadowSamples));\n}\n\nfloat PCSS (sampler2D shadowMap, vec4 coords) {\nvec2 uv = coords.xy;\nfloat zReceiver = coords.z;\n\ninitPoissonSamples(uv);\nfloat avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver);\n\nif(avgBlockerDepth == -1.0) return 1.0;\n\nfloat penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\nfloat filterRadius = penumbraRatio * (lightWorldSize/lightFrustum) * near/zReceiver;\n\nreturn PCF_Filter(shadowMap, uv, zReceiver, filterRadius);\n}\n#endif\n\n#if NUM_DIR_LIGHTS > 0\nuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\nvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n#endif\n\n\nfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\nreturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n}\nfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\nconst vec2 offset = vec2( 0.0, 1.0 );\nvec2 texelSize = vec2( 1.0 ) / size;\nvec2 centroidUV = floor( uv * size + 0.5 ) / size;\nfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\nfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\nfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\nfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\nvec2 f = fract( uv * size + 0.5 );\nfloat a = mix( lb, lt, f.y );\nfloat b = mix( rb, rt, f.y );\nfloat c = mix( a, b, f.x );\nreturn c;\n}\nfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\nshadowCoord.xyz /= shadowCoord.w;\nshadowCoord.z += shadowBias;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\n#if defined(USE_PCSS_SHADOW)\nreturn PCSS(shadowMap, shadowCoord);\n#elif defined( SHADOWMAP_TYPE_PCF )\nvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\nfloat dx0 = - texelSize.x * shadowRadius;\nfloat dy0 = - texelSize.y * shadowRadius;\nfloat dx1 = + texelSize.x * shadowRadius;\nfloat dy1 = + texelSize.y * shadowRadius;\nreturn (\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\ntexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n) * ( 1.0 / 9.0 );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\nfloat dx0 = - texelSize.x * shadowRadius;\nfloat dy0 = - texelSize.y * shadowRadius;\nfloat dx1 = + texelSize.x * shadowRadius;\nfloat dy1 = + texelSize.y * shadowRadius;\nreturn (\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\ntexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n) * ( 1.0 / 9.0 );\n#else\nreturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n#endif\n}\nreturn 1.0;\n}\nvec2 cubeToUV( vec3 v, float texelSizeY ) {\nvec3 absV = abs( v );\nfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\nabsV *= scaleToCube;\nv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\nvec2 planar = v.xy;\nfloat almostATexel = 1.5 * texelSizeY;\nfloat almostOne = 1.0 - almostATexel;\nif ( absV.z >= almostOne ) {\nif ( v.z > 0.0 )\nplanar.x = 4.0 - v.x;\n} else if ( absV.x >= almostOne ) {\nfloat signX = sign( v.x );\nplanar.x = v.z * signX + 2.0 * signX;\n} else if ( absV.y >= almostOne ) {\nfloat signY = sign( v.y );\nplanar.x = v.x + 2.0 * signY + 2.0;\nplanar.y = v.z * signY - 2.0;\n}\nreturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n}\nfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\nvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\nvec3 lightToPosition = shadowCoord.xyz;\nvec3 bd3D = normalize( lightToPosition );\nfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\nvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\nreturn (\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\ntexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n) * ( 1.0 / 9.0 );\n#else\nreturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n#endif\n}\n#endif\n\n\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUvBumpMap );\nvec2 dSTdy = dFdy( vUvBumpMap );\nfloat Hll = bumpScale * texture2D( bumpMap, vUvBumpMap ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUvBumpMap + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUvBumpMap + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\nvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n\n\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\nvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\nvec2 st0 = dFdx( vUvNormalMap.st );\nvec2 st1 = dFdy( vUvNormalMap.st );\nvec3 S = normalize( q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUvNormalMap ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif\n\n\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n#ifdef USE_COLOR\ndiffuseColor.rgb = vColor;\n#endif\n\n\n\n#if NUM_ADD_MAPS > 0\nvec4 texelColorAdd = texture2D( additionalMaps0, (uvTransformAddMap[0] * vec3(vUvOriginal, 1.0)).xy);\ntexelColorAdd = mapTexelToLinear( texelColorAdd );\n\nif(mapPropertyType[0] == 0){\ndiffuseColor = texelColorAdd.a * vec4(texelColorAdd.rgb, 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}else if(mapPropertyType[0] == 1){\ndiffuseColor = texelColorAdd.a * vec4(mapPropertyColor[0], 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}\n#endif\n#if NUM_ADD_MAPS > 1\n\ntexelColorAdd = texture2D( additionalMaps1, (uvTransformAddMap[1] * vec3(vUvOriginal, 1.0)).xy);\ntexelColorAdd = mapTexelToLinear( texelColorAdd );\n\nif(mapPropertyType[1] == 0){\ndiffuseColor = texelColorAdd.a * vec4(texelColorAdd.rgb, 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}else if(mapPropertyType[1] == 1){\ndiffuseColor = texelColorAdd.a * vec4(mapPropertyColor[1], 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}\n\n#endif\n#if NUM_ADD_MAPS > 2\n\ntexelColorAdd = texture2D( additionalMaps2, (uvTransformAddMap[2] * vec3(vUvOriginal, 1.0)).xy);\ntexelColorAdd = mapTexelToLinear( texelColorAdd );\n\nif(mapPropertyType[2] == 0){\ndiffuseColor = texelColorAdd.a * vec4(texelColorAdd.rgb, 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}else if(mapPropertyType[2] == 1){\ndiffuseColor = texelColorAdd.a * vec4(mapPropertyColor[2], 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}\n\n#endif\n#if NUM_ADD_MAPS > 3\n\ntexelColorAdd = texture2D( additionalMaps3, (uvTransformAddMap[3] * vec3(vUvOriginal, 1.0)).xy);\ntexelColorAdd = mapTexelToLinear( texelColorAdd );\n\nif(mapPropertyType[3] == 0){\ndiffuseColor = texelColorAdd.a * vec4(texelColorAdd.rgb, 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}else if(mapPropertyType[3] == 1){\ndiffuseColor = texelColorAdd.a * vec4(mapPropertyColor[3], 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}\n\n#endif\n#if NUM_ADD_MAPS > 4\n\ntexelColorAdd = texture2D( additionalMaps4, (uvTransformAddMap[4] * vec3(vUvOriginal, 1.0)).xy);\ntexelColorAdd = mapTexelToLinear( texelColorAdd );\n\nif(mapPropertyType[4] == 0){\ndiffuseColor = texelColorAdd.a * vec4(texelColorAdd.rgb, 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}else if(mapPropertyType[4] == 1){\ndiffuseColor = texelColorAdd.a * vec4(mapPropertyColor[4], 1.0) + (1.0 - texelColorAdd.a) * diffuseColor;\n}\n\n#endif\n\n#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUvMap );\ntexelColor = mapTexelToLinear( texelColor );\n\ndiffuseColor *= texelColor;\n#endif\n\n\n#ifdef USE_ALPHAMAP\ndiffuseColor.a *= texture2D( alphaMap, vUvAlphaMap ).g;\n#endif\n\n\n\t#include <alphatest_fragment>\nfloat roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n#ifdef USE_RGBMAP\nvec4 texelRoughness = texture2D( rgbMap, vUvRoughnessMap );\n#else\nvec4 texelRoughness = texture2D( roughnessMap, vUvRoughnessMap );\n#endif\nroughnessFactor *= texelRoughness.g;\n#endif\n\n\nfloat metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n#ifdef USE_RGBMAP\nvec4 texelMetalness = texture2D( rgbMap, vUvMetalnessMap );\n#else\nvec4 texelMetalness = texture2D( metalnessMap, vUvMetalnessMap );\n#endif\nmetalnessFactor *= texelMetalness.b;\n#endif\n\n\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n#ifdef USE_3D_NOISE\nvec3 threeDNoise = noise(worldPos.xyz / threeDNoiseScale);\nfloat op = threeDNoiseOpacity * (1.0 / (1.0 + vViewPosition.z * threeDNoiseDistanceFade));\nfloat dotP = dot(normal, threeDNoise);\nif(dotP < 0.0) threeDNoise *= -1.0;\n\ndotP = abs(dotP);\n\nnormal = (1.0 - op) * normal + op * threeDNoise;\nroughnessFactor += ((1.0 - roughnessFactor) * (1.0 - dotP)) * op;\nmetalnessFactor *= (1.0 - dotP * op);\n\nthreeDAmbient = min(1.0, (1.0 - op) + dotP * op);\ndiffuseColor.rgb *= min(1.0, (1.0 - op) + dotP * op);\n#endif\n\n\n\t#include <lights_physical_fragment>\n\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\nfloat invShadowAmount;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t// #ifdef USE_SHADOWMAP\n\t        // directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t// #endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t//#ifdef USE_SHADOWMAP\n\t\t//#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\ninvShadowAmount = all(bvec2(directionalLight.shadow, directLight.visible)) ? getShadow(directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ]) : 1.0;\ndirectLight.color *= min((invShadowAmount + (1.0 - shadowOpacity)), 1.0);\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n\n\n\n#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#else\nvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\nreflectVec = inverseTransformDirection( reflectVec, viewMatrix );\nradiance += (vec3((reflectVec.z + 1.0) / 2.0) + 0.5) / 1.5;\n#endif\n\n\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\n\t#ifdef USE_3D_NOISE\n\t\treflectedLight.indirectDiffuse *= threeDAmbient;\n#endif\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular * lightReflectivity + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.standard_vert="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nvarying vec4 worldPos;\n#include <common>\n#if defined( USE_MAP )\nvarying vec2 vUvMap;\nuniform mat3 uvTransformMap;\n#endif\n#if defined( USE_BUMPMAP )\nvarying vec2 vUvBumpMap;\nuniform mat3 uvTransformBumpMap;\n#endif\n#if defined( USE_NORMALMAP )\nvarying vec2 vUvNormalMap;\nuniform mat3 uvTransformNormalMap;\n#endif\n#if defined( USE_SPECULARMAP )\nvarying vec2 vUvSpecularMap;\nuniform mat3 uvTransformSpecularMap;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlphaMap;\nuniform mat3 uvTransformAlphaMap;\n#endif\n#if defined( USE_EMISSIVEMAP )\nvarying vec2 vUvEmissiveMap;\nuniform mat3 uvTransformEmissiveMap;\n#endif\n#if defined( USE_ROUGHNESSMAP )\nvarying vec2 vUvRoughnessMap;\nuniform mat3 uvTransformRoughnessMap;\n#endif\n#if defined( USE_METALNESSMAP )\nvarying vec2 vUvMetalnessMap;\nuniform mat3 uvTransformMetalnessMap;\n#endif\n\n#if NUM_ADD_MAPS > 0\nvarying vec2 vUvOriginal;\nuniform int mapsSize;\n#endif\n\n\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t// #if NUM_SPOT_LIGHTS > 0\n\t// \tuniform mat4 spotShadowMatrix[ 0 ];\n\t// \tvarying vec4 vSpotShadowCoord[ 0 ];\n\t// #endif\n\t// #if NUM_POINT_LIGHTS > 0\n\t// \tuniform mat4 pointShadowMatrix[ 0 ];\n\t// \tvarying vec4 vPointShadowCoord[ 0 ];\n\t// #endif\n#endif\n\n\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n#if defined( USE_MAP )\n\tvUvMap = (uvTransformMap * vec3(uv, 1)).xy;\n#endif\n#if defined( USE_BUMPMAP )\nvUvBumpMap = (uvTransformBumpMap * vec3(uv, 1)).xy;\n#endif\n#if defined( USE_NORMALMAP )\nvUvNormalMap = (uvTransformNormalMap * vec3(uv, 1)).xy;\n#endif\n#if defined( USE_SPECULARMAP )\n\tvUvSpecularMap = (uvTransformSpecularMap * vec3(uv, 1)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\n\tvUvAlphaMap = (uvTransformAlphaMap * vec3(uv, 1)).xy;\n#endif\n#if defined( USE_EMISSIVEMAP )\n\tvUvEmissiveMap = (uvTransformEmissiveMap * vec3(uv, 1)).xy;\n#endif\n#if defined( USE_ROUGHNESSMAP )\n\tvUvRoughnessMap = (uvTransformRoughnessMap * vec3(uv, 1)).xy;\n#endif\n#if defined( USE_METALNESSMAP )\n\tvUvMetalnessMap = (uvTransformMetalnessMap * vec3(uv, 1)).xy;\n#endif\n\n#if NUM_ADD_MAPS > 0\n\tvUvOriginal = uv;\n#endif\n\n\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t// #if NUM_SPOT_LIGHTS > 0\n\t// #pragma unroll_loop\n\t// for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t// \tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t// }\n\t// #endif\n\t// #if NUM_POINT_LIGHTS > 0\n\t// #pragma unroll_loop\n\t// for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t// \tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t// }\n\t// #endif\n#endif\n\n\n\tworldPos = worldPosition;\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.world_z_frag="varying vec4 position_VS;\nuniform float far;\n\nfloat compress(float a){\nreturn a < 0.0 ? -a / (2.0 * far) : a / (2.0 * far) + .5;\n}\n\nvoid main() {\n\tgl_FragColor = vec4(1,1,1, compress(position_VS.z));\n}\n\n",module$src$3d$viewports$default$shaders$ShaderFile.default.world_z_vert="varying vec4 position_VS;\n\nvoid main() {\nposition_VS = modelMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n\n";var module$src$3d$viewports$default$materials$Reflector={},THREE$$module$src$3d$viewports$default$materials$Reflector=module$src$externals$three.default,Shaders$$module$src$3d$viewports$default$materials$Reflector=module$src$3d$viewports$default$shaders$ShaderFile.default;module$src$externals$three.default=module$src$externals$three.default,module$src$externals$three.default.Reflector=function(e,t){module$src$externals$three.default.Mesh.call(this,e),this.type="Reflector";var n=this;e=new module$src$externals$three.default.Color(void 0!==(t=t||{}).color?t.color:8355711);var r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,i=void 0!==t.recursion?t.recursion:0,s=new module$src$externals$three.default.Plane,l=new module$src$externals$three.default.Vector3,u=new module$src$externals$three.default.Vector3,c=new module$src$externals$three.default.Vector3,d=new module$src$externals$three.default.Matrix4,p=new module$src$externals$three.default.Vector3(0,0,-1),h=new module$src$externals$three.default.Vector4,m=new module$src$externals$three.default.Vector4,f=new module$src$externals$three.default.Vector3,g=new module$src$externals$three.default.Vector3,$=new module$src$externals$three.default.Vector4,v=new module$src$externals$three.default.Matrix4,y=new module$src$externals$three.default.PerspectiveCamera,_=new module$src$externals$three.default.WebGLRenderTarget(r,o,{minFilter:module$src$externals$three.default.LinearFilter,magFilter:module$src$externals$three.default.LinearFilter,format:module$src$externals$three.default.RGBFormat,stencilBuffer:!1});module$src$externals$three.default.Math.isPowerOfTwo(r)&&module$src$externals$three.default.Math.isPowerOfTwo(o)||(_.texture.generateMipmaps=!1),t={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},textureMatrix:{type:"m4",value:null},worldPosition:{type:"v3",value:new module$src$externals$three.default.Vector3(0,0,0)},far:{type:"f",value:1},threshold:{type:"f",value:100}},fragmentShader:module$src$3d$viewports$default$shaders$ShaderFile.default.refl_frag,vertexShader:module$src$3d$viewports$default$shaders$ShaderFile.default.refl_vert};var b=new module$src$externals$three.default.ShaderMaterial(t),x=new module$src$externals$three.default.ShaderMaterial({uniforms:{far:{type:"f",value:1}},vertexShader:module$src$3d$viewports$default$shaders$ShaderFile.default.world_z_vert,fragmentShader:module$src$3d$viewports$default$shaders$ShaderFile.default.world_z_frag}),w=new module$src$externals$three.default.WebGLRenderTarget(r,o,{minFilter:module$src$externals$three.default.NearestFilter,magFilter:module$src$externals$three.default.NearestFilter,format:module$src$externals$three.default.RGBAFormat,type:module$src$externals$three.default.FloatType});b.uniforms.tDiffuse.value=_.texture,b.uniforms.tDepth.value=w.texture,b.uniforms.color.value=e,b.uniforms.textureMatrix.value=v,b.uniforms.worldPosition.value=u,b.uniforms.threshold.value=n.threshold=.01,this.material=b,this.material.transparent=!0,this.onBeforeRender=function(e,t,r){if("recursion"in r.userData){if(r.userData.recursion===i)return;r.userData.recursion++}if(b.uniforms.threshold.value=n.threshold,x.uniforms.far.value=r.far,b.uniforms.far.value=r.far,u.setFromMatrixPosition(n.matrixWorld),c.setFromMatrixPosition(r.matrixWorld),d.extractRotation(n.matrixWorld),l.set(0,0,1),l.applyMatrix4(d),f.subVectors(u,c),!(0<f.dot(l))){f.reflect(l).negate(),f.add(u),d.extractRotation(r.matrixWorld),p.set(0,0,-1),p.applyMatrix4(d),p.add(c),g.subVectors(u,p),g.reflect(l).negate(),g.add(u),y.position.copy(f),y.up.set(0,1,0),y.up.applyMatrix4(d),y.up.reflect(l),y.lookAt(g),y.far=r.far,y.updateMatrixWorld(),y.projectionMatrix.copy(r.projectionMatrix),y.userData.recursion=0,v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(y.projectionMatrix),v.multiply(y.matrixWorldInverse),v.multiply(n.matrixWorld),s.setFromNormalAndCoplanarPoint(l,u),s.applyMatrix4(y.matrixWorldInverse),h.set(s.normal.x,s.normal.y,s.normal.z,s.constant);var o=y.projectionMatrix;$.x=(Math.sign(h.x)+o.elements[8])/o.elements[0],$.y=(Math.sign(h.y)+o.elements[9])/o.elements[5],$.z=-1,$.w=(1+o.elements[10])/o.elements[14],h.multiplyScalar(2/h.dot($)),o.elements[2]=h.x,o.elements[6]=h.y,o.elements[10]=h.z+1-a,o.elements[14]=h.w,n.visible=!1,o=t.background,t.background=null;var S=e.getRenderTarget(),M=e.vr.enabled,E=e.shadowMap.autoUpdate,T=e.getClearColor().getHex(),C=e.getClearAlpha();e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,y,_,!0),e.setClearColor(16777215,1),t.overrideMaterial=x,e.render(t,y,w,!0),e.vr.enabled=M,e.shadowMap.autoUpdate=E,e.setClearColor(T,C),t.overrideMaterial=null,e.setRenderTarget(S),t.background=o,void 0!==(t=r.bounds)&&(r=e.getSize(),o=e.getPixelRatio(),m.x=t.x*r.width*o,m.y=t.y*r.height*o,m.z=t.z*r.width*o,m.w=t.w*r.height*o,e.state.viewport(m)),n.visible=!0}},this.getRenderTarget=function(){return _}},module$src$externals$three.default.Reflector.prototype=Object.create(module$src$externals$three.default.Mesh.prototype),module$src$externals$three.default.Reflector.prototype.constructor=module$src$externals$three.default.Reflector;var module$src$3d$viewports$default$passes$SSAAPass={},THREE$$module$src$3d$viewports$default$passes$SSAAPass=module$src$externals$three.default,Shaders$$module$src$3d$viewports$default$passes$SSAAPass=module$src$3d$viewports$default$shaders$ShaderFile.default;module$src$3d$viewports$default$passes$SSAAPass.default=function(e){var t=new module$src$externals$three.default.ShaderMaterial({uniforms:{tDiffuse:{value:null},opacity:{value:1}},attributes:["position","uv"],vertexShader:module$src$3d$viewports$default$shaders$ShaderFile.default.basic_vert,fragmentShader:module$src$3d$viewports$default$shaders$ShaderFile.default.copy_frag});t.premultipliedAlpha=!0,t.transparent=!0,t.blending=module$src$externals$three.default.AdditiveBlending,t.depthTest=!1,t.depthWrite=!1;var n=new module$src$externals$three.default.OrthographicCamera(-1,1,1,-1,0,1),r=new module$src$externals$three.default.Scene,o=new module$src$externals$three.default.Mesh(new module$src$externals$three.default.PlaneGeometry(2,2),t);o.frustumCulled=!1,r.add(o);var a=new module$src$externals$three.default.WebGLRenderTarget(e.width,e.height,{minFilter:module$src$externals$three.default.LinearFilter,magFilter:module$src$externals$three.default.LinearFilter,format:module$src$externals$three.default.RGBAFormat});a.texture.name="SSAAPass.sample";var i=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];this.render=function(e,s,l,u,c){(o=new module$src$externals$three.default.Mesh(new module$src$externals$three.default.PlaneGeometry(2,2),t)).frustumCulled=!1,r.children.length=0,r.add(o);var d=i[Math.max(0,Math.min(c,5))];c=e.autoClear,e.autoClear=!1;var p=e.getClearColor().getHex(),h=e.getClearAlpha(),m=1/d.length;t.uniforms.tDiffuse.value=a.texture,d.forEach((function(o,i){var c=m;l.setViewOffset&&l.setViewOffset(u.width,u.height,.0625*o[0],.0625*o[1],u.width,u.height),t.uniforms.opacity.value=c+=.03125*((i+.5)/d.length-.5),e.setClearColor(p,h),e.render(s,l,a,!0),0===i&&e.setClearColor(0,0),e.render(r,n,u,0===i)})),r.remove(o),o.geometry.dispose(),o=void 0,l.clearViewOffset&&l.clearViewOffset(),e.autoClear=c,e.setClearColor(p,h)},this.dispose=function(){a&&(a.dispose(),a=null)},this.setSize=function(e,t){a.setSize(e,t)}};var module$src$3d$viewports$default$passes$SaoPass={},THREE$$module$src$3d$viewports$default$passes$SaoPass=module$src$externals$three.default,Shaders$$module$src$3d$viewports$default$passes$SaoPass=module$src$3d$viewports$default$shaders$ShaderFile.default;module$src$3d$viewports$default$passes$SaoPass.default=function(e){function t(e,t){for(var n=[],r=0;r<=t;r++)n.push(Math.exp(-r*r/(2*e*e))/(Math.sqrt(2*Math.PI)*e));return n}var n=e.settings,r=new module$src$externals$three.default.MeshDepthMaterial;r.depthPacking=module$src$externals$three.default.RGBADepthPacking,r.blending=module$src$externals$three.default.NoBlending,r.side=module$src$externals$three.default.DoubleSide;var o=new module$src$externals$three.default.MeshNormalMaterial;o.blending=module$src$externals$three.default.NoBlending,o.side=module$src$externals$three.default.DoubleSide;var a=new module$src$externals$three.default.WebGLRenderTarget(e.width,e.height,{minFilter:module$src$externals$three.default.NearestFilter,magFilter:module$src$externals$three.default.NearestFilter,format:module$src$externals$three.default.RGBAFormat}),i=a.clone(),s=a.clone(),l=a.clone(),u={defines:{SAMPLES:n.getSetting("samples")},uniforms:{tDepth:{type:"t",value:null},tNormal:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},cameraProjectionMatrix:{type:"m4",value:new module$src$externals$three.default.Matrix4},cameraInverseProjectionMatrix:{type:"m4",value:new module$src$externals$three.default.Matrix4},scale:{type:"f",value:.1},kernelRadius:{type:"f",value:n.getSetting("kernelRadius")},size:{type:"v2",value:new module$src$externals$three.default.Vector2(e.width,e.height)},intensity:{type:"f",value:n.getSetting("intensity")}},attributes:["position","uv"],vertexShader:module$src$3d$viewports$default$shaders$ShaderFile.default.basic_vert,fragmentShader:module$src$3d$viewports$default$shaders$ShaderFile.default.sao_frag},c=new module$src$externals$three.default.ShaderMaterial(u);c.uniforms.tDepth.value=i.texture,c.uniforms.tNormal.value=s.texture,c.needsUpdate=!1,u={KERNEL_RADIUS:n.getSetting("kernelRadius")},e={tAO:{type:"t",value:null},tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},size:{type:"v2",value:new module$src$externals$three.default.Vector2(e.width,e.height)},sampleWeights:{type:"1fv",value:t(n.getSetting("standardDev"),n.getSetting("kernelRadius"))},orientation:{type:"i",value:0},cameraNear:{type:"f",value:10},cameraFar:{type:"f",value:1e3}};var d=module$src$3d$viewports$default$shaders$ShaderFile.default.basic_vert,p=module$src$3d$viewports$default$shaders$ShaderFile.default.blur_frag,h=new module$src$externals$three.default.ShaderMaterial({uniforms:module$src$externals$three.default.UniformsUtils.clone(e),defines:u,vertexShader:d,fragmentShader:p});h.uniforms.tAO.value=a.texture,h.uniforms.tDepth.value=i.texture,h.uniforms.orientation.value=0;var m=new module$src$externals$three.default.ShaderMaterial({uniforms:module$src$externals$three.default.UniformsUtils.clone(e),defines:u,vertexShader:d,fragmentShader:p});m.uniforms.tAO.value=l.texture,m.uniforms.tDepth.value=i.texture,m.uniforms.orientation.value=1;var f=new module$src$externals$three.default.OrthographicCamera(-1,1,1,-1,0,1),g=new module$src$externals$three.default.Scene,$=new module$src$externals$three.default.Mesh(new module$src$externals$three.default.PlaneGeometry(2,2),null);g.add($),this.render=function(e,t,n,u,d){!function(e){c.uniforms.cameraNear.value=e.near,c.uniforms.cameraFar.value=e.far,c.uniforms.cameraProjectionMatrix.value=e.projectionMatrix,c.uniforms.cameraInverseProjectionMatrix.value.getInverse(e.projectionMatrix,!0),h.uniforms.cameraNear.value=e.near,h.uniforms.cameraFar.value=e.far,m.uniforms.cameraNear.value=e.near,m.uniforms.cameraFar.value=e.far}(n),t.traverse((function(e){e.material&&!e.material.renderAO&&(e.wasItVisible=e.visible,e.visible=!1)})),m.uniforms.tDiffuse.value=u.texture,u=t.background,t.background=null;var p=e.getClearColor().getHex(),v=e.getClearAlpha();e.setClearColor(16777215),t.overrideMaterial=r,e.render(t,n,i,!0),e.setClearColor(7829503),t.overrideMaterial=o,e.render(t,n,s,!0),e.setClearColor(p,v),$.material=c,e.render(g,f,a,!0),$.material=h,e.render(g,f,l,!0),$.material=m,e.render(g,f,d,!0),t.overrideMaterial=null,t.background=u,t.traverse((function(e){e.material&&!e.material.renderAO&&(e.visible=e.wasItVisible)}))},n.registerHook("samples",(function(e){c.defines.samples=e,c.needsUpdate=!0})),n.registerHook("intensity",(function(e){c.uniforms.intensity.value=e})),n.registerHook("kernelRadius",(function(e){h.defines.KERNEL_RADIUS=e,m.defines.KERNEL_RADIUS=e,h.uniforms.sampleWeights.value=t(n.getSetting("standardDev"),e),m.uniforms.sampleWeights.value=t(n.getSetting("standardDev"),e),h.needsUpdate=!0,m.needsUpdate=!0})),n.registerHook("standardDev",(function(e){h.uniforms.sampleWeights.value=t(e,n.getSetting("kernelRadius")),m.uniforms.sampleWeights.value=t(e,n.getSetting("kernelRadius"))})),this.setSize=function(e,t){c.uniforms.size.value.set(e,t),h.uniforms.size.value.set(e,t),m.uniforms.size.value.set(e,t),a.setSize(e,t),i.setSize(e,t),s.setSize(e,t),l.setSize(e,t)}};var module$src$3d$viewports$default$handlers$BeautyRenderHandler={default:function(e,t){var n,r,o,a,i,s,l,u,c,d,p,h,m,f=e.settings,g=e.scene,$=e.renderer,v=$.getPixelRatio(),y=$.getSize().width*v,_=$.getSize().height*v,b=!1,x=!1,w=0;return(v=function(){n=this,/(android)/i.test(navigator.userAgent)&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&(b=!0),x=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,r=new module$src$3d$viewports$default$passes$SSAAPass.default({width:y,height:_}),o=new module$src$3d$viewports$default$passes$SaoPass.default({settings:f.getSection("sao"),width:y,height:_}),(a=new module$src$externals$three.default.WebGLRenderTarget(y,_,{minFilter:module$src$externals$three.default.LinearFilter,magFilter:module$src$externals$three.default.LinearFilter,format:module$src$externals$three.default.RGBAFormat,stencilBuffer:!1})).texture.name="hidden.rt",(i=a.clone()).texture.name="standard.rt",(s=a.clone()).texture.name="ssaa.rt",(l=a.clone()).texture.name="ao.rt",(u=new module$src$externals$three.default.ShaderMaterial({uniforms:{tStandard:{value:null},tBeauty:{value:null},size:{type:"v2",value:new module$src$externals$three.default.Vector2(512,512)},amount:{type:"f",value:0}},attributes:["position","uv"],vertexShader:module$src$3d$viewports$default$shaders$ShaderFile.default.basic_vert,fragmentShader:module$src$3d$viewports$default$shaders$ShaderFile.default.blend_frag})).uniforms.tStandard.value=i.texture,u.uniforms.tBeauty.value=s.texture,u.uniforms.size.value.set(y,_),u.uniforms.amount.value=0,p=new module$src$externals$three.default.OrthographicCamera(-1,1,1,-1,0,1),h=new module$src$externals$three.default.Scene,m=new module$src$externals$three.default.Mesh(new module$src$externals$three.default.PlaneGeometry(2,2),u),h.add(m)}).prototype._setToggleSoftShadows=function(e){for(var n=t.threeDManager.helpers.getMeshMaterialObjects(),r=t.threeDManager._getExchangeMeshMaterialObjects(),o=0,a=n.length;o<a;o++){var i=n[o].mesh,s=n[o].material,l=void 0;if("ShapeDiverStandardMaterial"===s.type&&i.geometry&&"TextGeometry"!==i.geometry.type){for(var u=-1,c=0,d=r.length;c<d;c++)if(r[c].mesh===i){u=c,l=r[c].material;break}if(-1===u&&((l=t.materialHandler.getMaterial()).deepCopy(s),l.defines.USE_PCSS_SHADOW="",l.softShadow=!0,u=r.length,r.push({mesh:i,material:l})),s.softShadow!==e){for(var p in n[o].material=l,r[u].material=s,i.material=l,s)"uuid"!==p&&"defines"!==p&&"vertexShader"!==p&&"fragmentShader"!==p&&"softShadow"!==p&&i.material[p]!==s[p]&&(i.material[p]=s[p]);for(var h in i.material.defines)"USE_PCSS_SHADOW"===h||i.material.defines[h]&&s.defines[h]||(delete i.material.defines[h],i.material.needsUpdate=!0);for(var m in s.defines)"USE_PCSS_SHADOW"===m||i.material.defines[m]&&s.defines[m]||(i.material.defines[m]=s.defines[m],i.material.needsUpdate=!0)}}}},v.prototype._startBlending=function(e,r){t.renderingHandler.registerForContinuousRendering("beautyRenderBlending",!1),c=performance.now(),w=0,u.uniforms.tStandard.value=e.texture,u.uniforms.tBeauty.value=r.texture,f.getSetting("shadows")&&n._setToggleSoftShadows(!1),$.render(g,t.cameraHandler.getCamera(),a,!0)},v.prototype.renderStandard=function(){$.render(g,t.cameraHandler.getCamera())},v.prototype.beautyRenderingActive=function(){var e=f.getSetting("shadows");return f.getSetting("ambientOcclusion")&&!x||e},v.prototype.renderBeauty=function(){var e=f.getSetting("shadows"),u=f.getSetting("ambientOcclusion");$.render(g,t.cameraHandler.getCamera()),r.render($,g,t.cameraHandler.getCamera(),i,2),e&&n._setToggleSoftShadows(!0),u&&!x?(e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.GENERIC),t.threeDManager.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_RENDER_BEAUTY_START,e),r.render($,g,t.cameraHandler.getCamera(),s,2),o.render($,g,t.cameraHandler.getCamera(),s,l),$.render(g,t.cameraHandler.getCamera(),a,!0),n._startBlending(i,l)):e?(e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.GENERIC),t.threeDManager.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_RENDER_BEAUTY_START,e),r.render($,g,t.cameraHandler.getCamera(),s,2),$.render(g,t.cameraHandler.getCamera(),a,!0),n._startBlending(i,s)):$.render(g,t.cameraHandler.getCamera())},v.prototype.renderBlending=function(){u.uniforms.amount.value=w,$.render(h,p,null,!0);var e=((d=performance.now())-c)/1e3;c=d,1<=(w+=Math.min(e/1.5,.1))&&(w=0,t.renderingHandler.unregisterForContinuousRendering("beautyRenderBlending"),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.GENERIC),t.threeDManager.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_RENDER_BEAUTY_END,e))},v.prototype.renderHidden=function(){t.threeDManager&&t.cameraHandler&&t.cameraHandler.getCamera()&&(t.threeDManager.helpers.toggleViewport(!0),$.render(g,t.cameraHandler.getCamera(),a),t.threeDManager.helpers.toggleViewport(!1))},v.prototype.updateCustomUniforms=function(){g.traverse((function(e){if(e.material)if("ShapeDiverStandardMaterial"===e.material.type){if(e.material.uniforms.lightWorldSize.value=e.material.lightWorldSize,e.material.uniforms.lightFrustum.value=e.material.lightFrustum,e.material.uniforms.shadowOpacity.value=e.material.shadowOpacity,e.material.uniforms.lightReflectivity.value=e.material.lightReflectivity,e.material.uniforms.rgbMap.value=e.material.rgbMap,e.material.uniforms.threeDNoiseOpacity.value=e.material.threeDNoiseOpacity,e.material.uniforms.threeDNoiseID.value=e.material.threeDNoiseID,e.material.uniforms.threeDNoiseScale.value=e.material.threeDNoiseScale,e.material.uniforms.threeDNoiseDistanceFade.value=e.material.threeDNoiseDistanceFade,0<e.material.threeDNoiseOpacity&&""!==e.material.defines["USE_3D_NOISE_F"+e.material.threeDNoiseID]&&(0<=e.material.threeDNoiseID&&3>=e.material.threeDNoiseID||999===e.material.threeDNoiseID)){for(var t in e.material.defines)0===t.indexOf("USE_3D_NOISE_F")&&delete e.material.defines[t];e.material.defines["USE_3D_NOISE_F"+e.material.threeDNoiseID]="",e.material.needsUpdate=!0}if(0<e.material.threeDNoiseOpacity&&""!==e.material.defines.USE_3D_NOISE)e.material.defines.USE_3D_NOISE="",e.material.needsUpdate=!0,-1===e.material.threeDNoiseID&&(e.material.threeDNoiseID=0,e.material.uniforms.threeDNoiseID.value=e.material.threeDNoiseID,e.material.defines.USE_3D_NOISE_F0="");else if(0>=e.material.threeDNoiseOpacity&&""===e.material.defines.USE_3D_NOISE){for(var n in e.material.defines)0===n.indexOf("USE_3D_NOISE_F")&&delete e.material.defines[n];delete e.material.defines.USE_3D_NOISE,e.material.needsUpdate=!0}if(e.material.map&&(e.material.uniforms.uvTransformMap.value=e.material.map.uvTransform,e.material.map.matrix.identity()),e.material.specularMap&&(e.material.uniforms.uvTransformSpecularMap.value=e.material.specularMap.uvTransform,e.material.specularMap.matrix.identity()),e.material.normalMap&&(e.material.uniforms.uvTransformNormalMap.value=e.material.normalMap.uvTransform,e.material.normalMap.matrix.identity()),e.material.bumpMap&&(e.material.uniforms.uvTransformBumpMap.value=e.material.bumpMap.uvTransform,e.material.bumpMap.matrix.identity()),e.material.roughnessMap&&(e.material.uniforms.uvTransformRoughnessMap.value=e.material.roughnessMap.uvTransform,e.material.roughnessMap.matrix=new module$src$externals$three.default.Matrix3),e.material.metalnessMap&&(e.material.uniforms.uvTransformMetalnessMap.value=e.material.metalnessMap.uvTransform,e.material.metalnessMap.matrix=new module$src$externals$three.default.Matrix3),e.material.alphaMap&&(e.material.uniforms.uvTransformAlphaMap.value=e.material.alphaMap.uvTransform,e.material.alphaMap.matrix.identity()),e.material.emissiveMap&&(e.material.uniforms.uvTransformEmissiveMap.value=e.material.emissiveMap.uvTransform,e.material.emissiveMap.matrix.identity()),0!==e.material.mapsSize){for(e.material.uniforms.mapsSize.value=e.material.mapsSize,0<e.material.mapsSize&&e.material.defines.NUM_ADD_MAPS!==e.material.mapsSize&&(e.material.defines.NUM_ADD_MAPS=e.material.mapsSize,e.material.needsUpdate=!0);5>e.material.mapPropertyType.length;)e.material.mapPropertyType.push(-1);for(;5>e.material.mapPropertyColor.length;)e.material.mapPropertyColor.push(new module$src$externals$three.default.Color(0));for(;5>e.material.uvTransformAddMap.length;)e.material.uvTransformAddMap.push((new module$src$externals$three.default.Matrix3).identity());for(e.material.uniforms.mapPropertyType.value=e.material.mapPropertyType,e.material.uniforms.mapPropertyColor.value=e.material.mapPropertyColor,e.material.uniforms.uvTransformAddMap.value=e.material.uvTransformAddMap,t=0,n=e.material.mapsSize;t<n;t++)0===t&&(e.material.uniforms.additionalMaps0.value=e.material.additionalMaps0),1===t&&(e.material.uniforms.additionalMaps1.value=e.material.additionalMaps1),2===t&&(e.material.uniforms.additionalMaps2.value=e.material.additionalMaps2),3===t&&(e.material.uniforms.additionalMaps3.value=e.material.additionalMaps3),4===t&&(e.material.uniforms.additionalMaps4.value=e.material.additionalMaps4)}else e.material.uniforms.mapsSize.value=0,0!==e.material.defines.NUM_ADD_MAPS&&(e.material.defines.NUM_ADD_MAPS=0,e.material.needsUpdate=!0);b&&""!==e.material.defines.LOD_BLACK_LIST&&(e.material.defines.LOD_BLACK_LIST="",e.material.needsUpdate=!0)}else"ShapeDiverGemMaterial"===e.material.type&&(e.material.uniforms.refractionIndex.value=e.material.refractionIndex,e.material.uniforms.center.value=e.material.center,e.material.uniforms.radius.value=e.material.radius,e.material.uniforms.sphericalNormalMap.value=e.material.sphericalNormalMap,e.material.uniforms.dispersion.value=e.material.dispersion,e.material.uniforms.contrast.value=e.material.contrast,e.material.uniforms.gamma.value=e.material.gamma,e.material.uniforms.brightness.value=e.material.brightness,e.material.uniforms.tracingOpacity.value=e.material.tracingOpacity,e.material.uniforms.impurityMap.value=e.material.impurityMap,e.material.uniforms.impurityScale.value=e.material.impurityScale,e.material.uniforms.colorTransferBegin.value=e.material.colorTransferBegin,e.material.uniforms.colorTransferEnd.value=e.material.colorTransferEnd,e.material.inverseModelMatrix=(new module$src$externals$three.default.Matrix4).getInverse(e.matrixWorld),e.material.uniforms.inverseModelMatrix.value=e.material.inverseModelMatrix,e.material.inverseTransposeModelMatrix=(new module$src$externals$three.default.Matrix3).getNormalMatrix((new module$src$externals$three.default.Matrix4).getInverse(e.matrixWorld).transpose()),e.material.uniforms.inverseTransposeModelMatrix.value=e.material.inverseTransposeModelMatrix,e.material.defines.DEPTH!=e.material.depth&&(e.material.defines.DEPTH=e.material.depth,e.material.needsUpdate=!0),""===e.material.defines.DISPERSION&&0===e.material.dispersion&&(delete e.material.defines.DISPERSION,e.material.needsUpdate=!0),""!==e.material.defines.DISPERSION&&0!==e.material.dispersion&&(e.material.defines.DISPERSION="",e.material.needsUpdate=!0),""===e.material.defines.USE_IMPURITY_MAP&&null===e.material.impurityMap&&(delete e.material.defines.USE_IMPURITY_MAP,e.material.needsUpdate=!0),""!==e.material.defines.USE_IMPURITY_MAP&&null!==e.material.impurityMap&&(e.material.defines.USE_IMPURITY_MAP="",e.material.needsUpdate=!0))}))},v.prototype.setSize=function(e,t){var n=$.getPixelRatio();o.setSize(e*=n,t*=n),r.setSize(e,t),a.setSize(e,t),i.setSize(e,t),s.setSize(e,t),l.setSize(e,t),u.uniforms.size.value.set(e,t)},new v(e)}},module$src$3d$viewports$default$handlers$RenderingHandler={default:function(e,t){var n,r,o,a=e.settings,i=e.scene,s=e.geometryNode,l=e.container,u=[],c=l.offsetWidth,d=l.offsetHeight,p=-1,h=null,m=!1,f=!1,g=-1,$=null,v=null,y=!0,_=!1,b=!1,x=function(e,t,r){t!==r&&n.render()},w=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"RenderingHandler.Hook->shadows")&&(t.lightHandler.setToggleLightShadows(e),!0)},S=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"RenderingHandler.Hook->ambientOcclusion")},M=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color",t.threeDManager.warn,"RenderingHandler.Hook->clearColor")&&(e=(0,module$src$shared$util$toTinyColor.default)(e),null!==v?o.setClearColor(e.toThreeColor(),v):o.setClearColor(e.toThreeColor()),n.render(),!0)},E=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"RenderingHandler.Hook->clearAlpha")&&(v=e,o.setClearAlpha(e),n.render(),!0)},T=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"RenderingHandler.Hook->pointSize")&&(i.traverse((function(t){t.hasOwnProperty("material")&&t instanceof module$src$externals$three.default.Points&&(t.material.size=e)})),n.render(),!0)},C=function(){module$src$3d$interfaces$handlers$RenderingHandlerInterface.default.call(this),n=this;var e=(r=new module$src$3d$helpers$handlers$RenderingHandlerHelpers.default(t)).createWebGLRenderer(l,{antialias:!0,alpha:!0,preserveDrawingBuffer:!0});if(t.threeDManager.success=e.success,r.handleCreateWebGLRendererResponse("RenderingHandler",e,"WebGL context was created","WebGL context could not be created"),!1===e.success)return null;(o=e.renderer).setPixelRatio(window.devicePixelRatio),o.setSize(c,d,!0),o.setClearColor((0,module$src$shared$util$toTinyColor.default)(a.getSetting("clearColor"),"white").toThreeColor(),a.getSetting("clearAlpha")),o.shadowMap.enabled=!0,o.shadowMap.autoUpdate=!1,o.shadowMap.needsUpdate=!0,o.shadowMap.type=module$src$externals$three.default.PCFShadowMap,o.gammaFactor=1,o.gammaInput=!1,o.gammaOutput=!0,o.textureUnitCount=e.renderer.context.getParameter(e.renderer.context.MAX_TEXTURE_IMAGE_UNITS),o.textureUnitCount||(o.textureUnitCount=8),o.depth=!1,window.onresize=function(){-1===g&&n.registerForContinuousRendering("registeredResizeEvent"),clearTimeout(g),g=setTimeout((function(){g=-1,n.unregisterForContinuousRendering("registeredResizeEvent"),n.render()}),250)},t.beautyRenderHandler=new module$src$3d$viewports$default$handlers$BeautyRenderHandler.default({settings:a,scene:i,geometryNode:s,renderer:o},t),t.threeDManager.beautyRenderHandler=t.beautyRenderHandler,t.threeDManager.viewerApi.state.addEventListener(t.threeDManager.viewerApi.state.EVENTTYPE.BUSY,(function(){-1===u.indexOf("busyMode")&&n.registerForContinuousRendering("busyMode")})),t.threeDManager.viewerApi.state.addEventListener(t.threeDManager.viewerApi.state.EVENTTYPE.IDLE,(function(){n.unregisterForContinuousRendering("busyMode")})),a.registerNotifier("shadows",x),a.registerNotifier("ambientOcclusion",x),a.registerHook("shadows",w),a.registerHook("ambientOcclusion",S),a.registerHook("clearColor",M),a.registerHook("clearAlpha",E),a.registerHook("pointSize",T)};return $jscomp.inherits(C,module$src$3d$interfaces$handlers$RenderingHandlerInterface.default),C.prototype._resizeEvent=function(){n.registerForContinuousRendering("unregisteredResizeEvent",!1),setTimeout((function(){n.unregisterForContinuousRendering("unregisteredResizeEvent")}),100)},C.prototype._beforeRender=function(e){if(o.clear(),module$node_modules$$tweenjs$tween_js$src$Tween.default.update(e),t.cameraHandler.updateOrbitControls(),document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement){var r=!0;if("true"==o.domElement.getAttribute("sdv-fullscreen")||null==o.domElement.parentNode){e=screen.width;var a=screen.height}else e=o.domElement.parentNode.offsetWidth,a=o.domElement.parentNode.offsetHeight}else r=!1,e=o.domElement.parentNode.offsetWidth,a=o.domElement.parentNode.offsetHeight;e===c&&a===d&&!1===r||(n._resizeEvent(),o.setSize(c=e,d=a,!0),t.cameraHandler.onResize(c,d),t.beautyRenderHandler.setSize(c,d)),t.beautyRenderHandler.updateCustomUniforms(),!0!==m&&!0!==f||(m=!1,o.shadowMap.needsUpdate=!0)},C.prototype._getExtension=function(e){return o.extensions.get(e)},C.prototype._getTextureUnitCount=function(){return o.textureUnitCount},C.prototype.render=function(e){if(!1!==_&&t.threeDManager&&o.domElement&&!1!==t.threeDManager.getSetting("show")&&y){if(h&&(clearTimeout(h),h=null),!e){if(-1!==u.indexOf("beautyRenderBlending"))return n.unregisterForContinuousRendering("beautyRenderBlending"),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.GENERIC),void t.threeDManager.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_RENDER_BEAUTY_CANCEL,e);if(-1!==p)return}if(p=1===u.length&&-1!==u.indexOf("beautyRenderBlending")?2:0===u.length&&!0===b?1:0,b=!1,0===p&&-1!==u.indexOf("beautyRenderBlending")){n.unregisterForContinuousRendering("beautyRenderBlending");var s=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.GENERIC);t.threeDManager.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_RENDER_BEAUTY_CANCEL,s)}n._beforeRender(e),t.threeDManager.helpers.toggleViewport(!0,e),0==p?(t.beautyRenderHandler.renderStandard(),r.processAnchors(o,i,t.cameraHandler.getCamera(),t.threeDManager.helpers.getAnchors())):2==p?t.beautyRenderHandler.renderBlending():1==p&&t.beautyRenderHandler.renderBeauty(),t.threeDManager.helpers.toggleViewport(!1,e),0<u.length?requestAnimationFrame(n.render):(0===p&&t.beautyRenderHandler.beautyRenderingActive()&&(h=setTimeout((function(){b=!0,h=null,requestAnimationFrame(n.render)}),a.getSetting("beautyRenderDelay"))),p=-1)}},C.prototype.renderHidden=function(){t.beautyRenderHandler.renderHidden()},C.prototype.onResize=function(e,t){o.setSize(e,t)},C.prototype.getSize=function(){return o.getSize()},C.prototype.start=function(){_=!0},C.prototype.pause=function(){y=!1},C.prototype.resume=function(){y=!0},C.prototype.destroy=function(){o.dispose();try{o.forceContextLoss()}catch(e){}},C.prototype.getScreenshot=function(){return o.domElement.toDataURL("image/png")},C.prototype.getDomElement=function(){return o.domElement},C.prototype.getCanvas=function(){return o.context.canvas},C.prototype.getRendererInfo=function(){return o.info},C.prototype.setBlur=function(e,t){$=null!=t&&t.hasOwnProperty("duration")?($=$||Promise.resolve()).then((function(){var n={r:e?0:3};return new Promise((function(r){new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(n).to({r:e?3:1},t.duration).onUpdate((function(){o.domElement.style.filter="blur("+n.r+"px)"})).onComplete((function(){o.domElement.style.filter=e?"blur(3px)":"",r()})).start()}))})):($||Promise.resolve()).then((function(){o.domElement.style.filter=e?"blur(3px)":""}))},C.prototype.registerForContinuousRendering=function(e,t){void 0!==e&&(u.includes("cameraMoving")&&"cameraMoving"===e||u.push(e),!1!==t&&n.render())},C.prototype.unregisterForContinuousRendering=function(e){-1<(e=u.indexOf(e))&&u.splice(e,1)},C.prototype.containsContinuousRendering=function(e){return-1!==u.indexOf(e)},C.prototype.updateShadowMap=function(){m=!0},C.prototype.keepUpdatingShadowMap=function(){f=!0},C.prototype.stopUpdatingShadowMap=function(){f=!1},C.prototype.getRenderer=function(){return o},new C(e)}},module$src$shared$materials$MaterialPresetsDbFallback={default:{}};module$src$shared$materials$MaterialPresetsDbFallback.default["00"]={"00":{name:"Default material",color:[211,211,211,255],metalness:0,roughness:1},properties:{name:"Default materials"}},module$src$shared$materials$MaterialPresetsDbFallback.default["01"]={"01":{name:"Default groundplane material",color:[211,211,211,255],metalness:0,roughness:1},properties:{name:"Groundplane materials"}},module$src$shared$materials$MaterialPresetsDbFallback.default["02"]={"00":{name:"Default plastic material",color:[211,211,211,255],metalness:0,roughness:1,normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Plastic materials"}},module$src$shared$materials$MaterialPresetsDbFallback.default["03"]={10:{name:"Gold material",color:[230,207,92,255],roughness:0},11:{name:"Used gold material",color:[230,207,92,255],roughness:0,roughnesstexture:"roughnessMap.jpg"},21:{name:"Hammered metal material",color:[205,205,205,255],roughness:1,normaltexture:"normalMap.jpg"},"00":{name:"Default metal material",color:[205,205,205,255],roughness:.25},"01":{name:"Used metal material 1",color:[205,205,205,255],roughness:1,roughnesstexture:"roughnessMap.jpg"},"02":{name:"Used metal material 2",color:[205,205,205,255],roughness:1,roughnesstexture:"roughnessMap.jpg"},"03":{name:"Used metal material 3",color:[205,205,205,255],roughness:1,roughnesstexture:"roughnessMap.jpg"},properties:{name:"Metal materials",metalness:1}},module$src$shared$materials$MaterialPresetsDbFallback.default["04"]={"00":{name:"Default glass material",color:[211,211,211,255],metalness:1,roughness:0,transparency:.75},properties:{name:"Glass materials"}},module$src$shared$materials$MaterialPresetsDbFallback.default["05"]={10:{bitmaptexture:"map.jpg",name:"Natural oak material",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},11:{bitmaptexture:"map.jpg",name:"Premium oak material",roughnesstexture:"roughnessMap.jpg"},"00":{bitmaptexture:"map.jpg",name:"Default wood material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"01":{bitmaptexture:"map.jpg",name:"Wood floor material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Wood materials",color:[211,211,211,255],metalness:0,roughness:1}},module$src$shared$materials$MaterialPresetsDbFallback.default["06"]={10:{bitmaptexture:"map.jpg",name:"Worn leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"00":{bitmaptexture:"map.jpg",name:"Default leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"01":{bitmaptexture:"map.jpg",name:"Dark brown leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"02":{bitmaptexture:"map.jpg",name:"Black leather material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Leather materials",metalness:0,roughness:1}},module$src$shared$materials$MaterialPresetsDbFallback.default["07"]={"00":{bitmaptexture:"map.jpg",name:"Default fabric material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},"01":{bitmaptexture:"map.jpg",name:"Grey fabric material",metalnesstexture:"metalnessMap.jpg",normaltexture:"normalMap.jpg",roughnesstexture:"roughnessMap.jpg"},properties:{name:"Fabric materials",metalness:1,roughness:1}};var module$src$shared$materials$MaterialPresets={},GLOBAL_UTILS$$module$src$shared$materials$MaterialPresets=module$src$shared$util$GlobalUtils.default,AXIOS$$module$src$shared$materials$MaterialPresets=module$src$externals$axios.default,VIEWERAPPCONSTANTS$$module$src$shared$materials$MaterialPresets=module$src$app$ViewerAppConstants.default,TEXTURE_PATH$$module$src$shared$materials$MaterialPresets="https://viewer.shapediver.com/v2/materials/",MATERIAL_PRESETS_URL$$module$src$shared$materials$MaterialPresets="https://viewer.shapediver.com/v2/materials/db.json",MATERIAL_PRESETS_DB_FALLBACK$$module$src$shared$materials$MaterialPresets=module$src$shared$materials$MaterialPresetsDbFallback.default,RESOLUTIONS$$module$src$shared$materials$MaterialPresets=["256","512","1024","2048"],DEFAULTRESOLUTION$$module$src$shared$materials$MaterialPresets="1024",MaterialPresets$$module$src$shared$materials$MaterialPresets=function(){var e=this,t={},n=function(e){var t=/^\d+$/;Object.keys(e).forEach((function(n){Object.keys(e[n]).forEach((function(r){t.test(n)&&t.test(r)&&a(n,r,e[n],e[n][r])}))}))},r=module$src$externals$axios.default.get(MATERIAL_PRESETS_URL$$module$src$shared$materials$MaterialPresets).then((function(e){n(e.data)}),(function(){return fetch(MATERIAL_PRESETS_URL$$module$src$shared$materials$MaterialPresets).then((function(e){e=e.json(),n(e)}),(function(){n(module$src$shared$materials$MaterialPresetsDbFallback.default)}))})),o=function(e){return"string"!=typeof e&&(e=String(e)),e.padStart(2,"0").slice(0,2)},a=function(e,n,r,a){e=o(e),n=o(n);var i={};Object.keys(r.properties).forEach((function(e){i[e]=r.properties[e]})),Object.keys(a).forEach((function(e){i[e]=a[e]})),i.version=i.version||"2.0",t.hasOwnProperty(e)||(t[e]={}),t[e][n]={name:i.name,mat:i}};return e.hasMaterial=function(e,n){return e=o(e),n=o(n),!(!t.hasOwnProperty(e)||!t[e].hasOwnProperty(n))},e.getMaterial=function(e,n,r){e=o(e),n=o(n),r=r||DEFAULTRESOLUTION$$module$src$shared$materials$MaterialPresets;var a=module$src$shared$util$GlobalUtils.default.deepCopy(t[e][n].mat),i=TEXTURE_PATH$$module$src$shared$materials$MaterialPresets+r+"/"+e+"/"+n+"/";return"bitmap metalness roughness bump normal transparency".split(" ").forEach((function(e){a.hasOwnProperty(e+="texture")&&(a[e]=i+a[e])})),a},e.fromId=function(t){return new Promise((function(n,o){r.then((function(){var r;if("string"==typeof t){var o=t.split("@");t=o[0],1<o.length&&(r=o[1])}RESOLUTIONS$$module$src$shared$materials$MaterialPresets.includes(r)||(r=DEFAULTRESOLUTION$$module$src$shared$materials$MaterialPresets),100>(t=Number(t))&&0==t%10&&(t/=10),10>t&&(t*=100),o=Math.floor(t/100);var a=t-100*o;e.hasMaterial(o,a)?n(e.getMaterial(o,a,r)):e.hasMaterial(o,0)?n(e.getMaterial(o,0,r)):e.hasMaterial(0,0)?n(e.getMaterial(0,0,r)):n(module$src$app$ViewerAppConstants.default.defaultSettings.defaultMaterial)}),(function(e){o(e)}))}))},e};module$src$shared$materials$MaterialPresets.default=new MaterialPresets$$module$src$shared$materials$MaterialPresets;var module$src$shared$materials$MaterialPropertiesStandard={},THREE$$module$src$shared$materials$MaterialPropertiesStandard=module$src$externals$three.default,toTinyColor$$module$src$shared$materials$MaterialPropertiesStandard=module$src$shared$util$toTinyColor.default;module$src$shared$materials$MaterialPropertiesStandard.default=function(){this.alphaMap=null,this.additionalMaps=[],this.mapPropertyType=[],this.mapPropertyColor=[],this.uvTransformAddMap=[],this.bumpMap=null,this.bumpScale=1,this.color=(0,module$src$shared$util$toTinyColor.default)("ffffffff").toThreeColor(),this.flatShading=!1,this.lightReflectivity=1,this.line={type:"basic",lineWidth:1,dashSize:3,gapSize:1,scale:1},this.map=null,this.metalness=0,this.normalMap=this.metalnessMap=null,this.opacity=1,this.roughness=.5,this.roughnessMap=null,this.shadowOpacity=1,this.side=module$src$externals$three.default.DoubleSide,this.threeDNoiseID=this.threeDNoiseOpacity=0,this.threeDNoiseScale=1,this.threeDNoiseDistanceFade=0,this.transparent=!1},module$src$shared$materials$MaterialPropertiesStandard.default.prototype.clone=function(){return Object.assign({},this)};var module$src$shared$materials$MaterialPropertiesGem={},toTinyColor$$module$src$shared$materials$MaterialPropertiesGem=module$src$shared$util$toTinyColor.default;module$src$shared$materials$MaterialPropertiesGem.default=function(){var e=this;e.materialType="gem",e.colorTransferBegin=(0,module$src$shared$util$toTinyColor.default)("ffffffff").toThreeColor(),e.colorTransferEnd=(0,module$src$shared$util$toTinyColor.default)("ffffffff").toThreeColor(),e.environmentMap=null,e.impurityMap=null,e.impurityScale=1,e.opacity=1,e.tracingOpacity=1,e.depth=8,e.refractionIndex=2.4,e.dispersion=0,e.gamma=1,e.contrast=1,e.brightness=0,e.resolution=1024,e.clone=function(){var t=new module$src$shared$materials$MaterialPropertiesGem.default;return t.materialType="gem",t.colorTransferBegin=e.colorTransferBegin,t.colorTransferEnd=e.colorTransferEnd,t.environmentMap=e.environmentMap,t.impurityMap=e.impurityMap,t.impurityScale=e.impurityScale,t.opacity=e.opacity,t.tracingOpacity=e.tracingOpacity,t.depth=e.depth,t.refractionIndex=e.refractionIndex,t.dispersion=e.dispersion,t.gamma=e.gamma,t.contrast=e.contrast,t.brightness=e.brightness,t.resolution=e.resolution,t}};var module$src$shared$materials$MaterialParser={},THREE$$module$src$shared$materials$MaterialParser=module$src$externals$three.default,MATERIAL_PRESETS$$module$src$shared$materials$MaterialParser=module$src$shared$materials$MaterialPresets.default,toTinyColor$$module$src$shared$materials$MaterialParser=module$src$shared$util$toTinyColor.default,loadTexture$$module$src$shared$materials$MaterialParser=module$src$shared$singletons$TextureLoader.default.loadTexture,GlobalUtils$$module$src$shared$materials$MaterialParser=module$src$shared$util$GlobalUtils.default,MaterialPropertiesStandard$$module$src$shared$materials$MaterialParser=module$src$shared$materials$MaterialPropertiesStandard.default,MaterialPropertiesGem$$module$src$shared$materials$MaterialParser=module$src$shared$materials$MaterialPropertiesGem.default;module$src$shared$materials$MaterialParser.default=function(e){var t=function(t){if("string"==typeof t&&(t={href:t}),!t.hasOwnProperty("href")&&!t.hasOwnProperty("canvas"))return Promise.reject(Error("Input object is not a valid JSON texture definition."));var n={};return n.offset=t.offset||[0,0],n.repeat=t.repeat||[1,1],n.rotation=t.rotation||0,n.center=t.center||[0,0],n.color=t.color||null,(0,module$src$shared$singletons$TextureLoader.default.loadTexture)(t.href||t.canvas,n,e).then((function(e){if(n.color){var t=(0,module$src$shared$util$toTinyColor.default)(n.color);t&&t.isValid()&&(e.SDColor=t)}return e}),(function(e){return Promise.reject(e)}))},n=function(e,n){if(-1==["1.0","2.0","3.0"].indexOf(n))return Promise.reject(Error("Material definition has unknown version."));var r=new module$src$shared$materials$MaterialPropertiesStandard.default;"1.0"===n&&(null!=e.shine&&(e.metalness=Math.min(1,e.shine)),null!=e.shine&&(e.roughness=1-Math.min(1,e.shine)),e.hasOwnProperty("diffuse")&&!e.hasOwnProperty("color")&&(e.color=e.diffuse)),"metalness roughness alphaThreshold shadowOpacity lightReflectivity transparency bumpAmplitude".split(" ").forEach((function(t){if(e.hasOwnProperty(t)){var n=parseFloat(e[t]);if(!isNaN(n)&&isFinite(n))switch(t){case"transparency":r.opacity=1-n,r.transparent=0<n;break;case"bumpAmplitude":r.bumpScale=n;break;default:r[t]=n}}})),["color"].forEach((function(t){if(e.hasOwnProperty(t)){var n=(0,module$src$shared$util$toTinyColor.default)(e[t]);n&&n.isValid()&&(r[t]=n.toThreeColor())}})),e.hasOwnProperty("threeDNoise")&&(r.threeDNoiseOpacity=e.threeDNoise.opacity||0,r.threeDNoiseID=e.threeDNoise.noiseID||0,r.threeDNoiseScale=e.threeDNoise.scale||1,r.threeDNoiseDistanceFade=e.threeDNoise.distance||0),e.hasOwnProperty("line")&&(r.line.type=module$src$shared$util$GlobalUtils.default.typeCheck(e.line.type,"string")?e.line.type:"basic",r.line.lineWidth=module$src$shared$util$GlobalUtils.default.typeCheck(e.line.lineWidth,"notnegative")?e.line.lineWidth:1,r.line.dashSize=module$src$shared$util$GlobalUtils.default.typeCheck(e.line.dashSize,"notnegative")?e.line.dashSize:3,r.line.gapSize=module$src$shared$util$GlobalUtils.default.typeCheck(e.line.gapSize,"notnegative")?e.line.gapSize:1,r.line.scale=module$src$shared$util$GlobalUtils.default.typeCheck(e.line.scale,"notnegative")?e.line.scale:1);var o=[];if(e.hasOwnProperty("bitmaptexture"))if(Array.isArray(e.bitmaptexture)){if(0===e.bitmaptexture.length)return Promise.resolve(null);n=[];for(var a=$jscomp.makeIterator(e.bitmaptexture),i=a.next();!i.done;i=a.next())n.push(t(i.value));o.push(Promise.all(n).then((function(e){if(1<e.length){r.additionalMaps=[],r.mapPropertyType=[],r.mapPropertyColor=[],r.uvTransformAddMap=[];for(var t=1,n=e.length;t<n;++t){var o=e[t];r.additionalMaps.push(o),r.mapPropertyType.push(o.hasOwnProperty("SDColor")?1:0);var a=o.hasOwnProperty("SDColor")&&o.SDColor?o.SDColor.toThreeColor():new module$src$externals$three.default.Color;r.mapPropertyColor.push(a),r.uvTransformAddMap.push(o.uvTransform)}}return r.map=e[0]})))}else o.push(t(e.bitmaptexture).then((function(e){return r.map=e})));return["metalness","roughness","bump","normal","transparency"].forEach((function(n){e.hasOwnProperty(n+"texture")&&o.push(t(e[n+"texture"]).then((function(e){"transparency"===n?(r.alphaMap=e,r.transparent=!0):r[n+"Map"]=e})))})),Promise.all(o).then((function(){return r._json=e,r}))};this.fromJSONMaterialObject=function(e){var t="standard";return e.hasOwnProperty("materialType")&&(t=e.materialType),"gem"===t?(e.hasOwnProperty("version")||(e.version="1.0"),function(e){var t=new module$src$shared$materials$MaterialPropertiesGem.default;["depth","resolution"].forEach((function(n){if(e.hasOwnProperty(n)){var r=parseInt(e[n]);!isNaN(r)&&isFinite(r)&&("resolution"===n&&r&r-1||(t[n]=r))}})),"impurityScale tracingTransparency transparency dispersion refractionIndex gamma contrast brightness".split(" ").forEach((function(n){if(e.hasOwnProperty(n)){var r=parseFloat(e[n]);if(!isNaN(r)&&isFinite(r))switch(n){case"tracingTransparency":t.tracingOpacity=1-r;break;case"transparency":t.opacity=1-r;break;default:t[n]=r}}})),["colorTransferBegin","colorTransferEnd"].forEach((function(n){if(e.hasOwnProperty(n)){var r=(0,module$src$shared$util$toTinyColor.default)(e[n]);r&&r.isValid()&&(t[n]=r.toThreeColor())}}));var n=[];return["impurity","environment"].forEach((function(r){e.hasOwnProperty(r+"texture")&&n.push(function(e){if(void 0===e)return Promise.reject(Error("Input object is not a valid JSON cube texture definition."));("string"==typeof e||Array.isArray(e))&&(e={href:e});var t="px nx pz nz py ny".split(" ");if(module$src$shared$util$GlobalUtils.default.typeCheck(e.href,"string")&&e.href.startsWith('["https')&&e.href.endsWith('"]')){var n=e.href;try{e.href=JSON.parse(n)}catch(o){e.href=n}}if(Array.isArray(e.href)){var r=e.href;if(6!==r.length)return Promise.reject(Error("Input object is not a valid JSON cube texture definition."))}if(void 0===r){if(r=[],!e.href.startsWith("https://")&&!e.href.startsWith("http://"))return Promise.reject(Error("Input object is not a valid JSON cube texture definition."));for(e.href.endsWith("/")||(e.href+="/"),n=0;n<t.length;n++)r.push(e.href+t[n]+".jpg")}return new Promise((function(e,t){(new module$src$externals$three.default.CubeTextureLoader).load(r,(function(t){e(t)}),null,(function(){t(Error("Input object is not a valid JSON cube texture definition."))}))}))}(e[r+"texture"]).then((function(e){t[r+"Map"]=e})))})),Promise.all(n).then((function(){return t._json=e,t}))}(e)):e.hasOwnProperty("version")?e.hasOwnProperty("materialpreset")?new Promise((function(t,r){module$src$shared$materials$MaterialPresets.default.fromId(e.materialpreset).then((function(r){r=module$src$shared$util$GlobalUtils.default.deepCopy(r),!e.hasOwnProperty("color")||255===parseInt(e.color[0])&&255===parseInt(e.color[1])&&255===parseInt(e.color[2])||(r.color=e.color),e.hasOwnProperty("bitmaptexture")&&(r.bitmaptexture=e.bitmaptexture),e.hasOwnProperty("bumptexture")&&(r.bumptexture=e.bumptexture),t(n(r,"2.0"))}),(function(e){r(e)}))})):n(e,e.version):Promise.reject(Error("Material definition did not have version number defined"))}};var module$src$3d$viewports$default$handlers$MaterialHandler={default:function(e,t){var n,r,o,a,i=e.pathUtils,s="default default_bw blurred_lights georgentor georgentor_blur georgentor_blue_blur georgentor_bw_blur levelsets lythwood_field mountains ocean piazza_san_marco residential_garden room_abstract_1 sky storage_room storm subway_entrance subway_entrance_bw_blur white yokohama".split(" "),l=[],u="px nx pz nz py ny".split(" "),c=e.settings,d=null,p=[],h=!1,m=.005,f=6.5,g=0,$={},v=function(e,r){if(void 0===e)return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","No input was provided, the environment map was not set."),Promise.resolve(!1);if("none"===e)return n._assignEnvironmentMap({name:"none",map:null}),Promise.resolve(!0);if(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&e.startsWith('["https')&&e.endsWith('"]')){var o=e;try{e=JSON.parse(o)}catch(m){e=o}}if(r=r||c.getSetting("environmentMapResolution"),module$src$shared$util$GlobalUtils.default.typeCheck(e,"string"))var a=e.toLowerCase().replace(/ /g,"_"),i=a+r;else if(Array.isArray(e)){var d=e;if(6!==d.length)return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","The number of URLs was not 6, the environment map was not set."),Promise.resolve(!1);i=a=JSON.stringify(d,null,0)}for(var h=(o=$jscomp.makeIterator(p)).next();!h.done;h=o.next())if((h=h.value).name===i)return n._assignEnvironmentMap(h),Promise.resolve(!0);if(void 0===d)if(d=[],0<=s.indexOf(a))for(o=0;o<u.length;o++)d.push("https://viewer.shapediver.com/v2/envmaps/"+r+"/"+a+"/"+u[o]+".jpg");else if(0<=l.indexOf(a))for(o=0;o<u.length;o++)d.push("https://viewer.shapediver.com/v2/envmaps/"+r+"/"+a+"/"+u[o]+".png");else{if(!e.startsWith("https://")&&!e.startsWith("http://"))return"none"!==e&&t.threeDManager.warn("MaterialHandler.setEnvironmentMap","Environment map name not found, and not a base URL",e),Promise.resolve(!1);for(e.endsWith("/")||(e+="/"),o=0;o<u.length;o++)d.push(e+u[o]+".jpg")}return n._loadEnvironmentMap(i,d).then((function(e){return p.push(e),n._assignEnvironmentMap(e),!0}),(function(){return t.threeDManager.warn("MaterialHandler.setEnvironmentMap","Was not able to load the environment map, the environment map was not set."),!1}))},y=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"MaterialHandler.Hook->environmentMapAsBackground")&&(t.threeDManager.getSetting("groundPlaneReflectionVisibility")&&e?(t.threeDManager.warn("MaterialHandler.Hook->environmentMapAsBackground","The ground plane reflection and the environment as background do not work together right now."),!1):(o=e?d:null,t.renderingHandler.render(),!0))},_=function(e){if(!["256","512","1024","2048"].includes(e))return t.threeDManager.warn("MaterialHandler.setEnvironmentMapResolution","No valid input was provided, the environment map was not changed."),Promise.resolve(!1);var n=c.getSetting("environmentMap");return"none"===n||v(n,e)},b=function(){module$src$3d$interfaces$handlers$MaterialHandlerInterface.default.call(this),n=this,r=new module$src$3d$helpers$handlers$MaterialHandlerHelpers.default(t,{nameStandard:"ShapeDiverStandardMaterial",nameSimple:"MeshPhongMaterial"}),t.renderingHandler._getExtension("EXT_shader_texture_lod")||(h=!0),g=t.renderingHandler._getTextureUnitCount(),c.registerHook("environmentMap",(function(e){return v(e)})),c.updateSettingAsync("environmentMap",c.getSetting("environmentMap")),c.registerHook("environmentMapAsBackground",y),c.registerHook("environmentMapResolution",_)};return $jscomp.inherits(b,module$src$3d$interfaces$handlers$MaterialHandlerInterface.default),b.prototype._loadEnvironmentMap=function(e,t){return new Promise((function(n,r){(new module$src$externals$three.default.CubeTextureLoader).load(t,(function(t){t.format=module$src$externals$three.default.RGBFormat,t.mapping=module$src$externals$three.default.CubeReflectionMapping,h&&(t.generateMipmaps=!1,t.minFilter=module$src$externals$three.default.LinearFilter,t.magFilter=module$src$externals$three.default.LinearFilter),n({name:e,map:t})}),null,(function(e){r(e)}))}))},b.prototype._assignEnvironmentMap=function(e){c.getSetting("environmentMapAsBackground")&&(o=e.map);for(var n=t.threeDManager.helpers.getMaterials(),r=0,a=n.length;r<a;r++){var i=n[r];"ShapeDiverStandardMaterial"==i.type?i.envMap=e.map:"ShapeDiverGemMaterial"!=i.type||i.customEnvMap||(i.envMap=e.map)}d=e.map,t.renderingHandler.render()},b.prototype._changeNoiseFunction=function(e){var n,r=t.threeDManager.helpers.getMeshMaterialObjects(),o=0;for(n=r.length;o<n;o++){var a=r[o].material;a.fragmentShader=module$src$3d$viewports$default$shaders$ShaderFile.default.standard_frag.replace("vec3 noise(vec3 m) { return vec3(0); }",e),a.needsUpdate=!0}for(o=0,n=(r=t.threeDManager.getExchangeMaterials()).length;o<n;o++)(a=r[o].material).fragmentShader=module$src$3d$viewports$default$shaders$ShaderFile.default.standard_frag.replace("vec3 noise(vec3 m) { return vec3(0); }",e),a.needsUpdate=!0;t.renderingHandler.render()},b.prototype.pause=function(){},b.prototype.resume=function(){},b.prototype.destroy=function(){},b.prototype._getTransformationPath=function(e){return(e=i.getObjectPath(e)).substring(0,e.indexOf(".",e.indexOf("transformation_")))},b.prototype._createCubeNormalMap=function(e,r,o){if(r=n._getTransformationPath(e)+r,$[r+"_"+o])return $[r+"_"+o];var i=new module$src$externals$three.default.Scene,s=new module$src$externals$three.default.CubeCamera(.001,1e4,o);if(s.renderTarget.texture.generateMipmaps=!1,s.renderTarget.texture.minFilter=module$src$externals$three.default.NearestFilter,s.renderTarget.texture.magFilter=module$src$externals$three.default.NearestFilter,s.renderTarget.texture.format=module$src$externals$three.default.RGBAFormat,i.add(s),!a){var l=module$src$externals$three.default.UniformsUtils.merge([module$src$externals$three.default.UniformsLib.common,{emissive:{value:new module$src$externals$three.default.Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),u=module$src$3d$viewports$default$shaders$ShaderFile.default.normal_vert,c=module$src$3d$viewports$default$shaders$ShaderFile.default.normal_frag;(a=new module$src$externals$three.default.ShaderMaterial({uniforms:module$src$externals$three.default.UniformsUtils.clone(l),defines:{STANDARD:""},vertexShader:u,fragmentShader:c})).blending=module$src$externals$three.default.NoBlending,a.side=module$src$externals$three.default.DoubleSide,i.overrideMaterial=a}return(e=new module$src$externals$three.default.Mesh(e.geometry.clone(),a)).geometry.center(),i.add(e),s.update(t.renderingHandler.getRenderer(),i),i.remove(e),$[r+"_"+o]=s.renderTarget.texture,$[r+"_"+o]},b.prototype.getMaterial=function(e,r,o,a,i){return null==e&&(e={}),!e.attributes&&r&&r.geometry&&r.geometry.attributes&&(e.attributes=Object.keys(r.geometry.attributes)),"gem"===e.materialType?(a=n._createCubeNormalMap(r,o,e.resolution),r.geometry.boundingSphere||r.geometry.computeBoundingSphere(),i=r.geometry.boundingSphere.center,o=r.geometry.boundingSphere.radius,e.side=module$src$externals$three.default.FrontSide,e=Object.assign({inverseModelMatrix:(new module$src$externals$three.default.Matrix4).getInverse(r.matrixWorld),inverseTransposeModelMatrix:(new module$src$externals$three.default.Matrix3).getNormalMatrix((new module$src$externals$three.default.Matrix4).getInverse(r.matrixWorld).transpose()),center:i,radius:o,sphericalNormalMap:a,envMap:e.environmentMap?e.environmentMap:d,customEnvMap:!!e.environmentMap},e),e=new module$src$externals$three.default.ShapeDiverGemMaterial(e)):(e=new module$src$externals$three.default.ShapeDiverStandardMaterial(Object.assign({textureUnitCount:g,lightWorldSize:m,lightFrustum:f,envMap:d,renderAO:!0},e)),a&&e.color.set(a.toRgbString()),i&&(e.vertexColors=module$src$externals$three.default.VertexColors),t.lightHandler.reevaluateNumberOfShadowMaps(e.availableTextures)),e},b.prototype.getSimpleMaterial=function(e){return new module$src$externals$three.default.MeshPhongMaterial(Object.assign({shininess:e.metalness?128*e.metalness:0},e))},b.prototype.compile=function(){t.beautyRenderHandler.renderHidden(),r.checkMaterials()},b.prototype.adjustToBoundingSphere=function(e){m=e.radius/25*.005,f=e.radius/25*6.5;for(var n=0,r=(e=t.threeDManager.helpers.getMaterials()).length;n<r;n++){var o=e[n];"ShapeDiverStandardMaterial"==o.type&&(o.lightWorldSize=m,o.lightFrustum=f)}},b.prototype.getEnvironmentMap=function(){return d},b.prototype.setSceneBackground=function(e){o=e},b.prototype.getSceneBackground=function(){return o},new b(e)}},module$node_modules$detect_hover$lib$index={default:{}};Object.defineProperty(module$node_modules$detect_hover$lib$index.default,"__esModule",{value:!0}),module$node_modules$detect_hover$lib$index.default.default={update:function(){"undefined"!=typeof window&&"function"==typeof window.matchMedia&&(module$node_modules$detect_hover$lib$index.default.default.hover=window.matchMedia("(hover: hover)").matches,module$node_modules$detect_hover$lib$index.default.default.none=window.matchMedia("(hover: none)").matches||window.matchMedia("(hover: on-demand)").matches,module$node_modules$detect_hover$lib$index.default.default.anyHover=window.matchMedia("(any-hover: hover)").matches,module$node_modules$detect_hover$lib$index.default.default.anyNone=window.matchMedia("(any-hover: none)").matches||window.matchMedia("(any-hover: on-demand)").matches)}},module$node_modules$detect_hover$lib$index.default.default.update();var module$node_modules$detect_pointer$lib$index={default:{}};Object.defineProperty(module$node_modules$detect_pointer$lib$index.default,"__esModule",{value:!0}),module$node_modules$detect_pointer$lib$index.default.default={update:function(){"undefined"!=typeof window&&"function"==typeof window.matchMedia&&(module$node_modules$detect_pointer$lib$index.default.default.fine=window.matchMedia("(pointer: fine)").matches,module$node_modules$detect_pointer$lib$index.default.default.coarse=window.matchMedia("(pointer: coarse)").matches,module$node_modules$detect_pointer$lib$index.default.default.none=window.matchMedia("(pointer: none)").matches,module$node_modules$detect_pointer$lib$index.default.default.anyFine=window.matchMedia("(any-pointer: fine)").matches,module$node_modules$detect_pointer$lib$index.default.default.anyCoarse=window.matchMedia("(any-pointer: coarse)").matches,module$node_modules$detect_pointer$lib$index.default.default.anyNone=window.matchMedia("(any-pointer: none)").matches)}},module$node_modules$detect_pointer$lib$index.default.default.update();var module$node_modules$detect_touch_events$lib$index={default:{}};Object.defineProperty(module$node_modules$detect_touch_events$lib$index.default,"__esModule",{value:!0}),module$node_modules$detect_touch_events$lib$index.default.default={update:function(){"undefined"!=typeof window&&(module$node_modules$detect_touch_events$lib$index.default.default.hasSupport="ontouchstart"in window,module$node_modules$detect_touch_events$lib$index.default.default.browserSupportsApi=!!window.TouchEvent)}},module$node_modules$detect_touch_events$lib$index.default.default.update();var module$node_modules$detect_passive_events$lib$index={default:{}};Object.defineProperty(module$node_modules$detect_passive_events$lib$index.default,"__esModule",{value:!0}),module$node_modules$detect_passive_events$lib$index.default.default={update:function(){if("undefined"!=typeof window&&"function"==typeof window.addEventListener){var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}}),n=function(){};window.addEventListener("testPassiveEventSupport",n,t),window.removeEventListener("testPassiveEventSupport",n,t),module$node_modules$detect_passive_events$lib$index.default.default.hasSupport=e}}},module$node_modules$detect_passive_events$lib$index.default.default.update();var module$node_modules$detect_it$lib$index={default:{}};Object.defineProperty(module$node_modules$detect_it$lib$index.default,"__esModule",{value:!0});var _detectHover$$module$node_modules$detect_it$lib$index=module$node_modules$detect_hover$lib$index.default,_detectHover2$$module$node_modules$detect_it$lib$index=_interopRequireDefault$$module$node_modules$detect_it$lib$index(module$node_modules$detect_hover$lib$index.default),_detectPointer$$module$node_modules$detect_it$lib$index=module$node_modules$detect_pointer$lib$index.default,_detectPointer2$$module$node_modules$detect_it$lib$index=_interopRequireDefault$$module$node_modules$detect_it$lib$index(module$node_modules$detect_pointer$lib$index.default),_detectTouchEvents$$module$node_modules$detect_it$lib$index=module$node_modules$detect_touch_events$lib$index.default,_detectTouchEvents2$$module$node_modules$detect_it$lib$index=_interopRequireDefault$$module$node_modules$detect_it$lib$index(module$node_modules$detect_touch_events$lib$index.default),_detectPassiveEvents$$module$node_modules$detect_it$lib$index=module$node_modules$detect_passive_events$lib$index.default,_detectPassiveEvents2$$module$node_modules$detect_it$lib$index=_interopRequireDefault$$module$node_modules$detect_it$lib$index(module$node_modules$detect_passive_events$lib$index.default);function _interopRequireDefault$$module$node_modules$detect_it$lib$index(e){return e&&e.__esModule?e:{default:e}}function determineDeviceType$$module$node_modules$detect_it$lib$index(e,t,n,r){return e&&(t||n)?"hybrid":e&&Object.keys(r.detectHover).filter((function(e){return"update"!==e})).every((function(e){return!1===r.detectHover[e]}))&&Object.keys(r.detectPointer).filter((function(e){return"update"!==e})).every((function(e){return!1===r.detectPointer[e]}))?window.navigator&&/android/.test(window.navigator.userAgent.toLowerCase())?"touchOnly":"hybrid":e?"touchOnly":"mouseOnly"}module$node_modules$detect_it$lib$index.default.default={state:{detectHover:_detectHover2$$module$node_modules$detect_it$lib$index.default,detectPointer:_detectPointer2$$module$node_modules$detect_it$lib$index.default,detectTouchEvents:_detectTouchEvents2$$module$node_modules$detect_it$lib$index.default,detectPassiveEvents:_detectPassiveEvents2$$module$node_modules$detect_it$lib$index.default},update:function(){module$node_modules$detect_it$lib$index.default.default.state.detectHover.update(),module$node_modules$detect_it$lib$index.default.default.state.detectPointer.update(),module$node_modules$detect_it$lib$index.default.default.state.detectTouchEvents.update(),module$node_modules$detect_it$lib$index.default.default.state.detectPassiveEvents.update(),module$node_modules$detect_it$lib$index.default.default.updateOnlyOwnProperties()},updateOnlyOwnProperties:function(){var e;"undefined"!=typeof window&&(module$node_modules$detect_it$lib$index.default.default.passiveEvents=module$node_modules$detect_it$lib$index.default.default.state.detectPassiveEvents.hasSupport||!1,module$node_modules$detect_it$lib$index.default.default.hasTouch=module$node_modules$detect_it$lib$index.default.default.state.detectTouchEvents.hasSupport||!1,module$node_modules$detect_it$lib$index.default.default.deviceType=determineDeviceType$$module$node_modules$detect_it$lib$index(module$node_modules$detect_it$lib$index.default.default.hasTouch,module$node_modules$detect_it$lib$index.default.default.state.detectHover.anyHover,module$node_modules$detect_it$lib$index.default.default.state.detectPointer.anyFine,module$node_modules$detect_it$lib$index.default.default.state),module$node_modules$detect_it$lib$index.default.default.hasMouse="touchOnly"!==module$node_modules$detect_it$lib$index.default.default.deviceType,module$node_modules$detect_it$lib$index.default.default.primaryInput=("mouseOnly"===module$node_modules$detect_it$lib$index.default.default.deviceType?"mouse":"touchOnly"===module$node_modules$detect_it$lib$index.default.default.deviceType&&"touch")||module$node_modules$detect_it$lib$index.default.default.state.detectPointer.fine&&"mouse"||module$node_modules$detect_it$lib$index.default.default.state.detectPointer.coarse&&"touch"||"mouse",(e=/windows/.test(window.navigator.userAgent.toLowerCase())&&/chrome/.test(window.navigator.userAgent.toLowerCase()))&&(e=59<=(e=parseInt(/Chrome\/([0-9.]+)/.exec(navigator.userAgent)[1],10))&&62>e),e&&module$node_modules$detect_it$lib$index.default.default.hasTouch&&(module$node_modules$detect_it$lib$index.default.default.deviceType="hybrid",module$node_modules$detect_it$lib$index.default.default.hasMouse=!0,module$node_modules$detect_it$lib$index.default.default.primaryInput="mouse"))}},module$node_modules$detect_it$lib$index.default.default.updateOnlyOwnProperties();var module$src$3d$viewports$default$handlers$CameraHandler={default:function(e,t){var n,r,o,a,i,s,l,u,c,d=e.settings,p=e.geometryNode,h=e.container,m=new module$src$externals$three.default.Sphere,f=new module$src$externals$three.default.Matrix4,g=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->fov")&&(10<s.fov&&10>e?(s.near=100*s.near*e,s.far=100*s.far*e):10>s.fov&&10<e&&(s.near/=100*s.fov,s.far/=100*s.fov),s.fov=e,s.updateProjectionMatrix(),t.renderingHandler.render(),!0)},$=function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.perspective.position")?Promise.resolve(!0):Promise.resolve(!1)},v=function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.perspective.target")?Promise.resolve(!0):Promise.resolve(!1)},y=function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e.position,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.perspective")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.target,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.perspective")?r instanceof module$src$externals$three.default.PerspectiveCamera?n.setPositionAndTarget(e.position,e.target,{duration:0}):Promise.resolve(!0):Promise.resolve(!1)},_=function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.orthographic.position")?Promise.resolve(!0):Promise.resolve(!1)},b=function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.orthographic.target")?Promise.resolve(!0):Promise.resolve(!1)},x=function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e.position,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.orthographic")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.target,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults.orthographic")?r instanceof module$src$externals$three.default.OrthographicCamera?n.setPositionAndTarget(e.position,e.target,{duration:d.getSetting("cameraMovementDuration")}):Promise.resolve(!0):Promise.resolve(!1)},w=function(e){return e.perspective&&module$src$shared$util$GlobalUtils.default.typeCheck(e.perspective.position,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.perspective.target,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults")&&e.orthographic&&module$src$shared$util$GlobalUtils.default.typeCheck(e.orthographic.position,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.orthographic.target,"vector3obj",t.threeDManager.warn,"CameraHandler.Hook->defaults")?Promise.resolve(!0):Promise.resolve(!1)},S=function(e){if("number"!=typeof e||e<module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.MIN||e>module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.MAX)return!1;if(e===module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE)r=s,o=l,l.enabled=!0,c.enabled=!1,d.getSetting("environmentMapAsBackground")&&t.materialHandler.setSceneBackground(t.materialHandler.getEnvironmentMap());else{switch(r=u,u.far=1e3*m.radius,u.near=m.radius,o=c,l.enabled=!1,c.enabled=!0,e){case module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.TOP:c.object.position.set(m.center.x,m.center.y,m.center.z+2*m.radius),c.target.set(m.center.x,m.center.y,m.center.z-m.radius);break;case module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.BOTTOM:c.object.position.set(m.center.x,m.center.y,m.center.z-2*m.radius),c.target.set(m.center.x,m.center.y,m.center.z+m.radius);break;case module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.RIGHT:c.object.position.set(m.center.x+2*m.radius,m.center.y,m.center.z),c.target.set(m.center.x-m.radius,m.center.y,m.center.z);break;case module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.LEFT:c.object.position.set(m.center.x-2*m.radius,m.center.y,m.center.z),c.target.set(m.center.x+m.radius,m.center.y,m.center.z);break;case module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.BACK:c.object.position.set(m.center.x,m.center.y+2*m.radius,m.center.z),c.target.set(m.center.x,m.center.y-m.radius,m.center.z);break;case module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.FRONT:c.object.position.set(m.center.x,m.center.y-2*m.radius,m.center.z),c.target.set(m.center.x,m.center.y+m.radius,m.center.z)}o.target.set(m.center.x,m.center.y,m.center.z),t.materialHandler.setSceneBackground(null)}return t.lightHandler.adaptLightingToCameraType(e),t.renderingHandler.render(),!0},M=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableOrbitControls")&&(o.enabled=e,o.resetState(),!0)},E=null,T=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->autoAdjust")&&(e&&!E&&(E=t.threeDManager.viewerApi.scene.addEventListener(t.threeDManager.viewerApi.scene.EVENTTYPE.SUBSCENE_PUBLISHED,(function(){d.getSetting("autoAdjust")&&t.threeDManager.getSetting("show")&&n.zoomExtents({default:!0})}))),!0)},C=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->damping")&&(e=Math.min(Math.max(.05,e),.25),o.dampingFactor=e,o.panDampingFactor=e,o.zoomDampingFactor=e,o.rotateDampingFactor=e,!0)},P=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableRotation")&&(o.enableRotation=e,!0)},A=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"float",t.threeDManager.warn,"CameraHandler.Hook->rotationSpeed")&&(o.rotationSpeed=e,!0)},L=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableAutoRotation")&&((o.enableAutoRotation=e)&&t.renderingHandler.render(),!0)},R=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"float",t.threeDManager.warn,"CameraHandler.Hook->autoRotationSpeed")&&(o.autoRotationSpeed=e,d.updateSetting("enableAutoRotation",0!==e),!0)},D=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableZoom")&&(o.enableZoom=e,!0)},I=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->zoomSpeed")&&(o.zoomSpeed=e,!0)},O=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enablePan")&&(o.enablePan=e,!0)},N=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"number",t.threeDManager.warn,"CameraHandler.Hook->panSpeed")&&(o.panSpeed=e,!0)},U=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->enableKeyPan")&&(o.enableKeyPan=e,!0)},k=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"number",t.threeDManager.warn,"CameraHandler.Hook->keyPanSpeed")&&(o.keyPanSpeed=7*e,!0)},H=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.min,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.cube")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.max,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.cube")||(o.minPosition=module$src$shared$util$GlobalUtils.default.toVector3(e.min),o.maxPosition=module$src$shared$util$GlobalUtils.default.toVector3(e.max),t.renderingHandler.render(),0))},G=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.center,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.sphere")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.radius,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->restrictions.position.sphere")||(o.positionSphereCenter=module$src$shared$util$GlobalUtils.default.toVector3(e.center),o.positionSphereRadius=e.radius,t.renderingHandler.render(),0))},V=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.min,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.cube")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.max,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.cube")||(o.minTarget=module$src$shared$util$GlobalUtils.default.toVector3(e.min),o.maxTarget=module$src$shared$util$GlobalUtils.default.toVector3(e.max),t.renderingHandler.render(),0))},j=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.center,"vector3any",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.sphere")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.radius,"notnegative",t.threeDManager.warn,"CameraHandler.Hook->restrictions.target.sphere")||(o.targetSphereCenter=module$src$shared$util$GlobalUtils.default.toVector3(e.center),o.targetSphereRadius=e.radius,t.renderingHandler.render(),0))},F=function(e){return!!(module$src$shared$util$GlobalUtils.default.typeCheck(e.minPolarAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.maxPolarAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.minAzimuthAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation")&&module$src$shared$util$GlobalUtils.default.typeCheck(e.maxAzimuthAngle,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.rotation"))&&(o.minPolarAngle=e.minPolarAngle*Math.PI/180,o.maxPolarAngle=e.maxPolarAngle*Math.PI/180,o.minAzimuthAngle=e.minAzimuthAngle*Math.PI/180,o.maxAzimuthAngle=e.maxAzimuthAngle*Math.PI/180,t.renderingHandler.render(),!0)},z=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e.minDistance,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.zoom")||!module$src$shared$util$GlobalUtils.default.typeCheck(e.maxDistance,"number",t.threeDManager.warn,"CameraHandler.Hook->restrictions.zoom")||(o.minDistance=e.minDistance,o.maxDistance=e.maxDistance,t.renderingHandler.render(),0))},B=null,W=null,Y=null,q=function(e){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"CameraHandler.Hook->revertAtMouseUp"))return!1;e=!1,!0===module$node_modules$detect_it$lib$index.default.default.passiveEvents&&(e={capture:!1,passive:!0});var r=t.renderingHandler.getDomElement();if(B||(B=r.addEventListener("mouseup",(function(){d.getSetting("revertAtMouseUp")&&n.resetPositionAndTarget({duration:d.getSetting("revertAtMouseUpDuration")})}),e)),W||(W=r.addEventListener("touchend",(function(){d.getSetting("revertAtMouseUp")&&n.resetPositionAndTarget({duration:d.getSetting("revertAtMouseUpDuration")})}),e)),!Y){var o=0,a=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";Y=r.addEventListener(a,(function(){clearTimeout(o),d.getSetting("revertAtMouseUp")&&(o=setTimeout((function(){n.resetPositionAndTarget({duration:d.getSetting("revertAtMouseUpDuration")})}),300))}),e)}return!0},X=function(){n.zoomExtents()},Z=function(e){module$src$3d$interfaces$handlers$CameraHandlerInterface.default.call(this,e),n=this,s=new module$src$externals$three.default.PerspectiveCamera(d.getSetting("fov"),h.offsetWidth/h.offsetHeight,d.getSetting("near"),d.getSetting("far")),a=d.getSetting("defaults.perspective.position"),s.position.set(a.x,a.y,a.z),s.up.set(0,0,1),t.threeDManager.helpers.addSceneObject(s),e=new module$src$3d$helpers$OrbitControlsProxyStandardImplementation.default(t),l=new module$src$externals$three.default.OrbitControls(s,e),e.initialize(),l.enableDamping=!0,l.dampingFactor=d.getSetting("damping"),l.panDampingFactor=d.getSetting("damping"),l.zoomDampingFactor=d.getSetting("damping"),l.rotateDampingFactor=d.getSetting("damping"),l.enableRotation=d.getSetting("enableRotation"),l.rotationSpeed=d.getSetting("rotationSpeed"),l.enableAutoRotation=d.getSetting("enableAutoRotation"),l.autoRotationSpeed=d.getSetting("autoRotationSpeed"),l.enableZoom=d.getSetting("enableZoom"),l.zoomSpeed=d.getSetting("zoomSpeed"),l.enablePan=d.getSetting("enablePan"),l.panSpeed=d.getSetting("panSpeed"),l.enableKeyPan=d.getSetting("enableKeyPan"),l.keyPanSpeed=7*d.getSetting("keyPanSpeed"),i=d.getSetting("defaults.perspective.target"),l.target.set(i.x,i.y,i.z),l.addEventListener("change",(function(){o==l&&o.isMoving&&t.renderingHandler.registerForContinuousRendering("cameraMoving")})),u=new module$src$externals$three.default.OrthographicCamera(-25,25,25,-25,.01,1e4),a=d.getSetting("defaults.orthographic.position"),u.position.set(a.x,a.y,a.z),u.up.set(0,0,1),e=new module$src$3d$helpers$OrbitControlsProxyStandardImplementation.default(t),c=new module$src$externals$three.default.OrbitControls(u,e),e.initialize(),c.enableDamping=!0,c.dampingFactor=d.getSetting("damping"),c.panDampingFactor=d.getSetting("damping"),c.zoomDampingFactor=d.getSetting("damping"),c.rotateDampingFactor=d.getSetting("damping"),c.enableRotation=!1,c.enableAutoRotation=!1,c.enablePan=!0,c.enableKeyPan=!0,c.enableZoom=d.getSetting("enableZoom"),c.zoomSpeed=d.getSetting("zoomSpeed"),c.addEventListener("change",(function(){o==c&&o.isMoving&&t.renderingHandler.registerForContinuousRendering("cameraMoving")})),i=d.getSetting("defaults.orthographic.target"),c.target.set(i.x,i.y,i.z),r=s,o=l,l.enabled=!0,c.enabled=!1,m.radius=25,d.registerHook("autoAdjust",T),d.registerHook("fov",g),d.registerHook("defaults.perspective.position",$),d.registerHook("defaults.perspective.target",v),d.registerHook("defaults.perspective",y),d.registerHook("defaults.orthographic.position",_),d.registerHook("defaults.orthographic.target",b),d.registerHook("defaults.orthographic",x),d.registerHook("defaults",w),d.registerHook("type",S),d.registerHook("enableOrbitControls",M),d.registerHook("damping",C),d.registerHook("enableRotation",P),d.registerHook("rotationSpeed",A),d.registerHook("enableAutoRotation",L),d.registerHook("autoRotationSpeed",R),d.registerHook("enableZoom",D),d.registerHook("zoomSpeed",I),d.registerHook("enablePan",O),d.registerHook("panSpeed",N),d.registerHook("enableKeyPan",U),d.registerHook("keyPanSpeed",k),d.registerHook("restrictions.position.cube",H),d.registerHook("restrictions.position.cube.min",(function(e){var t=d.getSetting("restrictions.position.cube");return t.min=e,H(t)})),d.registerHook("restrictions.position.cube.max",(function(e){var t=d.getSetting("restrictions.position.cube");return t.max=e,H(t)})),d.registerHook("restrictions.position.sphere",G),d.registerHook("restrictions.position.sphere.center",(function(e){var t=d.getSetting("restrictions.position.sphere");return t.center=e,G(t)})),d.registerHook("restrictions.position.sphere.radius",(function(e){var t=d.getSetting("restrictions.position.sphere");return t.radius=e,G(t)})),d.registerHook("restrictions.target.cube",V),d.registerHook("restrictions.target.cube.min",(function(e){var t=d.getSetting("restrictions.target.cube");return t.min=e,V(t)})),d.registerHook("restrictions.target.cube.max",(function(e){var t=d.getSetting("restrictions.target.cube");return t.max=e,V(t)})),d.registerHook("restrictions.target.sphere",j),d.registerHook("restrictions.target.sphere.center",(function(e){var t=d.getSetting("restrictions.target.sphere");return t.center=e,j(t)})),d.registerHook("restrictions.target.sphere.radius",(function(e){var t=d.getSetting("restrictions.target.sphere");return t.radius=e,j(t)})),d.registerHook("restrictions.rotation",F),d.registerHook("restrictions.rotation.minPolarAngle",(function(e){var t=d.getSetting("restrictions.rotation");return t.minPolarAngle=e,F(t)})),d.registerHook("restrictions.rotation.maxPolarAngle",(function(e){var t=d.getSetting("restrictions.rotation");return t.maxPolarAngle=e,F(t)})),d.registerHook("restrictions.rotation.minAzimuthAngle",(function(e){var t=d.getSetting("restrictions.rotation");return t.minAzimuthAngle=e,F(t)})),d.registerHook("restrictions.rotation.maxAzimuthAngle",(function(e){var t=d.getSetting("restrictions.rotation");return t.maxAzimuthAngle=e,F(t)})),d.registerHook("restrictions.zoom",z),d.registerHook("restrictions.zoom.minDistance",(function(e){var t=d.getSetting("restrictions.zoom");return t.minDistance=e,z(t)})),d.registerHook("restrictions.zoom.maxDistance",(function(e){var t=d.getSetting("restrictions.zoom");return t.maxDistance=e,z(t)})),d.registerHook("revertAtMouseUp",q),d.registerNotifier("zoomExtentsFactor",X)};return $jscomp.inherits(Z,module$src$3d$interfaces$handlers$CameraHandlerInterface.default),Z.prototype._transitionDefaults=function(e){var t={};return t.duration=module$src$shared$util$GlobalUtils.default.typeCheck(e.duration,"notnegative")?e.duration:d.getSetting("cameraMovementDuration"),module$src$shared$util$GlobalUtils.default.typeCheck(e.coordinates,"string")&&(t.coordinates=e.coordinates),"spherical"!==t.coordinates&&"cylindrical"!==t.coordinates&&(t.coordinates="cylindrical"),t.easing=null,void 0!==e.easing&&(module$src$shared$util$GlobalUtils.default.typeCheck(e.easing,"string")?t.easing=module$src$shared$util$GlobalUtils.default.getAtPath(module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing,e.easing):"function"==typeof e.easing&&(t.easing=e.easing)),t.easing=t.easing||module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Quartic.InOut,t.interpolation=null,void 0!==e.interpolation&&(module$src$shared$util$GlobalUtils.default.typeCheck(e.interpolation,"string")?t.interpolation=module$src$shared$util$GlobalUtils.default.getAtPath(module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation,e.interpolation):"function"==typeof e.interpolation&&(t.interpolation=e.interpolation)),t.interpolation=t.interpolation||module$node_modules$$tweenjs$tween_js$src$Tween.default.Interpolation.CatmullRom,"boolean"!=typeof t.default&&(t.default=!1),t},Z.prototype._isOrthographicCameraType=function(){return"OrthographicCamera"===o.object.type},Z.prototype._isPerspectiveCameraType=function(){return"PerspectiveCamera"===o.object.type},Z.prototype.pause=function(){o.enabled=!1,o.resetState()},Z.prototype.resume=function(){s.updateProjectionMatrix(),o.enabled=d.getSetting("enableOrbitControls")},Z.prototype.setViewAndProjectionMatrix=function(e,t){f.getInverse(e),f.decompose(r.position,r.quaternion,r.scale),r.projectionMatrix.copy(t)},Z.prototype.destroy=function(){},Z.prototype.setPosition=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.setPosition")&&(o.object.position.set(e.x,e.y,e.z),t.renderingHandler.render(),!0)},Z.prototype.resetPosition=function(){return n.setPosition(d.getSetting(r instanceof module$src$externals$three.default.PerspectiveCamera?"defaults.perspective.position":"defaults.orthographic.position"))},Z.prototype.getPosition=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(o.object.position)},Z.prototype.setTarget=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3obj",t.threeDManager.warn,"CameraHandler.setTarget")&&(o.target.set(e.x,e.y,e.z),t.renderingHandler.render(),!0)},Z.prototype.resetTarget=function(){return n.setTarget(d.getSetting(r instanceof module$src$externals$three.default.PerspectiveCamera?"defaults.perspective.target":"defaults.orthographic.target"))},Z.prototype.getTarget=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(o.target)},Z.prototype.setPositionAndTarget=function(e,a,i){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"vector3any",t.threeDManager.warn,"CameraHandler.setPositionAndTarget")||!module$src$shared$util$GlobalUtils.default.typeCheck(a,"vector3any",t.threeDManager.warn,"CameraHandler.setPositionAndTarget"))return Promise.resolve(!1);var s=module$src$shared$util$GlobalUtils.default.toVector3(e),l=module$src$shared$util$GlobalUtils.default.toVector3(a),u=n._transitionDefaults(i=i||{});return i.default&&(d.updateSetting((e=r instanceof module$src$externals$three.default.PerspectiveCamera?"defaults.perspective":"defaults.orthographic")+".position",s),d.updateSetting(e+".target",l)),module$src$shared$util$GlobalUtils.default.typeCheck(u.duration,"positive")?new Promise((function(e){var r=o.object.position,i=o.target,c=r.clone().sub(i),d=s.clone().sub(l),p=c.clone().normalize(),h="cylindrical"===u.coordinates?new module$src$externals$three.default.Vector3(0,0,1):(new module$src$externals$three.default.Vector3).crossVectors(p,d);h.sub(p.clone().multiplyScalar(p.dot(h))),h.normalize(),1e-12>h.lengthSq()&&(h.set(0,0,1),h.sub(p.clone().multiplyScalar(p.dot(h))),h.normalize()),1e-12>h.lengthSq()&&(h.set(0,1,0),h.sub(p.clone().multiplyScalar(p.dot(h))),h.normalize());var m=(new module$src$externals$three.default.Vector3).crossVectors(h,p),f=(new module$src$externals$three.default.Matrix4).makeBasis(p,m,h);p=new module$src$externals$three.default.Matrix4;try{p.getInverse(f,!0)}catch($){p.identity(),f=p}c.applyMatrix4(p),d.applyMatrix4(p),c=module$src$shared$util$GlobalUtils.default.cartesianToPolar(c.x,c.y,c.z),d=module$src$shared$util$GlobalUtils.default.cartesianToPolar(d.x,d.y,d.z);var g={dR:c[0],dTheta:c[1],dPhi:c[2],targetX:o.target.x,targetY:o.target.y,targetZ:o.target.z};d=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(g).easing(u.easing).to({dR:d[0],dTheta:d[1],dPhi:d[2],targetX:a.x,targetY:a.y,targetZ:a.z},u.duration).onUpdate((function(){i.set(g.targetX,g.targetY,g.targetZ);var e=module$src$shared$util$GlobalUtils.default.polarToCartesian(g.dR,g.dTheta,g.dPhi);(e=module$src$shared$util$GlobalUtils.default.toVector3(e)).applyMatrix4(f),e=i.clone().add(e),r.copy(e),n.updateOrbitControls(),t.renderingHandler.render()})).onComplete((function(){r.copy(s),i.copy(l),n.updateOrbitControls(),t.renderingHandler.unregisterForContinuousRendering("tweenID"),e(!0)})),t.renderingHandler.registerForContinuousRendering("tweenID"),d.start()})):(o.object.position.copy(s),o.target.copy(l),t.renderingHandler.render(),Promise.resolve(!0))},Z.prototype.resetPositionAndTarget=function(e){return e||(e={}),e.default=!1,r instanceof module$src$externals$three.default.PerspectiveCamera?n.setPositionAndTarget(d.getSetting("defaults.perspective.position"),d.getSetting("defaults.perspective.target"),e):n.setPositionAndTarget(d.getSetting("defaults.orthographic.position"),d.getSetting("defaults.orthographic.target"),e)},Z.prototype.getPositionAndTarget=function(){return{position:n.getPosition(),target:n.getTarget()}},Z.prototype.zoomExtents=function(e,r){if(!1===this._isPerspectiveCameraType())return t.threeDManager.warn("CameraHandler.zoomExtents","Not implemented for orthographic camera."),Promise.resolve(!0);if(!(r&&r instanceof module$src$externals$three.default.Box3)&&0==(r=p.computeSceneBoundingBox()).min.distanceTo(r.max)){var a=Number.MIN_VALUE;r=new module$src$externals$three.default.Box3(new module$src$externals$three.default.Vector3(-a,-a,-a),new module$src$externals$three.default.Vector3(a,a,a))}if(a=new module$src$externals$three.default.Vector3,r.getCenter(a),d.hasSetting("zoomExtentsFactor")){var i=new module$src$externals$three.default.Vector3;i.subVectors(r.max,a),i.multiplyScalar(d.getSetting("zoomExtentsFactor")),r=new module$src$externals$three.default.Box3((new module$src$externals$three.default.Vector3).subVectors(a,i),(new module$src$externals$three.default.Vector3).addVectors(a,i))}(i=[]).push(r.min),i.push(r.max),i.push(new module$src$externals$three.default.Vector3(r.max.x,r.min.y,r.min.z)),i.push(new module$src$externals$three.default.Vector3(r.max.x,r.max.y,r.min.z)),i.push(new module$src$externals$three.default.Vector3(r.max.x,r.min.y,r.max.z)),i.push(new module$src$externals$three.default.Vector3(r.min.x,r.max.y,r.max.z)),i.push(new module$src$externals$three.default.Vector3(r.min.x,r.min.y,r.max.z)),i.push(new module$src$externals$three.default.Vector3(r.min.x,r.max.y,r.min.z));var s=0;r=new module$src$externals$three.default.Vector3,o.object.getWorldDirection(r),r.normalize();var l=new module$src$externals$three.default.Line3(a.clone().addScaledVector(r,-100),a.clone()),u=new module$src$externals$three.default.Vector3;u.crossVectors(r,o.object.up),u.normalize();var c=new module$src$externals$three.default.Vector3;c.crossVectors(u,r),c.normalize();for(var h=0,m=i.length;h<m;h++){var f=new module$src$externals$three.default.Vector3;l.closestPointToPoint(i[h],!1,f);var g=i[h].clone();g.sub(f);var $=g.dot(u);g=g.dot(c);var v=Math.tan(Math.PI/180*o.object.fov*.5);$=Math.max(Math.abs($/(o.object.aspect*v)),Math.abs(g/v)),f=f.clone().sub(a).dot(r),s=Math.max(s,$-f)}return r.multiplyScalar(-1*s),(i=new module$src$externals$three.default.Vector3).addVectors(a,r),n.setPositionAndTarget(i,a,e)},Z.prototype.setCameraPath=function(e,a,i){var s,l;if(null==e&&null==a)return Promise.resolve(!1);var u=$jscomp.makeIterator([e=e||[],a=a||[]]);for(s=u.next();!s.done;s=u.next()){var c=s.value;if(!Array.isArray(c))return Promise.resolve(!1);for(s=0,l=c.length;s<l;++s){if(!module$src$shared$util$GlobalUtils.default.typeCheck(c[s],"vector3any",t.threeDManager.warn,"CameraHandler.setCameraPath"))return Promise.resolve(!1);c[s]=module$src$shared$util$GlobalUtils.default.toVector3(c[s])}}if(0==e.length)for(s=0,l=a.length;s<l;++s)e.push({x:o.object.position.x,y:o.object.position.y,z:o.object.position.z});if(0==a.length)for(s=0,l=e.length;s<l;++s)a.push({x:o.target.x,y:o.target.y,z:o.target.z});var p=n._transitionDefaults(i),h=module$src$shared$util$GlobalUtils.default.cartesianToPolar(o.object.position.x,o.object.position.y,o.object.position.z),m=[],f=[],g=[];e.forEach((function(e){e=module$src$shared$util$GlobalUtils.default.cartesianToPolar(e.x,e.y,e.z),m.push(e[0]),f.push(e[1]),g.push(e[2])}));var $=[],v=[],y=[];return a.forEach((function(e){$.push(e.x),v.push(e.y),y.push(e.z)})),new Promise((function(s){var l={objectR:h[0],objectTheta:h[1],objectPhi:h[2],targetX:o.target.x,targetY:o.target.y,targetZ:o.target.z},u=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(l).to({objectR:m,objectTheta:f,objectPhi:g,targetX:$,targetY:v,targetZ:y},p.duration).onUpdate((function(){var e=module$src$shared$util$GlobalUtils.default.polarToCartesian(l.objectR,l.objectTheta,l.objectPhi);o.object.position.set(e[0],e[1],e[2]),o.target.set(l.targetX,l.targetY,l.targetZ),n.updateOrbitControls(),t.renderingHandler.render()})).onComplete((function(){var l=e.length-1;if(o.object.position.set(e[l].x,e[l].y,e[l].z),o.target.set(a[l=a.length-1].x,a[l].y,a[l].z),n.updateOrbitControls(),t.renderingHandler.unregisterForContinuousRendering("tweenID"),i.default){var u=r instanceof module$src$externals$three.default.PerspectiveCamera?"defaults.perspective":"defaults.orthographic";d.updateSetting(u+".position",e[l]),d.updateSetting(u+".target",a[l])}s(!0)}));t.renderingHandler.registerForContinuousRendering("tweenID"),u.easing(p.easing).interpolation(p.interpolation).start()}))},Z.prototype.getCamera=function(){return r},Z.prototype.isCameraMoving=function(){return o.isMoving},Z.prototype.updateOrbitControls=function(){o.enabled&&(o.update(),t.renderingHandler.unregisterForContinuousRendering("cameraMoving"),o.isMoving&&t.renderingHandler.registerForContinuousRendering("cameraMoving",!1))},Z.prototype.adjustToBoundingSphere=function(e){m=e,u.left=-e.radius*s.aspect,u.bottom=-e.radius,u.right=e.radius*s.aspect,u.top=e.radius,u.far=1e4*e.radius,u.near=.01*e.radius,u.updateProjectionMatrix(),s.far=10>s.fov?1e4*s.fov*e.radius:100*e.radius,s.near=10>s.fov?1*s.fov*e.radius:.01*e.radius,s.updateProjectionMatrix()},Z.prototype.onResize=function(e,t){s.aspect=e/t,s.setViewOffset(e,t,0,0,e,t),s.updateProjectionMatrix()},new Z(e)}},module$src$3d$viewports$default$defaults$DefaultLights={},THREE$$module$src$3d$viewports$default$defaults$DefaultLights=module$src$externals$three.default,GLOBAL_UTILS$$module$src$3d$viewports$default$defaults$DefaultLights=module$src$shared$util$GlobalUtils.default,lightScenes$$module$src$3d$viewports$default$defaults$DefaultLights={default:{id:"default",lights:{ambient0:{id:"ambient0",type:"ambient",properties:{color:16777215,intensity:.5}},directional0:{id:"directional0",type:"directional",properties:{color:16777215,intensity:.75,direction:{x:.5774,y:-.5774,z:.5774},castShadow:!0}},directional1:{id:"directional1",type:"directional",properties:{color:16777215,intensity:.35,direction:{x:-.25,y:-1,z:1},castShadow:!1}}}},legacy:{id:"legacy",lights:{ambient0:{id:"ambient0",type:"ambient",properties:{color:6579300,intensity:1}},directional0:{id:"directional0",type:"directional",properties:{color:16777215,intensity:1,castShadow:!0,direction:{x:.5774,y:-.5774,z:.5774}}},flash:{id:"flash0",type:"flash",properties:{color:16777215,intensity:.4,distance:0,angle:Math.PI/2,penumbra:5,decay:5}}}}},lightProperties$$module$src$3d$viewports$default$defaults$DefaultLights={ambient:{color:{type:"color",default:16777215},intensity:{type:"notnegative",default:.5}},directional:{color:{type:"color",default:16777215},intensity:{type:"notnegative",default:.5},castShadow:{type:"boolean",default:!1},direction:{type:"vector3any",default:{x:-1,y:0,z:1}}},hemisphere:{skyColor:{type:"color",default:16777215},groundColor:{type:"color",default:16777215},intensity:{type:"notnegative",default:.5},position:{type:"vector3any",default:{x:0,y:0,z:1}}},point:{color:{type:"color",default:16777215},intensity:{type:"notnegative",default:.5},distance:{type:"notnegative",default:0},decay:{type:"notnegative",default:2},position:{type:"vector3any",default:{x:0,y:0,z:0}}},spot:{color:{type:"color",default:16777215},intensity:{type:"notnegative",default:.5},distance:{type:"notnegative",default:0},angle:{type:"notnegative",default:Math.PI/4},penumbra:{type:"notnegative",default:.5},decay:{type:"notnegative",default:1},position:{type:"vector3any",default:{x:1,y:1,z:1}},target:{type:"vector3any",default:{x:0,y:0,z:0}}},flash:{color:{type:"color",default:16777215},intensity:{type:"notnegative",default:.4},distance:{type:"notnegative",default:0},angle:{type:"notnegative",default:Math.PI/2},penumbra:{type:"notnegative",default:5},decay:{type:"notnegative",default:5}}},lightTypes$$module$src$3d$viewports$default$defaults$DefaultLights={AMBIENT:"ambient",DIRECTIONAL:"directional",HEMISPHERE:"hemisphere",POINT:"point",SPOT:"spot",FLASH:"flash"},initFunction$$module$src$3d$viewports$default$defaults$DefaultLights={ambient:function(e,t,n){var r=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor();return e=new module$src$externals$three.default.AmbientLight(r,e.properties.intensity),t.add(e),t=new module$src$externals$three.default.Object3D,n.add(t),{light:e,helper:new module$src$externals$three.default.Object3D}},directional:function(e,t,n,r,o,a){var i=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor(),s=new module$src$externals$three.default.DirectionalLight(i,e.properties.intensity),l=new module$src$externals$three.default.Object3D;return t.add(l),s.target=l,t.add(s),s.direction=module$src$shared$util$GlobalUtils.default.toVector3(e.properties.direction).normalize(),s.position.set(r.center.x+s.direction.x*r.radius*2.35,r.center.y+s.direction.y*r.radius*2.35,r.center.z+s.direction.z*r.radius*2.35),s.target.position.set(r.center.x,r.center.y,r.center.z),e.properties.castShadow&&(s.shadows=!0,s.castShadow=!o&&a,s.shadow.camera.up.set(0,0,1),s.shadow.camera.far=8*r.radius,s.shadow.camera.right=1.5*r.radius,s.shadow.camera.left=-1.5*r.radius,s.shadow.camera.top=1.5*r.radius,s.shadow.camera.bottom=-1.5*r.radius,s.shadow.mapSize.width=2048,s.shadow.mapSize.height=2048,s.shadow.radius=2,s.shadow.bias=-.00175,s.shadow.camera.updateProjectionMatrix()),(e=new module$src$externals$three.default.ArrowHelper(s.direction.clone().multiplyScalar(-1),s.position,s.target.position.distanceTo(s.position),i)).cone.material.wireframe=!0,n.add(e),{light:s,helper:e}},hemisphere:function(e,t,n){var r=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.skyColor).toThreeColor(),o=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.groundColor).toThreeColor();return(r=new module$src$externals$three.default.HemisphereLight(r,o,e.properties.intensity)).position.set(0,0,Math.abs(e.properties.position.z)),r.up.set(0,0,1),t.add(r),e=new module$src$externals$three.default.Object3D,n.add(e),{light:r,helper:e}},point:function(e,t,n,r){var o=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor(),a=new module$src$externals$three.default.PointLight(o,e.properties.intensity,e.properties.distance,e.properties.decay);return a.position.set(e.properties.position.x,e.properties.position.y,e.properties.position.z),t.add(a),t=new module$src$externals$three.default.IcosahedronBufferGeometry(r.radius/10,0),o=new module$src$externals$three.default.MeshBasicMaterial({color:o,wireframe:!0,fog:!1}),o=new module$src$externals$three.default.Mesh(t,o),(t=new module$src$externals$three.default.Object3D).add(o),t.position.set(e.properties.position.x,e.properties.position.y,e.properties.position.z),n.add(t),{light:a,helper:t}},spot:function(e,t,n){var r=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor(),o=new module$src$externals$three.default.Vector3(e.properties.position.x,e.properties.position.y,e.properties.position.z).distanceTo(new module$src$externals$three.default.Vector3(e.properties.target.x,e.properties.target.y,e.properties.target.z));return r=new module$src$externals$three.default.SpotLight(r,e.properties.intensity,o,e.properties.angle,e.properties.penumbra,e.properties.decay),o=new module$src$externals$three.default.Object3D,t.add(o),r.target=o,r.position.set(e.properties.position.x,e.properties.position.y,e.properties.position.z),r.target.position.set(e.properties.target.x,e.properties.target.y,e.properties.target.z),r.up.set(0,0,1),t.add(r),(e=new module$src$externals$three.default.SpotLightHelper(r)).up.set(0,0,1),n.add(e),{light:r,helper:e}},flash:function(e,t,n){var r=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor();return(e=new module$src$externals$three.default.SpotLight(r,e.properties.intensity,e.properties.distance,e.properties.angle,e.properties.penumbra,e.properties.decay)).position.set(0,0,1),e.target=t.cameraHandler.getCamera(),t.cameraHandler.getCamera().add(e),t=new module$src$externals$three.default.Object3D,n.add(t),{light:e,helper:t}}},updateFunction$$module$src$3d$viewports$default$defaults$DefaultLights={ambient:function(e,t){var n=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor();t.light.color=n,t.light.intensity=e.properties.intensity},directional:function(e,t,n,r,o){var a=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor();t.light.color=a,t.light.intensity=e.properties.intensity,t.light.direction=module$src$shared$util$GlobalUtils.default.toVector3(e.properties.direction).normalize(),t.light.position.set(n.center.x+t.light.direction.x*n.radius*2.35,n.center.y+t.light.direction.y*n.radius*2.35,n.center.z+t.light.direction.z*n.radius*2.35),t.light.target.position.set(n.center.x,n.center.y,n.center.z),t.light.shadows!==e.properties.castShadow&&(e.properties.castShadow?(t.light.shadows=!0,t.light.castShadow=!r&&o,t.light.shadow.camera.up.set(0,0,1),t.light.shadow.camera.far=8*n.radius,t.light.shadow.camera.right=1.5*n.radius,t.light.shadow.camera.left=-1.5*n.radius,t.light.shadow.camera.top=1.5*n.radius,t.light.shadow.camera.bottom=-1.5*n.radius,t.light.shadow.mapSize.width=2048,t.light.shadow.mapSize.height=2048,t.light.shadow.radius=2,t.light.shadow.bias=-.00175,t.light.shadow.camera.updateProjectionMatrix()):(t.light.shadows=!1,t.light.castShadow=!1)),t.helper.setColor(a),t.helper.setDirection(t.light.direction.clone().multiplyScalar(-1)),t.helper.position.set(t.light.position.x,t.light.position.y,t.light.position.z),t.helper.setLength(t.light.target.position.distanceTo(t.light.position))},hemisphere:function(e,t){t.light.position.set(0,0,Math.abs(e.properties.position.z)),t.light.intensity=e.properties.intensity,t.light.skyColor==e.properties.skyColor&&t.light.groundColor==e.properties.groundColor||(t.light.skyColor=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.skyColor).toThreeColor(),t.light.groundColor=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.groundColor).toThreeColor())},point:function(e,t){var n=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor();t.light.color=n,t.light.intensity=e.properties.intensity,t.light.distance=e.properties.distance,t.light.decay=e.properties.decay,t.light.position.set(e.properties.position.x,e.properties.position.y,e.properties.position.z),t.helper.children[0].material.color=n,t.helper.position.set(e.properties.position.x,e.properties.position.y,e.properties.position.z)},spot:function(e,t){var n=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor();t.light.color=n,t.light.intensity=e.properties.intensity,n=new module$src$externals$three.default.Vector3(e.properties.position.x,e.properties.position.y,e.properties.position.z).distanceTo(new module$src$externals$three.default.Vector3(e.properties.target.x,e.properties.target.y,e.properties.target.z)),t.light.distance=n,t.light.angle=e.properties.angle,t.light.penumbra=e.properties.penumbra,t.light.decay=e.properties.decay,t.light.position.set(e.properties.position.x,e.properties.position.y,e.properties.position.z),t.light.target.position.set(e.properties.target.x,e.properties.target.y,e.properties.target.z),t.helper.update()},flash:function(e,t){var n=module$src$shared$util$GlobalUtils.default.toTinyColor(e.properties.color).toThreeColor();t.light.color=n,t.light.intensity=e.properties.intensity,t.light.distance=e.properties.distance,t.light.angle=e.properties.angle,t.light.penumbra=e.properties.penumbra,t.light.decay=e.properties.decay}};module$src$3d$viewports$default$defaults$DefaultLights.default={lightScenes:lightScenes$$module$src$3d$viewports$default$defaults$DefaultLights,lightProperties:lightProperties$$module$src$3d$viewports$default$defaults$DefaultLights,lightTypes:lightTypes$$module$src$3d$viewports$default$defaults$DefaultLights,lightInit:initFunction$$module$src$3d$viewports$default$defaults$DefaultLights,lightUpdate:updateFunction$$module$src$3d$viewports$default$defaults$DefaultLights};var module$src$3d$viewports$default$handlers$LightHandler={default:function(e,t){var n,r=module$src$3d$viewports$default$defaults$DefaultLights.default.lightTypes,o=module$src$3d$viewports$default$defaults$DefaultLights.default.lightInit,a=module$src$3d$viewports$default$defaults$DefaultLights.default.lightUpdate,i=e.settings,s=new module$src$externals$three.default.Object3D,l=new module$src$externals$three.default.Object3D,u=new module$src$externals$three.default.Object3D,c=new module$src$externals$three.default.Object3D,d=new module$src$externals$three.default.Sphere,p=!1,h=e.shadows,m={},f=module$src$3d$viewports$default$defaults$DefaultLights.default.lightScenes,g={},$=module$src$3d$viewports$default$defaults$DefaultLights.default.lightProperties,v=function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string",t.threeDManager.warn,"LightHandler.Hook->lightScene")||(f[e]||g[e]?f[e]===m.id||g[e]===m.id?(t.threeDManager.warn("LightHandler.Hook->lightScene","The current light scene is already set to this value."),1):(m.id!==e&&n.setLightSceneFromID(e),0):(t.threeDManager.warn("LightHandler.Hook->lightScene","The provided light scene is not available."),1)))},y=function(e){return g=e,!0},_=function(e){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",t.threeDManager.warn,"LightHandler.Hook->helper"))return!1;c.visible=e,t.renderingHandler.updateShadowMap(),t.renderingHandler.render()},b=function(){for(var e in module$src$3d$interfaces$handlers$LightHandlerInterface.default.call(this),n=this,t.threeDManager.helpers.addSceneObject(s),s.add(u),s.add(c),s.visible=t.threeDManager.getSetting("camera.type")==module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE,c.visible=i.getSetting("helper"),t.threeDManager.helpers.addSceneObject(l),l.add(new module$src$externals$three.default.AmbientLight(16777215,1)),l.visible=t.threeDManager.getSetting("camera.type")!=module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE,d.radius=25,(m=JSON.parse(JSON.stringify(f.default))).lights)n.updateLight(m.lights[e]);m.wasUpdated=!1,m.id="default",i.registerHook("lightScene",v),i.registerHook("lightScenes",y),i.registerHook("helper",_)};return $jscomp.inherits(b,module$src$3d$interfaces$handlers$LightHandlerInterface.default),b.prototype.pause=function(){},b.prototype.resume=function(){},b.prototype.destroy=function(){},b.prototype._getCleanLightScene=function(e){for(var t in delete(e=JSON.parse(JSON.stringify(e))).wasUpdated,e.lights)delete e.lights[t].lightObject,delete e.lights[t].wasUpdated;return e},b.prototype._updateLightObject=function(e,n){n?e.type===r.DIRECTIONAL?a[r.DIRECTIONAL](e,n,d,p,h):e.type===r.AMBIENT?a[r.AMBIENT](e,n):e.type===r.HEMISPHERE?a[r.HEMISPHERE](e,n):e.type===r.POINT?a[r.POINT](e,n):e.type===r.SPOT?a[r.SPOT](e,n):e.type===r.FLASH&&a[r.FLASH](e,n):(e.type===r.DIRECTIONAL?n=o[r.DIRECTIONAL](e,u,c,d,p,h):e.type===r.AMBIENT?n=o[r.AMBIENT](e,u,c):e.type===r.HEMISPHERE?n=o[r.HEMISPHERE](e,u,c):e.type===r.POINT?n=o[r.POINT](e,u,c,d):e.type===r.SPOT?n=o[r.SPOT](e,u,c):e.type===r.FLASH&&((n=o[r.FLASH](e,t,c)).visible=t.threeDManager.getSetting("camera.type")==module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE),e.lightObject=n)},b.prototype._createDefault=function(e){var t,n={};for(t in $[e])n[t]=$[e][t].default;return e===r.SPOT?(e=d.center.clone().add(new module$src$externals$three.default.Vector3(1,0,1).normalize().multiplyScalar(2*d.radius)),n.position={x:e.x,y:e.y,z:e.z},n.target={x:d.center.x,y:d.center.y,z:d.center.z}):e===r.POINT&&(e=d.center.clone().add(new module$src$externals$three.default.Vector3(0,0,1).normalize().multiplyScalar(d.radius)),n.position={x:e.x,y:e.y,z:e.z}),n},b.prototype._evaluateProperties=function(e,t,n){for(var r in n.properties)null!=t[r]&&$[e][r]&&module$src$shared$util$GlobalUtils.default.typeCheck(t[r],$[e][r].type)&&(n.properties[r]=t[r]);return n},b.prototype._parseLightDefinition=function(e,t){return e.id&&module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")||(e.id=module$src$shared$util$GlobalUtils.default.createRandomId()),e.type&&-1!==Object.values(r).indexOf(e.type)?(t||((t={}).id=e.id,t.type=e.type,t.properties=n._createDefault(e.type)),n._evaluateProperties(e.type,e.properties,t)):null},b.prototype.updateLight=function(e){var r=n._parseLightDefinition(e,e.id&&module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")?m.lights[e.id]:null);return!(!r||r.type!==e.type||(n._updateLightObject(r,r.lightObject),m.lights[r.id]=r,m.wasUpdated||(m.wasUpdated=!0,m.id=module$src$shared$util$GlobalUtils.default.createRandomId()),t.renderingHandler.updateShadowMap(),t.renderingHandler.render(),0))},b.prototype.removeLight=function(e){return!(!e||!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")||(c.remove(m.lights[e].lightObject.helper),m.lights[e].lightObject.light.target&&u.remove(m.lights[e].lightObject.light.target),u.remove(m.lights[e].lightObject.light),m.lights[e].type===r.FLASH?t.cameraHandler.getCamera().remove(m.lights[e].lightObject.light):u.remove(m.lights[e].lightObject.light),delete m.lights[e].lightObject,delete m.lights[e],m.wasUpdated||(m.wasUpdated=!0,m.id=module$src$shared$util$GlobalUtils.default.createRandomId()),t.renderingHandler.updateShadowMap(),t.renderingHandler.render(),0))},b.prototype.getLight=function(e){return n._getCleanLightScene(m).lights[e]},b.prototype.setLightSceneFromID=function(e){if(e&&module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&(f[e]||g[e])){for(var t in m.lights)n.removeLight(t);var r;for(var o in f[e]?r=JSON.parse(JSON.stringify(f[e])):g[e]&&(r=JSON.parse(JSON.stringify(g[e]))),r.lights)n.updateLight(r.lights[o]);return m.id=r.id,m.wasUpdated=!1,i.updateSetting("lightScene",e),!0}return!1},b.prototype.setLightSceneFromDefinition=function(e){for(var t in e.id&&module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")&&!f[e.id]||(e.id=module$src$shared$util$GlobalUtils.default.createRandomId()),m.lights)n.removeLight(t);for(var r in m={id:e.id,wasUpdated:!1,lights:{}},e.lights)n.updateLight(e.lights[r]);return n.saveLightScene(e.id),m.id},b.prototype.getLightScene=function(e){return e?f[e]?n._getCleanLightScene(f[e]):g[e]?n._getCleanLightScene(g[e]):void 0:n._getCleanLightScene(m)},b.prototype.getAllLightScenes=function(){return Object.keys(f).concat(Object.keys(g))},b.prototype.saveLightScene=function(e){return e&&module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&!f[e]||(e=module$src$shared$util$GlobalUtils.default.createRandomId()),m.id=e,m.wasUpdated=!1,g[e]=n._getCleanLightScene(m),i.updateSetting("lightScenes",g),i.updateSetting("lightScene",e),e},b.prototype.adjustToBoundingSphere=function(e){for(var n in d=e,m.lights){var r=m.lights[n].lightObject.light,o=m.lights[n].lightObject.helper;r.isDirectionalLight?(r.position.set(e.center.x+r.direction.x*e.radius*2.35,e.center.y+r.direction.y*e.radius*2.35,e.center.z+r.direction.z*e.radius*2.35),r.target.position.set(e.center.x,e.center.y,e.center.z),o.setDirection(r.direction.clone().multiplyScalar(-1)),o.position.set(r.position.x,r.position.y,r.position.z),o.setLength(r.target.position.distanceTo(r.position)),r.shadows&&(r.shadow.camera.far=8*e.radius,r.shadow.camera.right=1.5*e.radius,r.shadow.camera.left=-1.5*e.radius,r.shadow.camera.top=1.5*e.radius,r.shadow.camera.bottom=-1.5*e.radius,r.shadow.camera.updateProjectionMatrix())):r.isPointLight&&(o.children[0].geometry.radius=d.radius/10)}t.renderingHandler.updateShadowMap()},b.prototype.adaptLightingToCameraType=function(e){for(var t in s.visible=e==module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE,l.visible=e!=module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE,m.lights){var n=m.lights[t];n.type===r.FLASH&&(n.lightObject.visible=e==module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE)}return!0},b.prototype.setToggleLightShadows=function(e){for(h=e,e=0;e<u.children.length;e++)u.children[e].shadows&&(u.children[e].castShadow=!p&&h)},b.prototype.shadowSettingOverride=function(e){p||(p=e),p&&(t.threeDManager.warn("LightHandler","Due to restrictions to the number of maps that can be used with this device, the shadows were disabled."),n.setToggleLightShadows())},b.prototype.reevaluateNumberOfShadowMaps=function(e){for(var r=t.threeDManager.helpers.getMaterials(),o=0,a=r.length;o<a;o++){var i=r[o];i.availableTextures&&(e=Math.min(e,i.availableTextures))}for(o=r=0;o<u.children.length;o++)u.children[o].castShadow&&r++;n.shadowSettingOverride(r-1>=e)},b.prototype.toggleLights=function(e){u.visible=e},new b(e)}},module$src$3d$viewports$default$handlers$HighlightingHandler={default:function(e,t){var n,r=e.pathUtils,o=e.geometryNode,a=null,i=null,s=[],l=[],u=!1,c=!1,d=function(){n=this};return d.prototype._highlight=function(e,t,n){t&&(e=r.getPathObject(o,e.interactionPath+"")).highlighted!=n&&(e.highlighted=n,e.traverse((function(e){n?t.apply(e,t.options):t.remove(e,t.options)})))},d.prototype.setDragged=function(e){return n.setToggleHighlights(!1),i=e,n.setToggleHighlights(!0),!0},d.prototype.removeDragged=function(){return n.setToggleHighlights(!1),i=null,n.setToggleHighlights(!0),!0},d.prototype.getDragged=function(){return i},d.prototype.toggleSelected=function(e){n.setToggleHighlights(!1);for(var t=-1,r=0;r<s.length;r++)void 0!==e.interactionPath?e.interactionPath===s[r].interactionPath&&(t=r):s[r]==e&&(t=r);return r=!1,-1<t?s.splice(t,1):(s.push(e),r=!0),c=!0,n.setToggleHighlights(!0,r),r},d.prototype.setSelected=function(e){if(!e.interactionGroup)return!1;n.setToggleHighlights(!1);for(var t=-1,r=0;r<s.length;r++)void 0!==e.interactionPath?e.interactionPath===s[r].interactionPath&&(t=r):s[r]==e&&(t=r);return-1===t&&s.push(e),c=-1===t,n.setToggleHighlights(!0),!0},d.prototype.removeSelected=function(e){if(!e.interactionGroup)return!1;var t=!1;n.setToggleHighlights(!1);for(var r=-1,o=0;o<s.length;o++)void 0!==e.interactionPath?e.interactionPath===s[o].interactionPath&&(r=o):s[o]==e&&(r=o);return-1!==r&&(s.splice(r,1),t=!0),c=-1!==r,n.setToggleHighlights(!0),t},d.prototype.getSelected=function(){return s},d.prototype.setHovered=function(e){return n.setToggleHighlights(!1),a=e,n.setToggleHighlights(!0),!0},d.prototype.removeHovered=function(){return n.setToggleHighlights(!1),a=null,n.setToggleHighlights(!0),!0},d.prototype.getHovered=function(){return a},d.prototype.removeObject=function(e){return n.removeSelected(e),a===e&&(a=null),i===e&&(i=null),-1!=(e=l.indexOf(e))&&l.splice(e,1),!0},d.prototype.setInteractable=function(e){return!!Array.isArray(e)&&(n.setToggleHighlights(!1),l=e,n.setToggleHighlights(!0),!0)},d.prototype.setToggleHighlights=function(e){if("boolean"!=typeof e)return t.threeDManager.warn("HighlightingHandler.setToggleHighlights","Not a boolean. The highlighting was not toggled."),!1;if(u==e)return!1;if(t.threeDManager.helpers.toggleViewport(!0),u=e,i){var r=t.interactionGroupManager.getGroup(i.interactionGroup);n._highlight(i,r.getDraggableHighlight().active,e)}var o=0;for(r=s.length;o<r;o++){var d=s[o],p=t.interactionGroupManager.getGroup(d.interactionGroup);n._highlight(d,p.getSelectableHighlight().active,e)}if(a&&!c&&(r=t.interactionGroupManager.getGroup(a.interactionGroup),n._highlight(a,r.getHoverableHighlight().active,e)),i)for(o=t.interactionGroupManager.getGroup(i.interactionGroup),d=0,r=l.length;d<r;d++)l[d].interactionGroup==i.interactionGroup&&l[d]!=i&&n._highlight(l[d],o.getDraggableHighlight().passive,e);if(a&&!c)for(o=t.interactionGroupManager.getGroup(a.interactionGroup),d=0,r=l.length;d<r;d++)l[d].interactionGroup==a.interactionGroup&&l[d]!=a&&n._highlight(l[d],o.getHoverableHighlight().passive,e);for(o=0,r=s.length;o<r;o++){p=t.interactionGroupManager.getGroup((d=s[o]).interactionGroup);for(var h={i$191:0},m=l.length;h.i$191<m;(h={i$191:h.i$191}).i$191++)l[h.i$191].interactionGroup==d.interactionGroup&&(s.includes(l[h.i$191])||(void 0!==l[h.i$191].interactionPath?0===s.filter(function(e){return function(t){return t.interactionPath===l[e.i$191].interactionPath}}(h)).length&&n._highlight(l[h.i$191],p.getSelectableHighlight().passive,e):n._highlight(l[h.i$191],p.getSelectableHighlight().passive,e)))}return c&&(c=u),t.threeDManager.helpers.toggleViewport(!1),!0},d.prototype.getToggleHighlights=function(){return u},new d(e)}},module$src$3d$viewports$default$handlers$InteractionHandler={default:function(e,t){var n,r,o=e.pathUtils,a=e.settings,i=e.scene,s=e.geometryNode,l=[],u=t.renderingHandler.getDomElement(),c=!1,d=new module$src$externals$three.default.Vector3,p=new module$src$externals$three.default.Vector3,h=function(){n=this,(r=new module$src$externals$three.default.DragControls(l,t.cameraHandler.getCamera(),u)).addEventListener("dragstart",n._interactionStartEvent),r.addEventListener("drag",n._interactionEvent),r.addEventListener("dragend",n._interactionEndEvent),r.addEventListener("hoveron",n._hoverStartEvent),r.addEventListener("hover",n._hoverEvent),r.addEventListener("hoveroff",n._hoverEndEvent),r.addEventListener("emptyclick",n._interactionEmptyClickEvent),r.addEventListener("mousedowncustom",(function(){c=!0})),r.addEventListener("mouseupcustom",(function(){c=!1})),t.highlightingHandler=new module$src$3d$viewports$default$handlers$HighlightingHandler.default({settings:a,scene:i,geometryNode:s,pathUtils:o},t),t.threeDManager.highlightingHandler=t.highlightingHandler};return h.prototype._dispatchEvent=function(e){for(var t=new CustomEvent(e.type),n=$jscomp.makeIterator(e),r=n.next();!r.done;r=n.next())t[r=r.value]=e[r];return u.dispatchEvent(t),t},h.prototype._interactionStartEvent=function(e){if(e.object.interactionGroup){var r=t.interactionGroupManager.getGroup(e.object.interactionGroup);if(r&&(1==r.isDraggable()||1==r.isSelectable())){var a=void 0===e.object.interactionPath||!0===e.object.parent.meshHelper&&"global"!==e.object.parent.interactionType?e.object.parent:o.getPathObject(s,e.object.interactionPath+"");if(1==r.isDraggable()){d.copy(e.object.position),p.copy(e.object.position),t.threeDManager.updateSetting("camera.enableOrbitControls",!1),t.renderingHandler.updateShadowMap(),t.highlightingHandler.setDragged(e.object),t.renderingHandler.registerForContinuousRendering("interactionInProcess");var i={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_DRAG_START,obj:a,scenePath:o.getObjectPath(a),dragPosStart:d.clone(),clientX:e.event.clientX,clientY:e.event.clientY},l=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,i);t.threeDManager.message(i.type+"."+i.scenePath,l),n._dispatchEvent(i)}if(1==r.isSelectable()){if(r={clientX:e.event.clientX,clientY:e.event.clientY},t.highlightingHandler.toggleSelected(e.object)){if(r.type=module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SELECT_ON,"single"===t.interactionGroupManager.getGroup(e.object.interactionGroup).getSelectionMode()){l=0;for(var u=(i=t.highlightingHandler.getSelected()).length;l<u;l++)if(i[l].interactionGroup==e.object.interactionGroup&&i[l]!=e.object){u=void 0===i[l].interactionPath||!0===i[l].parent.meshHelper&&"global"!==i[l].parent.interactionType?i[l].parent:o.getPathObject(s,i[l].interactionPath+""),t.highlightingHandler.removeSelected(i[l]),i={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SELECT_OFF,obj:u,scenePath:o.getObjectPath(u),clientX:e.event.clientX,clientY:e.event.clientY},l=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,i),t.threeDManager.message(i.type+"."+i.scenePath,l),n._dispatchEvent(i);break}}}else r.type=module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SELECT_OFF;r.obj=a,r.scenePath=o.getObjectPath(a),r.type===module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SELECT_ON&&(r.selectPos=e.point),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,r),t.threeDManager.message(r.type+"."+r.scenePath,e),n._dispatchEvent(r),t.renderingHandler.render()}}}},h.prototype._interactionEvent=function(e){if(e.object.interactionGroup){var r=t.interactionGroupManager.getGroup(e.object.interactionGroup);r&&0!=r.isDraggable()&&e.position&&((r=void 0===e.object.interactionPath||!0===e.object.parent.meshHelper&&"global"!==e.object.parent.interactionType?e.object.parent:o.getPathObject(s,e.object.interactionPath+"")).position.add(e.position.clone().sub(p)),p.copy(e.position),(e={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_DRAG_MOVE,obj:r,scenePath:o.getObjectPath(r),dragPosStart:d.clone(),dragPosAbs:p.clone(),clientX:e.event.clientX,clientY:e.event.clientY}).dragPosRel=e.dragPosAbs.clone().sub(e.dragPosStart),r=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,e),t.threeDManager.message(e.type+"."+e.scenePath,r),n._dispatchEvent(e),t.renderingHandler.updateShadowMap())}},h.prototype._interactionEndEvent=function(e){if(e.object.interactionGroup){var r=t.interactionGroupManager.getGroup(e.object.interactionGroup);if(r&&0!=r.isDraggable()){t.highlightingHandler.removeDragged(),r={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_DRAG_END,clientX:e.event.clientX,clientY:e.event.clientY};var a=t.highlightingHandler.getHovered();a&&(a=void 0===a.interactionPath||!0===a.parent.meshHelper&&"global"!==a.parent.interactionType?a.parent:o.getPathObject(s,a.interactionPath+""),r.hovered={obj:a,scenePath:o.getObjectPath(a)}),e=void 0===e.object.interactionPath||!0===e.object.parent.meshHelper&&"global"!==e.object.parent.interactionType?e.object.parent:o.getPathObject(s,e.object.interactionPath+""),r.obj=e,r.scenePath=o.getObjectPath(e),r.dragPosStart=d.clone(),r.dragPosAbs=p.clone(),r.dragPosRel=r.dragPosAbs.clone().sub(r.dragPosStart),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,r),t.threeDManager.message(r.type+"."+r.scenePath,e),t.threeDManager.updateSetting("camera.enableOrbitControls",!0),t.renderingHandler.unregisterForContinuousRendering("interactionInProcess"),n._dispatchEvent(r)}}},h.prototype._interactionEmptyClickEvent=function(){for(var e=t.highlightingHandler.getSelected(),r=!1,a=e.length;a--;)if("single"===t.interactionGroupManager.getGroup(e[a].interactionGroup).getSelectionMode()){r=void 0===e[a].interactionPath||!0===e[a].parent.meshHelper&&"global"!==e[a].parent.interactionType?e[a].parent:o.getPathObject(s,e[a].interactionPath+""),t.highlightingHandler.removeSelected(e[a]),r={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SELECT_OFF,obj:r,scenePath:o.getObjectPath(r)};var i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,r);t.threeDManager.message(r.type+"."+r.scenePath,i),n._dispatchEvent(r),r=!0}1==r&&t.renderingHandler.render()},h.prototype._hoverStartEvent=function(e){if((!0!==c||t.highlightingHandler.getDragged())&&e.object.interactionGroup){var r=t.interactionGroupManager.getGroup(e.object.interactionGroup);r&&0!=r.isHoverable()&&(r=void 0===e.object.interactionPath||!0===e.object.parent.meshHelper&&"global"!==e.object.parent.interactionType?e.object.parent:o.getPathObject(s,e.object.interactionPath+""),t.highlightingHandler.setHovered(e.object),t.renderingHandler.registerForContinuousRendering("hoverInProcess"),e={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_HOVER_ON,obj:r,scenePath:o.getObjectPath(r),hoverPos:e.point,clientX:e.event.clientX,clientY:e.event.clientY},r=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,e),t.threeDManager.message(e.type+"."+e.scenePath,r),n._dispatchEvent(e))}},h.prototype._hoverEvent=function(e){if((!0!==c||t.highlightingHandler.getDragged())&&e.object.interactionGroup){var r=t.interactionGroupManager.getGroup(e.object.interactionGroup);if(r&&0!=r.isHoverable()){if(r=void 0===e.object.interactionPath||!0===e.object.parent.meshHelper&&"global"!==e.object.parent.interactionType?e.object.parent:o.getPathObject(s,e.object.interactionPath+""),t.highlightingHandler.getHovered()!==e.object){t.highlightingHandler.setHovered(e.object),t.renderingHandler.registerForContinuousRendering("hoverInProcess");var a={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_HOVER_ON,obj:r,scenePath:o.getObjectPath(r),hoverPos:e.point,clientX:e.event.clientX,clientY:e.event.clientY},i=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,a);t.threeDManager.message(a.type+"."+a.scenePath,i),n._dispatchEvent(a)}e={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_HOVER_OVER,obj:r,scenePath:o.getObjectPath(r),hoverPos:e.point,clientX:e.event.clientX,clientY:e.event.clientY},r=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,e),t.threeDManager.message(e.type+"."+e.scenePath,r),n._dispatchEvent(e)}}},h.prototype._hoverEndEvent=function(e){if(t.highlightingHandler.getHovered()&&e.object.interactionGroup){var r=t.interactionGroupManager.getGroup(e.object.interactionGroup);r&&0!=r.isHoverable()&&(r=void 0===e.object.interactionPath||!0===e.object.parent.meshHelper&&"global"!==e.object.parent.interactionType?e.object.parent:o.getPathObject(s,e.object.interactionPath+""),t.highlightingHandler.removeHovered(),e={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_HOVER_OFF,obj:r,scenePath:o.getObjectPath(r),clientX:e.event.clientX,clientY:e.event.clientY},r=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,e),t.threeDManager.message(e.type+"."+e.scenePath,r),t.renderingHandler.unregisterForContinuousRendering("hoverInProcess"),n._dispatchEvent(e))}},h.prototype.addToInteractionGroup=function(e,a,i,u){var c=o.getPathObject(s,e+"");if(!c)return t.threeDManager.warn("InteractionHandler.addToInteractionGroup","No valid path provided, interactivity was not set."),!1;if(!a||!t.interactionGroupManager.isInteractionGroup(a))return t.threeDManager.warn("InteractionHandler.addToInteractionGroup","No valid group provided, interactivity was not set."),!1;var d=t.interactionGroupManager.getGroup(a);if(!d)return!1;var p=d.isSelectable(a)||d.isDraggable(a)||d.isHoverable(a);return"global"===i&&(c.interactionGroup=a),c.traverse((function(t){"Mesh"==t.type&&(t.interactionGroup=a,!0===t.parent.meshHelper&&(t.parent.interactionGroup=a,t.interactionPath=o.getObjectPath(t.parent.parent),t.parent.interactionType="global"===i?"global":"sub"),"global"===i&&(t.interactionPath=e+""),p&&l.push(t))})),u?n.setInteractionPlaneNormal(e,u):n.removeInteractionPlaneNormal(e),r.setObjects(l),t.highlightingHandler.setInteractable(l),!0},h.prototype.removeFromInteractions=function(e){return(e=o.getPathObject(s,e+""))?(e.traverse((function(e){for(var r=t.highlightingHandler.getSelected(),a=-1,i=0;i<r.length;i++)void 0!==e.interactionPath?e.interactionPath===r[i].interactionPath&&(a=i):r[i]==e&&(a=i);-1!==a&&(t.highlightingHandler.removeObject(e),r={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SELECT_OFF,obj:e,scenePath:o.getObjectPath(e)},a=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,r),t.threeDManager.message(r.type+"."+r.scenePath,a),n._dispatchEvent(r)),e===t.highlightingHandler.getHovered()&&(t.highlightingHandler.removeHovered(),t.highlightingHandler.removeObject(e),r={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_HOVER_OFF,obj:e,scenePath:o.getObjectPath(e)},a=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,r),t.threeDManager.message(r.type+"."+r.scenePath,a),t.renderingHandler.unregisterForContinuousRendering("hoverInProcess"),n._dispatchEvent(r)),e===t.highlightingHandler.getDragged()&&(t.highlightingHandler.removeDragged(),t.highlightingHandler.removeObject(e),r=void 0!==e.interactionPath?p:e.position,(r={type:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_DRAG_END,obj:e,scenePath:o.getObjectPath(e),dragPosStart:d.clone(),dragPosAbs:r.clone()}).dragPosRel=r.dragPosAbs.clone().sub(r.dragPosStart),a=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION,r),t.threeDManager.message(r.type+"."+r.scenePath,a),t.threeDManager.updateSetting("camera.enableOrbitControls",!0),t.renderingHandler.unregisterForContinuousRendering("interactionInProcess"),n._dispatchEvent(r)),"Mesh"==e.type&&(delete e.interactionGroup,delete e.interactionPath,-1<(e=l.indexOf(e))&&l.splice(e,1))})),r.setObjects(l),t.highlightingHandler.setInteractable(l),!0):(t.threeDManager.warn("InteractionHandler.removeFromInteractionGroup","No valid path provided, interactivity was not removed."),!1)},h.prototype.removeAllInteractivity=function(){for(var e=0,n=l.length;e<n;e++)t.highlightingHandler.removeObject(l[e]),delete l[e].interactionGroup,delete l[e].interactionPath;return r.setObjects(l=[]),t.highlightingHandler.setInteractable(l),!0},h.prototype.setSelectedPaths=function(e,r){e=e||[],r=r||[];for(var a=n.getSelectedPaths(),i=[],u=[],c=0,d=l.length;c<d;c++)void 0!==l[c].interactionPath?(i.push(l[c].interactionPath),u.push("global")):(i.push(o.getObjectPath(l[c])),u.push("sub"));for(u=0,d=e.length;u<d;u++){if(!0!==module$src$shared$util$GlobalUtils.default.typeCheck(e[u],"string"))return t.threeDManager.warn("InteractionHandler.setSelectedPaths","At least one path is not a string."),!1;if(!i.includes(e[u]))return t.threeDManager.warn("InteractionHandler.setSelectedPaths","At least one path is not interactable."),!1}for(u=0,d=r.length;u<d;u++){if(!0!==module$src$shared$util$GlobalUtils.default.typeCheck(r[u],"string"))return t.threeDManager.warn("InteractionHandler.setSelectedPaths","At least one path is not a string."),!1;if(!i.includes(r[u]))return t.threeDManager.warn("InteractionHandler.setSelectedPaths","At least one path is not interactable."),!1}for(i=0,d=r.length;i<d;i++)a.includes(r[i])&&o.getPathObject(s,r[i]+"").traverse((function(e){"Mesh"==e.type&&t.highlightingHandler.removeSelected(e)}));for(a=n.getSelectedPaths(),r=0,d=e.length;r<d;r++)a.includes(e[r])||o.getPathObject(s,e[r]+"").traverse((function(e){if("Mesh"==e.type){if("single"===t.interactionGroupManager.getGroup(e.interactionGroup).getSelectionMode())for(var n=t.highlightingHandler.getSelected(),r=0,o=n.length;r<o;r++)if(n[r].interactionGroup==e.interactionGroup){t.highlightingHandler.removeSelected(n[r]);break}t.highlightingHandler.setSelected(e)}}));return t.renderingHandler.render(),!0},h.prototype.getSelectedPaths=function(){for(var e=t.highlightingHandler.getSelected(),n=[],r=0,a=e.length;r<a;r++)n.push(void 0!==e[r].interactionPath?e[r].interactionPath+"":o.getObjectPath(e[r]));return n},h.prototype.setInteractionPlaneNormal=function(e,n){return(e=o.getPathObject(s,e))?(e.traverse((function(e){"Mesh"==e.type&&(e.interactionPlaneNormal=n)})),!0):(t.threeDManager.warn("InteractionHandler.setInteractionPlaneNormal","No valid path provided, interaction plane was not set."),!1)},h.prototype.removeInteractionPlaneNormal=function(e){return(e=o.getPathObject(s,e))?(e.traverse((function(e){"Mesh"==e.type&&e.hasOwnProperty("interactionPlaneNormal")&&delete e.interactionPlaneNormal})),!0):(t.threeDManager.warn("InteractionHandler.removeInteractionPlaneNormal","No valid path provided, interaction plane was not removed."),!1)},new h(e)}},module$src$3d$viewports$default$ThreeDManager={default:function(e,t){var n,r,o,a,i,s=t.pathUtils,l=t.settings,u=t.scene,c=t.geometryNode,d=t.container,p=t.interactionGroupManager,h={},m=[],f=0,g=d.offsetWidth,$=d.offsetHeight,v={},y=!0,_=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean")&&(d&&(d.style.opacity=e?1:0),!0)},b=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&(d&&(d.style.transition=0<e.length?"opacity "+e:"none"),!0)},x=function(e){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->fullscreen"))return!1;var t=d;if("true"!=d.getAttribute("sdv-fullscreen"))for(var r=d.parentElement,o=!1;!o&&null!==r;)"true"==r.getAttribute("sdv-fullscreen")?(o=!0,t=r):r=r.parentElement;return e&&!n._isInFullScreen()?(t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen(),v.left=t.style.left,v.top=t.style.top,v.backgroundColor=t.style.backgroundColor,t.style.left="0%",t.style.top="0%",t.style.backgroundColor=t.style.backgroundColor||"rgba(255,255,255,1)",h.renderingHandler.render(),!0):!e&&n._isInFullScreen()?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),module$src$shared$util$GlobalUtils.default.typeCheck(v.left,"string")&&(t.style.left=v.left,delete v.left),module$src$shared$util$GlobalUtils.default.typeCheck(v.top,"string")&&(t.style.top=v.top,delete v.top),module$src$shared$util$GlobalUtils.default.typeCheck(v.backgroundColor,"string")&&""!==v.backgroundColor&&(t.style.backgroundColor=v.backgroundColor,delete v.backgroundColor),h.renderingHandler.render(),!0):n._isInFullScreen()===e},w=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->groundPlaneVisibility")&&(a&&(a.visible=e),h.renderingHandler.render(),!0)},S=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->groundPlaneReflectionVisibility")&&(i&&(i.visible=e),e&&(n.warn("ThreeDManager.Hook->groundPlaneReflectionVisibility","The ground plane reflection and the environment as background do not work together right now."),n.updateSetting("material.environmentMapAsBackground",!1),h.materialHandler.setSceneBackground(null)),h.renderingHandler.render(),!0)},M=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"number",n.warn,"ThreeDManager.Hook->groundPlaneReflectionThreshold")&&(i&&(i.threshold=e),h.renderingHandler.render(),!0)},E=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->gridVisibility")&&(o&&(o.visible=e),h.renderingHandler.render(),!0)},T=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"number",n.warn,"ThreeDManager.Hook->duration")&&(f=e,!0)},C=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",n.warn,"ThreeDManager.Hook->ignorePointerEvents")&&(h.renderingHandler.getDomElement().style.pointerEvents=e?"none":"",!0)},P=function(e,t){module$src$3d$interfaces$ThreeDManagerInterface.default.call(this,t,module$src$shared$util$GlobalUtils.default),(n=this).constants=module$src$3d$viewports$default$ThreeDManagerConstants.default,h.threeDManager=n,n.viewerApi=e,r=new module$src$3d$helpers$ThreeDManagerHelpers.default({scene:u,geometryNode:c,pathUtils:s},h),h.threeDManager.helpers=r,d.style.padding="0",module$src$shared$mixins$SettingsMixin.default.call(n,l,module$src$3d$viewports$default$ThreeDManagerConstants.default.defaultSettings,t.runtimeId),document.addEventListener("webkitfullscreenchange",(function(){n.updateSetting("fullscreen",n._isInFullScreen())}),!1),document.addEventListener("mozfullscreenchange",(function(){n.updateSetting("fullscreen",n._isInFullScreen())}),!1),document.addEventListener("fullscreenchange",(function(){n.updateSetting("fullscreen",n._isInFullScreen())}),!1),this.renderingHandler=new module$src$3d$viewports$default$handlers$RenderingHandler.default({settings:n.getSection("render"),scene:u,geometryNode:c,container:d},h),h.renderingHandler=this.renderingHandler,!1!==n.success&&(this.materialHandler=new module$src$3d$viewports$default$handlers$MaterialHandler.default({settings:n.getSection("material"),scene:u,geometryNode:c,pathUtils:s},h),h.materialHandler=this.materialHandler,!1!==n.success&&(this.cameraHandler=new module$src$3d$viewports$default$handlers$CameraHandler.default({settings:n.getSection("camera"),scene:u,geometryNode:c,container:d},h),h.cameraHandler=this.cameraHandler,!1!==n.success&&(this.lightHandler=new module$src$3d$viewports$default$handlers$LightHandler.default({settings:n.getSection("lights"),shadows:n.getSettingShallow("render.shadows"),scene:u,geometryNode:c},h),h.lightHandler=this.lightHandler,!1!==n.success&&(h.interactionGroupManager=p,h.threeDManager.interactionGroupManager=p,this.interactionHandler=new module$src$3d$viewports$default$handlers$InteractionHandler.default({settings:n.getSection("interaction"),scene:u,geometryNode:c,pathUtils:s},h),h.interactionHandler=this.interactionHandler,!1!==n.success&&(this.registerHook("show",_),this.registerHook("showTransition",b),this.registerHook("fullscreen",x),this.registerHook("groundPlaneVisibility",w),this.registerHook("groundPlaneReflectionVisibility",S),this.registerHook("groundPlaneReflectionThreshold",M),this.registerHook("gridVisibility",E),this.registerHook("duration",T),this.registerHook("ignorePointerEvents",C))))))};return $jscomp.inherits(P,module$src$3d$interfaces$ThreeDManagerInterface.default),P.prototype._isInFullScreen=function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement)},P.prototype._getExchangeMeshMaterialObjects=function(){return m},P.prototype.init=function(e){h.renderingHandler.start();var t=e.min.distanceTo(e.max);if(1<t){var s=parseInt(t);s=(s=s.toString()).length,s=Math.pow(10,s-1),s=(t=Math.max(Math.ceil(t/s)*s,1))/(s/10)}else{s=1-Math.floor(Math.log(t)/Math.log(10))-2,t=t.toFixed(s+1);var l=parseInt(t.substr(t.length-1))+1;t="0.";for(var u=0;u<s;++u)t+="0";t=parseFloat(t+l),s=10*l}(o=new module$src$externals$three.default.GridHelper(2*t,s)).material.opacity=.15,o.material.transparent=!0,o.isSelectable=!1,o.rotateX(Math.PI/2),o.visible=n.getSetting("gridVisibility"),(s=new module$src$externals$three.default.Object3D).SDLocalPath="grid",s.add(o),t=new module$src$externals$three.default.PlaneGeometry(2*t,2*t,2,2),(a=new module$src$externals$three.default.Mesh(t,h.materialHandler.getMaterial(l={color:13882323,side:module$src$externals$three.default.FrontSide,roughness:1,metalness:0}))).receiveShadow=!0,a.visible=n.getSetting("groundPlaneVisibility"),(u=new module$src$externals$three.default.Object3D).SDLocalPath="groundplane",u.add(a),n.addMesh(a,a.material,l),(i=new module$src$externals$three.default.Reflector(t,{clipBias:.003,textureWidth:g*window.devicePixelRatio,textureHeight:$*window.devicePixelRatio,color:7829367,recursion:1})).receiveShadow=!0,i.transparent=!0,i.visible=n.getSetting("groundPlaneReflectionVisibility"),i.visible&&n.updateSetting("material.environmentMapAsBackground",!1),u.add(i),o.position.set(0,0,e.min.z-.005),a.position.set(0,0,e.min.z-.005),i.scale.set(1e3,1e3,1e3),i.position.set(0,0,e.min.z-.005),r.addSceneObject(s),r.addSceneObject(u),r.initialize(),n.adjustScene()},P.prototype.adjustScene=function(){if(r.isInitialized()){var e=c.computeSceneBoundingBox(),t=new module$src$externals$three.default.Sphere;e.getBoundingSphere(t),o.position.set(0,0,e.min.z-.005),a.position.set(0,0,e.min.z-.005),i.position.set(0,0,e.min.z-.005),h.materialHandler.adjustToBoundingSphere(t),h.lightHandler.adjustToBoundingSphere(t),h.cameraHandler.adjustToBoundingSphere(t),h.materialHandler.compile(),h.renderingHandler.updateShadowMap(),h.renderingHandler.render()}},P.prototype.computeBoundingBox=function(e){return c.computeBoundingBox(e)},P.prototype.pause=function(){y=!1,h.renderingHandler.pause(),h.cameraHandler.pause(),h.lightHandler.pause(),h.materialHandler.pause()},P.prototype.resume=function(){y=!0,h.renderingHandler.resume(),h.cameraHandler.resume(),h.lightHandler.resume(),h.materialHandler.resume()},P.prototype.destroy=function(){for(delete h.threeDManager,r.destroyViewport(),h.renderingHandler&&h.renderingHandler.destroy(),h.cameraHandler&&h.cameraHandler.destroy(),h.lightHandler&&h.lightHandler.destroy(),h.materialHandler&&h.materialHandler.destroy(),n.deregisterAllHooks(),n.deregisterAllNotifiers();d.firstChild;)d.removeChild(d.firstChild);for(var e in h)delete h[e]},P.prototype.addMesh=function(e,t,n){r.addMesh(e,t,n)},P.prototype.removeMesh=function(e){for(var t=0,n=m.length;t<n;t++)if(e===m[t].mesh){m.splice(t,1);break}r.removeMesh(e)},P.prototype.addAnchor=function(e,t){r.addAnchor(e,t)},P.prototype.removeAnchor=function(e){r.removeAnchor(e)},P.prototype.fadeIn=function(e,t){var n=s.getPathObject(c,e);return null==n?Promise.reject(Error("Could not fade in geometry, path not found")):(y?module$src$shared$util$GlobalUtils.default.typeCheck(t,"number")||(t=f):t=0,new Promise((function(o){r.toggleMeshes(!0),n.traverseVisible((function(e){e.SDMaterialDefinition&&e.material&&(e.material.transparent=!0,e.material.opacity=0)})),r.toggleMeshes(!1);var a={opacity:0},i=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(a).to({opacity:1},t).onUpdate((function(){r.toggleMeshes(!0),n.traverseVisible((function(e){e.SDMaterialDefinition&&e.material&&(e.material.opacity="gem"===e.SDMaterialDefinition.materialType?e.material.side===module$src$externals$three.default.FrontSide?a.opacity*(e.SDMaterialDefinition.transparent?e.SDMaterialDefinition.opacityFront:1):a.opacity*(e.SDMaterialDefinition.transparent?e.SDMaterialDefinition.opacityBack:1):a.opacity*(e.SDMaterialDefinition.transparent?e.SDMaterialDefinition.opacity:1))})),r.toggleMeshes(!1)})).onComplete((function(){r.toggleMeshes(!0),n.traverseVisible((function(e){e.SDMaterialDefinition&&e.material&&(e.material.opacity="gem"===e.SDMaterialDefinition.materialType?e.material.side===module$src$externals$three.default.FrontSide?e.SDMaterialDefinition.opacityFront:e.SDMaterialDefinition.opacityBack:e.SDMaterialDefinition.opacity,e.material.transparent=e.SDMaterialDefinition.transparent)})),r.toggleMeshes(!1),h.renderingHandler.unregisterForContinuousRendering("FADE_IN_"+e),o()}));h.renderingHandler.registerForContinuousRendering("FADE_IN_"+e),i.start()})))},P.prototype.fadeOut=function(e,t){var n=s.getPathObject(c,e);return null==n?Promise.reject(Error("Could not fade out, geometry, path not found.")):(y?module$src$shared$util$GlobalUtils.default.typeCheck(t,"number")||(t=f):t=0,new Promise((function(o){r.toggleMeshes(!0),n.traverseVisible((function(e){e.hasOwnProperty("material")&&(e.material.transparent=!0)})),r.toggleMeshes(!1);var a={opacity:1},i=new module$node_modules$$tweenjs$tween_js$src$Tween.default.Tween(a).to({opacity:0},t).onUpdate((function(){r.toggleMeshes(!0),n.traverseVisible((function(e){e.SDMaterialDefinition&&e.material&&(e.material.opacity="gem"===e.SDMaterialDefinition.materialType?e.material.side===module$src$externals$three.default.FrontSide?a.opacity*e.SDMaterialDefinition.opacityFront:a.opacity*e.SDMaterialDefinition.opacityBack:a.opacity*e.SDMaterialDefinition.opacity)})),r.toggleMeshes(!1)})).onComplete((function(){r.toggleMeshes(!0),n.traverseVisible((function(e){e.SDMaterialDefinition&&e.material&&(e.material.opacity=0)})),r.toggleMeshes(!1),h.renderingHandler.unregisterForContinuousRendering("FADE_OUT_"+e),o()}));h.renderingHandler.registerForContinuousRendering("FADE_OUT_"+e),i.start()})))},P.prototype.setLiveTransformation=function(e,t,n,o,a){return r.setLiveTransformation(e,t,n,o,a)},P.prototype.updateInteractions=function(e,t){if(t&&module$src$shared$util$GlobalUtils.default.typeCheck(t.interactionGroup,"string")){h.highlightingHandler.setToggleHighlights(!1);var n=t.interactionGroup,r="sub";module$src$shared$util$GlobalUtils.default.typeCheck(t.interactionMode,"string")&&"global"===t.interactionMode&&(r="global"),t=module$src$shared$util$GlobalUtils.default.typeCheck(t.dragPlaneNormal,"vector3any")?module$src$shared$util$GlobalUtils.default.toVector3(t.dragPlaneNormal):void 0,h.interactionHandler.addToInteractionGroup(e,n,r,t),h.highlightingHandler.setToggleHighlights(!0)}},P.prototype.removeFromInteractions=function(e){h.interactionHandler.removeFromInteractions(e)},new P(e,t)}},module$src$3d$viewports$default$api$CameraApi={default:function(e,t){var n=t.threeDManager,r=t.apiResponse;return $jscomp.inherits(e=function(){module$src$3d$interfaces$api$CameraApiInterface.default.call(this),this.TYPE={PERSPECTIVE:0,TOP:1,BOTTOM:2,RIGHT:3,LEFT:4,BACK:5,FRONT:6,AR:7},this.get=this.get.bind(this),this.updateAsync=this.updateAsync.bind(this),this.animateAsync=this.animateAsync.bind(this),this.zoomAsync=this.zoomAsync.bind(this),this.resetAsync=this.resetAsync.bind(this),this.updateMatrices=this.updateMatrices.bind(this)},module$src$3d$interfaces$api$CameraApiInterface.default),e.prototype.get=function(){return r(null,n.cameraHandler.getPositionAndTarget())},e.prototype.updateAsync=function(e,t){return n.cameraHandler.setPositionAndTarget(e.position,e.target,t).then((function(e){return r(e?null:"Setting new camera target and position failed",n.cameraHandler.getPositionAndTarget())}))},e.prototype.animateAsync=function(e,t){if(!Array.isArray(e))return Promise.resolve(r("First parameter must be an array of CameraDefinitions"));var o=[],a=[];return e.forEach((function(e){o.push(e.position),a.push(e.target)})),n.cameraHandler.setCameraPath(o,a,t).then((function(e){return r(e?null:"Camera path animation failed",n.cameraHandler.getPositionAndTarget())}))},e.prototype.zoomAsync=function(e,t){return n.cameraHandler.zoomExtents(t,n.computeBoundingBox(e)).then((function(e){return r(e?null:"Zooming to extents failed",n.cameraHandler.getPositionAndTarget())}))},e.prototype.resetAsync=function(e){return n.cameraHandler.resetPositionAndTarget(e).then((function(e){return r(e?null:"Resetting camera position or target failed",n.cameraHandler.getPositionAndTarget())}))},e.prototype.updateMatrices=function(e,t){n.cameraHandler.setViewAndProjectionMatrix(e,t)},new e}},module$src$3d$viewports$default$api$LightApi={default:function(e,t){var n=t.threeDManager;return $jscomp.inherits(t=function(){module$src$3d$interfaces$api$LightApiInterface.default.call(this),this.utils=e.utils,this.LIGHTTYPE={AMBIENT:"ambient",DIRECTIONAL:"directional",HEMISPHERE:"hemisphere",POINT:"point",SPOT:"spot",FLASH:"flash"},this.LIGHTSCENE={DEFAULT:"default",LEGACY:"legacy"},this.updateLight=this.updateLight.bind(this),this.getLight=this.getLight.bind(this),this.removeLight=this.removeLight.bind(this),this.setLightSceneFromID=this.setLightSceneFromID.bind(this),this.setLightSceneFromDefinition=this.setLightSceneFromDefinition.bind(this),this.getLightScene=this.getLightScene.bind(this),this.getAllLightScenes=this.getAllLightScenes.bind(this),this.saveLightScene=this.saveLightScene.bind(this)},module$src$3d$interfaces$api$LightApiInterface.default),t.prototype.updateLight=function(e){return n.lightHandler.updateLight(e)},t.prototype.getLight=function(e){return n.lightHandler.getLight(e)},t.prototype.removeLight=function(e){return n.lightHandler.removeLight(e)},t.prototype.setLightSceneFromID=function(e){return n.lightHandler.setLightSceneFromID(e)},t.prototype.setLightSceneFromDefinition=function(e){return n.lightHandler.setLightSceneFromDefinition(e)},t.prototype.getLightScene=function(e){return n.lightHandler.getLightScene(e)},t.prototype.getAllLightScenes=function(){return n.lightHandler.getAllLightScenes()},t.prototype.saveLightScene=function(e){return n.lightHandler.saveLightScene(e)},new t}},module$src$3d$viewports$default$api$ViewportApi={default:function(e,t){var n,r,o=t.threeDManager,a=t.viewportManager,i={};return $jscomp.inherits(t=function(){module$src$3d$interfaces$api$ViewportApiInterface.default.call(this),this.utils=e.utils,this.EVENTTYPE=e.viewports.EVENTTYPE,this.camera=new module$src$3d$viewports$default$api$CameraApi.default(e,{threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse}),this.lights=new module$src$3d$viewports$default$api$LightApi.default(e,{threeDManager:o,apiResponse:this.utils.APIResponse}),n=module$src$3d$helpers$api$ViewportApiHelpers.default.getInstance(),r={THREE_D_MANAGER_CONSTANTS:module$src$3d$viewports$default$ThreeDManagerConstants.default,EVENTTYPE:this.EVENTTYPE,threeDManager:o,viewportManager:a,apiResponse:this.utils.APIResponse,listeners:i},this.getRuntimeId=this.getRuntimeId.bind(this),this.getContainer=this.getContainer.bind(this),this.getScreenshot=this.getScreenshot.bind(this),this.render=this.render.bind(this),this.convertTo2D=this.convertTo2D.bind(this),this.onResize=this.onResize.bind(this),this.getSize=this.getSize.bind(this),this.pause=this.pause.bind(this),this.resume=this.resume.bind(this),this.reload=this.reload.bind(this),this.destroy=this.destroy.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.getSettingDefinitions=this.getSettingDefinitions.bind(this),this.getSettings=this.getSettings.bind(this),this.getSetting=this.getSetting.bind(this),this.updateSettingAsync=this.updateSettingAsync.bind(this),this.updateSettingsAsync=this.updateSettingsAsync.bind(this),this.setTransformation=this.setTransformation.bind(this),this.getTransformation=this.getTransformation.bind(this),this.applyTransformation=this.applyTransformation.bind(this),this.resetTransformation=this.resetTransformation.bind(this),this.setLiveTransformation=this.setLiveTransformation.bind(this),this.updateSelected=this.updateSelected.bind(this),this.getSelected=this.getSelected.bind(this)},module$src$3d$interfaces$api$ViewportApiInterface.default),t.prototype.getRuntimeId=function(){return o.runtimeId},t.prototype.getContainer=function(){return o.container},t.prototype.getScreenshot=function(){return o.renderingHandler.getScreenshot()},t.prototype.render=function(){o.renderingHandler.render()},t.prototype.convertTo2D=function(e){return n.convertTo2D(r,e)},t.prototype.onResize=function(e,t){o.cameraHandler.onResize(e,t),o.renderingHandler.onResize(e,t)},t.prototype.getSize=function(){return o.renderingHandler.getSize()},t.prototype.pause=function(){o.pause()},t.prototype.resume=function(){o.resume()},t.prototype.reload=function(){return n.reload(r)},t.prototype.destroy=function(){return n.destroy(r)},t.prototype.addEventListener=function(e,t){return n.addEventListener(r,e,t)},t.prototype.removeEventListener=function(e){return n.removeEventListener(r,e)},t.prototype.getSettingDefinitions=function(){return n.getSettingDefinitions(r)},t.prototype.getSettings=function(e){return n.getSettings(r,e)},t.prototype.getSetting=function(e){return n.getSetting(r,e)},t.prototype.updateSettingAsync=function(e,t){return n.updateSettingAsync(r,e,t)},t.prototype.updateSettingsAsync=function(e){return n.updateSettingsAsync(r,e)},t.prototype.setTransformation=function(e){return n.setTransformation(r,e)},t.prototype.getTransformation=function(){return n.getTransformation(r)},t.prototype.applyTransformation=function(e){return n.applyTransformation(r,e)},t.prototype.resetTransformation=function(){return n.resetTransformation(r)},t.prototype.setLiveTransformation=function(e,t){return n.setLiveTransformation(r,e,t)},t.prototype.updateSelected=function(e,t){return o.interactionHandler.setSelectedPaths(e,t)},t.prototype.getSelected=function(){return o.interactionHandler.getSelectedPaths()},new t}},module$src$3d$ViewportManager={default:function(e,t){var n,r,o,a,i,s=[],l=!1,u=function(e,t){i=t,module$src$shared$util$GlobalUtils.default.inject({message:(o=e).message,subscribeToMessageStream:o.subscribeToMessageStream,unsubscribeFromMessageStream:o.unsubscribeFromMessageStream},n=this);var a=n.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_VISIBILITY_ON,(function(){n.unsubscribeFromMessageStream(a),r=o.sceneGeometryManager.getGeometryNode().computeSceneBoundingBox(),l=!0;for(var e=0,t=s.length;e<t;e++)o.settingsHandler.restoreSettings(s[e]),s[e].init(r),!0===o.getSetting("showScene")&&s[e].updateSetting("show",!0)}))};return u.prototype._convertInputObject=function(e){if(e.type&&"expo"===e.type||e.type&&"expo-ar"===e.type)return e;if(e.container){if(!(e.container instanceof Element))return;var t=e.container,n=e.type?e.type:"default";if(e=e.runtimeId){for(var r=!1,o=0,a=s.length;o<a;o++)s[o].runtimeId===e&&(r=!0);e=r?module$src$shared$util$GlobalUtils.default.createRandomId():e}else e=module$src$shared$util$GlobalUtils.default.createRandomId()}else{if(!(e instanceof Element))return;t=e,n="default",e=module$src$shared$util$GlobalUtils.default.createRandomId()}return{container:t,type:n,runtimeId:e}},u.prototype._createThreeDManager=function(e){if(a||(a=o.api({version:2})),!e)return null;if("simple"===e.type)var t=new module$src$3d$viewports$simple$ThreeDManager.default(a,{scene:o.sceneGeometryManager.getScene(),geometryNode:o.sceneGeometryManager.getGeometryNode(),pathUtils:o.sceneGeometryManager.getPathUtils(),container:e.container,runtimeId:e.runtimeId,loggingHandler:i,messagingHandler:{message:o.message,subscribeToMessageStream:o.subscribeToMessageStream,unsubscribeFromMessageStream:o.unsubscribeFromMessageStream}}),r=new module$src$3d$viewports$simple$api$ViewportApi.default(a,{threeDManager:t,viewportManager:n});else"expo"===e.type?(t=new module$src$3d$viewports$expo$default$ThreeDManager.default(a,{scene:o.sceneGeometryManager.getScene(),geometryNode:o.sceneGeometryManager.getGeometryNode(),pathUtils:o.sceneGeometryManager.getPathUtils(),container:e.container,runtimeId:e.runtimeId,loggingHandler:i,messagingHandler:{message:o.message,subscribeToMessageStream:o.subscribeToMessageStream,unsubscribeFromMessageStream:o.unsubscribeFromMessageStream},ExpoTHREE:e.externalLibraries.ExpoTHREE,AR:e.externalLibraries.AR}),r=new module$src$3d$viewports$expo$default$api$ViewportApi.default(a,{threeDManager:t,viewportManager:n})):"expo-ar"===e.type?(t=new module$src$3d$viewports$expo$ar$ThreeDManager.default(a,{scene:o.sceneGeometryManager.getScene(),geometryNode:o.sceneGeometryManager.getGeometryNode(),pathUtils:o.sceneGeometryManager.getPathUtils(),container:e.container,runtimeId:e.runtimeId,loggingHandler:i,messagingHandler:{message:o.message,subscribeToMessageStream:o.subscribeToMessageStream,unsubscribeFromMessageStream:o.unsubscribeFromMessageStream},ExpoTHREE:e.externalLibraries.ExpoTHREE,AR:e.externalLibraries.AR}),r=new module$src$3d$viewports$expo$ar$api$ViewportApi.default(a,{threeDManager:t,viewportManager:n})):(e.type="default",t=new module$src$3d$viewports$default$ThreeDManager.default(a,{scene:o.sceneGeometryManager.getScene(),geometryNode:o.sceneGeometryManager.getGeometryNode(),pathUtils:o.sceneGeometryManager.getPathUtils(),container:e.container,runtimeId:e.runtimeId,loggingHandler:i,messagingHandler:{message:o.message,subscribeToMessageStream:o.subscribeToMessageStream,unsubscribeFromMessageStream:o.unsubscribeFromMessageStream},interactionGroupManager:o.interactionGroupManager}),r=new module$src$3d$viewports$default$api$ViewportApi.default(a,{threeDManager:t,viewportManager:n}));return t.type=e.type,t.runtimeId=e.runtimeId,t.container=e.container,t.api=r,t.startUpObject=e,t.transformationMatrix=new module$src$externals$three.default.Matrix4,t.transformationGroups=[],t},u.prototype.createThreeDManager=function(e){if(!e)return null;Array.isArray(e)||(e=[e]);for(var t=[],a=0,i=e.length;a<i;a++){var u=n._convertInputObject(e[a]);if(u=n._createThreeDManager(u),s.push(u),!1===u.success)u.api.destroy();else{u.updateSetting("show",!1),u.updateSetting("showTransition",o.getSetting("showSceneTransition"));for(var c,d,p,h,m,f=o.sceneGeometryManager.getMeshMaterialObjects(),g=0,$=f.length;g<$;g++)c=(m=f[g]).mesh,p=m.hasTextureCoordinates,null==(h=u.materialHandler.getMaterial(d=m.properties,h=m.overrideColor,m=m.vertexColors))?u.warn("The creation of a material failed."):(p||(h.map=null,h.alphaMap=null,h.aoMap=null,h.bumpMap=null,h.displacementMap=null,h.emissiveMap=null,h.normalMap=null,h.metalnessMap=null,h.roughnessMap=null),u.addMesh(c,h,d));u&&(t.push(u.api),l&&(o.settingsHandler.restoreSettings(u),u.init(r),!0===o.getSetting("showScene")&&u.updateSetting("show",!0)))}}return t},u.prototype.removeThreeDManager=function(e){for(var t=0,n=s.length;t<n;t++)if(s[t].runtimeId===e){for(var r in(e=s[t]).api)delete e.api[r];return e.destroy(),s.splice(t,1),!0}return!1},u.prototype.reloadThreeDManager=function(e){for(var t=0,r=s.length;t<r;t++)if(s[t].runtimeId===e){for(var o in e=s[t],r=Object.assign({},e.startUpObject),e.destroy(),s.splice(t,1),t=n.createThreeDManager(r)[r.runtimeId],e.api.__proto__=t.__proto__,t)e.api[o]=t[o];break}},u.prototype.getContainers=function(){for(var e=[],t=0,n=s.length;t<n;t++)e.push(s[t].container);return e},u.prototype.getDefaultThreeDManagers=function(){for(var e=[],t=0,n=s.length;t<n;t++)"default"===s[t].type&&e.push(s[t]);return e},u.prototype.getFirstDefaultThreeDManager=function(){var e=n.getDefaultThreeDManagers();return 0<e.length?e[0]:null},u.prototype.getFirstDefaultThreeDManagerApi=function(){var e=n.getDefaultThreeDManagers();return 0<e.length?e[0].api:null},u.prototype.getApi=function(e){for(var t=null,n=0,r=s.length;n<r;n++)e===s[n].runtimeId&&(t=s[n].api);return t},u.prototype.getApis=function(){for(var e=[],t=0,n=s.length;t<n;t++)e.push(s[t].api);return e},u.prototype.getThreeDManagers=function(){return s},u.prototype.onlyOneDefault=function(){return 1===n.getDefaultThreeDManagers().length},u.prototype.updateSetting=function(e,t){for(var n=0,r=s.length;n<r;n++)s[n].updateSetting(e,t)},u.prototype.adjustScene=function(){for(var e=0,t=s.length;e<t;e++)s[e].adjustScene()},u.prototype.fadeIn=function(e,t){for(var n=[],r=0,o=s.length;r<o;r++)n.push(s[r].fadeIn(e,t));return Promise.all(n)},u.prototype.fadeOut=function(e,t){for(var n=[],r=0,o=s.length;r<o;r++)n.push(s[r].fadeOut(e,t));return Promise.all(n)},u.prototype.updateInteractions=function(e,t){for(var n=0,r=s.length;n<r;n++)s[n].updateInteractions(e,t)},u.prototype.removeFromInteractions=function(e){for(var t=0,n=s.length;t<n;t++)s[t].removeFromInteractions(e)},u.prototype.addMesh=function(e,t,n){for(var r=0,o=s.length;r<o;r++)s[r].addMesh(e,t[r],n)},u.prototype.removeMesh=function(e){for(var t=0,n=s.length;t<n;t++)s[t].removeMesh(e);e.geometry.dispose()},u.prototype.addAnchor=function(e,t){var n=[];t.viewports&&0!==t.viewports.length&&(n=t.viewports);for(var r=0,o=s.length;r<o;r++)(n.includes(s[r].runtimeId)||0===n.length)&&s[r].addAnchor(e,t)},u.prototype.removeAnchor=function(e){for(var t=0,n=s.length;t<n;t++)s[t].removeAnchor(e)},u.prototype.render=function(){for(var e=0,t=s.length;e<t;e++)s[e].renderingHandler.render()},u.prototype.setBlur=function(e,t){for(var n=0,r=s.length;n<r;n++)s[n].renderingHandler.setBlur(e,t)},u.prototype.registerForContinuousRendering=function(e,t){for(var n=0,r=s.length;n<r;n++)s[n].renderingHandler.registerForContinuousRendering(e,t)},u.prototype.unregisterForContinuousRendering=function(e){for(var t=0,n=s.length;t<n;t++)s[t].renderingHandler.unregisterForContinuousRendering(e)},u.prototype.containsContinuousRendering=function(e){for(var t=[],n=0,r=s.length;n<r;n++)t.push(s[n].renderingHandler.containsContinuousRendering(e));return 1===t.length?t[0]:t},u.prototype.updateShadowMap=function(){for(var e=0,t=s.length;e<t;e++)s[e].renderingHandler.updateShadowMap()},u.prototype.keepUpdatingShadowMap=function(){for(var e=0,t=s.length;e<t;e++)s[e].renderingHandler.keepUpdatingShadowMap()},u.prototype.stopUpdatingShadowMap=function(){for(var e=0,t=s.length;e<t;e++)s[e].renderingHandler.stopUpdatingShadowMap()},u.prototype.getMaterial=function(e,t,n,r,o){for(var a=[],i=0,l=s.length;i<l;i++)a.push(s[i].materialHandler.getMaterial(e,t,n,r,o));return a},new u(e,t)}},module$src$shared$util$PathUtils={default:function(){var e,t=null,n={},r=function(){e=this};return r.prototype.setScene=function(e){(t=e)._sdIndexObj=n,n.obj=t},r.prototype.getChildByName=function(e,t){return null==(e=e._sdIndexObj)?null:module$src$shared$util$GlobalUtils.default.getAtPath(e,t+".obj")},r.prototype.getOrCreateChild=function(t,n){var r=t._sdIndexObj;if(null==r)return null;var o=e.getChildByName(t,n);return null==o&&((o=new module$src$externals$three.default.Object3D).SDLocalPath=n,t.add(o),r[n]={obj:o},o._sdIndexObj=r[n]),o},r.prototype.getPathObject=function(e,n){return null==(e=(e=e||t)._sdIndexObj)?null:module$src$shared$util$GlobalUtils.default.getAtPath(e,n+".obj")},r.prototype.ensurePath=function(t,n){n=n.split(".");for(var r=(n=$jscomp.makeIterator(n)).next();!r.done;r=n.next())t=e.getOrCreateChild(t,r.value);return t},r.prototype.deletePath=function(t,n){if(null==(t=e.getPathObject(t,n)))return!0;if(null==(n=t.SDLocalPath)||!module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")||""==n)return!1;var r=t.parent;if(null==r)return!1;var o=r._sdIndexObj;return null!=o&&(r.remove(t),delete o[n],!0)},r.prototype.getObjectPath=function(e){if(!e)return null;for(;e&&!e.hasOwnProperty("SDLocalPath");)e=e.parent;for(var t=[];e&&e.hasOwnProperty("SDLocalPath");)t.push(e.SDLocalPath),e=e.parent;return t.reverse(),""===(e=t.join("."))?null:e},new r}},module$src$3d$controls$OrbitControls={default:{}},THREE$$module$src$3d$controls$OrbitControls=module$src$externals$three.default;module$src$externals$three.default.OrbitControls=function(e,t){function n(){return Math.pow(.95,o.zoomSpeed)}function r(e){o.object instanceof module$src$externals$three.default.PerspectiveCamera?h=e:o.object instanceof module$src$externals$three.default.OrthographicCamera?m=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}this.object=e,this.isMoving=!1,this.lastMove=0,this.proxy=t,this.proxy.onContextMenu=function(e){e.preventDefault()},this.proxy.onMouseDown=function(e){if(!1!==o.enabled){if(e.preventDefault(),e.button===o.mouseButtons.ORBIT){if(!1===o.enableRotation)return;$.set(e.clientX,e.clientY),u=l.ROTATE}else if(e.button===o.mouseButtons.ZOOM){if(!1===o.enableZoom)return;w.set(e.clientX,e.clientY),u=l.DOLLY}else if(e.button===o.mouseButtons.PAN){if(!1===o.enablePan)return;_.set(e.clientX,e.clientY),u=l.PAN}u!==l.NONE&&(o.proxy.onStateChange(),o.dispatchEvent(i))}},this.proxy.onMouseWheel=function(e){if(!1!==o.enabled&&!1!==o.enableZoom&&(u===l.NONE||u===l.ROTATE)){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),0<t?r(-(1-n())):0>t&&r(1-n()),o.update(),o.dispatchEvent(i),o.dispatchEvent(s)}},this.proxy.onTouchStart=function(e){if(!1!==o.enabled){switch(e.touches.length){case 1:if(!1===o.enableRotation)return;$.set(e.touches[0].pageX,e.touches[0].pageY),u=l.TOUCH_ROTATE;break;case 2:if(!1===o.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX;e=e.touches[0].pageY-e.touches[1].pageY,w.set(0,Math.sqrt(t*t+e*e)),u=l.TOUCH_DOLLY;break;case 3:if(!1===o.enablePan)return;_.set(e.touches[0].pageX,e.touches[0].pageY),u=l.TOUCH_PAN;break;default:u=l.NONE}u!==l.NONE&&o.dispatchEvent(i)}},this.proxy.onTouchEnd=function(e){!1!==o.enabled&&(o.dispatchEvent(s),u=l.NONE)},this.proxy.onTouchMove=function(e){if(!1!==o.enabled)switch(e.touches.length){case 1:if(!1===o.enableRotation)break;if(u!==l.TOUCH_ROTATE)break;e.preventDefault(),e.stopPropagation(),v.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(v,$);var t=o.proxy.getClientSize();0!=t.width&&0!=t.height&&(p.theta-=2*Math.PI*y.x/t.width*o.rotationSpeed,p.phi-=2*Math.PI*y.y/t.height*o.rotationSpeed,$.copy(v),o.update());break;case 2:if(!1===o.enableZoom)break;if(u!==l.TOUCH_DOLLY)break;e.preventDefault(),e.stopPropagation(),t=e.touches[0].pageX-e.touches[1].pageX,e=e.touches[0].pageY-e.touches[1].pageY,S.set(0,Math.sqrt(t*t+e*e)),M.subVectors(S,w),0<M.y?r(-(1-n())):0>M.y&&r(1-n()),w.copy(S),o.update();break;case 3:if(!1===o.enablePan)break;if(u!==l.TOUCH_PAN)break;e.preventDefault(),e.stopPropagation(),b.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(b,_),C(x.x,x.y),_.copy(b),o.update();break;default:e.preventDefault(),e.stopPropagation(),u=l.NONE}},this.proxy.onMouseMove=function(e){!1!==o.enabled&&(e.preventDefault(),u===l.ROTATE?!1!==o.enableRotation&&(v.set(e.clientX,e.clientY),y.subVectors(v,$),0!=(e=o.proxy.getClientSize()).width&&0!=e.height&&(p.theta-=2*Math.PI*y.x/e.width*o.rotationSpeed,p.phi-=2*Math.PI*y.y/e.height*o.rotationSpeed,$.copy(v),o.update())):u===l.DOLLY?!1!==o.enableZoom&&(S.set(e.clientX,e.clientY),M.subVectors(S,w),0<M.y?r(n()):0>M.y&&r(-n()),w.copy(S),o.update()):u===l.PAN&&!1!==o.enablePan&&(b.set(e.clientX,e.clientY),x.subVectors(b,_),C(x.x*o.panSpeed,x.y*o.panSpeed),_.copy(b),o.update()))},this.proxy.onMouseUp=function(e){!1!==o.enabled&&(o.proxy.onStateChangeNone(),o.dispatchEvent(s),u=l.NONE)},this.proxy.onKeyDown=function(e){if(!1!==o.enabled&&!1!==o.enableKeys&&0!=o.enableKeyPan&&!1!==o.enableKeyPan)switch(e.keyCode){case o.keys.UP:C(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:C(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:C(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:C(-o.keyPanSpeed,0),o.update()}},this.enabled=!0,this.target=new module$src$externals$three.default.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=-1/0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minPosition=new module$src$externals$three.default.Vector3(-1/0,-1/0,-1/0),this.maxPosition=new module$src$externals$three.default.Vector3(1/0,1/0,1/0),this.positionSphereCenter=new module$src$externals$three.default.Vector3(0,0,0),this.positionSphereRadius=1/0,this.minTarget=new module$src$externals$three.default.Vector3(-1/0,-1/0,-1/0),this.maxTarget=new module$src$externals$three.default.Vector3(1/0,1/0,1/0),this.targetSphereCenter=new module$src$externals$three.default.Vector3(0,0,0),this.targetSphereRadius=1/0,this.enableDamping=!1,this.rotateDampingFactor=this.zoomDampingFactor=this.panDampingFactor=.1,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotation=!0,this.rotationSpeed=1,this.enablePan=!0,this.panSpeed=1,this.enableKeyPan=!0,this.keyPanSpeed=7,this.enableAutoRotation=!1,this.autoRotationSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:module$src$externals$three.default.MOUSE.LEFT,PAN:module$src$externals$three.default.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(a),this.isMoving=!0,this.lastMove=Date.now(),o.update(),u=l.NONE},this.resetState=function(){u=l.NONE},this.update=function(){var t=new module$src$externals$three.default.Vector3,n=(new module$src$externals$three.default.Quaternion).setFromUnitVectors(e.up,new module$src$externals$three.default.Vector3(0,1,0)),r=n.clone().inverse(),i=new module$src$externals$three.default.Vector3,s=new module$src$externals$three.default.Quaternion;return function(){var e=o.object.position;if(t.copy(e).sub(o.target),t.applyQuaternion(n),d.setFromVector3(t),o.enableAutoRotation&&u===l.NONE&&(p.theta=0,p.theta-=2*Math.PI/60/60*o.autoRotationSpeed),d.theta+=p.theta,d.phi+=p.phi,d.theta>Math.PI?(d.theta-=2*Math.PI,o.minAzimuthAngle>d.theta&&(d.theta+=2*Math.PI)):d.theta<-Math.PI&&(d.theta+=2*Math.PI,o.maxAzimuthAngle<d.theta&&(d.theta-=2*Math.PI)),d.theta=Math.max(o.minAzimuthAngle,Math.min(o.maxAzimuthAngle,d.theta)),d.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,d.phi)),d.makeSafe(),o.object instanceof module$src$externals$three.default.PerspectiveCamera?d.radius*=1+h:o.object instanceof module$src$externals$three.default.OrthographicCamera&&(o.object.left*=1+m,o.object.right*=1+m,o.object.top*=1+m,o.object.bottom*=1+m,o.object.scale=module$src$externals$three.default.Vector3(1+m,1+m,1+m),o.object.updateProjectionMatrix()),d.radius=Math.max(o.minDistance,Math.min(o.maxDistance,d.radius)),o.target.add(f),o.target.setComponent(0,Math.max(o.minTarget.x,Math.min(o.maxTarget.x,o.target.x))),o.target.setComponent(1,Math.max(o.minTarget.y,Math.min(o.maxTarget.y,o.target.y))),o.target.setComponent(2,Math.max(o.minTarget.z,Math.min(o.maxTarget.z,o.target.z))),o.target.distanceTo(o.targetSphereCenter)>o.targetSphereRadius){var $=new module$src$externals$three.default.Vector3(o.target.x-o.targetSphereCenter.x,o.target.y-o.targetSphereCenter.y,o.target.z-o.targetSphereCenter.z).normalize();o.target.setComponent(0,o.targetSphereCenter.x+$.x*o.targetSphereRadius),o.target.setComponent(1,o.targetSphereCenter.y+$.y*o.targetSphereRadius),o.target.setComponent(2,o.targetSphereCenter.z+$.z*o.targetSphereRadius)}return t.setFromSpherical(d),t.applyQuaternion(r),e.copy(o.target).add(t),e.setComponent(0,Math.max(o.minPosition.x,Math.min(o.maxPosition.x,e.x))),e.setComponent(1,Math.max(o.minPosition.y,Math.min(o.maxPosition.y,e.y))),e.setComponent(2,Math.max(o.minPosition.z,Math.min(o.maxPosition.z,e.z))),e.distanceTo(o.positionSphereCenter)>o.positionSphereRadius&&($=new module$src$externals$three.default.Vector3(e.x-o.positionSphereCenter.x,e.y-o.positionSphereCenter.y,e.z-o.positionSphereCenter.z).normalize(),e.setComponent(0,o.positionSphereCenter.x+$.x*o.positionSphereRadius),e.setComponent(1,o.positionSphereCenter.y+$.y*o.positionSphereRadius),e.setComponent(2,o.positionSphereCenter.z+$.z*o.positionSphereRadius)),o.object.lookAt(o.target),!0===o.enableDamping?(p.theta*=1-o.rotateDampingFactor,p.phi*=1-o.rotateDampingFactor,f.x*=1-o.panDampingFactor,f.y*=1-o.panDampingFactor,f.z*=1-o.panDampingFactor,h*=1-o.zoomDampingFactor,m*=1-o.zoomDampingFactor):(p.set(0,0,0),f.set(0,0,0),m=h=0),g||i.distanceToSquared(o.object.position)>c||8*(1-s.dot(o.object.quaternion))>c||o.object instanceof module$src$externals$three.default.OrthographicCamera&&Math.abs(m)>c?(this.isMoving=!0,this.lastMove=Date.now(),i.copy(o.object.position),s.copy(o.object.quaternion),g=!1,o.dispatchEvent(a),!0):(100<Date.now()-this.lastMove&&(this.isMoving=!1,f.set(0,0,0),p.set(0,0,0),m=h=0,o.dispatchEvent(a)),!1)}}(),this.dispose=function(){o.proxy.dispose()};var o=this,a={type:"change"},i={type:"start"},s={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=l.NONE,c=.001,d=new module$src$externals$three.default.Spherical,p=new module$src$externals$three.default.Spherical,h=0,m=0,f=new module$src$externals$three.default.Vector3,g=!1,$=new module$src$externals$three.default.Vector2,v=new module$src$externals$three.default.Vector2,y=new module$src$externals$three.default.Vector2,_=new module$src$externals$three.default.Vector2,b=new module$src$externals$three.default.Vector2,x=new module$src$externals$three.default.Vector2,w=new module$src$externals$three.default.Vector2,S=new module$src$externals$three.default.Vector2,M=new module$src$externals$three.default.Vector2,E=function(){var e=new module$src$externals$three.default.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),f.add(e)}}(),T=function(){var e=new module$src$externals$three.default.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),f.add(e)}}(),C=function(){var e=new module$src$externals$three.default.Vector3;return function(t,n){var r=o.proxy.getClientSize();if(0!=r.width&&0!=r.height)if(o.object instanceof module$src$externals$three.default.PerspectiveCamera){e.copy(o.object.position).sub(o.target);var a=e.length();a*=Math.tan(o.object.fov/2*Math.PI/180),E(2*t*a/r.width,o.object.matrix),T(2*n*a/r.height,o.object.matrix)}else o.object instanceof module$src$externals$three.default.OrthographicCamera?(E(t*(o.object.right-o.object.left)/o.object.zoom/r.width,o.object.matrix),T(n*(o.object.top-o.object.bottom)/o.object.zoom/r.height,o.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),o.enablePan=!1)}}();this.update()},module$src$externals$three.default.OrbitControls.prototype=Object.create(module$src$externals$three.default.EventDispatcher.prototype),module$src$externals$three.default.OrbitControls.prototype.constructor=module$src$externals$three.default.OrbitControls,Object.defineProperties(module$src$externals$three.default.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotation instead."),!this.enableRotation},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotation instead."),this.enableRotation=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var module$src$3d$controls$DragControls={default:{}},THREE$$module$src$3d$controls$DragControls=module$src$externals$three.default,DETECT_IT$$module$src$3d$controls$DragControls=module$node_modules$detect_it$lib$index.default.default;module$src$externals$three.default.DragControls=function(e,t,n){function r(){var e=!1;!0===module$node_modules$detect_it$lib$index.default.default.passiveEvents&&(e={capture:!1,passive:!1}),n.addEventListener("mousemove",a,e),n.addEventListener("mousedown",i,e),n.addEventListener("mouseup",s,e),n.addEventListener("mouseleave",s,e),n.addEventListener("touchmove",l,e),n.addEventListener("touchstart",u,e),n.addEventListener("touchend",c,e)}function o(){n.removeEventListener("mousemove",a,!1),n.removeEventListener("mousedown",i,!1),n.removeEventListener("mouseup",s,!1),n.removeEventListener("mouseleave",s,!1),n.removeEventListener("touchmove",l,!1),n.removeEventListener("touchstart",u,!1),n.removeEventListener("touchend",c,!1)}function a(r){r.preventDefault();var o,a=n.getBoundingClientRect();m.x=(r.clientX-a.left)/a.width*2-1,m.y=-(r.clientY-a.top)/a.height*2+1,$&&_.enabled&&(h.setFromCamera(m,t),h.ray.intersectPlane(p,g)&&(o=g.sub(f)),_.dispatchEvent({type:"drag",object:$,position:o,event:r})),h.setFromCamera(m,t);var i=e.indexOf($);0<(o=h.intersectObjects(e.filter((function(e,t){return i!==t})))).length?(a=o[0].object,o=o[0].point,v!==a?(null!==v&&_.dispatchEvent({type:"hoveroff",object:v,event:r}),_.dispatchEvent({type:"hoveron",object:a,point:o,event:r}),n.style.cursor="pointer",v=a):_.dispatchEvent({type:"hover",object:a,point:o,event:r})):null!==v&&(_.dispatchEvent({type:"hoveroff",object:v,event:r}),n.style.cursor="auto",v=null)}function i(r){if(r.preventDefault(),0===r.button){_.dispatchEvent({type:"mousedowncustom",event:r}),h.setFromCamera(m,t);var o=h.intersectObjects(e);0<o.length?($=o[0].object,o=o[0].point,$.hasOwnProperty("interactionPlaneNormal")?p.setFromNormalAndCoplanarPoint($.interactionPlaneNormal,$.position):p.setFromNormalAndCoplanarPoint(t.getWorldDirection(p.normal),$.position),h.ray.intersectPlane(p,g)&&f.copy(g).sub($.position),n.style.cursor="move",_.dispatchEvent({type:"dragstart",object:$,event:r,point:o})):_.dispatchEvent({type:"emptyclick",event:r})}}function s(e){e.preventDefault(),_.dispatchEvent({type:"mouseupcustom",event:e}),$&&(_.dispatchEvent({type:"dragend",object:$,event:e}),$=null),n.style.cursor="auto"}function l(r){if(y){r.preventDefault();for(var o,a=null,i=0;i<r.changedTouches.length;i++)if((o=r.changedTouches[i]).identifier===y){a=o;break}if(a){var s;r=a,a=n.getBoundingClientRect(),m.x=(r.clientX-a.left)/a.width*2-1,m.y=-(r.clientY-a.top)/a.height*2+1,$&&_.enabled&&(h.setFromCamera(m,t),h.ray.intersectPlane(p,g)&&(s=g.sub(f)),_.dispatchEvent({type:"drag",object:$,position:s,event:r})),h.setFromCamera(m,t);var l=e.indexOf($);0<(a=h.intersectObjects(e.filter((function(e,t){return l!==t})))).length?(s=a[0].object,a=a[0].point,s.hasOwnProperty("interactionPlaneNormal")?p.setFromNormalAndCoplanarPoint(s.interactionPlaneNormal,s.position):p.setFromNormalAndCoplanarPoint(t.getWorldDirection(p.normal),s.position),v!==s?(null!==v&&_.dispatchEvent({type:"hoveroff",object:v,event:r}),_.dispatchEvent({type:"hoveron",object:s,point:a,event:r}),v=s):_.dispatchEvent({type:"hover",object:s,point:a,event:r})):null!==v&&(_.dispatchEvent({type:"hoveroff",object:v,event:r}),v=null)}}}function u(r){if(r.preventDefault(),!(1<r.touches.length)){y=(r=r.changedTouches[0]).identifier;var o=n.getBoundingClientRect();m.x=(r.clientX-o.left)/o.width*2-1,m.y=-(r.clientY-o.top)/o.height*2+1,h.setFromCamera(m,t),0<(o=h.intersectObjects(e)).length?($=o[0].object,o=o[0].point,$.hasOwnProperty("interactionPlaneNormal")?p.setFromNormalAndCoplanarPoint($.interactionPlaneNormal,$.position):p.setFromNormalAndCoplanarPoint(t.getWorldDirection(p.normal),$.position),h.ray.intersectPlane(p,g)&&f.copy(g).sub($.position),n.style.cursor="move",_.dispatchEvent({type:"dragstart",object:$,event:r,point:o})):_.dispatchEvent({type:"emptyclick",event:r})}}function c(e){if(y){e.preventDefault();for(var t,r=null,o=0;o<e.changedTouches.length;o++)if((t=e.changedTouches[o]).identifier===y){r=t;break}r&&(e=r,y=null,$&&(_.dispatchEvent({type:"dragend",object:$,event:e}),$=null),null!==v&&(_.dispatchEvent({type:"hoveroff",object:v,event:e}),v=null),n.style.cursor="auto")}}if(e instanceof module$src$externals$three.default.Camera){console.warn("THREE.DragControls: Constructor now expects ( objects, camera, domElement )");var d=e;e=t,t=d}var p=new module$src$externals$three.default.Plane,h=new module$src$externals$three.default.Raycaster,m=new module$src$externals$three.default.Vector2,f=new module$src$externals$three.default.Vector3,g=new module$src$externals$three.default.Vector3,$=null,v=null,y=null,_=this;r(),this.enabled=!0,this.activate=r,this.deactivate=o,this.dispose=function(){o()},this.setObjects=function(t){e=t},this.on=function(e,t){console.warn("THREE.DragControls: on() has been deprecated. Use addEventListener() instead."),_.addEventListener(e,t)},this.off=function(e,t){console.warn("THREE.DragControls: off() has been deprecated. Use removeEventListener() instead."),_.removeEventListener(e,t)},this.notify=function(e){console.error("THREE.DragControls: notify() has been deprecated. Use dispatchEvent() instead."),_.dispatchEvent({type:e})}},module$src$externals$three.default.DragControls.prototype=Object.create(module$src$externals$three.default.EventDispatcher.prototype),module$src$externals$three.default.DragControls.prototype.constructor=module$src$externals$three.default.DragControls;var module$src$3d$viewports$default$materials$ShapeDiverStandardMaterial={default:{}},THREE$$module$src$3d$viewports$default$materials$ShapeDiverStandardMaterial=module$src$externals$three.default,Shaders$$module$src$3d$viewports$default$materials$ShapeDiverStandardMaterial=module$src$3d$viewports$default$shaders$ShaderFile.default;module$src$externals$three.default.ShapeDiverStandardMaterial=function(e){module$src$externals$three.default.MeshStandardMaterial.call(this),this.defines={STANDARD:""},e&&0<e.threeDNoiseOpacity&&(this.defines.USE_3D_NOISE="",e.threeDNoiseID||(e.threeDNoiseID=0),0<=e.threeDNoiseID&&3>e.threeDNoiseID||999==e.threeDNoiseID)&&(this.defines["USE_3D_NOISE_F"+e.threeDNoiseID]=""),this.uniforms=module$src$externals$three.default.UniformsUtils.merge([module$src$externals$three.default.UniformsLib.common,module$src$externals$three.default.UniformsLib.envmap,module$src$externals$three.default.UniformsLib.aomap,module$src$externals$three.default.UniformsLib.lightmap,module$src$externals$three.default.UniformsLib.bumpmap,module$src$externals$three.default.UniformsLib.normalmap,module$src$externals$three.default.UniformsLib.displacementmap,module$src$externals$three.default.UniformsLib.roughnessmap,module$src$externals$three.default.UniformsLib.metalnessmap,module$src$externals$three.default.UniformsLib.lights,{emissive:{value:new module$src$externals$three.default.Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}},{lightWorldSize:{value:.005},lightFrustum:{value:6.5}},{shadowOpacity:{value:1}},{lightReflectivity:{value:1}},{threeDNoiseOpacity:{value:0},threeDNoiseID:{value:0},threeDNoiseScale:{value:1},threeDNoiseDistanceFade:{value:0}},{uvTransformMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()},uvTransformBumpMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()},uvTransformNormalMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()},uvTransformSpecularMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()},uvTransformAlphaMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()},uvTransformEmissiveMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()},uvTransformRoughnessMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()},uvTransformMetalnessMap:{type:"m3",value:(new module$src$externals$three.default.Matrix3).identity()}},{rgbMap:{type:"t",value:null}},{mapsSize:{type:"i",value:0},additionalMaps0:{type:"t",value:null},additionalMaps1:{type:"t",value:null},additionalMaps2:{type:"t",value:null},additionalMaps3:{type:"t",value:null},additionalMaps4:{type:"t",value:null},mapPropertyType:{type:"iv1",value:[-1,-1,-1,-1,-1]},mapPropertyColor:{type:"v3v",value:[new module$src$externals$three.default.Color(0),new module$src$externals$three.default.Color(0),new module$src$externals$three.default.Color(0),new module$src$externals$three.default.Color(0),new module$src$externals$three.default.Color(0)]},uvTransformAddMap:{type:"m3v",value:[(new module$src$externals$three.default.Matrix3).identity(),(new module$src$externals$three.default.Matrix3).identity(),(new module$src$externals$three.default.Matrix3).identity(),(new module$src$externals$three.default.Matrix3).identity(),(new module$src$externals$three.default.Matrix3).identity()]}}]),this.lightWorldSize=this.uniforms.lightWorldSize.value,this.lightFrustum=this.uniforms.lightFrustum.value,this.shadowOpacity=this.uniforms.shadowOpacity.value,this.lightReflectivity=this.uniforms.lightReflectivity.value,this.threeDNoiseID=this.uniforms.threeDNoiseID.value,this.threeDNoiseScale=this.uniforms.threeDNoiseScale.value,this.threeDNoiseDistanceFade=this.uniforms.threeDNoiseDistanceFade.value,this.threeDNoiseOpacity=this.uniforms.threeDNoiseOpacity.value,this.mapsSize=this.uniforms.mapsSize.value,this.rgbMap=this.uniforms.rgbMap.value;var t=0;if(e){if(e.map&&(this.uvTransformMap=e.map.uvTransform,e.map.matrix.identity(),t++),e.specularMap&&(this.uvTransformSpecularMap=e.specularMap.uvTransform,e.specularMap.matrix.identity(),t++),e.normalMap&&(this.uvTransformNormalMap=e.normalMap.uvTransform,e.normalMap.matrix.identity(),t++),e.bumpMap&&(this.uvTransformBumpMap=e.bumpMap.uvTransform,e.bumpMap.matrix.identity(),t++),e.roughnessMap&&(this.uvTransformRoughnessMap=e.roughnessMap.uvTransform,e.roughnessMap.matrix.identity(),t++),e.metalnessMap&&(this.uvTransformMetalnessMap=e.metalnessMap.uvTransform,e.metalnessMap.matrix.identity(),t++),e.alphaMap&&(this.uvTransformAlphaMap=e.alphaMap.uvTransform,e.alphaMap.matrix.identity(),t++),e.emissiveMap&&(this.uvTransformEmissiveMap=e.emissiveMap.uvTransform,e.emissiveMap.matrix.identity(),t++),e.alphaMode&&(this.blending=e.alphaMap),e.alphaTest&&(this.alphaTest=e.alphaTest),e&&e.roughnessMap&&e.metalnessMap&&e.roughnessMap.image===e.metalnessMap.image&&(this.rgbMap=e.roughnessMap,e.roughnessMap={uvTransform:e.roughnessMap.uvTransform,isTexture:!1},e.metalnessMap={uvTransform:e.metalnessMap.uvTransform,isTexture:!1},this.defines.USE_RGBMAP="",t--),e&&e.additionalMaps){for(this.mapsSize=e.additionalMaps.length;5>e.mapPropertyType.length;)e.mapPropertyType.push(-1);for(;5>e.mapPropertyColor.length;)e.mapPropertyColor.push(new module$src$externals$three.default.Color(0));for(;5>e.uvTransformAddMap.length;)e.uvTransformAddMap.push((new module$src$externals$three.default.Matrix3).identity());this.mapPropertyType=e.mapPropertyType,this.mapPropertyColor=e.mapPropertyColor,this.uvTransformAddMap=e.uvTransformAddMap;for(var n=0,r=e.additionalMaps.length;n<r;n++)0==n&&(this.additionalMaps0=e.additionalMaps[n]),1==n&&(this.additionalMaps1=e.additionalMaps[n]),2==n&&(this.additionalMaps2=e.additionalMaps[n]),3==n&&(this.additionalMaps3=e.additionalMaps[n]),4==n&&(this.additionalMaps4=e.additionalMaps[n]);delete e.additionalMaps}for(t+=this.mapsSize,this.defines.NUM_ADD_MAPS=this.mapsSize,e.envMap&&t++;t>=e.textureUnitCount;)if(e.envMap)delete e.envMap,this.envMap=null,t--;else if(e.emissiveMap&&e.emissiveMap.image)delete e.emissiveMap,this.uvTransformEmissiveMap=this.uniforms.uvTransformEmissiveMap.value,t--;else if(e.alphaMap&&e.alphaMap.image)delete e.alphaMap,this.uvTransformAlphaMap=this.uniforms.uvTransformAlphaMap.value,t--;else if(e.metalnessMap&&e.metalnessMap.image)delete e.metalnessMap,this.uvTransformMetalnessMap=this.uniforms.uvTransformMetalnessMap.value,t--;else if(e.roughnessMap&&e.roughnessMap.image)delete e.roughnessMap,this.uvTransformRoughnessMap=this.uniforms.uvTransformRoughnessMap.value,t--;else if(this.rgbMap)this.rgbMap=null,delete this.defines.USE_RGBMAP,this.uvTransformMetalnessMap=this.uniforms.uvTransformMetalnessMap.value,this.uvTransformRoughnessMap=this.uniforms.uvTransformRoughnessMap.value,t--;else if(e.bumpMap&&e.bumpMap.image)delete e.bumpMap,this.uvTransformBumpMap=this.uniforms.uvTransformBumpMap.value,t--;else if(e.normalMap&&e.normalMap.image)delete e.normalMap,this.uvTransformNormalMap=this.uniforms.uvTransformNormalMap.value,t--;else{if(!e.specularMap||!e.specularMap.image)break;delete e.specularMap,this.uvTransformSpecularMap=this.uniforms.uvTransformSpecularMap.value,t--}this.availableTextures=e.textureUnitCount-1-t,delete e.textureUnitCount,this.renderAO=e.renderAO}this.vertexShader=module$src$3d$viewports$default$shaders$ShaderFile.default.standard_vert,this.fragmentShader=module$src$3d$viewports$default$shaders$ShaderFile.default.standard_frag,this.type="ShapeDiverStandardMaterial",this.softShadow=!1,this.attributes=["position","normal"],0<t&&this.attributes.push("uv"),delete e.line,delete e._json,this.needsUpdate=!1,this.setValues(e)},module$src$externals$three.default.ShapeDiverStandardMaterial.prototype=Object.create(module$src$externals$three.default.MeshStandardMaterial.prototype),module$src$externals$three.default.ShapeDiverStandardMaterial.prototype.constructor=module$src$externals$three.default.ShapeDiverStandardMaterial,module$src$externals$three.default.ShapeDiverStandardMaterial.prototype.isMeshStandardMaterial=!0,module$src$externals$three.default.ShapeDiverStandardMaterial.prototype.copy=function(e){return module$src$externals$three.default.MeshStandardMaterial.prototype.copy.call(this,e),this.defines=e.defines,this.uniforms=module$src$externals$three.default.UniformsUtils.clone(e.uniforms),this.type=e.type,this.softShadow=e.softShadow,this.renderAO=e.renderAO,this},module$src$externals$three.default.ShapeDiverStandardMaterial.prototype.deepCopy=function(e){return module$src$externals$three.default.MeshStandardMaterial.prototype.copy.call(this,e),this.defines=Object.assign({},e.defines),this.uniforms=module$src$externals$three.default.UniformsUtils.clone(e.uniforms),this.type=e.type,this.softShadow=e.softShadow,this.renderAO=e.renderAO,this};var module$src$3d$viewports$default$materials$ShapeDiverGemMaterial={default:{}},THREE$$module$src$3d$viewports$default$materials$ShapeDiverGemMaterial=module$src$externals$three.default,Shaders$$module$src$3d$viewports$default$materials$ShapeDiverGemMaterial=module$src$3d$viewports$default$shaders$ShaderFile.default;module$src$externals$three.default.ShapeDiverGemMaterial=function(e){module$src$externals$three.default.MeshStandardMaterial.call(this),this.defines={STANDARD:"",DEPTH:5},this.uniforms=module$src$externals$three.default.UniformsUtils.merge([module$src$externals$three.default.UniformsLib.common,module$src$externals$three.default.UniformsLib.envmap,module$src$externals$three.default.UniformsLib.aomap,module$src$externals$three.default.UniformsLib.lightmap,module$src$externals$three.default.UniformsLib.bumpmap,module$src$externals$three.default.UniformsLib.normalmap,module$src$externals$three.default.UniformsLib.displacementmap,module$src$externals$three.default.UniformsLib.roughnessmap,module$src$externals$three.default.UniformsLib.metalnessmap,module$src$externals$three.default.UniformsLib.lights,{emissive:{value:new module$src$externals$three.default.Color(0)},roughness:{value:0},metalness:{value:1},envMapIntensity:{value:1}},{refractionIndex:{value:2.4},impurityMap:{value:null},impurityScale:{value:1},colorTransferBegin:{value:new module$src$externals$three.default.Color(16777215)},colorTransferEnd:{value:new module$src$externals$three.default.Color(16777215)},center:{value:new module$src$externals$three.default.Vector3(0,0,0)},radius:{value:1},sphericalNormalMap:{value:null},gamma:{value:1},contrast:{value:1},brightness:{value:0},dispersion:{value:0},tracingOpacity:{value:0},inverseModelMatrix:{value:new module$src$externals$three.default.Matrix4},inverseTransposeModelMatrix:{value:new module$src$externals$three.default.Matrix4}}]),e&&(this.customEnvMap=e.customEnvMap,delete e.customEnvMap,delete e.materialType,delete e.environmentMap,this.depth=e.depth,this.defines.DEPTH=this.depth,0!=e.dispersion&&(this.defines.DISPERSION=""),this.roughness=0,this.metalness=1,this.transparent=!0,e.impurityMap&&(this.defines.USE_IMPURITY_MAP=""),this.inverseModelMatrix=this.uniforms.inverseModelMatrix.value=e.inverseModelMatrix,this.inverseTransposeModelMatrix=this.uniforms.inverseTransposeModelMatrix.value=e.inverseTransposeModelMatrix,this.refractionIndex=this.uniforms.refractionIndex.value=e.refractionIndex,this.dispersion=this.uniforms.dispersion.value=e.dispersion,this.center=this.uniforms.center.value=e.center,this.radius=this.uniforms.radius.value=e.radius,this.sphericalNormalMap=this.uniforms.sphericalNormalMap.value=e.sphericalNormalMap,this.impurityMap=this.uniforms.impurityMap.value=e.impurityMap,this.impurityScale=this.uniforms.impurityScale.value=e.impurityScale,this.colorTransferBegin=this.uniforms.colorTransferBegin.value=e.colorTransferBegin,this.colorTransferEnd=this.uniforms.colorTransferEnd.value=e.colorTransferEnd,this.gamma=this.uniforms.gamma.value=e.gamma,this.contrast=this.uniforms.contrast.value=e.contrast,this.brightness=this.uniforms.brightness.value=e.brightness,this.tracingOpacity=this.uniforms.tracingOpacity.value=e.tracingOpacity),this.vertexShader=module$src$3d$viewports$default$shaders$ShaderFile.default.gem_vert,this.fragmentShader=module$src$3d$viewports$default$shaders$ShaderFile.default.gem_frag,this.type="ShapeDiverGemMaterial",this.needsUpdate=!1,this.setValues(e),delete e.line,delete e._json},module$src$externals$three.default.ShapeDiverGemMaterial.prototype=Object.create(module$src$externals$three.default.MeshStandardMaterial.prototype),module$src$externals$three.default.ShapeDiverGemMaterial.prototype.constructor=module$src$externals$three.default.ShapeDiverGemMaterial,module$src$externals$three.default.ShapeDiverGemMaterial.prototype.isMeshStandardMaterial=!0,module$src$externals$three.default.ShapeDiverGemMaterial.prototype.copy=function(e){return module$src$externals$three.default.MeshStandardMaterial.prototype.copy.call(this,e),this.defines=e.defines,this.uniforms=module$src$externals$three.default.UniformsUtils.clone(e.uniforms),this.type=e.type,this},module$src$externals$three.default.ShapeDiverGemMaterial.prototype.deepCopy=function(e){return module$src$externals$three.default.MeshStandardMaterial.prototype.copy.call(this,e),this.defines=Object.assign({},e.defines),this.uniforms=module$src$externals$three.default.UniformsUtils.clone(e.uniforms),this.type=e.type,this};var module$src$3d$SceneGeometryManager={default:function(e,t){var n,r,o,a,i=[],s=[],l=[],u=new module$src$externals$three.default.Matrix4,c=new module$src$externals$three.default.Matrix4,d=[],p=new module$src$shared$util$PathUtils.default,h=function(e,t){n=this,r=e,module$src$externals$three.default.Cache.enabled=!0,o=new module$src$externals$three.default.Scene,(a=new module$src$externals$three.default.Object3D).computeSceneBoundingBox=function(){var e=new module$src$externals$three.default.Box3;return this.traverse((function(t){var n=p.getObjectPath(t);n&&!n.includes("lightHelper")&&e.union((new module$src$externals$three.default.Box3).setFromObject(t))})),0==e.min.distanceTo(e.max)&&(e=new module$src$externals$three.default.Box3(new module$src$externals$three.default.Vector3(-1,-1,-1),new module$src$externals$three.default.Vector3(1,1,1))),e},a.computeBoundingBox=function(e){var t=new module$src$externals$three.default.Box3;if(!Array.isArray(e)||0===e.length)return this.computeSceneBoundingBox();for(var n=0,r=e.length;n<r;n++){var o=p.getPathObject(this,e[n]+"");o&&t.union((new module$src$externals$three.default.Box3).setFromObject(o))}return 0==t.min.distanceTo(t.max)&&(t=this.computeSceneBoundingBox()),t},o.add(a),p.setScene(a),module$src$shared$mixins$GlobalMixin.default.call(n),t&&t.loggingHandler?module$src$shared$util$GlobalUtils.default.inject(t.loggingHandler,n):module$src$shared$mixins$LoggingMixin.default.call(n),module$src$shared$mixins$SettingsMixin.default.call(n,t.settings,{}),t&&t.messagingHandler&&module$src$shared$util$GlobalUtils.default.inject(t.messagingHandler,n)};return h.prototype._getMaterials=function(e,t,o,a,i,s){if(((e=r.getMaterial(e,t,o,a,i)).includes(null)||e.includes(void 0))&&n.warn("The creation of a material for at least one viewport failed."),!s)for(s=0,t=e.length;s<t;s++)e[s].map=null,e[s].alphaMap=null,e[s].aoMap=null,e[s].bumpMap=null,e[s].displacementMap=null,e[s].emissiveMap=null,e[s].normalMap=null,e[s].metalnessMap=null,e[s].roughnessMap=null;return e},h.prototype._setMeshMaterialCombo=function(e,t,n,o,a,s){r.addMesh(e,t,n),i.push({mesh:e,properties:n,hasTextureCoordinates:o,overrideColor:a,vertexColors:s})},h.prototype._addMesh=function(e,t,r,o,a,i){if(e.transparentMeshHelper){t.renderAO=!1,t.side=module$src$externals$three.default.BackSide;var s=n._getMaterials(t,e.children[0],r,a,i,o);e.children[0].castShadow=!0,t.opacity&&.5<t.opacity&&(e.children[0].receiveShadow=!0),n._setMeshMaterialCombo(e.children[0],s,t,o,a,i),t.side=module$src$externals$three.default.FrontSide,s=n._getMaterials(t,e.children[1],r,a,i,o),e.children[1].castShadow=!0,t.opacity&&.5<t.opacity&&(e.children[1].receiveShadow=!0),n._setMeshMaterialCombo(e.children[1],s,t,o,a,i),t.side=module$src$externals$three.default.DoubleSide}else e.meshHelper?(r=n._getMaterials(t,e.children[0],r,a,i,o),e.children[0].castShadow=!0,e.children[0].receiveShadow=!0,n._setMeshMaterialCombo(e.children[0],r,t,o,a,i)):(r=n._getMaterials(t,e,r,a,i,o),e.castShadow=!0,e.receiveShadow=!0,n._setMeshMaterialCombo(e,r,t,o,a,i))},h.prototype._removeMesh=function(e){r.removeMesh(e);for(var t=0,n=i.length;t<n;t++)if(i[t].mesh===e){i.splice(t,1);break}},h.prototype._addAnchor=function(e,t){s.push({object:e,properties:t}),r.addAnchor(e,t)},h.prototype._removeAnchor=function(e){r.removeAnchor(e);for(var t=0,n=s.length;t<n;t++)if(s[t].object===e){s.splice(t,1);break}},h.prototype.getScene=function(){return o},h.prototype.getGeometryNode=function(){return a},h.prototype.getPathUtils=function(){return p},h.prototype.getMeshMaterialObjects=function(){return i},h.prototype.addGeometry=function(e,t,o,i){if(r.registerForContinuousRendering("geomAddEvent"),o=o||{},null!=p.getPathObject(a,e))return r.unregisterForContinuousRendering("geomAddEvent"),Promise.reject(Error("Geometry already exists at that path: "+e));var s=p.ensurePath(a,e);module$src$shared$util$GlobalUtils.default.typeCheck(o.name,"string")&&(s.SDName=o.name),s.visible=!module$src$shared$util$GlobalUtils.default.typeCheck(o.visible,"boolean")||o.visible;var l=o.hasOwnProperty("boundingBox");l&&(s.SDBoundingBox=o.boundingBox);for(var u={},c=(t=$jscomp.makeIterator(t)).next();!c.done;u={g:u.g},c=t.next()){u.g=c.value,["geometry","path","type","material"].forEach(function(e){return function(t){if(!e.g.hasOwnProperty(t))return r.unregisterForContinuousRendering("geomAddEvent"),Promise.reject(Error("GeometryData object is missing property "+t))}}(u));var d=p.ensurePath(s,u.g.path),h=void 0;h=u.g.material.color?new module$src$externals$three.default.Color(u.g.material.color):new module$src$externals$three.default.Color,u.g.color&&h.set(u.g.color.toRgbString()),c=null;var m=!1;try{switch(u.g.type){case"mesh":if(u.g.geometry instanceof module$src$externals$three.default.BufferGeometry?u.g.geometry.hasOwnProperty("attributes")&&u.g.geometry.attributes.hasOwnProperty("uv")&&(m=!0):u.g.geometry instanceof module$src$externals$three.default.Geometry&&0<u.g.geometry.faceVertexUvs.length&&(m=!0),u.g.geometry instanceof module$src$externals$three.default.BufferGeometry)u.g.geometry.attributes.hasOwnProperty("normal")&&null!=u.g.geometry.attributes.normal||u.g.geometry.computeVertexNormals();else if(u.g.geometry instanceof module$src$externals$three.default.Geometry&&0<u.g.geometry.faces.length){var f=u.g.geometry.faces[0];null!=f.vertexNormals&&0!=f.vertexNormals.length||(u.g.geometry.computeFaceNormals(),u.g.geometry.computeVertexNormals())}if((c=new module$src$externals$three.default.Object3D).meshHelper=!0,u.g.geometry.boundingSphere||(u.g.geometry.computeBoundingSphere(),u.g.geometry.boundingSphere.realCenter=u.g.geometry.boundingSphere.center.clone(),u.g.geometry.translate(-u.g.geometry.boundingSphere.center.x,-u.g.geometry.boundingSphere.center.y,-u.g.geometry.boundingSphere.center.z)),u.g.material&&!0===u.g.material.transparent&&u.g.material.side===module$src$externals$three.default.DoubleSide&&"gem"!==u.g.material.materialType){c.transparentMeshHelper=!0;var g=new module$src$externals$three.default.Mesh(u.g.geometry,new module$src$externals$three.default.MeshBasicMaterial);g.position.set(u.g.geometry.boundingSphere.realCenter.x,u.g.geometry.boundingSphere.realCenter.y,u.g.geometry.boundingSphere.realCenter.z);var $=new module$src$externals$three.default.Mesh(u.g.geometry,new module$src$externals$three.default.MeshBasicMaterial);$.position.set(u.g.geometry.boundingSphere.realCenter.x,u.g.geometry.boundingSphere.realCenter.y,u.g.geometry.boundingSphere.realCenter.z),c.add(g),c.add($)}else{var v=new module$src$externals$three.default.Mesh(u.g.geometry,new module$src$externals$three.default.MeshBasicMaterial);v.position.set(u.g.geometry.boundingSphere.realCenter.x,u.g.geometry.boundingSphere.realCenter.y,u.g.geometry.boundingSphere.realCenter.z),c.add(v)}break;case"points":c=new module$src$externals$three.default.Points(u.g.geometry,new module$src$externals$three.default.PointsMaterial({color:h,size:1}));break;case"line":c=new module$src$externals$three.default.Line(u.g.geometry,"dashed"===u.g.material.line.type?new module$src$externals$three.default.LineDashedMaterial({color:h,linewidth:u.g.material.line.lineWidth,dashSize:u.g.material.line.dashSize,gapSize:u.g.material.line.gapSize,scale:u.g.material.line.scale}):new module$src$externals$three.default.LineBasicMaterial({color:h,linewidth:u.g.material.line.lineWidth})),"dashed"===u.g.material.line.type&&c.computeLineDistances();break;case"linesegments":c=new module$src$externals$three.default.LineSegments(u.g.geometry,"dashed"===u.g.material.line.type?new module$src$externals$three.default.LineDashedMaterial({color:h,linewidth:u.g.material.line.lineWidth,dashSize:u.g.material.line.dashSize,gapSize:u.g.material.line.gapSize,scale:u.g.material.line.scale}):new module$src$externals$three.default.LineBasicMaterial({color:h,linewidth:u.g.material.line.lineWidth})),"dashed"===u.g.material.line.type&&c.computeLineDistances();break;case"lineloop":c=new module$src$externals$three.default.LineLoop(u.g.geometry,"dashed"===u.g.material.line.type?new module$src$externals$three.default.LineDashedMaterial({color:h,linewidth:u.g.material.line.lineWidth,dashSize:u.g.material.line.dashSize,gapSize:u.g.material.line.gapSize,scale:u.g.material.line.scale}):new module$src$externals$three.default.LineBasicMaterial({color:h,linewidth:u.g.material.line.lineWidth})),"dashed"===u.g.material.line.type&&c.computeLineDistances();break;case"anchor":(c=new module$src$externals$three.default.Object3D).position.set(u.g.geometry.position.x,u.g.geometry.position.y,u.g.geometry.position.z),c.type="Anchor",c.material={}}}catch(_){return r.unregisterForContinuousRendering("geomAddEvent"),Promise.reject(_)}if(c){u.g.hasOwnProperty("initialMatrix")&&c.applyMatrix(u.g.initialMatrix);var y=0;for(h=c.children.length;y<h;y++)c.children[y].SDMaterialDefinition=u.g.material;if(d.add(c),c.meshHelper?n._addMesh(c,u.g.material,i,m,u.g.color,u.g.geometry.attributes&&u.g.geometry.attributes.hasOwnProperty("color")):"Anchor"===c.type&&n._addAnchor(c,Object.assign({path:e+d.SDLocalPath},u.g.geometry)),"number"==typeof o.duration&&0<o.duration)for(d=0,h=c.children.length;d<h;d++)c.children[d].material.transparent=!0,c.children[d].material.opacity=0}}return r.updateInteractions(e,o),n.evaluateGeometryVisibility(),l||((i=new module$src$externals$three.default.Box3).setFromObject(s),s.SDBoundingBox=i),r.adjustScene(),"number"==typeof o.duration&&0<o.duration?r.fadeIn(e,o.duration).then((function(){r.unregisterForContinuousRendering("geomAddEvent")})):(r.unregisterForContinuousRendering("geomAddEvent"),Promise.resolve())},h.prototype.removeGeometry=function(e,t){t=t||{};var o=p.getPathObject(a,e);if(null==o)return Promise.resolve();r.registerForContinuousRendering("geomRemoveEvent");var i=function(){if(r.removeFromInteractions(e),r.adjustScene(),r.unregisterForContinuousRendering("geomRemoveEvent"),o.traverse((function(e){"Mesh"===e.type?(n._removeMesh(e),e.material.dispose(),e.geometry.dispose()):"Anchor"===e.type&&n._removeAnchor(e)})),!p.deletePath(a,e)){var t="Could not delete scene path "+e;return n.error("ThreeDManager.removeGeometry",t),Promise.reject(Error(t))}return Promise.resolve()};return"number"==typeof t.duration&&0<t.duration?r.fadeOut(e,t.duration).then((function(){return i()})).catch((function(t){return n.error("ThreeDManager.removeGeometry","Exception when removing geometry at path "+e,t),Promise.reject(t)})):i()},h.prototype.replaceGeometry=function(e,t,o,i){o=o||{},r.registerForContinuousRendering("geomReplaceEvent");for(var s=r.getDefaultThreeDManagers(),l={},u=0,c=s.length;u<c;u++){var d=s[u],h=d.api.getSelected(),m=[];if(h.includes(e))m.push(e);else{var f=p.getPathObject(a,e);if(null!==f)for(var g=0,$=h.length;g<$;g++){var v=h[g];null!==p.getPathObject(f,v)&&m.push(v)}}l[d.runtimeId]=m}var y={};return"number"==typeof o.duration&&0<o.duration&&(y={duration:.5*o.duration}),["interactionGroup","interactionMode","dragPlaneNormal","visible"].forEach((function(e){o.hasOwnProperty(e)&&(y[e]=o[e])})),n.removeGeometry(e,y).catch((function(e){return r.unregisterForContinuousRendering("geomReplaceEvent"),Promise.reject(e)})).then((function(){n.addGeometry(e,t,y,i)})).catch((function(e){return r.unregisterForContinuousRendering("geomReplaceEvent"),Promise.reject(e)})).then((function(){for(var e=r.getDefaultThreeDManagers(),t=0,n=e.length;t<n;t++){var o=e[t],a=l[o.runtimeId];a&&0!=a.length&&o.api.updateSelected(o.api.getSelected().concat(a))}r.unregisterForContinuousRendering("geomReplaceEvent")}))},h.prototype.setToggleCastShadow=function(e,t){return null!=(e=p.getPathObject(a,e))&&(e.castShadow=t,e.traverse((function(e){e.castShadow=t})),r.updateShadowMap(),r.render(),!0)},h.prototype.getObjectPath=function(e){return p.getObjectPath(e)},h.prototype.getPathObject=function(e,t){return p.getPathObject(e,t)},h.prototype.getBoundingBox=function(e){if(e=p.getPathObject(a,e)){var t=(new module$src$externals$three.default.Box3).setFromObject(e);return e.traverseVisible((function(e){var n=p.getObjectPath(e);n&&!n.includes("lightHelper")&&t.union((new module$src$externals$three.default.Box3).setFromObject(e))})),{min:t.min,max:t.max}}return null},h.prototype.setPluginTransformation=function(e,t,n){if(!(e=p.getPathObject(a,e)))return!1;e.originalMatrix||(e.originalMatrix=e.matrix.clone()),e.transformationMatrices||(e.transformationMatrices=[]),("number"==typeof t[0]||t.isMatrix4)&&(t=[t]),u.identity();for(var o=0,i=t.length>e.transformationMatrices.length?t.length:e.transformationMatrices.length;o<i;o++){var s;t[o]?e.transformationMatrices[o]=t[o].isMatrix4?t[o]:(s=c.clone()).set.apply(s,$jscomp.arrayFromIterable(t[o])):e.transformationMatrices[o]||(e.transformationMatrices[o]=c.clone()),u.premultiply(e.transformationMatrices[o])}return e.matrix.identity(),e.applyMatrix(u),n||r.adjustScene(),r.render(),!0},h.prototype.getPluginTransformation=function(e){if(!(e=p.getPathObject(a,e)))return[new module$src$externals$three.default.Matrix4];if(e.transformationMatrices&&0<e.transformationMatrices.length){for(var t=[],n=0,r=e.transformationMatrices.length;n<r;n++)t[n]=e.transformationMatrices[n].clone();return t}return[e.matrix.clone()]},h.prototype.applyPluginTransformation=function(e,t,n){(e=p.getPathObject(a,e)).originalMatrix||(e.originalMatrix=e.matrix.clone()),e.transformationMatrices||(e.transformationMatrices=[]),("number"==typeof t[0]||t.isMatrix4)&&(t=[t]),u.identity();for(var o=0,i=t.length>e.transformationMatrices.length?t.length:e.transformationMatrices.length;o<i;o++){var s;t[o]&&(d[o]=t[o].isMatrix4?t[o]:(s=c.clone()).set.apply(s,$jscomp.arrayFromIterable(t[o]))),e.transformationMatrices[o]?t[o]&&e.transformationMatrices[o].multiply(d[o]):e.transformationMatrices[o]=t[o]?d[o]:c.clone(),u.premultiply(e.transformationMatrices[o])}return e.matrix.identity(),e.applyMatrix(u),n||r.adjustScene(),r.render(),!0},h.prototype.resetPluginTransformation=function(e,t){return(e=p.getPathObject(a,e)).originalMatrix&&(e.matrix.identity(),e.applyMatrix(e.originalMatrix),e.transformationMatrices=[]),t||r.adjustScene(),r.render(),!0},h.prototype.toggleGeometry=function(e,t){for(var r=0;r<e.length;r++)if(module$src$shared$util$GlobalUtils.default.typeCheck(e[r],"string")){var o=p.getPathObject(a,e[r]);o&&(o.visible=!0),-1<(o=l.indexOf(e[r]))&&l.splice(o,1)}for(e=0;e<t.length;e++)module$src$shared$util$GlobalUtils.default.typeCheck(t[e],"string")&&(l.includes(t[e])||l.push(t[e]));n.evaluateGeometryVisibility()},h.prototype.evaluateGeometryVisibility=function(){for(var e=0;e<l.length;e++){var t=p.getPathObject(a,l[e]);t&&(t.visible=!1)}r.updateShadowMap(),r.render()},new h(e,t)}},module$src$app$handlers$ViewportVisibilityHandler={},viewerAppConstants$$module$src$app$handlers$ViewportVisibilityHandler=module$src$app$ViewerAppConstants.default,MessagePrototype$$module$src$app$handlers$ViewportVisibilityHandler=module$src$shared$messages$MessagePrototype.default,GlobalUtils$$module$src$app$handlers$ViewportVisibilityHandler=module$src$shared$util$GlobalUtils.default;module$src$app$handlers$ViewportVisibilityHandler.default=function(e){var t=this,n=e.viewportManager,r=e.sceneGeometryManager,o=!1,a={isVisible:function(){return t.getSettingShallow("showScene")},showScene:function(e){if(!1===e)n.updateSetting("show",!1),a.isVisible()&&(e=new module$src$shared$messages$MessagePrototype.default(module$src$app$ViewerAppConstants.default.messageDataTypes.GENERIC,{shownBefore:o}),t.message(module$src$app$ViewerAppConstants.default.messageTopics.SCENE_VISIBILITY_OFF,e));else{if(n.updateSetting("show",!0),a.isVisible()||(e=new module$src$shared$messages$MessagePrototype.default(module$src$app$ViewerAppConstants.default.messageDataTypes.GENERIC,{shownBefore:o}),t.message(module$src$app$ViewerAppConstants.default.messageTopics.SCENE_VISIBILITY_ON,e)),!o&&!t.getSetting("hasRestoredSettings")&&0<(e=n.getDefaultThreeDManagers()).length){var r=e[0];r.api.camera.zoomAsync().then((function(e){e.data&&r.updateSettingAsync("camera.defaults.perspective",e.data)}))}o=!0}},hideScene:function(){t.updateSetting("showScene",!1)}};this.registerHook("showSceneTransition",(function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&(n.updateSetting("showTransition",e),!0)})),this.registerHook("showScene",(function(e){return!(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean")||0===r.getGeometryNode().children.length||(a.showScene(e),0))}));var i={};return a.messageReceiver=function(e,n,r){if(!o)if(n=n||{},r===module$src$app$ViewerAppConstants.default.messageDataTypes.PROCESS_STATUS&&0===n.progress)i[e.id]=e;else if(r===module$src$app$ViewerAppConstants.default.messageDataTypes.PROCESS_SUCCESS)i.hasOwnProperty(e.id)&&(delete i[e.id],((e=t.getSettingShallow("showSceneMode"))===module$src$app$ViewerAppConstants.default.showSceneModes.ON_FIRST_PLUGIN||0===Object.keys(i).length&&e===module$src$app$ViewerAppConstants.default.showSceneModes.ON_ALL_PLUGINS)&&t.updateSetting("showScene",!0));else if(r===module$src$app$ViewerAppConstants.default.messageDataTypes.PROCESS_ERROR)t.debug("ViewportVisibilityHandler.messageReceiver","Received PROCESS_ERROR for initial geometry loading process, not yet showing 3D scene",e);else if(r===module$src$app$ViewerAppConstants.default.messageDataTypes.PROCESS_FORK&&i.hasOwnProperty(e.id)){for(var a in r=i[e.id],n)(n=module$src$shared$util$GlobalUtils.default.deepCopy(r)).id=a,i[a]=n;delete i[e.id]}},a.init=function(){t.getSetting("showSceneMode")===module$src$app$ViewerAppConstants.default.showSceneModes.INSTANT?t.updateSetting("showScene",!0):t.updateSetting("showScene",!1),setTimeout((function(){t.updateSetting("showSceneTransition",t.getSetting("showSceneTransition"))}),0)},a};var module$src$shared$scene$OutputVersion={},GlobalUtils$$module$src$shared$scene$OutputVersion=module$src$shared$util$GlobalUtils.default;module$src$shared$scene$OutputVersion.default=function(e){var t=this,n={},r={};if(this.addOutputVersion=function(e){return!(!e.hasOwnProperty("id")||n.hasOwnProperty(e.id)||(n[e.id]=e,e.hasOwnProperty("name")&&(r[e.name]=r[e.name]||[],r[e.name].push(e.id)),0))},this.removeOutputVersion=function(e){if(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")){n[e]&&delete n[e];for(var t=Object.keys(r),o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next()){var a=r[o=o.value].indexOf(e);-1!==a&&r[o].splice(a,1)}}},this.getOutputVersion=function(e){return n[e]},this.getOutputVersionIdByName=function(e){return r[e]},this.outputIds=Object.defineProperty(this,"outputIds",{enumerable:!0,configurable:!1,readable:!0,get:function(){return Object.keys(n)}}),this.outputNames=Object.defineProperty(this,"outputNames",{enumerable:!0,configurable:!1,readable:!0,get:function(){return Object.keys(r)}}),this.getCompiledOutputVersion=function(e,n){if("string"!=typeof e||!n)return null;var r=t.getOutputVersion(e);if(!r||!Array.isArray(r.geometry)||0===r.geometry.length)return null;var o={geometry:[]};if("id version name bbmin bbmax interactionGroup interactionMode duration dragPlaneNormal visible".split(" ").forEach((function(e){r.hasOwnProperty(e)&&(o[e]=r[e])})),e=null,r.hasOwnProperty("materialId")){var a=this.getOutputVersion(r.materialId);a&&a.material&&(e=a.material)}a={};for(var i=$jscomp.makeIterator(r.geometry),s=i.next();!s.done;a={geom:a.geom,g:a.g},s=i.next()){if(a.geom=s.value,a.g={},"path type geometry texcoord initialMatrix material color".split(" ").forEach(function(e){return function(t){e.geom.hasOwnProperty(t)&&(e.g[t]=e.geom[t])}}(a)),["path","type"].forEach(function(e){return function(t){if(!e.g.hasOwnProperty(t))return null}}(a)),!a.g.hasOwnProperty("material")){s=null,s=e||(r.hasOwnProperty("material")?r.material:[n]);var l=a.g.path.split(".");if(0<l.length){for(var u=null,c=(l=$jscomp.makeIterator(l)).next();!c.done;c=l.next())if((c=c.value).includes("content_")){u=c;break}null!==u&&"content"===(u=u.split("_"))[0]&&2===u.length&&(u=parseInt(u[1]),isNaN(u)||(a.g.material=s[u%s.length].clone(),a.geom.hasOwnProperty("flatShade")&&!1===a.g.material.flatShading&&(a.g.material.flatShading=a.geom.flatShade)))}a.g.hasOwnProperty("material")||(a.g.material=s[0])}a.g.material.bumpScale=n.bumpScale,o.geometry.push(a.g)}return o},null!==e&&Array.isArray(e))for(var o=(e=$jscomp.makeIterator(e)).next();!o.done;o=e.next())t.addOutputVersion(o.value)};var module$src$externals$verb_nurbs={};try{module$src$externals$verb_nurbs.default=eval("verb")}catch(a){"function"==typeof require&&(module$src$externals$verb_nurbs.default=eval("require('verb-nurbs')"))}var module$src$shared$util$verbToThreeConversion={default:{}},verb$$module$src$shared$util$verbToThreeConversion;try{verb$$module$src$shared$util$verbToThreeConversion=module$src$externals$verb_nurbs.default}catch(a){verb$$module$src$shared$util$verbToThreeConversion=null}if(verb$$module$src$shared$util$verbToThreeConversion){var THREE$219=module$src$externals$three.default,asVector3=function(e){return e.map((function(e){return new module$src$externals$three.default.Vector3(e[0],e[1],e[2])}))},tessellateCurve=function(e){var t=new module$src$externals$three.default.Geometry;return t.vertices=asVector3(e.tessellate()),t},tessellateSurface=function(e){var t=e.tessellate();return(e=new module$src$externals$three.default.Geometry).vertices=asVector3(t.points),e.faces=t.faces.map((function(e){var n=e.map((function(e){return new module$src$externals$three.default.Vector3((e=t.normals[e])[0],e[1],e[2])}));return new module$src$externals$three.default.Face3(e[0],e[1],e[2],n)})),e};verb$$module$src$shared$util$verbToThreeConversion.geom.NurbsCurve.prototype.toThreeGeometry=function(){return tessellateCurve(this)},verb$$module$src$shared$util$verbToThreeConversion.geom.NurbsSurface.prototype.toThreeGeometry=function(){return tessellateSurface(this)}}var module$src$shared$singletons$GLBLoader={},AXIOS$$module$src$shared$singletons$GLBLoader=module$src$externals$axios.default,THREE$$module$src$shared$singletons$GLBLoader=module$src$externals$three.default,TO_TINY_COLOR$$module$src$shared$singletons$GLBLoader=module$src$shared$util$toTinyColor.default,GLOBAL_UTILS$$module$src$shared$singletons$GLBLoader=module$src$shared$util$GlobalUtils.default,MATERIAL_PROPERTIES_STANDARD$$module$src$shared$singletons$GLBLoader=module$src$shared$materials$MaterialPropertiesStandard.default,verb$$module$src$shared$singletons$GLBLoader,verb_util$$module$src$shared$singletons$GLBLoader;try{verb$$module$src$shared$singletons$GLBLoader=module$src$externals$verb_nurbs.default,null!==verb$$module$src$shared$singletons$GLBLoader&&(verb_util$$module$src$shared$singletons$GLBLoader=module$src$shared$util$verbToThreeConversion)}catch(a){verb$$module$src$shared$singletons$GLBLoader=null}var GLBLoader$$module$src$shared$singletons$GLBLoader=function(){var e=this;this.log=function(){},this.warn=function(){},this.error=function(){},this.loadGeometry=function(e,n,r,o){return r=r||.001,e={method:"GET",url:e,responseType:"arraybuffer",headers:{}},(o=o||{}).authorization&&(e.headers.Authorization=o.authorization),(0,module$src$externals$axios.default)(e).catch((function(e){return Promise.reject(e.response?Error("Loading glb failed with status "+e.response.status+"."):e.request?Error("No response to glb download AJAX request."):Error("Error setting up the glb download AJAX request."))})).then((function(e){return t(e.data,n,r)}))};var t=function(t,n,r){return new Promise((function(o,a){for(var i=new DataView(t),s="",l=0;4>l;++l)s+=String.fromCharCode(i.getUint8(l));if("glTF"!=s)a(Error("ShapeDiverGLBLoader got invalid data: glTF magic wrong."));else{s=i.getUint32(8,!0),l=i.getUint32(12,!0);for(var u="",c=0;c<l;++c)u+=String.fromCharCode(i.getUint8(20+c));var d=JSON.parse(u),p=20+l;if(d.hasOwnProperty("meshes")&&d.hasOwnProperty("bufferViews")&&d.hasOwnProperty("accessors")){var h={};Object.keys(d.accessors).forEach((function(n){var r=d.accessors[n],o=r.bufferView;if(d.bufferViews.hasOwnProperty(o)){var i=d.bufferViews[o];if(o={},r.hasOwnProperty("type")&&r.hasOwnProperty("count")&&r.hasOwnProperty("componentType")){switch(r.type){case"SCALAR":o.itemSize=1;break;case"VEC2":o.itemSize=2;break;case"VEC3":o.itemSize=3;break;case"VEC4":case"MAT2":o.itemSize=4;break;case"MAT3":o.itemSize=9;break;case"MAT4":o.itemSize=16;break;default:o.itemSize=1}var s=p+parseInt(i.byteOffset)+parseInt(r.byteOffset);if(t.length<s+r.count*o.itemSize)a(Error("Error: buffer length exceeded"));else{var l=r.count*o.itemSize;switch(r.componentType){case 5120:o.typedArray=new Int8Array(t,s,l);break;case 5121:o.typedArray=new Uint8Array(t,s,l);break;case 5122:if(0==s%2)o.typedArray=new Int16Array(t,s,l);else{e.warn("Geometry loader encountered unaligned data."),i=new ArrayBuffer(2*l);var u=new Int8Array(i);s=new Int8Array(t,s,2*l);for(var c=0,m=2*l;c<m;++c)u[c]=s[c];o.typedArray=new Int16Array(i,0,r.count*o.itemSize)}break;case 5123:if(0==s%2)o.typedArray=new Uint16Array(t,s,l);else{for(e.warn("Geometry loader encountered unaligned data."),i=new ArrayBuffer(2*l),u=new Int8Array(i),s=new Int8Array(t,s,2*l),r=0,m=2*l;r<m;++r)u[r]=s[r];o.typedArray=new Uint16Array(i,0,l)}break;case 5124:e.warn("Encountered 16 bit integer as type for array buffer. This is illegal for webGL. Ignoring it.");break;case 5125:e.warn("Encountered 16 bit unsigned integer as type for array buffer. This is illegal for webGL. Ignoring it.");break;case 5126:if(0==s%4)o.typedArray=new Float32Array(t,s,l);else{for(e.warn("Geometry loader encountered unaligned data."),i=new ArrayBuffer(4*l),u=new Int8Array(i),s=new Int8Array(t,s,4*l),r=0,m=4*l;r<m;++r)u[r]=s[r];o.typedArray=new Float32Array(i,0,l)}break;default:o.typedArray=new Float32Array(t,s,l)}h[n]=o}}else a(Error("Invalid JSON format in glTF file. Accessor is missing required property."))}}));var m={};d.hasOwnProperty("materials")&&Object.keys(d.materials).forEach((function(e){var t=d.materials[e];if(t.hasOwnProperty("extensions"))if(t.extensions.hasOwnProperty("KHR_materials_common"))if(t.extensions.KHR_materials_common.hasOwnProperty("technique"))if("BLINN"!=t.extensions.KHR_materials_common.technique)a(Error("ShapeDiverGLBLoader got invalid data: only BLINN material technique is supported, we got "+t.extensions.KHR_materials_common.technique));else if(t.extensions.KHR_materials_common.hasOwnProperty("values")){var n=new module$src$shared$materials$MaterialPropertiesStandard.default;if((t=t.extensions.KHR_materials_common.values).hasOwnProperty("doubleSided")&&(n.side=t.doubleSided?module$src$externals$three.default.DoubleSide:module$src$externals$three.default.FrontSide),t.hasOwnProperty("diffuse")){for(var r=t.diffuse.slice(0,3),o=0;3>o;++o)r[o]*=255;n.color=(0,module$src$shared$util$toTinyColor.default)(r).toThreeColor(),r=Math.max(0,Math.min(t.diffuse[3],1)),n.opacity=r,n.transparent=1>r}t.hasOwnProperty("shininess")&&(n.metalness=Math.min(1,t.shininess),n.roughness=1-Math.min(1,t.shininess)),t.hasOwnProperty("transparency")&&(r=Math.max(0,Math.min(t.transparency,1)),n.opacity=r,n.transparent=1>r),t.hasOwnProperty("transparent")&&(r=module$src$shared$util$GlobalUtils.default.toBoolean(t.transparent),n.transparent=r,r||(n.opacity=1)),t.hasOwnProperty("_roughness")&&(n.roughness=Math.min(1,Math.max(0,t.roughness))),t.hasOwnProperty("_metalness")&&(n.metalness=Math.min(1,Math.max(0,t.metalness))),m[e]=n}else a(Error("ShapeDiverGLBLoader got invalid data: material definition did not contain values member."));else a(Error("ShapeDiverGLBLoader got invalid data: material definition did not contain technique member."));else a(Error("ShapeDiverGLBLoader got invalid data: material definition did not contain KHR_materials_common member."));else a(Error("ShapeDiverGLBLoader got invalid data: material definition did not contain extensions member."))}));var f={};Object.keys(d.meshes).forEach((function(e){var t=[],n=d.meshes[e];if(n.hasOwnProperty("primitives")){for(var r=(n=$jscomp.makeIterator(n.primitives)).next();!r.done;r=n.next()){var o=r.value;if(!o.hasOwnProperty("indices")||!o.hasOwnProperty("attributes"))return void a(Error("ShapeDiverGLBLoader got invalid data: mesh definition primitive misses indices or attributes."));if(!o.attributes.hasOwnProperty("POSITION"))return void a(Error("ShapeDiverGLBLoader got invalid data: mesh definition primitive is missing POSITION"));if(r=new module$src$externals$three.default.BufferGeometry,!h.hasOwnProperty(o.indices))return void a(Error("ShapeDiverGLBLoader got invalid data: accessor for mesh primitives not found."));var i=h[o.indices];if(r.setIndex(new module$src$externals$three.default.BufferAttribute(i.typedArray,i.itemSize)),!h.hasOwnProperty(o.attributes.POSITION))return void a(Error("ShapeDiverGLBLoader got invalid data: accessor for mesh positions not found"));if(r.addAttribute("position",new module$src$externals$three.default.BufferAttribute((i=h[o.attributes.POSITION]).typedArray,i.itemSize)),i=!1,o.attributes.hasOwnProperty("NORMAL")){if(h.hasOwnProperty(o.attributes.NORMAL)){for(var s=h[o.attributes.NORMAL],l=!1,u=0;10>u;++u){if(.001<Math.abs(s.typedArray[3*u])){l=!0;break}if(.001<Math.abs(s.typedArray[3*u+1])){l=!0;break}if(.001<Math.abs(s.typedArray[3*u+2])){l=!0;break}}l?r.addAttribute("normal",new module$src$externals$three.default.BufferAttribute(s.typedArray,s.itemSize)):r.computeVertexNormals()}}else i=!0;s=!1,o.attributes.hasOwnProperty("COLOR")&&h.hasOwnProperty(o.attributes.COLOR)&&(r.addAttribute("color",new module$src$externals$three.default.BufferAttribute((s=h[o.attributes.COLOR]).typedArray,s.itemSize,!0)),s=!0),u=!1,o.attributes.hasOwnProperty("TEXCOORD_0")&&h.hasOwnProperty(o.attributes.TEXCOORD_0)&&(r.addAttribute("uv",new module$src$externals$three.default.BufferAttribute((l=h[o.attributes.TEXCOORD_0]).typedArray,l.itemSize)),u=!0),l=null,o.hasOwnProperty("material")&&m.hasOwnProperty(o=o.material)&&(l=m[o]),r={geometry:r,hasTexCoord:u,hasVertexColors:s,flatShading:i},null!=l&&(r.material=l),t.push(r)}f[e]=t}else a(Error("ShapeDiverGLBLoader got invalid data: primitives property missing."))}));var g=[];for(Array.isArray(n)&&0!=n.length&&n.every((function(e){return e&&e.isMatrix4}))||(n=[new module$src$externals$three.default.Matrix4]),Object.keys(d.nodes).forEach((function(e){var t=d.nodes[e],r=new module$src$externals$three.default.Matrix4;if(t.hasOwnProperty("matrix")&&r.fromArray(t.matrix),t.hasOwnProperty("meshes"))for(var o={transformIndex:0};o.transformIndex<n.length;++(o={transformIndex:o.transformIndex,matrixFinal:o.matrixFinal}).transformIndex){var a=n[o.transformIndex];o.matrixFinal=new module$src$externals$three.default.Matrix4,o.matrixFinal.multiplyMatrices(a,r),t.meshes.forEach(function(t){return function(n){if(f.hasOwnProperty(n))for(var r=0,o=f[n].length;r<o;++r){var a={path:"transformation_"+t.transformIndex+"."+e+"."+n+".primitive_"+r,geometry:f[n][r].geometry,texCoord:f[n][r].hasTexCoord,vertexColors:f[n][r].hasVertexColors,initialMatrix:t.matrixFinal,type:"mesh"};f[n][r].hasOwnProperty("material")?(f[n][r].flatShading&&!1===f[n][r].material.flatShading&&(f[n][r].material.flatShading=f[n][r].flatShading),a.material=f[n][r].material):a.flatShade=f[n][r].flatShading,g.push(a)}}}(o))}})),s>=i.byteLength&&o(g),l="",u=0;5>u;++u)l+=String.fromCharCode(i.getUint8(s+u));if("sdgTF"!=l)e.warn("ShapeDiverGLBLoader got invalid data, sdgTF magic wrong : "+l);else{for(i=i.getUint32(s+13,!0),l="",u=Math.ceil(i/1024),c=0;c<u;++c){var $=1024;1024>i-1024*c&&($=i-1024*c),l+=String.fromCharCode.apply(null,new Uint8Array(t,s+21+1024*c,$))}var v=JSON.parse(l),y=s+21+i;if(v.hasOwnProperty("accessors")){if(h={},Object.keys(v.accessors).forEach((function(n){var r=v.accessors[n],a={};if(r.hasOwnProperty("type")&&r.hasOwnProperty("count")&&r.hasOwnProperty("componentType")){switch(r.type){case"SCALAR":a.itemSize=1;break;case"VEC2":a.itemSize=2;break;case"VEC3":a.itemSize=3;break;case"VEC4":a.itemSize=4;break;case"VEC7":a.itemSize=7;break;case"VEC10":a.itemSize=10;break;case"VEC12":a.itemSize=12;break;case"MAT2":a.itemSize=4;break;case"MAT3":a.itemSize=9;break;case"MAT4":a.itemSize=16;break;default:a.itemSize=1}var i=y+parseInt(r.byteOffset);switch(t.length<i+r.count*r.itemSize&&e.warn("Error: buffer length exceeded"),r.componentType){case 5120:a.typedArray=new Int8Array(t,i,r.count*a.itemSize);break;case 5121:a.typedArray=new Uint8Array(t,i,r.count*a.itemSize);break;case 5122:a.typedArray=new Int16Array(t,i,r.count*a.itemSize);break;case 5123:a.typedArray=new Uint16Array(t,i,r.count*a.itemSize);break;case 5126:a.typedArray=new Float32Array(t,i,r.count*a.itemSize);break;default:a.typedArray=new Float32Array(t,i,r.count*a.itemSize)}a.count=r.count,h[n]=a}else e.warn("ShapeDiverGLBLoader got invalid data for ShapeDiver formats. Returning pure glTF-based object only."),o(g)})),v.hasOwnProperty("spheres")&&(s=v.spheres).hasOwnProperty("attributes")&&(s=s.attributes).hasOwnProperty("SPHERES"))for(u=0,s=(i=h[s.SPHERES]).count;u<s;++u)(l=new module$src$externals$three.default.SphereBufferGeometry(i.typedArray[4*u+3],20,20)).translate(i.typedArray[4*u],i.typedArray[4*u+1],i.typedArray[4*u+2]),g.push({path:"sdgtf_sphere_"+(u+1).toString(),geometry:l,texCoord:!1,type:"mesh"});if(v.hasOwnProperty("circles")&&(s=v.circles).hasOwnProperty("attributes")&&(s=s.attributes).hasOwnProperty("CIRCLES"))for(l=0,s=(i=h[s.CIRCLES]).count;l<s;++l){u=new module$src$externals$three.default.Vector3(i.typedArray[10*l],i.typedArray[10*l+1],i.typedArray[10*l+2]),c=new module$src$externals$three.default.Vector3(i.typedArray[10*l+3],i.typedArray[10*l+4],i.typedArray[10*l+5]),$=new module$src$externals$three.default.Vector3(i.typedArray[10*l+6],i.typedArray[10*l+7],i.typedArray[10*l+8]);var _=i.typedArray[10*l+9],b=new module$src$externals$three.default.Vector3;if(b.crossVectors(c,$),0<_){_=new module$src$externals$three.default.ArcCurve(0,0,_,0,2*Math.PI,!1),_=(new module$src$externals$three.default.Geometry).setFromPoints(_.getPoints(50));var x=new module$src$externals$three.default.Matrix4;x.set(c.x,$.x,b.x,0,c.y,$.y,b.y,0,c.z,$.z,b.z,0,0,0,0,1),_.applyMatrix(x),_.translate(u.x,u.y,u.z),_.sdgtfType="circle",g.push({path:"sdgtf_circle_"+(l+1).toString(),geometry:_,type:"line"})}}if(v.hasOwnProperty("cylinders")&&(s=v.cylinders).hasOwnProperty("attributes")&&(s=s.attributes).hasOwnProperty("CYLINDERS"))for(l=0,s=(i=h[s.CYLINDERS]).count;l<s;++l){b=new module$src$externals$three.default.Vector3(i.typedArray[7*l],i.typedArray[7*l+1],i.typedArray[7*l+2]),u=new module$src$externals$three.default.Vector3(i.typedArray[7*l+3],i.typedArray[7*l+4],i.typedArray[7*l+5]),_=i.typedArray[7*l+6],(c=new module$src$externals$three.default.Vector3).subVectors(b,u),x=Math.abs(c.dot(new module$src$externals$three.default.Vector3(1,0,0)));var w=Math.abs(c.dot(new module$src$externals$three.default.Vector3(0,1,0)));($=new module$src$externals$three.default.Vector3).crossVectors(c,x<w?new module$src$externals$three.default.Vector3(1,0,0):new module$src$externals$three.default.Vector3(0,1,0)),(x=new module$src$externals$three.default.Vector3).crossVectors(c,$),c.normalize(),$.normalize(),x.normalize(),(_=new module$src$externals$three.default.CylinderBufferGeometry(_,_,b.distanceTo(u),50,1,!0)).rotateX(.5*Math.PI),_.translate(0,0,.5*b.distanceTo(u)),(b=new module$src$externals$three.default.Matrix4).set($.x,x.x,c.x,0,$.y,x.y,c.y,0,$.z,x.z,c.z,0,0,0,0,1),_.applyMatrix(b),_.translate(u.x,u.y,u.z),g.push({path:"sdgtf_cylinder_"+(l+1).toString(),geometry:_,texCoord:!1,type:"mesh"})}if(v.hasOwnProperty("arcs")&&(s=v.arcs).hasOwnProperty("attributes")&&(s=s.attributes).hasOwnProperty("ARCS"))for(l=0,s=(i=h[s.ARCS]).count;l<s;++l)u=new module$src$externals$three.default.Vector3(i.typedArray[12*l],i.typedArray[12*l+1],i.typedArray[12*l+2]),c=new module$src$externals$three.default.Vector3(i.typedArray[12*l+3],i.typedArray[12*l+4],i.typedArray[12*l+5]),$=new module$src$externals$three.default.Vector3(i.typedArray[12*l+6],i.typedArray[12*l+7],i.typedArray[12*l+8]),w=i.typedArray[12*l+9],_=i.typedArray[12*l+10],x=i.typedArray[12*l+11],(b=new module$src$externals$three.default.Vector3).crossVectors(c,$),0<w&&(w=new module$src$externals$three.default.ArcCurve(0,0,w,_,x,!1),_=(new module$src$externals$three.default.Geometry).setFromPoints(w.getPoints(Math.max(3,Math.round((x-_)/2*50*Math.PI)))),(x=new module$src$externals$three.default.Matrix4).set(c.x,$.x,b.x,0,c.y,$.y,b.y,0,c.z,$.z,b.z,0,0,0,0,1),_.applyMatrix(x),_.translate(u.x,u.y,u.z),_.sdgtfType="arc",g.push({path:"sdgtf_arc_"+(l+1).toString(),geometry:_,type:"line"}));if(verb$$module$src$shared$singletons$GLBLoader&&v.hasOwnProperty("beziercurves")){var S=v.beziercurves,M=0;Object.keys(S).forEach((function(t){var n=S[t];if(n.hasOwnProperty("attributes")&&n.hasOwnProperty("degree")){var o=n.attributes;if(o.hasOwnProperty("KNOTS")&&o.hasOwnProperty("CONTROLPOINTS")){var a=h[o.KNOTS];t=[];for(var i=0,s=a.typedArray.length;i<s;++i)t.push(a.typedArray[i]),0!=i&&i!=a.typedArray.length-1||t.push(a.typedArray[i]);for(a=h[o.CONTROLPOINTS],o=[],i=0,s=a.typedArray.length/3;i<s;++i)o.push([a.typedArray[3*i],a.typedArray[3*i+1],a.typedArray[3*i+2]]);n=n.degree;try{var l=verb$$module$src$shared$singletons$GLBLoader.geom.NurbsCurve.byKnotsControlPointsWeights(n,t,o)}catch(u){return void e.warn("verb nurbs curve creation failed with error "+u)}(l=l.toThreeGeometry(r)).sdgtfType="beziercurve",g.push({path:"sdgtf_curve_"+(M+1).toString(),geometry:l,type:"line"}),++M}}}))}if(verb$$module$src$shared$singletons$GLBLoader&&v.hasOwnProperty("surfacepatches")){var E=v.surfacepatches,T=0;Object.keys(E).forEach((function(t){var n=E[t];if(n.hasOwnProperty("attributes")&&n.hasOwnProperty("degreeU")&&n.hasOwnProperty("degreeV")&&n.hasOwnProperty("controlPointCountU")&&n.hasOwnProperty("controlPointCountV")){var o=n.attributes;if(o.hasOwnProperty("KNOTSU")&&o.hasOwnProperty("KNOTSV")&&o.hasOwnProperty("CONTROLPOINTS")){var a=h[o.KNOTSU];t=[];for(var i=0,s=a.typedArray.length;i<s;++i)t.push(a.typedArray[i]),0!=i&&i!=a.typedArray.length-1||t.push(a.typedArray[i]);a=[];var l=0;for(s=(i=h[o.KNOTSV]).typedArray.length;l<s;++l)a.push(i.typedArray[l]),0!=l&&l!=i.typedArray.length-1||a.push(i.typedArray[l]);s=n.controlPointCountU,i=n.controlPointCountV,l=h[o.CONTROLPOINTS],o=[];for(var u=0,c=0;c<s;++c){for(var d=[],p=0;p<i;++p)d.push([l.typedArray[3*u],l.typedArray[3*u+1],l.typedArray[3*u+2]]),++u;o.push(d)}s=n.degreeU,n=n.degreeV;try{var m=verb$$module$src$shared$singletons$GLBLoader.geom.NurbsSurface.byKnotsControlPointsWeights(s,n,t,a,o)}catch(f){return void e.warn("verb surface curve creation failed with error "+f.message)}(m=m.toThreeGeometry(r)).computeFaceNormals(),m.computeVertexNormals(),g.push({path:"sdgtf_surface_"+(T+1).toString(),geometry:m,texCoord:!1,type:"mesh"}),++T}}}))}if(v.hasOwnProperty("polylines")){var C=v.polylines,P=0;Object.keys(C).forEach((function(e){if((e=C[e]).hasOwnProperty("attributes")&&(e=e.attributes).hasOwnProperty("VERTICES")){e=h[e.VERTICES];var t=new module$src$externals$three.default.BufferGeometry;t.addAttribute("position",new module$src$externals$three.default.BufferAttribute(e.typedArray,3)),t.sdgtfType="polyline",g.push({path:"sdgtf_polyline_"+(P+1).toString(),geometry:t,type:"line"}),++P}}))}if(v.hasOwnProperty("points")){var A=v.points,L=0;Object.keys(A).forEach((function(e){if((e=A[e]).hasOwnProperty("attributes")&&(e=e.attributes).hasOwnProperty("POINTS")){e=h[e.POINTS];for(var t=new module$src$externals$three.default.Geometry,n=0,r=e.typedArray.length/3;n<r;++n){var o=new module$src$externals$three.default.Vector3(e.typedArray[3*n],e.typedArray[3*n+1],e.typedArray[3*n+2]);t.vertices.push(o)}g.push({path:"sdgtf_pointcloud_"+(L+1).toString(),geometry:t,type:"points"}),++L}}))}}else e.warn("ShapeDiverGLBLoader got invalid data for ShapeDiver formats. Returning pure glTF-based object only.")}o(g)}else a(Error("Invalid JSON format in glTF file. Main object is missing required property."))}}))}};module$src$shared$singletons$GLBLoader.default=new GLBLoader$$module$src$shared$singletons$GLBLoader;var module$src$shared$singletons$GLTFHelpers$Node={},THREE$$module$src$shared$singletons$GLTFHelpers$Node=module$src$externals$three.default;module$src$shared$singletons$GLTFHelpers$Node.default=function(e,t,n,r,o){this.id=e,this.gltf=t,this.nodeRef=t.nodes[e],this.parent=n||null,this.nodes=[],this.materials=[],this.rootNode=o,this.mesh=isNaN(this.nodeRef.mesh)?null:t.meshes[this.nodeRef.mesh],this.camera=isNaN(this.nodeRef.camera)?null:t.cameras[this.nodeRef.camera],this.matrix=new module$src$externals$three.default.Matrix4,this.matrix.multiply(t.rotationMatrix),this.transformedMatrix=new module$src$externals$three.default.Matrix4,this.transformationsOrder=[],this.nodeRef.matrix?this.transformedMatrix.fromArray(this.nodeRef.matrix):(this.nodeRef.translation&&((e=new module$src$externals$three.default.Matrix4).makeTranslation.apply(e,$jscomp.arrayFromIterable(this.nodeRef.translation)),this.transformedMatrix.multiply(e)),this.nodeRef.rotation&&(e=new(Function.prototype.bind.apply(module$src$externals$three.default.Quaternion,[null].concat($jscomp.arrayFromIterable(this.nodeRef.rotation)))),(n=new module$src$externals$three.default.Matrix4).makeRotationFromQuaternion(e),this.transformedMatrix.multiply(n)),this.nodeRef.scale&&((e=new module$src$externals$three.default.Matrix4).makeScale.apply(e,$jscomp.arrayFromIterable(this.nodeRef.scale)),this.transformedMatrix.multiply(e))),this._setTransformationOrder(),this._createChildNodes(t,r),this._resolveFinalMatrix(t),this._createMaterials(t),r.push(this)},module$src$shared$singletons$GLTFHelpers$Node.default.prototype._mat4CoordChange=function(e){var t=new module$src$externals$three.default.Matrix4;return t.fromArray(e),t.multiply(this.gltf.rotationMatrix),t},module$src$shared$singletons$GLTFHelpers$Node.default.prototype._setTransformationOrder=function(){var e=this.parent;for(this.transformationsOrder.push(this.transformedMatrix.clone());e;)e.transformedMatrix&&this.transformationsOrder.length&&this.transformationsOrder.push(e.transformedMatrix.clone()),e=e.parent;this.transformationsOrder.reverse()},module$src$shared$singletons$GLTFHelpers$Node.default.prototype._createChildNodes=function(e,t){var n=this;this.nodeRef.children&&0<this.nodeRef.children.length&&this.nodeRef.children.forEach((function(r){return n.nodes.push(new module$src$shared$singletons$GLTFHelpers$Node.default(r,e,n,t))}))},module$src$shared$singletons$GLTFHelpers$Node.default.prototype._resolveFinalMatrix=function(){for(var e=this.transformationsOrder[0],t=1;t<this.transformationsOrder.length;t++)e.multiply(this.transformationsOrder[t]);this.matrix.multiply(e)},module$src$shared$singletons$GLTFHelpers$Node.default.prototype._createMaterials=function(e){var t=this;this.mesh&&this.mesh.primitives.forEach((function(n){n.hasOwnProperty("material")&&t.materials.push(e.materials[n.material])}))};var module$src$shared$singletons$GLTFHelpers$SceneHierarchy={},Node$$module$src$shared$singletons$GLTFHelpers$SceneHierarchy=module$src$shared$singletons$GLTFHelpers$Node.default,THREE$$module$src$shared$singletons$GLTFHelpers$SceneHierarchy=module$src$externals$three.default;module$src$shared$singletons$GLTFHelpers$SceneHierarchy.default=function(e){var t=this;this.sceneId=e.scene||0,this.sceneRef=e.scenes[this.sceneId],this.nodes=[],this.allNodes=[],this.rotationMatrix=new module$src$externals$three.default.Matrix4,this.rotationMatrix.makeRotationAxis(new module$src$externals$three.default.Vector3(1,0,0),.5*Math.PI),e.rotationMatrix=this.rotationMatrix,this.sceneRef.nodes.forEach((function(n){return t.nodes.push(new module$src$shared$singletons$GLTFHelpers$Node.default(n,e,null,t.allNodes,!0))}))};var module$src$shared$singletons$GLTFHelpers$WebGLConstants={default:{}};module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.ELEMENT_ARRAY_BUFFER=34963,module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.ARRAY_BUFFER=34962,module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.UNSIGNED_BYTE=5121,module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.UNSIGNED_SHORT=5123,module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.UNSIGNED_INT=5125,module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.FLOAT=5126;var module$src$shared$singletons$GLTFHelpers$Accessor={},WebGLConstants$$module$src$shared$singletons$GLTFHelpers$Accessor=module$src$shared$singletons$GLTFHelpers$WebGLConstants.default,ELEM_IN_TYPE$$module$src$shared$singletons$GLTFHelpers$Accessor={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},$jscomp$compprop11={},SIZE_OF_ELEM_IN_BYTES$$module$src$shared$singletons$GLTFHelpers$Accessor=($jscomp$compprop11[module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.UNSIGNED_BYTE]=1,$jscomp$compprop11[module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.UNSIGNED_SHORT]=2,$jscomp$compprop11[module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.UNSIGNED_INT]=4,$jscomp$compprop11[module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.FLOAT]=4,$jscomp$compprop11);module$src$shared$singletons$GLTFHelpers$Accessor.default=function(e,t,n,r){switch(this.buffer=n,this.bufferView=r,this.id=e,this.accessorRef=t.accessors[e],this.type=this.accessorRef.type,this.componentType=this.accessorRef.componentType,this.offsetForInterleaved=this.bufferView.numOfTypeArrayElementsPerVertex,this.byteOffset=this.accessorRef.byteOffset||0,this.min=this.accessorRef.min,this.max=this.accessorRef.max,this.elementComponentsSize=ELEM_IN_TYPE$$module$src$shared$singletons$GLTFHelpers$Accessor[this.type],this.bytesPerElement=SIZE_OF_ELEM_IN_BYTES$$module$src$shared$singletons$GLTFHelpers$Accessor[this.componentType],e=this.componentType===module$src$shared$singletons$GLTFHelpers$WebGLConstants.default.FLOAT,this.count=this.accessorRef.count,this.byteLength=this.count*this.elementComponentsSize*this.bytesPerElement,t=this.bufferView.dataView,this.bufferArray=null,n=[],this.bufferView.isInterleaved?null==this.bufferView.interleavedBuffer&&(n=this._processInterleavedBufferArray(t,e)):n=this._processBufferArray(t,e),this.bytesPerElement){case 1:this.bufferArray=new Uint8Array(n);break;case 2:this.bufferArray=new Uint16Array(n);break;case 4:this.bufferArray=e?new Float32Array(n):new Uint32Array(n)}this.array=n,this.bufferView.isInterleaved&&(this.bufferView.interleavedBuffer=this.bufferArray)},module$src$shared$singletons$GLTFHelpers$Accessor.default.prototype._processInterleavedBufferArray=function(e,t){for(var n=[],r=0,o=0;o<this.bufferView.byteLength;o+=this.bytesPerElement){var a=0;switch(this.bytesPerElement){case 1:a=e.getUint8(o,!0);break;case 2:a=e.getUint16(o,!0);break;case 4:t?(a=e.getFloat32(o,!0),this.min&&a<this.min[r]&&(a=this.min[r]),this.max&&a>this.max[r]&&(a=this.max[r]),++r>=this.elementComponentsSize&&(r=0)):a=e.getUint32(o,!0)}n.push(a)}return n},module$src$shared$singletons$GLTFHelpers$Accessor.default.prototype._processBufferArray=function(e,t){for(var n=[],r=0,o=this.byteOffset;o<this.byteOffset+this.byteLength;o+=this.bytesPerElement){var a=0;switch(this.bytesPerElement){case 1:a=e.getUint8(o,!0);break;case 2:a=e.getUint16(o,!0);break;case 4:t?(a=e.getFloat32(o,!0),this.min&&a<this.min[r]&&(a=this.min[r]),this.max&&a>this.max[r]&&(a=this.max[r]),++r>=this.elementComponentsSize&&(r=0)):a=e.getUint32(o,!0)}n.push(a)}return n};var module$src$shared$singletons$GLTFHelpers$BufferView={},Accessor$$module$src$shared$singletons$GLTFHelpers$BufferView=module$src$shared$singletons$GLTFHelpers$Accessor.default;module$src$shared$singletons$GLTFHelpers$BufferView.default=function(e,t,n){var r=this;for(var o in this.id=e,this.buffer=n,this.bufferViewRef=t.bufferViews[e],this.byteOffset=this.bufferViewRef.byteOffset,this.byteLength=this.bufferViewRef.byteLength,this.byteStride=this.bufferViewRef.byteStride||0,this.target=this.bufferViewRef.target,this.isInterleaved=!1,this.interleavedBuffer=null,0<(n=t.accessors?t.accessors.filter((function(e){return e.bufferView==r.id})):[]).length&&(this.isInterleaved=n[0].count*this.byteStride===this.byteLength),this.numOfTypeArrayElementsPerVertex=0,this.accessors=[],this.dataView=new DataView(this.buffer.buffer,this.byteOffset,this.byteLength),this.strideOffset=0,t.accessors)t.accessors[o].bufferView==e&&(n=new module$src$shared$singletons$GLTFHelpers$Accessor.default(o,t,this.buffer,this),this.numOfTypeArrayElementsPerVertex+=n.elementComponentsSize,this.accessors.push(n))};var module$src$shared$singletons$GLTFHelpers$Buffer={},BufferView$$module$src$shared$singletons$GLTFHelpers$Buffer=module$src$shared$singletons$GLTFHelpers$BufferView.default,DATA_URI_REGEX$$module$src$shared$singletons$GLTFHelpers$Buffer=/^data:(.*?)(;base64)?,(.*)$/;module$src$shared$singletons$GLTFHelpers$Buffer.default=function(e,t){var n=this;this.id=e,this.bufferRef=t.buffers[e],this.buffer=null,this.byteLength=this.bufferRef.byteLength,this.bufferViews=[],this.onLoad=new Promise((function(e,r){if(DATA_URI_REGEX$$module$src$shared$singletons$GLTFHelpers$Buffer.test(n.bufferRef.uri)){var o=DATA_URI_REGEX$$module$src$shared$singletons$GLTFHelpers$Buffer.exec(n.bufferRef.uri);n.buffer=n._decodeDataUri(o,"arraybuffer"),n._createBufferViews(t),e(n)}else if(t.isGlb){o=new ArrayBuffer(t.dataView.byteLength);for(var a=new Uint8Array(o),i=0;i<t.dataView.byteLength;i++)a[i]=t.dataView.getUint8(i);n.buffer=o,n._createBufferViews(t),e(n)}else n._loadArrayBuffer(t.baseUrl+"/"+n.bufferRef.uri,(function(r){n.buffer=r,n._createBufferViews(t),e(n)}),(function(e){return r(e)}))}))},module$src$shared$singletons$GLTFHelpers$Buffer.default.prototype._decodeDataUri=function(e,t){var n=e[1],r=!!e[2];switch(e=e[3],t=void 0!==t?t:""){case"":case"text":return this._decodeDataUriText(r,e);case"arraybuffer":return this._decodeDataUriArrayBuffer(r,e);case"blob":return t=this._decodeDataUriArrayBuffer(r,e),new Blob([t],{type:n});case"document":return(new DOMParser).parseFromString(this._decodeDataUriText(r,e),n);case"json":return JSON.parse(this._decodeDataUriText(r,e));default:throw"Unhandled responseType: "+t}},module$src$shared$singletons$GLTFHelpers$Buffer.default.prototype._decodeDataUriText=function(e,t){return t=decodeURIComponent(t),e?atob(t):t},module$src$shared$singletons$GLTFHelpers$Buffer.default.prototype._decodeDataUriArrayBuffer=function(e,t){e=this._decodeDataUriText(e,t),t=new ArrayBuffer(e.length);for(var n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t},module$src$shared$singletons$GLTFHelpers$Buffer.default.prototype._createBufferViews=function(e){for(var t in e.bufferViews)e.bufferViews[t].buffer==this.id&&this.bufferViews.push(new module$src$shared$singletons$GLTFHelpers$BufferView.default(t,e,this))},module$src$shared$singletons$GLTFHelpers$Buffer.default.prototype._binaryAgent3=function(e){return e.split(" ").map((function(e){return String.fromCharCode(parseInt(e,2)).join("")}))},module$src$shared$singletons$GLTFHelpers$Buffer.default.prototype._loadArrayBuffer=function(e,t,n){this._loadWithXhr(e,"arraybuffer",t,n)},module$src$shared$singletons$GLTFHelpers$Buffer.default.prototype._loadWithXhr=function(e,t,n,r){var o=DATA_URI_REGEX$$module$src$shared$singletons$GLTFHelpers$Buffer.exec(e);if(null!==o)n(this._decodeDataUri(o,t));else{var a=new XMLHttpRequest;a.open("GET",e,!0),void 0!==t&&(a.responseType=t),a.onload=function(e){200===a.status?n(a.response):r(e)},a.onerror=function(e){r(e)},a.send()}};var module$src$shared$singletons$GLTFHelpers$Texture={},TextureLoader$$module$src$shared$singletons$GLTFHelpers$Texture=module$src$shared$singletons$TextureLoader.default,DATA_URI_REGEX$$module$src$shared$singletons$GLTFHelpers$Texture=/^data:(.*?)(;base64)?,(.*)$/;module$src$shared$singletons$GLTFHelpers$Texture.default=function(e,t){var n=this;this.id=e,this.textureRef=t.textures[this.id],this.imageRef=t.images[this.textureRef.source],this.texture=null,this.onLoad=new Promise((function(e,r){var o=DATA_URI_REGEX$$module$src$shared$singletons$GLTFHelpers$Texture.test(n.imageRef.uri)?n.imageRef.uri:t.baseUrl+"/"+n.imageRef.uri;module$src$shared$singletons$TextureLoader.default.loadTexture(o).then((function(t){t.flipY=!1,n.texture=t,e(n)}),(function(e){return r(e)}))}))},module$src$shared$singletons$GLTFHelpers$Texture.default.prototype.toJSONTexture=function(){return{href:this.href}};var module$src$shared$singletons$GLTFLoader={},AXIOS$$module$src$shared$singletons$GLTFLoader=module$src$externals$axios.default,THREE$$module$src$shared$singletons$GLTFLoader=module$src$externals$three.default,SceneHierarchy$$module$src$shared$singletons$GLTFLoader=module$src$shared$singletons$GLTFHelpers$SceneHierarchy.default,Buffer$$module$src$shared$singletons$GLTFLoader=module$src$shared$singletons$GLTFHelpers$Buffer.default,Texture$$module$src$shared$singletons$GLTFLoader=module$src$shared$singletons$GLTFHelpers$Texture.default,MaterialPropertiesStandard$$module$src$shared$singletons$GLTFLoader=module$src$shared$materials$MaterialPropertiesStandard.default,SUPPORTED_EXTENSIONS$$module$src$shared$singletons$GLTFLoader=[],GLTFLoader$$module$src$shared$singletons$GLTFLoader=function(){};GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype.log=function(){},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype.warn=function(e){console.warn(e)},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype.error=function(){},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype.loadGeometry=function(e,t){var n=this,r=e.split(".").reverse()[0];if("glb"!=r&&"gltf"!=r)throw Error("Unexpected format "+r);var o="glb"===r;return(0,module$src$externals$axios.default)({method:"GET",url:e,timeout:3e4,responseType:o?"arraybuffer":"json"}).catch((function(e){var t="Error setting up the gltf download AJAX request.";return e.response?t="Loading gltf failed with status "+e.response.status+".":e.request&&(t="No response to gltf download AJAX request."),Promise.reject(Error(t))})).then((function(r){var a=r.data;if(o){a=new DataView(r.data);for(var i="",s=0;4>s;++s)i+=String.fromCharCode(a.getUint8(s));if("glTF"!=i)throw Error("ShapeDiverGLtfLoader got invalid data: glTF magic wrong.");i=a.getUint32(12,!0),s="";for(var l=0;l<i;++l)s+=String.fromCharCode(a.getUint8(20+l));(a=JSON.parse(s)).glTFBinaryDataByteOffset=28+i,a.dataView=new DataView(r.data,a.glTFBinaryDataByteOffset),a.isGlb=o}return a.baseUrl=n._removeLastDirectoryPartOf(e),n._processGltf(a,t)}))},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype._processGltf=function(e,t){var n=this;e.extensionsUsed&&e.extensionsUsed.forEach((function(e){SUPPORTED_EXTENSIONS$$module$src$shared$singletons$GLTFLoader.some((function(t){return t===e}))||n.warn("Extension "+e+" not supported.")}));var r,o=new module$src$shared$singletons$GLTFHelpers$SceneHierarchy.default(e),a=[],i=[];for(r in e.buffers)a.push(new module$src$shared$singletons$GLTFHelpers$Buffer.default(r,e));for(var s in e.textures)i.push(new module$src$shared$singletons$GLTFHelpers$Texture.default(s,e));return new Promise((function(r,s){Promise.all(a.concat(i).map((function(e){return e.onLoad}))).then((function(){var s=[];a.forEach((function(e){e.bufferViews.forEach((function(e){e.accessors.forEach((function(e){s.push(e)}))}))}));var l=[];o.allNodes.forEach((function(r){t&&Array.isArray(t)&&0!==t.length||(t=[new module$src$externals$three.default.Matrix4]);for(var o={transformIndex:0};o.transformIndex<t.length;(o={transformIndex:o.transformIndex,geometry:o.geometry}).transformIndex++)if(r.mesh)if(o.geometry=n._createGeometry(e,r,s),r.mesh&&0===r.materials.length){var a={path:"transformation_"+o.transformIndex+"."+r.name+"."+r.mesh.name,geometry:o.geometry,initialMatrix:r.matrix.multiply(t[o.transformIndex]),type:"mesh"};l.push(a)}else r.mesh&&n._createMaterials(r,i).forEach(function(e){return function(n){n={path:"transformation_"+e.transformIndex+"."+r.name+"."+r.mesh.name,geometry:e.geometry,material:n,initialMatrix:r.matrix.multiply(t[e.transformIndex]),type:"mesh"},l.push(n)}}(o))})),r(l)})).catch((function(e){return s(e)}))}))},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype._createGeometry=function(e,t,n){var r={POSITION:"position",JOINTS_0:"joint",WEIGHTS_0:"weight",NORMAL:"normal",TEXCOORD_0:"uv",COLOR_0:"color",TANGENT:"tangent"},o={POSITION:!1,NORMAL:!1,TEXCOORD_0:!1,COLOR_0:!0,TANGENT:!1,JOINTS_0:!1,WEIGHTS_0:!1},a=new module$src$externals$three.default.BufferGeometry;return e=new module$src$externals$three.default.Box3,a.boundingSphere=e.getBoundingSphere(),a.boundingSphere.realCenter=a.boundingSphere.center.clone(),t.mesh.primitives.forEach((function(e){var t=e.attributes||{},i=null;e.hasOwnProperty("indices")&&(i=e.indices),e=null;var s={};for(c in t){s.key=c;var l=n.find(function(e){return function(n){return n.id==t[e.key]}}(s));if(l){var u=l.bufferView;u.isInterleaved?(null==e&&(e=new module$src$externals$three.default.InterleavedBuffer(u.interleavedBuffer,u.numOfTypeArrayElementsPerVertex)),a.addAttribute(r[s.key],new module$src$externals$three.default.InterleavedBufferAttribute(e,l.elementComponentsSize,l.offsetForInterleaved))):a.addAttribute(r[s.key],new module$src$externals$three.default.BufferAttribute(l.bufferArray,l.elementComponentsSize,o[s.key]))}s={key:s.key}}if(null!=i){var c=n.find((function(e){return e.id==i}));a.setIndex(c.array)}})),a},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype._createDefaultMaterialForGLtfDef=function(){var e=new module$src$shared$materials$MaterialPropertiesStandard.default;return e.side=module$src$externals$three.default.DoubleSide,e.metalness=1,e.roughness=1,e},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype._createMaterials=function(e,t){var n=this,r=[],o={OPAQUE:module$src$externals$three.default.NormalBlending,BLEND:module$src$externals$three.default.AdditiveBlending,MASK:module$src$externals$three.default.MultiplyBlending};return e.materials.forEach((function(e){var a=n._createDefaultMaterialForGLtfDef(),i=e.pbrMetallicRoughness;i.doubleSided||e.doubleSided?a.side=module$src$externals$three.default.DoubleSide:!1!==i.doubleSided&&!1!==e.doubleSided||(a.side=module$src$externals$three.default.FrontSide),i.hasOwnProperty("baseColorFactor")&&(a.color=new(Function.prototype.bind.apply(module$src$externals$three.default.Color,[null].concat($jscomp.arrayFromIterable(i.baseColorFactor))))),i.hasOwnProperty("baseColorTexture")&&(a.map=t[i.baseColorTexture.index].texture),i.hasOwnProperty("metallicFactor")&&(a.metalness=i.metallicFactor),i.hasOwnProperty("roughnessFactor")&&(a.roughness=i.roughnessFactor),i.hasOwnProperty("metallicRoughnessTexture")&&(a.metalnessMap=t[i.metallicRoughnessTexture.index].texture,a.roughnessMap=t[i.metallicRoughnessTexture.index].texture),e.hasOwnProperty("normalTexture")&&(a.normalMap=t[e.normalTexture.index].texture),e.hasOwnProperty("alphaMode")?(a.blending=o[e.alphaMode],a.blending==module$src$externals$three.default.MultiplyBlending&&(a.alphaTest=.5)):a.blending=module$src$externals$three.default.NoBlending,e.hasOwnProperty("alphaCutoff")&&(a.alphaTest=e.alphaCutoff),r.push(a)})),r},GLTFLoader$$module$src$shared$singletons$GLTFLoader.prototype._removeLastDirectoryPartOf=function(e){return(e=e.split("/")).pop(),e.join("/")},module$src$shared$singletons$GLTFLoader.default=new GLTFLoader$$module$src$shared$singletons$GLTFLoader;var module$src$3d$loaders$MTLLoader={default:{}},THREE$$module$src$3d$loaders$MTLLoader=module$src$externals$three.default;module$src$externals$three.default.MTLLoader=function(e){this.manager=void 0!==e?e:module$src$externals$three.default.DefaultLoadingManager},module$src$externals$three.default.MTLLoader.prototype={constructor:module$src$externals$three.default.MTLLoader,load:function(e,t,n,r){var o=this,a=new module$src$externals$three.default.FileLoader(this.manager);a.setPath(this.path),a.load(e,(function(e){t(o.parse(e))}),n,r)},setPath:function(e){return this.path=e,this},setTexturePath:function(e){return this.texturePath=e,this},setBaseUrl:function(e){return console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e){var t=e.split("\n"),n={},r=/\s+/;e={};for(var o=0;o<t.length;o++){var a=t[o];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var i=a.indexOf(" "),s=0<=i?a.substring(0,i):a;s=s.toLowerCase(),a=(a=0<=i?a.substring(i+1):"").trim(),"newmtl"===s?e[a]=n={name:a}:n&&("ka"===s||"kd"===s||"ks"===s?(a=a.split(r,3),n[s]=[parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2])]):n[s]=a)}}return(t=new module$src$externals$three.default.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions)).setCrossOrigin(this.crossOrigin),t.setManager(this.manager),t.setMaterials(e),t}},module$src$externals$three.default.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:module$src$externals$three.default.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:module$src$externals$three.default.RepeatWrapping},module$src$externals$three.default.MTLLoader.MaterialCreator.prototype={constructor:module$src$externals$three.default.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t,n={};for(t in e){var r=e[t],o={};for(var a in n[t]=o,r){var i=!0,s=r[a],l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(i=!1)}i&&(o[l]=s)}}return n},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e,t=0;for(e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){function t(e,t){if(!a[e]){t=r.getTextureParams(t,a);var n=r.loadTexture(function(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}(r.baseUrl,t.url));n.repeat.copy(t.scale),n.offset.copy(t.offset),n.wrapS=r.wrap,n.wrapT=r.wrap,a[e]=n}}var n,r=this,o=this.materialsInfo[e],a={name:e,side:this.side};for(n in o){var i=o[n];if(""!==i)switch(n.toLowerCase()){case"kd":a.color=(new module$src$externals$three.default.Color).fromArray(i);break;case"ks":a.specular=(new module$src$externals$three.default.Color).fromArray(i);break;case"map_kd":t("map",i);break;case"map_ks":t("specularMap",i);break;case"norm":t("normalMap",i);break;case"map_bump":case"bump":t("bumpMap",i);break;case"ns":a.shininess=parseFloat(i);break;case"d":1>(i=parseFloat(i))&&(a.opacity=i,a.transparent=!0);break;case"tr":i=parseFloat(i),this.options&&this.options.invertTrProperty&&(i=1-i),0<i&&(a.opacity=1-i,a.transparent=!0)}}return this.materials[e]=new module$src$externals$three.default.MeshPhongMaterial(a),this.materials[e]},getTextureParams:function(e,t){var n={scale:new module$src$externals$three.default.Vector2(1,1),offset:new module$src$externals$three.default.Vector2(0,0)},r=(e=e.split(/\s+/)).indexOf("-bm");return 0<=r&&(t.bumpScale=parseFloat(e[r+1]),e.splice(r,2)),0<=(r=e.indexOf("-s"))&&(n.scale.set(parseFloat(e[r+1]),parseFloat(e[r+2])),e.splice(r,4)),0<=(r=e.indexOf("-o"))&&(n.offset.set(parseFloat(e[r+1]),parseFloat(e[r+2])),e.splice(r,4)),n.url=e.join(" ").trim(),n},loadTexture:function(e,t,n,r,o){var a=module$src$externals$three.default.Loader.Handlers.get(e);return null===a&&(a=new module$src$externals$three.default.TextureLoader(void 0!==this.manager?this.manager:module$src$externals$three.default.DefaultLoadingManager)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin),e=a.load(e,n,r,o),void 0!==t&&(e.mapping=t),e}};var module$src$3d$loaders$OBJLoader={default:{}},THREE$$module$src$3d$loaders$OBJLoader=module$src$externals$three.default;module$src$externals$three.default.OBJLoader=function(){function e(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)this.object.name=e,this.object.fromDeclaration=!1!==t;else{var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);return n&&(n.inherited||0>=n.groupCount)&&this.materials.splice(n.index,1),e={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&0<t.length?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){return(e={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1}).clone=this.clone.bind(e),e}},this.materials.push(e),e},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&1<this.materials.length)for(var n=this.materials.length-1;0<=n;n--)0>=this.materials[n].groupCount&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone&&((e=n.clone(0)).inherited=!0,this.object.materials.push(e)),this.objects.push(this.object)}},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){return 3*(0<=(e=parseInt(e,10))?e-1:e+t/3)},parseNormalIndex:function(e,t){return 3*(0<=(e=parseInt(e,10))?e-1:e+t/3)},parseUVIndex:function(e,t){return 2*(0<=(e=parseInt(e,10))?e-1:e+t/2)},addVertex:function(e,t,n){var r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addColor:function(e,t,n){var r=this.colors,o=this.object.geometry.colors;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){var r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[t+0],r[t+1]),o.push(r[n+0],r[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,o,a,i,s,l){var u=this.vertices.length;e=this.parseVertexIndex(e,u),t=this.parseVertexIndex(t,u),n=this.parseVertexIndex(n,u),this.addVertex(e,t,n),void 0!==r&&""!==r&&(e=this.parseUVIndex(r,n=this.uvs.length),t=this.parseUVIndex(o,n),n=this.parseUVIndex(a,n),this.addUV(e,t,n)),void 0!==i&&""!==i&&(e=this.parseNormalIndex(i,r=this.normals.length),t=i===s?e:this.parseNormalIndex(s,r),n=i===l?e:this.parseNormalIndex(l,r),this.addNormal(e,t,n)),0<this.colors.length&&this.addColor(e,t,n)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,r=this.uvs.length,o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));for(e=0,a=t.length;e<a;e++)this.addUVLine(this.parseUVIndex(t[e],r))}};return e.startObject("",!1),e}function t(e){this.manager=void 0!==e?e:module$src$externals$three.default.DefaultLoadingManager,this.materials=null}var n=/^[og]\s*(.+)?/,r=/^mtllib /,o=/^usemtl /;return t.prototype={constructor:t,load:function(e,t,n,r){var o=this,a=new module$src$externals$three.default.FileLoader(o.manager);a.setPath(this.path),a.load(e,(function(e){t(o.parse(e))}),n,r)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(t){console.time("OBJLoader");var a=new e;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));var i,s=t.split("\n"),l="function"==typeof"".trimLeft;t=0;for(var u=s.length;t<u;t++){var c=s[t],d=(c=l?c.trimLeft():c.trim()).length;if(0!==d&&"#"!==(d=c.charAt(0)))if("v"===d)switch(c=c.split(/\s+/),c[0]){case"v":a.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),8===c.length&&a.colors.push(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6]));break;case"vn":a.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":a.uvs.push(parseFloat(c[1]),parseFloat(c[2]))}else if("f"===d){var p=(c=c.substr(1).trim()).split(/\s+/);for(c=[],d=0,i=p.length;d<i;d++){var h=p[d];0<h.length&&(h=h.split("/"),c.push(h))}for(p=c[0],d=1,i=c.length-1;d<i;d++){var m=c[d+1];a.addFace(p[0],(h=c[d])[0],m[0],p[1],h[1],m[1],p[2],h[2],m[2])}}else if("l"===d){if(d=c.substring(1).trim().split(" "),i=[],p=[],-1===c.indexOf("/"))i=d;else for(c=0,h=d.length;c<h;c++)""!==(m=d[c].split("/"))[0]&&i.push(m[0]),""!==m[1]&&p.push(m[1]);a.addLineGeometry(i,p)}else if("p"===d)c=(c=c.substr(1).trim()).split(" "),a.addPointGeometry(c);else if(null!==(i=n.exec(c)))c=(" "+i[0].substr(1).trim()).substr(1),a.startObject(c);else if(o.test(c))a.object.startMaterial(c.substring(7).trim(),a.materialLibraries);else if(r.test(c))a.materialLibraries.push(c.substring(7).trim());else if("s"===d)1<(i=c.split(" ")).length?(c=i[1].trim().toLowerCase(),a.object.smooth="0"!==c&&"off"!==c):a.object.smooth=!0,(c=a.object.currentMaterial())&&(c.smooth=a.object.smooth);else if("\0"!==c)throw Error('THREE.OBJLoader: Unexpected line: "'+c+'"')}for(a.finalize(),(s=new module$src$externals$three.default.Group).materialLibraries=[].concat(a.materialLibraries),t=0,u=a.objects.length;t<u;t++)if(d=(l=a.objects[t]).materials,i="Line"===(c=l.geometry).type,p="Points"===c.type,h=!1,0!==c.vertices.length){(m=new module$src$externals$three.default.BufferGeometry).addAttribute("position",new module$src$externals$three.default.Float32BufferAttribute(c.vertices,3)),0<c.normals.length?m.addAttribute("normal",new module$src$externals$three.default.Float32BufferAttribute(c.normals,3)):m.computeVertexNormals(),0<c.colors.length&&(h=!0,m.addAttribute("color",new module$src$externals$three.default.Float32BufferAttribute(c.colors,3))),0<c.uvs.length&&m.addAttribute("uv",new module$src$externals$three.default.Float32BufferAttribute(c.uvs,2));for(var f=[],g=0,$=d.length;g<$;g++){var v=d[g];if(c=void 0,null!==this.materials)if(c=this.materials.create(v.name),!i||!c||c instanceof module$src$externals$three.default.LineBasicMaterial){if(p&&c&&!(c instanceof module$src$externals$three.default.PointsMaterial)){var y=new module$src$externals$three.default.PointsMaterial({size:10,sizeAttenuation:!1});_.copy(c),c=y}}else{var _=new module$src$externals$three.default.LineBasicMaterial;_.copy(c),_.lights=!1,c=_}c||((c=i?new module$src$externals$three.default.LineBasicMaterial:p?new module$src$externals$three.default.PointsMaterial({size:1,sizeAttenuation:!1}):new module$src$externals$three.default.MeshPhongMaterial).name=v.name),!1===c.flatShading&&(c.flatShading=!v.smooth),c.vertexColors=h?module$src$externals$three.default.VertexColors:module$src$externals$three.default.NoColors,f.push(c)}if(1<f.length){for(g=0,$=d.length;g<$;g++)m.addGroup((v=d[g]).groupStart,v.groupCount,g);c=i?new module$src$externals$three.default.LineSegments(m,f):p?new module$src$externals$three.default.Points(m,f):new module$src$externals$three.default.Mesh(m,f)}else c=i?new module$src$externals$three.default.LineSegments(m,f[0]):p?new module$src$externals$three.default.Points(m,f[0]):new module$src$externals$three.default.Mesh(m,f[0]);c.name=l.name,s.add(c)}return console.timeEnd("OBJLoader"),s}},t}();var module$src$3d$loaders$DDSLoader={default:{}},THREE$$module$src$3d$loaders$DDSLoader=module$src$externals$three.default;module$src$externals$three.default.DDSLoader=function(e){module$src$externals$three.default.CompressedTextureLoader.call(this,e),this._parser=module$src$externals$three.default.DDSLoader.parse},module$src$externals$three.default.DDSLoader.prototype=Object.create(module$src$externals$three.default.CompressedTextureLoader.prototype),module$src$externals$three.default.DDSLoader.prototype.constructor=module$src$externals$three.default.DDSLoader,module$src$externals$three.default.DDSLoader.parse=function(e,t){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e,t,n,r){var o=n*r*4;e=new Uint8Array(e,t,o),o=new Uint8Array(o);for(var a=t=0,i=0;i<r;i++)for(var s=0;s<n;s++){var l=e[a],u=e[++a],c=e[++a],d=e[++a];a++,o[t]=c,o[++t]=u,o[++t]=l,o[++t]=d,t++}return o}var o={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},a=n("DXT1"),i=n("DXT3"),s=n("DXT5"),l=n("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),o;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),o;var c=u[21],d=!1;switch(c){case a:a=8,o.format=module$src$externals$three.default.RGB_S3TC_DXT1_Format;break;case i:a=16,o.format=module$src$externals$three.default.RGBA_S3TC_DXT3_Format;break;case s:a=16,o.format=module$src$externals$three.default.RGBA_S3TC_DXT5_Format;break;case l:a=8,o.format=module$src$externals$three.default.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",String.fromCharCode(255&c,c>>8&255,c>>16&255,c>>24&255)),o;d=!0,a=64,o.format=module$src$externals$three.default.RGBAFormat}if(o.mipmapCount=1,131072&u[2]&&!1!==t&&(o.mipmapCount=Math.max(1,u[7])),o.isCubemap=!!(512&(t=u[28])),o.isCubemap&&!(1024&t&&2048&t&&4096&t&&8192&t&&16384&t&&32768&t))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),o;for(o.width=u[4],o.height=u[3],u=u[1]+4,t=o.isCubemap?6:1,i=0;i<t;i++)for(s=o.width,l=o.height,c=0;c<o.mipmapCount;c++){if(d)var p=r(e,u,s,l),h=p.length;else h=Math.max(4,s)/4*Math.max(4,l)/4*a,p=new Uint8Array(e,u,h);o.mipmaps.push({data:p,width:s,height:l}),u+=h,s=Math.max(s>>1,1),l=Math.max(l>>1,1)}return o};var module$src$shared$singletons$OBJLoader={},THREE$$module$src$shared$singletons$OBJLoader=module$src$externals$three.default,MaterialPropertiesStandard$$module$src$shared$singletons$OBJLoader=module$src$shared$materials$MaterialPropertiesStandard.default,OBJLoader$$module$src$shared$singletons$OBJLoader=function(){this.log=function(){},this.warn=function(){},this.error=function(){},module$src$externals$three.default.Loader.Handlers.add(/\.dds$/i,new module$src$externals$three.default.DDSLoader),this.loadGeometry=function(e,t,n,r,o,a){var i=function(t){return new Promise((function(r,o){var i=new module$src$externals$three.default.OBJLoader;null!=t&&i.setMaterials(t),null!=n&&i.setPath(n),i.load(e,(function(e){Array.isArray(a)&&0!=a.length&&a.every((function(e){return e&&e.isMatrix4}))||(a=[new module$src$externals$three.default.Matrix4]);var n=[];e.traverse((function(e){if(null!=e.geometry){var r=!1;e.geometry instanceof module$src$externals$three.default.BufferGeometry?e.geometry.hasOwnProperty("attributes")&&e.geometry.attributes.hasOwnProperty("uv")&&(r=!0):e.geometry instanceof module$src$externals$three.default.Geometry&&0<e.geometry.faceVertexUvs.length&&(r=!0);var o=null;if(null!=t&&e.hasOwnProperty("material")){if((o=new module$src$shared$materials$MaterialPropertiesStandard.default).side=e.material.side,o.color=e.material.color,o.opacity=e.material.opacity,o.transparent=e.material.transparent,e.material.hasOwnProperty("shininess")&&(o.metalness=Math.min(1,e.material.shininess),o.roughness=1-Math.min(1,e.material.shininess)),null!=e.material.map){var i=e.material.map.clone();i.needsUpdate=!0,o.map=i}["alpha","normal","bump"].forEach((function(t){if(null!=e.material[t+"Map"]){var n=e.material[t+"Map"].clone();n.needsUpdate=!0,o[t+"Map"]=n}}))}i=0;for(var s=$jscomp.makeIterator(a),l=s.next();!l.done;l=s.next())l={path:"transformation_"+i,geometry:e.geometry,texCoord:r,initialMatrix:l.value,type:"mesh"},null!=o&&(l.material=o),n.push(l),++i}})),r(n)}),(function(){}),(function(e){o(e)}))}))};return null!=t&&0<t.length?function(){var e=new module$src$externals$three.default.LoadingManager,a=new module$src$externals$three.default.MTLLoader(e);a.setCrossOrigin(!0),null!=n&&a.setPath(n),null!=r&&a.setTexturePath(r);var s=module$src$externals$three.default.DoubleSide;"front"===o?s=module$src$externals$three.default.FrontSide:"back"===o&&(s=module$src$externals$three.default.BackSide);var l={};return l.wrap=module$src$externals$three.default.ClampToEdgeWrapping,l.side=s,a.setMaterialOptions(l),new Promise((function(){var n=null;e.onLoad=function(){return n.hasOwnProperty("materialsInfo")&&0<Object.keys(n.materialsInfo).length?i(n):i()},a.load(t,(function(e){e.preload(),n=e}),(function(){}),(function(){i()}))}))}:i()}};module$src$shared$singletons$OBJLoader.default=new OBJLoader$$module$src$shared$singletons$OBJLoader;var module$src$shared$singletons$THREELoader={},THREE$$module$src$shared$singletons$THREELoader=module$src$externals$three.default,THREELoader$$module$src$shared$singletons$THREELoader=function(){this.loadGeometry=function(e,t){var n=[];if(e.isMesh)var r="mesh";else if(e.isLineLoop)r="lineloop";else if(e.isLineSegments)r="linesegments";else if(e.isLine)r="line";else{if(!e.isPoints)return Promise.reject(Error("Unsupported type of THREE.Object3D"));r="points"}Array.isArray(t)&&0!=t.length&&t.every((function(e){return e&&e.isMatrix4}))||(t=[new module$src$externals$three.default.Matrix4]);var o=e.geometry;"Geometry"===e.geometry.type&&(o=(new module$src$externals$three.default.Geometry).copy(e.geometry)),"BufferGeometry"===e.geometry.type&&(o=(new module$src$externals$three.default.BufferGeometry).copy(e.geometry)),e=0;for(var a=(t=$jscomp.makeIterator(t)).next();!a.done;a=t.next())n.push({path:"transformation_"+e,geometry:o,texCoord:!1,initialMatrix:a.value,type:r}),++e;return Promise.resolve(n)}};module$src$shared$singletons$THREELoader.default=new THREELoader$$module$src$shared$singletons$THREELoader;var module$src$shared$singletons$Tag3DLoader={default:{}},THREE$$module$src$shared$singletons$Tag3DLoader=module$src$externals$three.default,toTinyColor$$module$src$shared$singletons$Tag3DLoader=module$src$shared$util$toTinyColor.default,_font3d$$module$src$shared$singletons$Tag3DLoader=null;module$src$shared$singletons$Tag3DLoader.default.load3DTags=function(e){return new Promise((function(e){null==_font3d$$module$src$shared$singletons$Tag3DLoader?(new module$src$externals$three.default.FontLoader).load("https://viewer.shapediver.com/graphik_regular.typeface.json",(function(t){_font3d$$module$src$shared$singletons$Tag3DLoader=t,e()}).bind(this)):e()})).then((function(){var t,n=[],r={};for(t in e){var o=e[t];(o=o||{}).size=o.size||1,o.text=o.text||"";for(var a={size:o.size,height:o.size/10,font:_font3d$$module$src$shared$singletons$Tag3DLoader},i=o.text.split(/\r\n|\r|\n/g),s="tag3d_"+t,l=[],u=0;u<i.length;++u){var c=s+".line_"+u;c={path:c,geometry:new module$src$externals$three.default.TextBufferGeometry(i[u],a),texCoord:!1,type:"mesh"},"default"!=o.color&&(c.color=(0,module$src$shared$util$toTinyColor.default)(o.color)),l.push(c)}for(a=new module$src$externals$three.default.Object3D,i=(s=$jscomp.makeIterator(l)).next();!i.done;i=s.next())a.add(new module$src$externals$three.default.Mesh(i.value.geometry,new module$src$externals$three.default.MeshPhongMaterial));for(s=i=s=void 0,r.lineHeight=void 0,r.lineHeight=0,s=(i=$jscomp.makeIterator(a.children)).next();!s.done;s=i.next())s=s.value,s=(s=(new module$src$externals$three.default.Box3).setFromObject(s)).max.y-s.min.y,r.lineHeight=Math.max(r.lineHeight,s);switch(r.lineHeight*=1.15,l.forEach(function(e){return function(t,n){t.geometry.translate(0,(-n-1)*e.lineHeight,0)}}(r)),i=(s=(new module$src$externals$three.default.Box3).setFromObject(a)).max.x-s.min.x,s=s.max.y-s.min.y,a=new module$src$externals$three.default.Vector3(0,0,0),o.justification){case"TC":a.x=.5*-i;break;case"TR":a.x=-i;break;case"ML":a.y=.5*s;break;case"MC":a.x=.5*-i,a.y=.5*s;break;case"MR":a.x=-i,a.y=.5*s;break;case"BL":a.y=s;break;case"BC":a.x=.5*-i,a.y=s;break;case"BR":a.x=-i,a.y=s}for(i=(s=$jscomp.makeIterator(l)).next();!i.done;i=s.next())i.value.geometry.translate(a.x,a.y,a.z);if(o.location.hasOwnProperty("xAxis"))for((a=new module$src$externals$three.default.Matrix4).set(o.location.xAxis.X,o.location.yAxis.X,o.location.normal.X,0,o.location.xAxis.Y,o.location.yAxis.Y,o.location.normal.Y,0,o.location.xAxis.Z,o.location.yAxis.Z,o.location.normal.Z,0,0,0,0,1),i=(s=$jscomp.makeIterator(l)).next();!i.done;i=s.next())(i=i.value).geometry.applyMatrix(a),i.geometry.translate(o.location.origin.X,o.location.origin.Y,o.location.origin.Z);Array.prototype.push.apply(n,l),r={lineHeight:r.lineHeight}}return n}))};var module$src$app$partials$ViewerAppSceneManager={},THREE$$module$src$app$partials$ViewerAppSceneManager=module$src$externals$three.default,toTinyColor$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$util$toTinyColor.default,messagingConstants$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$constants$MessagingConstants.default,MessagePrototype$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$messages$MessagePrototype.default,SubScene$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$scene$OutputVersion.default,GlobalUtils$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$util$GlobalUtils.default,GLBLoader$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$singletons$GLBLoader.default,GLTFLoader$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$singletons$GLTFLoader.default,OBJLoader$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$singletons$OBJLoader.default,THREELoader$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$singletons$THREELoader.default,Tag3DLoader$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$singletons$Tag3DLoader.default,MaterialParser$$module$src$app$partials$ViewerAppSceneManager=module$src$shared$materials$MaterialParser.default;module$src$app$partials$ViewerAppSceneManager.default=function(e){var t=this,n=e.sceneGeometryManager,r={},o={},a={},i=["canvas","threeObject","transformations"],s={},l={},u={},c={},d=Promise.resolve(),p={},h={},m={},f=["interactionGroup","interactionMode","duration","dragPlaneNormal","visible"],g={authorization:t.getSettingShallow("authorization")};t.registerHook("authorization",(function(e){g.authorization=e}));var $=function(e,t,n){return(t=Error(t)).scope=e,t.data=n,Promise.reject(t)},v=function(e,t){var n,r=e.id,o=u[r],l=o.creatorId,c=t.id,d=!1;if(a[l]&&a[l][c]&&(c=a[l][c]).ov)for(n in d=!0,c=c.ov)"_json"===n?(t._json_scene=module$src$shared$util$GlobalUtils.default.deepCopy(t[n],i),module$src$shared$util$GlobalUtils.default.defaults(t._json_scene,c._json,!0)):"_json_scene"!==n&&(t[n]=c[n]);return d||delete t._json_scene,s[l][r].subScene.addOutputVersion(t)?(++o.finishedOutputVersions,o.finishedOutputVersions<o.totalOutputVersions?Promise.resolve(!0):_(e)):$("SceneManager._addOutputVersion","could not add output version to subscene",void 0)},y=function(e,a,i,s){var l=function(e,t){return $("SceneManager._publishSubScene",e,t)},u=i.id,h=("boolean"==typeof(s=s||{}).forceUpdate||"string"==typeof s.forceUpdate)&&s.forceUpdate;if(!t.hasSetting("defaultMaterial"))return l("no default material configured");var v=m[a+"."+u],y=p[a];return y&&y.serial>v?Promise.resolve(!1):d=y=d.then((function(){var d=null;return new module$src$shared$materials$MaterialParser.default(g).fromJSONMaterialObject(t.getSetting("defaultMaterial")).then((function(e){d=e}),(function(e){return l("could not create default material",e)})).then((function(){for(var m=e.outputIds,g=o.hasOwnProperty(a)?o[a]._subSceneObject:null,$=null!==g?g.outputIds:[],y=$jscomp.makeIterator($),_=y.next();!_.done;_=y.next())-1===m.indexOf(_=_.value)&&(e.addOutputVersion(g.getOutputVersion(_)),m.push(_));y=[];var b={},x={},w={assets:{add:{},replace:{},remove:{}}};_={};for(var S=m.length-1;-1<S;_={compiledOutputVersion:_.compiledOutputVersion,options:_.options,options$260:_.options$260},--S){var M=m[S],E=e.getOutputVersion(M),T=r.getJSONOutputVersion(M,a,!0);if(E.hasOwnProperty("geometry")){if(_.compiledOutputVersion=e.getCompiledOutputVersion(M,d),!_.compiledOutputVersion||!Array.isArray(_.compiledOutputVersion.geometry))return l("could not compile output version "+M);x[M]={};for(var C={},P=$jscomp.makeIterator(_.compiledOutputVersion.geometry),A=P.next();!A.done;C={g:C.g,o:C.o},A=P.next()){C.g=A.value,C.o=x[M],A=C.g.path.split(".");for(var L=(A=$jscomp.makeIterator(A)).next();!L.done;L=A.next())C.o[L=L.value]=C.o[L]||{},C.o=C.o[L];["type","geometry","material","initialMatrix"].forEach(function(e){return function(t){e.g.hasOwnProperty(t)&&(e.o[t]=e.g[t])}}(C)),C.o._isSDGeometry=!0}if(-1===$.indexOf(M)){if(_.options={},_.compiledOutputVersion.hasOwnProperty("name")&&(_.options.name=_.compiledOutputVersion.name),_.compiledOutputVersion.hasOwnProperty("bbmin")&&_.compiledOutputVersion.hasOwnProperty("bbmax"))try{var R=new module$src$externals$three.default.Box3(module$src$shared$util$GlobalUtils.default.toVector3(_.compiledOutputVersion.bbmin),module$src$shared$util$GlobalUtils.default.toVector3(_.compiledOutputVersion.bbmax));(0<R.min.lengthSq()||0<R.max.lengthSq())&&(_.options.boundingBox=R)}catch(D){t.debug("SceneManager._publishSubScene","invalid bounding box for output version "+M,D)}f.forEach(function(e){return function(t){e.compiledOutputVersion.hasOwnProperty(t)&&(e.options[t]=e.compiledOutputVersion[t])}}(_)),y.push(n.addGeometry(a+"."+M,_.compiledOutputVersion.geometry,_.options,E.version)),w.assets.add[M]=T}else(C=!0===h||h===M)||(C=g.getOutputVersion(M).version!==E.version),!C&&E.materialId&&(P=e.getOutputVersion(E.materialId),(A=g.getOutputVersion(E.materialId))&&P.version===A.version&&E.materialId!==h||(C=!0)),C&&(_.options$260={},f.forEach(function(e){return function(t){e.compiledOutputVersion.hasOwnProperty(t)&&(e.options$260[t]=e.compiledOutputVersion[t])}}(_)),"number"==typeof s.duration&&0<=s.duration&&(_.options$260.duration=s.duration),y.push(n.replaceGeometry(a+"."+M,_.compiledOutputVersion.geometry,_.options$260,E.version)),w.assets.replace[M]=T)}else g&&(C=g.getOutputVersion(M))&&C.geometry&&(y.push(n.removeGeometry(a+"."+M)),w.assets.remove[M]=T);E.hasOwnProperty("data")&&(b[M]=E.data)}return Promise.all(y).then((function(){o[a]=x,o[a]._subSceneObject=e,c[a]=b,p[a]={serial:v,id:u},Object.keys(w.assets.add).forEach((function(e){w.assets.add[e]=r.getJSONOutputVersion(e,a,!0)}));var n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_UPDATE,w,i);return t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_PUBLISHED,n),0<Object.keys(b).length&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.DATA,b,i),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.DATA,n)),w}))}))}))},_=function(e){var r=function(e,t){return $("SceneManager._finishProcess",e,t)},a=e.id,i=u[a],c=i.creatorId;l[c]=l[c]||{},l[c][a]=s[c][a],delete s[c][a],0===Object.keys(s[c]).length&&delete s[c];var d=l[c][a].subScene,p=o[c]?o[c]._subSceneObject:null,h=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{state:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_READY,progress:.75},e);return t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,h),y(d,c,e,i.options).then((function(e){return delete l[c][a],0===Object.keys(l[c]).length&&delete l[c],e}),(function(t){return null!==p?y(p,c,e).then((function(){return r("publishing of subscene failed, restored previous state",t)})):(o.hasOwnProperty(c)&&delete o[c],n.removeGeometry(c).then((function(){return r("publishing of subscene failed, restored previous state",t)})))})).catch((function(e){return r("publishing of subscene failed",e)}))},b=function(e,t){var n=function(e,t){return $("SceneManager._convertOutputVersion",e,t)};if(void 0===t&&(t=!1),e=e||{},!t){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e.version,"string"))return n("version missing");if(!Array.isArray(e.content))return n("content array missing")}var r={id:e.id};["version","name"].concat($jscomp.arrayFromIterable(f)).forEach((function(t){null!=e[t]&&(r[t]=e[t])})),module$src$shared$util$GlobalUtils.default.typeCheck(e.material,"string")&&(r.materialId=e.material),module$src$shared$util$GlobalUtils.default.typeCheck(e.bbmin,"vector3any")&&(r.bbmin=module$src$shared$util$GlobalUtils.default.toVector3(e.bbmin)),module$src$shared$util$GlobalUtils.default.typeCheck(e.bbmax,"vector3any")&&(r.bbmax=module$src$shared$util$GlobalUtils.default.toVector3(e.bbmax));var o=(r.bbmin&&r.bbmax?r.bbmin.distanceTo(r.bbmax):1)/1e4,a=[],s=[];if(t=[],Array.isArray(e.content))for(var l=$jscomp.makeIterator(e.content),u=l.next();!u.done;u=l.next()){if(!module$src$shared$util$GlobalUtils.default.typeCheck((u=u.value).format,"string"))return n("format of content item missing");switch(u.format){case"material":if(!u.data)return n("data of material content item missing");u=module$src$shared$util$GlobalUtils.default.deepCopy(u.data,i),a.push(u);break;case"gltf":case"glb":case"obj":case"tag2d":case"tag3d":case"anchor":case"three":s.push(module$src$shared$util$GlobalUtils.default.deepCopy(u,i));break;default:t.push(module$src$shared$util$GlobalUtils.default.deepCopy(u))}}for(l=[],u=(a=$jscomp.makeIterator(a)).next();!u.done;u=a.next()){u=u.value;var c=new module$src$shared$materials$MaterialParser.default(g);l.push(c.fromJSONMaterialObject(u))}for(a=[],u={},c=(s=$jscomp.makeIterator(s)).next();!c.done;u={gj:u.gj,anchorArray:u.anchorArray},c=s.next()){if(u.gj=c.value,c=[],Array.isArray(u.gj.transformations))for(var d=$jscomp.makeIterator(u.gj.transformations),p=d.next();!p.done;p=d.next())if((p=p.value).isMatrix4)c.push(p.clone());else{var h=new module$src$externals$three.default.Matrix4;h.fromArray(p),c.push(h)}u.gj.hasOwnProperty("href")&&"gltf"===u.gj.format?a.push(module$src$shared$singletons$GLTFLoader.default.loadGeometry(u.gj.href,c)):u.gj.hasOwnProperty("href")&&"glb"===u.gj.format?a.push(module$src$shared$singletons$GLBLoader.default.loadGeometry(u.gj.href,c,o,g)):"obj"===u.gj.format?u.gj.data&&u.gj.data.objUrl&&a.push(module$src$shared$singletons$OBJLoader.default.loadGeometry(u.gj.data.objUrl,u.gj.data.mtlUrl,u.gj.data.path,u.gj.data.texturePath,u.gj.data.side,c)):"three"===u.gj.format?u.gj.data&&u.gj.data.threeObject&&a.push(module$src$shared$singletons$THREELoader.default.loadGeometry(u.gj.data.threeObject,c)):"tag3d"===u.gj.format&&u.gj.hasOwnProperty("data")&&Array.isArray(u.gj.data)?a.push(module$src$shared$singletons$Tag3DLoader.default.load3DTags(u.gj.data)):("tag2d"===u.gj.format||"anchor"===u.gj.format)&&u.gj.hasOwnProperty("data")&&Array.isArray(u.gj.data)&&(u.anchorArray=[],u.gj.data.forEach(function(e){return function(t,n){if(t.location){var r=t.location;r=void 0!==r.x?new module$src$externals$three.default.Vector3(r.x,r.y,r.z):new module$src$externals$three.default.Vector3(r.X,r.Y,r.Z),e.anchorArray.push({path:"Anchor_"+n,type:"anchor",geometry:{position:r,viewports:t.viewports,format:"tag2d"===e.gj.format?e.gj.format:t.format,data:"tag2d"===e.gj.format?{color:t.color,text:t.text}:t.data}})}}}(u)),a.push(Promise.resolve(u.anchorArray)))}return o=Promise.all(a).then((function(e){return e.forEach((function(e,t){for(var n=(e=$jscomp.makeIterator(e)).next();!n.done;n=e.next())(n=n.value).path="content_"+t+"."+n.path})),e})).catch((function(e){return n("loading of geometry failed",e)})),l=Promise.all(l).catch((function(e){return n("loading of material failed",e)})),t=Promise.resolve(t),Promise.all([o,l,t]).then((function(t){if(0<t[0].length){r.geometry=[];for(var n=$jscomp.makeIterator(t[0]),o=n.next();!o.done;o=n.next())for(var a=(o=$jscomp.makeIterator(o.value)).next();!a.done;a=o.next())r.geometry.push(a.value)}return 0<t[1].length&&(r.material=t[1]),0<t[2].length&&(r.data=t[2]),r._json=e,r}))},x=function(e){for(var t in s)delete s[t][e],delete m[t+"."+e];delete u[e]};return r.initSubScene=function(e,n,r,o){var a=function(e,n){return n instanceof Error?e=n:((e=Error(e)).scope="SceneManager.initSubScene",e.data=n),i&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,e,r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,n)),t.error(e.scope,e.message,e),!1};if(!r||!r.id)return a("invalid token");var i=r.id,l=r.serial?r.serial:Date.now();return"number"!=typeof l&&(l=parseInt(l),isNaN(l)&&(l=Date.now())),h.hasOwnProperty(n)&&h[n].serial>l||p.hasOwnProperty(n)&&p[n].serial>l?(e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT,"Subscene obsolete because of newer request",r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,e),!1):u.hasOwnProperty(i)?a("attempt to register duplicate process "+i):(h[n]={serial:l,id:i},m[n+"."+i]=l,u[i]={initTime:Date.now(),creatorId:n,processId:i,totalOutputVersions:e,finishedOutputVersions:0,options:o},s[n]=s[n]||{},s[n][i]={creatorId:n,processId:i,subScene:new module$src$shared$scene$OutputVersion.default},!0)},r.addJSONOutputVersionToSubScene=function(e,n,o){var a=function(e,n){return n instanceof Error?e=n:((e=Error(e)).scope="SceneManager.addJSONOutputVersionToSubScene",e.data=n),i&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,e,o),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,n),x(i)),t.error(e.scope,e.message,e),Promise.reject(e)};if(!o||!o.id)return a("invalid token");var i=o.id;return b(e).then((function(e){return r.addOutputVersionToSubScene(e,n,o)}),(function(e){return a("conversion of output version failed",e)}))},r.addOutputVersionToSubScene=function(e,n,r){var o=function(e,n,o){return n instanceof Error?e=n:((e=o?{message:e}:Error(e)).scope="SceneManager.addOutputVersionToSubScene",e.data=n),a&&(n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,e,r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,n),x(a)),o?(t.warn(e.scope,e.message,e),Promise.resolve(!1)):(t.error(e.scope,e.message,e),Promise.reject(e))};if(!e.id)return o("output version without id");if(!r||!r.id)return o("invalid token");var a=r.id;if(!u[a])return o("unknown process id "+a+", probably process was superseded",void 0,!0);var i=u[a];if(i.creatorId!==n)return o("unexpected creatorId");if(!s[n]||!s[n][a])return o("no partial subscene for creatorId/processId, probably process was superseded",void 0,!0);var l=h[n];return l?t.getSettingShallow("ignoreSuperseded")&&l.id!==a?(x(a),e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT,"Subscene obsolete because of newer request",r),t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,e),Promise.resolve(!1)):v(r,e).then((function(e){if(!1===e){var n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT,"Subscene superseded, not published",r);x(r.id)}else!0===e?n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{state:module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_OUTPUTVERSION,progress:.25+i.finishedOutputVersions/i.totalOutputVersions*.5},r):((n=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS,"Subscene published",r)).addPart(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_UPDATE,e),x(r.id));return t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,n),e}),(function(e){return o("adding output version failed",e)})):o("could not find latest serial for creator id "+n+", probably process was superseded",void 0,!0)},r.numberOfPartialSubScenes=function(){return Object.keys(s).length},r.numberOfCompleteSubScenes=function(){return Object.keys(l).length},r.getModelData=function(e){for(var t=[],n=(e=e||{}).creatorId?[e.creatorId]:Object.keys(c),r=(n=$jscomp.makeIterator(n)).next();!r.done;r=n.next())if(c.hasOwnProperty(r=r.value))for(var o=Object.keys(c[r]),a=(o=$jscomp.makeIterator(o)).next();!a.done;a=o.next())if(a=a.value,null==e.id||a==e.id)for(var i=$jscomp.makeIterator(c[r][a]),s=i.next();!s.done;s=i.next())s=s.value,(null==e.name||s.name==e.name)&&(delete(s=module$src$shared$util$GlobalUtils.default.deepCopy(s)).format,s.plugin=r,s.id=a,t.push(s));return t},r.getGeometryNames=function(e){var t={};return(null==e?Object.keys(o):[e]).forEach((function(e){if(o.hasOwnProperty(e)&&o[e].hasOwnProperty("_subSceneObject")){t[e]={};for(var n=$jscomp.makeIterator(o[e]._subSceneObject.outputNames),r=n.next();!r.done;r=n.next()){t[e][r=r.value]=[];for(var a=o[e]._subSceneObject.getOutputVersionIdByName(r),i=(a=$jscomp.makeIterator(a)).next();!i.done;i=a.next()){var s=o[e]._subSceneObject.getOutputVersion(i=i.value);s&&s.hasOwnProperty("geometry")&&t[e][r].push(i)}}}})),t},r.getGeometryPathsByName=function(e,t){var n=[];return(null==t?Object.keys(o):[t]).forEach((function(t){if(o.hasOwnProperty(t)&&o[t].hasOwnProperty("_subSceneObject"))for(var r=o[t]._subSceneObject.getOutputVersionIdByName(e),a=(r=$jscomp.makeIterator(r)).next();!a.done;a=r.next()){var i=o[t]._subSceneObject.getOutputVersion(a=a.value);i&&i.hasOwnProperty("geometry")&&n.push(t+"."+a)}})),n},r.getJSONOutputVersion=function(e,t,n){if(!o.hasOwnProperty(t))return null;var r=o[t]._subSceneObject.getOutputVersion(e);if(!r)return null;var a="_json";if(!r.hasOwnProperty(a))return null;if(n&&r.hasOwnProperty("_json_scene")&&(a="_json_scene"),(r=module$src$shared$util$GlobalUtils.default.deepCopy(r[a],i)).scenePath=t+"."+e,!r.format){if(e=null,Array.isArray(r.content))if(0===r.content.length)e="unknown";else{for(t=0,n=r.content.length;t<n;t++)if((a=r.content[t]).format)if(e){if(e!==a.format){e=null;break}}else e=a.format;e||(e="mixed")}e&&(r.format=e)}return r},r.getOutputIds=function(e){return o.hasOwnProperty(e)?o[e]._subSceneObject.outputIds:[]},r.removeOutputIds=function(e,t){Array.isArray(t)||(t=[t]);var r=Promise.resolve();if(o[e])for(var a=o[e],i={},s=(t=$jscomp.makeIterator(t)).next();!s.done;i={id$263:i.id$263},s=t.next())i.id$263=s.value,a[i.id$263]&&(a._subSceneObject.removeOutputVersion(i.id$263),delete a[i.id$263],r=r.then(function(t){return function(){return n.removeGeometry(e+"."+t.id$263)}}(i)));return r},r.setPersistentAttributes=function(e,n,s){var l;a[n]=a[n]||{},a[n][e]=a[n][e]||{},a[n][e].json=a[n][e].json||{};var u=-1;s.hasOwnProperty("duration")&&(u=s.duration,delete s.duration);var c=module$src$shared$util$GlobalUtils.default.deepCopy(a[n][e].json,i);for(l in s=module$src$shared$util$GlobalUtils.default.deepCopy(s,i))null===s[l]?delete c[l]:c[l]=s[l];return c.id=e,b(c,!0).then((function(i){if(a[n][e].json=c,a[n][e].ov=i,!o.hasOwnProperty(n))return c;if(!(i=o[n]._subSceneObject.getOutputVersion(e)))return c;var s={id:module$src$shared$util$GlobalUtils.default.createRandomId(),serial:Date.now()},l=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{busy:!1,progress:0,creator:"SceneManager.setPersistentAttributes"},s);return t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,l),l={forceUpdate:e},0<=u&&(l.duration=u),r.initSubScene(1,n,s,l)?r.addOutputVersionToSubScene(i,n,s).then((function(){return c})):$("SceneManager.setPersistentAttributes","ViewerApp.initSubScene failed",void 0)}))},r.getPersistentAttributes=function(e,t){return a[t]&&a[t][e]?a[t][e].json:null},r.getCreatorIds=function(){return Object.keys(o)},r};var module$src$app$handlers$ProcessStatusHandler={},GlobalUtils$$module$src$app$handlers$ProcessStatusHandler=module$src$shared$util$GlobalUtils.default,MessagePrototype$$module$src$app$handlers$ProcessStatusHandler=module$src$shared$messages$MessagePrototype.default,viewerAppConstants$$module$src$app$handlers$ProcessStatusHandler=module$src$app$ViewerAppConstants.default;module$src$app$handlers$ProcessStatusHandler.default=function(e){var t=this;if(e&&e.viewportManager)var n=e.viewportManager;var r={},o={busy:!1,progress:1,processes:module$src$shared$util$GlobalUtils.default.deepCopy(r)},a={getSummary:function(){return module$src$shared$util$GlobalUtils.default.deepCopy(o)},updateViewerStatus:function(){var e=o.busy,a={busy:!1,progress:1,processes:module$src$shared$util$GlobalUtils.default.deepCopy(r)};for(s in r){var i=r[s];i.busy&&(a.busy=!0),void 0!==i.progress&&"number"==typeof i.progress&&i.progress<a.progress&&0<=i.progress&&(a.progress=i.progress)}if((o=module$src$shared$util$GlobalUtils.default.deepCopy(a)).busy){var s=new module$src$shared$messages$MessagePrototype.default(module$src$app$ViewerAppConstants.default.messageDataTypes.APP_STATUS,a);t.message(module$src$app$ViewerAppConstants.default.messageTopics.STATUS_BUSY,s),e||(t.debug("ProcessStatusHandler.updateViewerStatus","Entering busy mode, progress "+100*o.progress+"%",a),n&&t.getSettingShallow("blurSceneWhenBusy")&&n.setBlur(o.busy,100))}else!o.busy&&e?(t.debug("ProcessStatusHandler.updateViewerStatus","Entering idle mode",a),e=new module$src$shared$messages$MessagePrototype.default(module$src$app$ViewerAppConstants.default.messageDataTypes.APP_STATUS,a),t.message(module$src$app$ViewerAppConstants.default.messageTopics.STATUS_IDLE,e),n&&t.getSettingShallow("blurSceneWhenBusy")&&n.setBlur(o.busy,100)):o.busy&&t.debug("ProcessStatusHandler.updateViewerStatus","Updating busy mode",a)},updateProcessStatus:function(e,n){var o=e;if(o&&"object"==typeof o&&module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")&&(o=e.id),!module$src$shared$util$GlobalUtils.default.typeCheck(o,"string"))return!1;if(n=n||{},r.hasOwnProperty(o))module$src$shared$util$GlobalUtils.default.inject(n,r[o],!0);else{if(0!==n.progress)return t.debug("ProcessStatusHandler.updateProcessStatus","Ignoring status message for unknown process "+o,n),!1;r[o]={initTime:Date.now()},module$src$shared$util$GlobalUtils.default.inject(n,r[o],!0)}return a.updateViewerStatus(),!0},forkProcessStatus:function(e,t){var n=e;if(n&&"object"==typeof n&&module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")&&(n=e.id),!(module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")&&r.hasOwnProperty(n)&&Array.isArray(t)&&t.every((function(e){return e.startsWith(n+".")}))))return!1;var o=r[n];return t.forEach((function(e){r[e]=module$src$shared$util$GlobalUtils.default.deepCopy(o)})),delete r[n],!0},unregisterProcess:function(e){var n=e;return n&&"object"==typeof n&&module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")&&(n=e.id),!!module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")&&(r.hasOwnProperty(n)?(delete r[n],a.updateViewerStatus(),!0):(t.debug("ProcessStatusHandler.unregisterProcess","Unregistering unknown process "+n),!1))}};return a};var module$src$ar$ArApiInterface={default:function(){}};module$src$ar$ArApiInterface.default.prototype.hitTest=function(){},module$src$ar$ArApiInterface.default.prototype.registerAnchor=function(){},module$src$ar$ArApiInterface.default.prototype.removeAnchor=function(){},module$src$ar$ArApiInterface.default.prototype.pauseSession=function(){},module$src$ar$ArApiInterface.default.prototype.runSession=function(){},module$src$ar$ArApiInterface.default.prototype.getStatus=function(){},module$src$ar$ArApiInterface.default.prototype.addEventListener=function(){},module$src$ar$ArApiInterface.default.prototype.removeEventListener=function(){},module$src$ar$ArApiInterface.default.prototype.EVENTTYPE={ANCHOR_CREATE_IMAGE:"anchor.create.image",ANCHOR_UPDATE:"anchor.update",STATUS_TRACKING:"status.tracking",STATUS_MAPPING:"status.mapping"};var module$src$ar$diagnostics$ArStatusType={default:function(e,t,n,r,o){this.framework=e,this.anchors=t,this.tracking=n,this.trackingReason=r,this.worldMapping=o}},module$src$ar$ArSettingsHooks={},GLOBAL_UTILS$$module$src$ar$ArSettingsHooks=module$src$shared$util$GlobalUtils.default;module$src$ar$ArSettingsHooks.default=function(e){var t=this;this._settings=e.settings,this._loggingHandler=e.loggingHandler,this._viewportManager=e.viewportManager,this._container=e.container,this.getDefaultHitTestTypeVal=this.getEnableAutomaticPlacementVal=this.getEnableTouchControlRotationVal=this.getEnableTouchControlsVal=this.getEnableLightingEstimationVal=this.getEnableCameraSyncVal=this.onSettingChange=null,e=this._settings.getSettings();var n=function(e,n){var r=t[e](n);return t.onSettingChange&&r&&t.onSettingChange(e,n),r};this.enableCameraSync(e.enableCameraSync),this._settings.registerHook("enableCameraSync",(function(e){return n("enableCameraSync",e)})),this.enableLightingEstimation(e.enableLightingEstimation),this._settings.registerHook("enableLightingEstimation",(function(e){return n("enableLightingEstimation",e)})),this.enableTouchControls(e.enableTouchControls),this._settings.registerHook("enableTouchControls",(function(e){return n("enableTouchControls",e)})),this.enableTouchControlRotation(e.enableTouchControlRotation),this._settings.registerHook("enableTouchControlRotation",(function(e){return n("enableTouchControlRotation",e)})),this.enableAutomaticPlacement(e.enableAutomaticPlacement),this._settings.registerHook("enableAutomaticPlacement",(function(e){return n("enableAutomaticPlacement",e)})),this.defaultHitTestType(e.defaultHitTestType),this._settings.registerHook("defaultHitTestType",(function(e){return n("defaultHitTestType",e)}))},module$src$ar$ArSettingsHooks.default.prototype.enableCameraSync=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",this._loggingHandler.warn,"ArHandler.Hook->enableCameraSync")&&(this.getEnableCameraSyncVal=e,!0)},module$src$ar$ArSettingsHooks.default.prototype.enableLightingEstimation=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",this._loggingHandler.warn,"ArHandler.Hook->enableLightingEstimation")&&(this.getEnableLightingEstimationVal=e,!0)},module$src$ar$ArSettingsHooks.default.prototype.enableTouchControls=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",this._loggingHandler.warn,"ArHandler.Hook->enableTouchControls")&&(this.getEnableTouchControlsVal=e,!0)},module$src$ar$ArSettingsHooks.default.prototype.enableTouchControlRotation=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",this._loggingHandler.warn,"ArHandler.Hook->enableTouchControlRotation")&&(this.getEnableTouchControlRotationVal=e,!0)},module$src$ar$ArSettingsHooks.default.prototype.enableAutomaticPlacement=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"boolean",this._loggingHandler.warn,"ArHandler.Hook->enableAutomaticPlacement")&&(this.getEnableAutomaticPlacementVal=e,!0)},module$src$ar$ArSettingsHooks.default.prototype.defaultHitTestType=function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string",this._loggingHandler.warn,"ArHandler.Hook->defaultHitTestType")&&(this.getDefaultHitTestTypeVal=e,!0)};var module$src$ar$ArEvent={default:function(e,t,n){this.type=e,this.api=t,n&&(n.image&&(this.image=n.image),n.anchors&&(this.anchors=n.anchors),n.tracking&&(this.tracking=n.tracking),n.trackingReason&&(this.trackingReason=n.trackingReason),n.worldMapping&&(this.worldMapping=n.worldMapping))}},module$src$ar$utils$ArApi_utils={default:{}};module$src$ar$utils$ArApi_utils.default.temp2rgb=function(e){var t=e/100,n=[];return 6504>=e?(n[0]=255,n[1]=t,n[1]=99.4708025861*Math.log(n[1])-161.1195681661):(n[0]=t-60,n[0]=329.698727446*Math.pow(n[0],-.1332047592),0>n[0]&&(n[0]=0),255<n[0]&&(n[0]=255),n[1]=t-60,n[1]=288.1221695283*Math.pow(n[1],-.0755148492)),0>n[1]&&(n[1]=0),255<n[1]&&(n[1]=255),6504<=e?n[2]=255:19>=t?n[2]=0:(n[2]=t-10,n[2]=138.5177312231*Math.log(n[2])-305.0447927307,0>n[2]&&(n[2]=0),255<n[2]&&(n[2]=255)),n};var module$src$ar$ArApiARKit={},THREE$$module$src$ar$ArApiARKit=module$src$externals$three.default,GLOBAL_UTILS$$module$src$ar$ArApiARKit=module$src$shared$util$GlobalUtils.default,ArApiFactory$$module$src$ar$ArApiARKit=function(e){var t=new module$src$ar$ArApiInterface.default,n={events:[],listen:function(e,t,n){this.events[e]||(this.events[e]=[]),this.events[e].push({token:t,cb:n})},raise:function(e,t){this.events[e]&&this.events[e].forEach((function(e){e.cb(t)}))},remove:function(e){var t=e.split(":");if(e=t[0],t=t[1],this.events[e])for(var n=0;n<this.events[e].length;n++)if(this.events[e][n].token==t){this.events[e].splice(n,1);break}}},r=e.viewportManager,o=Array.isArray(e.container)&&0<e.container.length?e.container[0]:e.container,a=e.apiResponse,i=e.sceneGeometryManager,s={},l=null,u=new module$src$externals$three.default.Matrix4,c=new module$src$externals$three.default.Matrix4,d=null,p=new module$src$ar$ArSettingsHooks.default({viewportManager:e.viewportManager,loggingHandler:e.loggingHandler,settings:e.settings}),h=function(){return d||(d=r.getFirstDefaultThreeDManagerApi()),d},m=function(){var e;return function(){return e||(e=h().camera),e}}();e={};var f=new module$src$externals$three.default.Matrix4,g=new module$src$externals$three.default.Matrix4,$={};f.makeRotationAxis(new module$src$externals$three.default.Vector3(1,0,0),-.5*Math.PI),g.getInverse(f),window.SDVARKitBridge=e;var v=function(e){return e.includes("'")||e.includes('"')?JSON.parse(e):e.replace(/["'\[\]]/g,"").split(",").map((function(e){return parseFloat(e)}))};e.viewProjectionMatrixUpdate=function(e,t,n,r,o){w(n,r,o),"string"==typeof e&&(e=v(e)),"string"==typeof t&&(t=v(t)),u.identity(),c.identity(),u.fromArray(e),u.multiply(f),c.fromArray(t),p.getEnableCameraSyncVal&&m().updateMatrices(u,c),p.getEnableCameraSyncVal&&p.getEnableTouchControlsVal&&N&&j(U[0],U[1])},e.lightingEstimateUpdate=function(){};var y=function(e){var t=new module$src$externals$three.default.Matrix4,n=e.plane;t.fromArray(e.transform),t.multiply(f),t.premultiply(g),e.transform=t,n&&(e=new module$src$externals$three.default.Vector3,t=new module$src$externals$three.default.Vector3,e.fromArray(n.center),e.applyMatrix4(g),n.center=e,t.fromArray(n.extent),t.applyMatrix4(g),n.extent=t)};e.anchorTransformUpdate=function(e,t){l="string"==typeof e?JSON.parse(e):e,Object.keys(l).forEach((function(e){y(l[e])})),M(l,t)},e.imageAnchorCreated=function(e){e="string"==typeof e?JSON.parse(e):e,y(e),E(e)},e.hitTestResponse=function(e,t){var n=$[e];n&&(delete $[e],t?((e="string"==typeof t?JSON.parse(t):t).forEach((function(e){var t=new module$src$externals$three.default.Matrix4,n=new module$src$externals$three.default.Matrix4,r=e.anchor;t.fromArray(e.worldTransform),t.multiply(f),t.premultiply(g),e.worldTransform=t,n.fromArray(e.localTransform),n.multiply(f),n.premultiply(g),e.localTransform=n,r&&y(r)})),n.resolve(e)):n.resolve([]))},e.registerAnchorResponse=function(e,t){var n=$[e];n&&(delete $[e],n.resolve(t))},e.removeAnchorResponse=function(e,t){var n=$[e];n&&(delete $[e],n.resolve(t))},e.pauseSessionResponse=function(e){var t=$[e];t&&(delete $[e],t.resolve())},e.runSessionResponse=function(e){var t=$[e];t&&(delete $[e],t.resolve())};var _,b,x,w=function(e,r,o){if(s.worldMappingStatus!==e){var a=new module$src$ar$ArEvent.default(t.EVENTTYPE.STATUS_MAPPING,this,{worldMapping:e,tracking:r,trackingReason:o});n.raise(t.EVENTTYPE.STATUS_MAPPING,a)}s.trackingStatus!==r&&(a=new module$src$ar$ArEvent.default(t.EVENTTYPE.STATUS_TRACKING,this,{worldMapping:e,tracking:r,trackingReason:o}),n.raise(t.EVENTTYPE.STATUS_TRACKING,a)),s.worldMappingStatus=e,s.trackingStatus=r,s.trackingStatusReason=o},S=new module$src$ar$ArEvent.default(t.EVENTTYPE.ANCHOR_UPDATE,this),M=function(e){if(p.getEnableCameraSyncVal&&p.getEnableAutomaticPlacementVal){if(!G){var r=Object.keys(e);0<r.length&&(G=r[0])}G&&e[G]&&i.setPluginTransformation("CommPlugin_1",[null,null,e[G].transform],!0)}S.anchors=e,n.raise(t.EVENTTYPE.ANCHOR_UPDATE,S)},E=function(e){e=new module$src$ar$ArEvent.default(t.EVENTTYPE.ANCHOR_CREATE_IMAGE,this,{image:e}),n.raise(t.EVENTTYPE.ANCHOR_CREATE_IMAGE,e)},T=0,C=window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.runSession?"arkit":"none",P=function(e,t){return new Promise((function(n,r){if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers[e]){var o="id"+T++;(t=t||{}).requestId=o,$[o]={resolve:n,reject:r},window.webkit.messageHandlers[e].postMessage(t)}else r("Handler "+e+" does not exist")}))},A=function(e,t,n){return 0>e||1<e||0>t||1<t?Promise.reject("Expects normalized screen coordinates"):("string"==typeof n?n=[n]:Array.isArray(n)||(n=[]),P("hitTest",{screenX:e+"",screenY:t+"",types:n.join(";")}))},L=function(e,t){if(!e||!e.isMatrix4)return Promise.reject("Provide a THREE.Matrix4");"string"!=typeof t&&(t="");var n=new module$src$externals$three.default.Matrix4;return n.copy(e),n.multiply(g),n.premultiply(f),P("registerAnchor",{transform:JSON.stringify(n.toArray(),null,0),name:t})},R=function(e){return"string"!=typeof e?Promise.reject("Anchor uuid must be a string"):P("removeAnchor",{uuid:e})},D=0,I=0,O=0,N="",U=[],k=new module$src$externals$three.default.Matrix4,H=new module$src$externals$three.default.Matrix4,G=!1,V="",j=function(e,t,n){return A(e,t,n=n||p.getDefaultHitTestTypeVal).then((function(e){Array.isArray(e)&&0<e.length&&(i.setPluginTransformation("CommPlugin_1",[null,null,e[0].worldTransform],!0),G="x",_=e[0].worldTransform)}))},F=function(e){if(2>e.length)return[0,0];for(var t=[],n=0,r=e.length;n<r;n++)t.push(e.item(n));return t.sort((function(e,t){return e.identifier<t.identifier})),new module$src$externals$three.default.Vector2(t[1].screenX-t[0].screenX,t[1].screenY-t[0].screenY)},z=function(e){if(e.preventDefault(),2===e.touches.length)D=F(e.touches).angle();else if(!(1<e.touches.length)){var t=(e=e.changedTouches.item(0)).screenX/window.innerWidth,n=e.screenY/window.innerHeight;N=e.identifier,U=[t,n],j(t,n)}},B=function(e){e.preventDefault();var t=e.changedTouches;2===(e=e.touches).length&&(e=F(e),I=D-e.angle()+O,k.makeRotationZ(I),p.getEnableTouchControlRotationVal&&i.setPluginTransformation("CommPlugin_1",[null,k],!0)),e=0;for(var n=t.length;e<n;e++)if(t.item(e).identifier===N){e=t.item(e),t=e.screenX/window.innerWidth,e=e.screenY/window.innerHeight,U=[t,e],j(t,e);break}},W=function(e){e.preventDefault(),O=I;for(var t=0,n=(e=e.changedTouches).length;t<n;t++)if(e.item(t).identifier===N){N="";break}N||(r.adjustScene(),R(V).then((function(){return L(_).then((function(e){V=G=e}))})))};if(o){var Y=!1;p.onSettingChange=function(e,t){"enableCameraSync"===e&&(t?(b&&x&&i.setPluginTransformation("CommPlugin_1",[null,b,x]),r.registerForContinuousRendering("AR"),t&&h().updateSettingAsync("camera.enableOrbitControls",!t)):(e=i.getPluginTransformation("CommPlugin_1"),Array.isArray(e)&&3<=e.length&&(b=e[1],x=e[2]),i.setPluginTransformation("CommPlugin_1",[null,H,H]),r.unregisterForContinuousRendering("AR"))),p.getEnableCameraSyncVal&&p.getEnableTouchControlsVal&&!Y?(o.addEventListener("touchstart",z,!1),o.addEventListener("touchmove",B,!1),o.addEventListener("touchend",W,!1),o.addEventListener("touchcancel",W,!1),Y=!0):(o.removeEventListener("touchstart",z,!1),o.removeEventListener("touchmove",B,!1),o.removeEventListener("touchend",W,!1),o.removeEventListener("touchcancel",W,!1),Y=!1)},setTimeout((function(){h()&&p.onSettingChange("enableCameraSync",p.getEnableCameraSyncVal)}),0)}return $jscomp.inherits(e=function(){module$src$ar$ArApiInterface.default.call(this)},module$src$ar$ArApiInterface.default),e.prototype.hitTest=function(e,t,n){return A(e,t,n)},e.prototype.registerAnchor=function(e,t){return L(e,t)},e.prototype.removeAnchor=function(e){return R(e)},e.prototype.pauseSession=function(){return P("pauseSession")},e.prototype.runSession=function(e,t){return"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]),"string"==typeof t?t=[t]:Array.isArray(t)||(t=[]),P("runSession",{planeDetection:e.join(";"),options:t.join(";")})},e.prototype.getStatus=function(){return a(null,new module$src$ar$diagnostics$ArStatusType.default(C,l,s.trackingStatus,s.trackingStatusReason,s.worldMappingStatus))},e.prototype.addEventListener=function(e,r){if(!Object.keys(t.EVENTTYPE).find((function(n){return t.EVENTTYPE[n]===e})))return a("Unsupported event type");var o=module$src$shared$util$GlobalUtils.default.createRandomId();return n.listen(e,o,r),a(null,{token:e+":"+o})},e.prototype.removeEventListener=function(e){return a(null,n.remove(e))},new e},_ArApiInstance$$module$src$ar$ArApiARKit;module$src$ar$ArApiARKit.default=function(e){return _ArApiInstance$$module$src$ar$ArApiARKit||(_ArApiInstance$$module$src$ar$ArApiARKit=ArApiFactory$$module$src$ar$ArApiARKit(e)),_ArApiInstance$$module$src$ar$ArApiARKit};var module$src$api$v2$ApiResponse={},GLOBALUTILS$$module$src$api$v2$ApiResponse=module$src$shared$util$GlobalUtils.default;module$src$api$v2$ApiResponse.default=function(e,t,n){var r={};return null!=e&&(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")?r.err=Error(e):e instanceof Error?r.err=e:e.hasOwnProperty("m")?(r.err=Error(e.m),e.hasOwnProperty("d")&&(r.err.data=Error(e.d))):(r.err=Error(),r.err.data=e)),null!=t&&(r.data=t),null!=n&&(r.payload=n),r};var module$src$api$v2$ApiInterfaceV2_1={},ARAPIINTERFACE$$module$src$api$v2$ApiInterfaceV2_1=module$src$ar$ArApiInterface.default,ApiParameterInterface$$module$src$api$v2$ApiInterfaceV2_1=function(){this.EVENTTYPE={REGISTERED:"registered",UPDATE:"update",VALUE_UPDATE:"value.update"},this.RESULT={PARAM_NOT_FOUND:"param_not_found",NO_VALUE:"no_value",VALUE_REJECT:"value_reject",VALUE_EXISTS:"value_exists",VALUE_OK:"value_ok",PLUGIN_NOT_FOUND:"plugin_not_found",ERROR:"error",LIVE:"live",CACHE:"cache",LOAD:"load",ABORT:"abort"},this.TYPE={FLOAT:"Float",INT:"Int",EVEN:"Even",ODD:"Odd",STRING:"String",COLOR:"Color",STRINGLIST:"StringList",BOOL:"Bool",TIME:"Time",FILE:"File"},this.VISUALIZATION={SLIDER:"slider",SEQUENCE:"sequence",CYCLE:"cycle",DROPDOWN:"dropdown",CHECKLIST:"checklist",CLOCK:"clock",CALENDAR:"calendar"},this.get=function(){},this.updateAsync=function(){},this.canGoBackInHistory=function(){},this.canGoForwardInHistory=function(){},this.goBackInHistoryAsync=function(){},this.goForwardInHistoryAsync=function(){},this.updateProperties=function(){},this.addEventListener=function(){},this.removeEventListener=function(){}},ApiExportInterface$$module$src$api$v2$ApiInterfaceV2_1=function(){this.RESULT={EXPORT_NOT_FOUND:"export_not_found",PLUGIN_NOT_FOUND:"plugin_not_found",ERROR:"error",CACHE:"cache",LOAD:"load"},this.EVENTTYPE={AVAILABLE:"available",REGISTERED:"registered",UPDATE:"update",STATUS:"status"},this.get=function(){},this.requestAsync=function(){},this.updateProperties=function(){},this.addEventListener=function(){},this.removeEventListener=function(){}},ApiPluginInterface$$module$src$api$v2$ApiInterfaceV2_1=function(){this.STATUS={NONE:"none",READY:"ready",FAILED:"failed",LOADED:"loaded",ACTIVE:"active",UNLOADED:"unloaded"},this.get=function(){},this.registerPluginAsync=function(){},this.registerCommPluginAsync=function(){},this.refreshPluginAsync=function(){},this.saveDefaultParameterValuesAsync=function(){},this.deregisterPluginAsync=function(){}},ApiStateInterface$$module$src$api$v2$ApiInterfaceV2_1=function(){this.EVENTTYPE={BUSY:"busy",IDLE:"idle",MESSAGE:"message",FAILED:"failed"},this.get=function(){},this.setBusy=function(){},this.addEventListener=function(){},this.removeEventListener=function(){}},ApiViewportsInterface$$module$src$api$v2$ApiInterfaceV2_1=function(){this.TYPE={DEFAULT:"default"},this.EVENTTYPE={DESTROYED:"destroyed"},this.get=function(){},this.create=function(){},this.destroy=function(){}},ApiSceneInterface$$module$src$api$v2$ApiInterfaceV2_1=function(){this.FORMAT={GLB:"glb",GLTF:"gltf",OBJ:"obj",THREE:"three",DATA:"data",MATERIAL:"material",TAG2D:"tag2d",TAG3D:"tag3d",ANCHOR:"anchor"},this.EVENTTYPE={ANCHOR_ADD:"anchor.add",ANCHOR_REMOVE:"anchor.remove",DRAG_START:"drag.start",DRAG_MOVE:"drag.move",DRAG_END:"drag.end",HOVER_ON:"hover.on",HOVER_OVER:"hover.over",HOVER_OFF:"hover.off",RENDER_BEAUTY_START:"render.beauty.start",RENDER_BEAUTY_CANCEL:"render.beauty.cancel",RENDER_BEAUTY_END:"render.beauty.end",SELECT_ON:"select.on",SELECT_OFF:"select.off",SUBSCENE_PUBLISHED:"subscene.published",VISIBILITY_ON:"visibility.on",VISIBILITY_OFF:"visibility.off"},this.MATERIALTYPE={STANDARD:"standard",GEM:"gem"},this.INTERACTIONMODETYPE={GLOBAL:"global",SUB:"sub"},this.SELECTIONMODETYPE={SINGLE:"single",MULTIPLE:"multiple"},this.TRANSFORMATIONTYPE={PLUGIN:"plugin",VIEWPORT:"viewport"},this.LIVETRANSFORMATIONTYPE={ROTATION:"rotation",TRANSLATION:"translation",SCALING:"scaling"},this.updateAsync=function(){},this.get=function(){},this.getData=function(){},this.convertTo2D=function(){},this.getBoundingBox=function(){},this.setTransformation=function(){},this.getTransformation=function(){},this.applyTransformation=function(){},this.resetTransformation=function(){},this.setLiveTransformation=function(){},this.getScreenshot=function(){},this.updateSelected=function(){},this.getSelected=function(){},this.removeAsync=function(){},this.render=function(){},this.startContinuousRendering=function(){},this.stopContinuousRendering=function(){},this.pause=function(){},this.resume=function(){},this.updatePersistentAsync=function(){},this.getPersistent=function(){},this.updateInteractionGroups=function(){},this.getInteractionGroups=function(){},this.addEventListener=function(){},this.removeEventListener=function(){},this.toggleGeometry=function(){}};module$src$api$v2$ApiInterfaceV2_1.default=function(){this.EVENTTYPE={SETTINGS_UPDATE:"settings.update",SETTINGS_REGISTERED:"settings.registered"},this.state=new ApiStateInterface$$module$src$api$v2$ApiInterfaceV2_1,this.parameters=new ApiParameterInterface$$module$src$api$v2$ApiInterfaceV2_1,this.exports=new ApiExportInterface$$module$src$api$v2$ApiInterfaceV2_1,this.plugins=new ApiPluginInterface$$module$src$api$v2$ApiInterfaceV2_1,this.viewports=new ApiViewportsInterface$$module$src$api$v2$ApiInterfaceV2_1,this.scene=new ApiSceneInterface$$module$src$api$v2$ApiInterfaceV2_1,this.ar=new module$src$ar$ArApiInterface.default,this.addEventListener=function(){},this.removeEventListener=function(){},this.getSettingDefinitions=function(){},this.getSettings=function(){},this.getSetting=function(){},this.updateSettingAsync=function(){},this.updateSettingsAsync=function(){},this.saveSettingsAsync=function(){},this.createAsynchronousFunctions=function(){},this.getRuntimeId=function(){}},module$src$api$v2$ApiInterfaceV2_1.default.utils={},module$src$api$v2$ApiInterfaceV2_1.default.utils.APIResponse={};var module$src$api$v2$ApiImplementationV2_1={},COMM_PLUGIN$$module$src$api$v2$ApiImplementationV2_1=module$src$plugins$comm$CommPlugin.default,ARAPIARKIT$$module$src$api$v2$ApiImplementationV2_1=module$src$ar$ArApiARKit.default,messagingConstants$$module$src$api$v2$ApiImplementationV2_1=module$src$shared$constants$MessagingConstants.default,pluginConstantsGlobal$$module$src$api$v2$ApiImplementationV2_1=module$src$shared$constants$PluginConstantsGlobal.default,GlobalUtils$$module$src$api$v2$ApiImplementationV2_1=module$src$shared$util$GlobalUtils.default,MessagePrototype$$module$src$api$v2$ApiImplementationV2_1=module$src$shared$messages$MessagePrototype.default,ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1=new module$src$api$v2$ApiInterfaceV2_1.default,TWEEN$$module$src$api$v2$ApiImplementationV2_1=module$node_modules$$tweenjs$tween_js$src$Tween.default,APIResponse$$module$src$api$v2$ApiImplementationV2_1=module$src$api$v2$ApiResponse.default,StateApi$$module$src$api$v2$ApiImplementationV2_1=function(e,t){var n=this;this.EVENTTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.state.EVENTTYPE;var r=t.messagingHandler,o=t.processStatusHandler;this.get=function(){var e=o.getSummary();return e.failedStatusMessages=r.getFailedStatusMessages(),(0,module$src$api$v2$ApiResponse.default)(null,e)},this.setBusy=function(t,n){var r={};if(n){if("number"!=typeof n||0>n||1<n)return(0,module$src$api$v2$ApiResponse.default)("progess must be a number between 0 and 1",o.getSummary());r.progress=n}return t?(r.busy=!0,o.updateProcessStatus(e.getRuntimeId(),r)):o.unregisterProcess(e.getRuntimeId()),this.get()},this.addEventListener=function(t,r){if(!Object.keys(n.EVENTTYPE).find((function(e){return n.EVENTTYPE[e]===t})))return(0,module$src$api$v2$ApiResponse.default)("Unsupported event type");var o=e.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.STATUS+"."+t,(function(e,n){(e=new CustomEvent(t)).api=n.api,n.token&&(e.token=n.token);var o={};for(var a in o[module$src$shared$constants$MessagingConstants.default.messageDataTypes.APP_STATUS]={progress:1},o[module$src$shared$constants$MessagingConstants.default.messageDataTypes.STATUS_MESSAGE]=null,o){var i=n.getUniquePartByType(a);if(i){i.data&&(i=i.data);var s,l=o[a]?o[a]:i;for(s in l)e[s]=i[s]}}r(e)}));return(0,module$src$api$v2$ApiResponse.default)(null,o)},this.removeEventListener=function(t){return(0,module$src$api$v2$ApiResponse.default)(null,e.unsubscribeFromMessageStream(t))}},SceneApi$$module$src$api$v2$ApiImplementationV2_1=function(e,t){var n=this;this.FORMAT=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.scene.FORMAT,this.EVENTTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.scene.EVENTTYPE,this.INTERACTIONMODETYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.scene.INTERACTIONMODETYPE,this.SELECTIONMODETYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.scene.SELECTIONMODETYPE,this.TRANSFORMATIONTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.scene.TRANSFORMATIONTYPE,this.LIVETRANSFORMATIONTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.scene.LIVETRANSFORMATIONTYPE;var r=t.sceneManager,o=t.viewportManager,a=t.sceneGeometryManager,i=t.interactionGroupManager,s=t.messagingHandler;t=o.getFirstDefaultThreeDManagerApi(),n.lights=t?t.lights:null,n.camera=t?t.camera:null,this.updateAsync=function(t,o,a){Array.isArray(t)||(t=[t]);var i=o||e.getRuntimeId(),l=[],u=[];for(o=(t=$jscomp.makeIterator(t)).next();!o.done;o=t.next()){var c=o.value;if(!c||!c.id)return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Asset without id property",null,a));if(u.push(c.id),o=module$src$shared$util$GlobalUtils.default.deepCopy(c,["canvas","threeObject","transformations"]),c=r.getJSONOutputVersion(c.id,i,!1))for(var d=Object.keys(c),p=(d=$jscomp.makeIterator(d)).next();!p.done;p=d.next())o.hasOwnProperty(p=p.value)||"version"===p||(o[p]=c[p]);o.hasOwnProperty("version")||(o.version=module$src$shared$util$GlobalUtils.default.createRandomId()),l.push(o)}var h=module$src$shared$constants$MessagingConstants.default.makeMessageToken();return h.payload=a,new Promise((function(e,t){var o=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,{busy:!1,progress:0},h);if(s.message(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,o),r.initSubScene(l.length,i,h)){o=[];for(var a=$jscomp.makeIterator(l),c=a.next();!c.done;c=a.next())o.push(r.addJSONOutputVersionToSubScene(c.value,i,h));return Promise.all(o).then((function(){for(var o=[],a={},s=$jscomp.makeIterator(u),l=s.next();!l.done;a={asset$268:a.asset$268},l=s.next())a.asset$268=r.getJSONOutputVersion(l.value,i,!0),a.asset$268&&(a.asset$268.addEventListener=function(e){return function(t,r){if(!module$src$shared$util$GlobalUtils.default.typeCheck(t,"string")||0>=t.length)return(0,module$src$api$v2$ApiResponse.default)("Event type must be a string");var o=t;return t.endsWith(e.asset$268.scenePath)||(o=t+"."+e.asset$268.scenePath),n.addEventListener(o,r)}}(a),o.push(a.asset$268));o.length==u.length?e(o):t("Failed to publish all assets, unknown error.")}),(function(e){t(e)}))}t(Error("Could not initialize subscene."))})).then((function(e){return(0,module$src$api$v2$ApiResponse.default)(null,e,a)}),(function(e){return Promise.resolve((0,module$src$api$v2$ApiResponse.default)(e,null,a))}))},this.get=function(t,n,o){"object"!=typeof(t=t||{})&&(t={});var a=[];a=module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")?[n]:[e.getRuntimeId()],n=[];for(var i=(a=$jscomp.makeIterator(a)).next();!i.done;i=a.next()){i=i.value;for(var s=t.hasOwnProperty("id")?[t.id]:r.getOutputIds(i),l=(s=$jscomp.makeIterator(s)).next();!l.done;l=s.next()){if(null===(l=r.getJSONOutputVersion(l.value,i,o)))return(0,module$src$api$v2$ApiResponse.default)(void 0,[]);n.push(l)}}for(a=Object.keys(t),o={},i=(a=$jscomp.makeIterator(a)).next();!i.done;o={f:o.f},i=a.next())o.f=i.value,n=n.filter(function(e){return function(n){return n[e.f]===t[e.f]}}(o));return(0,module$src$api$v2$ApiResponse.default)(null,n)},this.getData=function(e,t){return e=module$src$shared$util$GlobalUtils.default.deepCopy(e),module$src$shared$util$GlobalUtils.default.typeCheck(t,"string")&&(e.plugin=t),t=r.getModelData(e),(0,module$src$api$v2$ApiResponse.default)(null,t)},this.convertTo2D=function(t){if(!module$src$shared$util$GlobalUtils.default.typeCheck(t,"vector3obj"))return null;for(var n=[],r=e.viewports.get(),o=0,a=r.length;o<a;o++)n.push(r[o].convertTo2D(t));return(0,module$src$api$v2$ApiResponse.default)(null,n)},this.getBoundingBox=function(e){return!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")||0>=e.length?(0,module$src$api$v2$ApiResponse.default)("Path must be a string."):(e=a.getBoundingBox(e))?(0,module$src$api$v2$ApiResponse.default)(null,e):(0,module$src$api$v2$ApiResponse.default)("No Object was found at this path.")},this.setTransformation=function(t,n,r){if("number"==typeof r[0]||r.isMatrix4){if(!module$src$shared$util$GlobalUtils.default.typeCheck(r,"matrix4x4arr")&&!r.isMatrix4)return(0,module$src$api$v2$ApiResponse.default)("The provided matrix is not valid.")}else for(var i=0,s=r.length;i<s;i++)if(null!==r[i]&&!module$src$shared$util$GlobalUtils.default.typeCheck(r[i],"matrix4x4arr")&&!r[i].isMatrix4)return(0,module$src$api$v2$ApiResponse.default)("At least one provided matrix is not valid.");if(t===this.TRANSFORMATIONTYPE.PLUGIN){if(t=e.plugins.get().data,n){i=!1;var l=0;for(s=t.length;l<s;l++)t[l].id===n&&(a.setPluginTransformation(n,r),i=!0);if(!i)return(0,module$src$api$v2$ApiResponse.default)("Plugin with id "+n+" does not exist.")}else for(n=0,s=t.length;n<s;n++)a.setPluginTransformation(t[n].id,r);o.updateShadowMap(),o.render()}else{if(t!==this.TRANSFORMATIONTYPE.VIEWPORT)return(0,module$src$api$v2$ApiResponse.default)('Invalid transformation type. Types: "plugin", "viewport"');if(n){if(!(s=e.viewports.get(n)))return(0,module$src$api$v2$ApiResponse.default)("Viewport with id "+n+" does not exist.");s.setTransformation(r)}else for(t=0,s=(n=e.viewports.get()).length;t<s;t++)n[t].setTransformation(r)}return(0,module$src$api$v2$ApiResponse.default)(null,!0)},this.getTransformation=function(t,n){if(t===this.TRANSFORMATIONTYPE.PLUGIN){var r=e.plugins.get().data;if(n){var o=0;for(t=r.length;o<t;o++)if(r[o].id===n){for(r=[],o=0,n=(t=a.getPluginTransformation(n)).length;o<n;o++)r[o]=t[o].transpose().elements;return(0,module$src$api$v2$ApiResponse.default)(null,1===r.length?r[0]:r)}return(0,module$src$api$v2$ApiResponse.default)("Plugin with id "+n+" does not exist.")}if(1==r.length){for(t=a.getPluginTransformation(r[0].id),r=[],o=0,n=t.length;o<n;o++)r[o]=t[o].transpose().elements;return(0,module$src$api$v2$ApiResponse.default)(null,1===r.length?r[0]:r)}for(o=0,t=r.length;o<t;o++){var i=a.getPluginTransformation(r[o].id),s=0;for(n=i.length;s<n;s++)i[s].transpose()}return(0,module$src$api$v2$ApiResponse.default)(null,void 0)}if(t===this.TRANSFORMATIONTYPE.VIEWPORT){if(n){if(!(t=e.viewports.get(n)))return(0,module$src$api$v2$ApiResponse.default)("Viewport with id "+n+" does not exist.");for(r=[],o=0,n=(t=t.getTransformation()).length;o<n;o++)r[o]=t[o].transpose().elements;return(0,module$src$api$v2$ApiResponse.default)(null,1===r.length?r[0]:r)}if(1==(r=e.viewports.get()).length){for(t=r[0].getTransformation(),r=[],o=0,n=t.length;o<n;o++)r[o]=t[o].transpose().elements;return(0,module$src$api$v2$ApiResponse.default)(null,1===r.length?r[0]:r)}for(o=0,t=r.length;o<t;o++){s=[];var l=0;for(n=(i=r[o].getTransformation()).length;l<n;l++)s[l]=i[l].transpose().elements;(void 0)[r[o].getRuntimeId()]=1===s.length?s[0]:s}return(0,module$src$api$v2$ApiResponse.default)(null,void 0)}return(0,module$src$api$v2$ApiResponse.default)('Invalid transformation type. Types: "plugin", "viewport"')},this.applyTransformation=function(t,n,r){if("number"==typeof r[0]||r.isMatrix4){if(!module$src$shared$util$GlobalUtils.default.typeCheck(r,"matrix4x4arr")&&!r.isMatrix4)return(0,module$src$api$v2$ApiResponse.default)("The provided matrix is not valid.")}else for(var i=0,s=r.length;i<s;i++)if(null!==r[i]&&!module$src$shared$util$GlobalUtils.default.typeCheck(r[i],"matrix4x4arr")&&!r[i].isMatrix4)return(0,module$src$api$v2$ApiResponse.default)("At least one provided matrix is not valid.");if(t===this.TRANSFORMATIONTYPE.PLUGIN){if(t=e.plugins.get().data,n){i=!1;var l=0;for(s=t.length;l<s;l++)t[l].id===n&&(a.applyPluginTransformation(n,r),i=!0);if(!i)return(0,module$src$api$v2$ApiResponse.default)("Plugin with id "+n+" does not exist.")}else for(n=0,s=t.length;n<s;n++)a.applyPluginTransformation(t[n].id,r);o.updateShadowMap(),o.render()}else{if(t!==this.TRANSFORMATIONTYPE.VIEWPORT)return(0,module$src$api$v2$ApiResponse.default)('Invalid transformation type. Types: "plugin", "viewport"');if(n){if(!(s=e.viewports.get(n)))return(0,module$src$api$v2$ApiResponse.default)("Viewport with id "+n+" does not exist.");s.applyTransformation(r)}else for(t=0,s=(n=e.viewports.get()).length;t<s;t++)n[t].applyTransformation(r)}return(0,module$src$api$v2$ApiResponse.default)(null,!0)},this.resetTransformation=function(t,n){if(t===this.TRANSFORMATIONTYPE.PLUGIN){var r=e.plugins.get().data;if(n){var i=!1,s=0;for(t=r.length;s<t;s++)r[s].id===n&&(a.resetPluginTransformation(n),i=!0);if(!i)return(0,module$src$api$v2$ApiResponse.default)("Plugin with id "+n+" does not exist.")}else for(n=0,t=r.length;n<t;n++)a.resetPluginTransformation(r[n].id);o.updateShadowMap(),o.render()}else{if(t!==this.TRANSFORMATIONTYPE.VIEWPORT)return(0,module$src$api$v2$ApiResponse.default)('Invalid transformation type. Types: "plugin", "viewport"');if(n){if(!(t=e.viewports.get(n)))return(0,module$src$api$v2$ApiResponse.default)("Viewport with id "+n+" does not exist.");t.resetTransformation()}else for(r=0,t=(n=e.viewports.get()).length;r<t;r++)n[r].resetTransformation()}return(0,module$src$api$v2$ApiResponse.default)(null,!0)},this.setLiveTransformation=function(t,r,o){if(r&&!module$src$shared$util$GlobalUtils.default.typeCheck(r,"string")&&!Array.isArray(r))return(0,module$src$api$v2$ApiResponse.default)("The provided viewports is not of type array or string, but also not null.");module$src$shared$util$GlobalUtils.default.typeCheck(r,"string")&&!Array.isArray(r)&&(r=[r]);var i=[];if(r){for(var s=0,l=r.length;s<l;s++)i.push(e.viewports.get(r[s]));if(0===i.length)return(0,module$src$api$v2$ApiResponse.default)("No viewports with the provided runtimeIds were found.")}else if(0===(i=e.viewports.get()).length)return(0,module$src$api$v2$ApiResponse.default)("No viewports are created at this point.");if(o&&!module$src$shared$util$GlobalUtils.default.typeCheck(o,"notnegative"))return(0,module$src$api$v2$ApiResponse.default)("The provided duration is not a valid number.");if(o||(o=1/0),0===(t=Array.isArray(t)?t:[t]).length)return(0,module$src$api$v2$ApiResponse.default)("No live transformations were provided.");for(r=0,l=t.length;r<l;r++){if(!(s=t[r]).scenePaths)return(0,module$src$api$v2$ApiResponse.default)("No scene paths provided.");Array.isArray(s.scenePaths)||(s.scenePaths=[s.scenePaths]);for(var u=0,c=s.scenePaths.length;u<c;u++)if(!module$src$shared$util$GlobalUtils.default.typeCheck(s.scenePaths[u],"string"))return(0,module$src$api$v2$ApiResponse.default)("One of the provided scenePaths of a live transformation is not of valid type.");if(!s.transformations)return(0,module$src$api$v2$ApiResponse.default)("No live transformations provided.");if(Array.isArray(s.transformations)||(s.transformations=[t]),0===s.transformations.length)return(0,module$src$api$v2$ApiResponse.default)("One of the provided live transformations does not have any transformations.");for(u=0,c=s.transformations.length;u<c;u++){var d=s.transformations[u];if(!module$src$shared$util$GlobalUtils.default.typeCheck(d.type,"string")||d.type!==n.LIVETRANSFORMATIONTYPE.ROTATION&&d.type!==n.LIVETRANSFORMATIONTYPE.TRANSLATION&&d.type!==n.LIVETRANSFORMATIONTYPE.SCALING)return(0,module$src$api$v2$ApiResponse.default)("No valid transformation type provided for at least one of the live transformations.");if(!module$src$shared$util$GlobalUtils.default.typeCheck(d.duration,"notnegative"))return(0,module$src$api$v2$ApiResponse.default)("No valid duration provided for at least one of the live transformations.");if(module$src$shared$util$GlobalUtils.default.typeCheck(d.delay,"notnegative")||(d.delay&&e.warn("setLiveTransformation","The value "+d.delay+" is not a valid input for the delay. It is set to the default (0)."),d.delay=0),module$src$shared$util$GlobalUtils.default.typeCheck(d.repeat,"notnegative")||(d.repeat&&e.warn("setLiveTransformation","The value "+d.repeat+" is not a valid input for the repeat. It is set to the default (0)."),d.repeat=0),module$src$shared$util$GlobalUtils.default.typeCheck(d.yoyo,"boolean")||(d.yoyo&&e.warn("setLiveTransformation","The value "+d.yoyo+" is not a valid input for the yoyo. It is set to the default (false)."),d.yoyo=!1),module$src$shared$util$GlobalUtils.default.typeCheck(d.parent,"string")?a.getBoundingBox(d.parent)||(e.warn("setLiveTransformation","The value "+d.parent+" is not a valid path to a parent. It is set to the default (null)."),d.parent=null):(d.parent&&e.warn("setLiveTransformation","The value "+d.parent+" is not a valid input for the parent. It is set to the default (null)."),d.parent=null),d.easing?module$src$shared$util$GlobalUtils.default.typeCheck(d.easing,"string")?(d.easing=module$src$shared$util$GlobalUtils.default.getAtPath(module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing,d.easing),d.easing||(e.warn("setLiveTransformation","The value "+d.easing+" is not a valid input for the easing. It is set to the default (Linear.None)."),d.easing=module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Linear.None)):module$src$shared$util$GlobalUtils.default.typeCheck(d.easing,"function")||d.easing||(e.warn("setLiveTransformation","The value "+d.easing+" is not a valid input for the easing. It is set to the default (Linear.None)."),d.easing=module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Linear.None):d.easing=module$node_modules$$tweenjs$tween_js$src$Tween.default.Easing.Linear.None,module$src$shared$util$GlobalUtils.default.typeCheck(d.pivot,"vector3any")||(d.pivot&&e.warn("setLiveTransformation","The value "+d.pivot+" is not a valid input for the pivot. It is set to the default (null)."),d.pivot=null),!module$src$shared$util$GlobalUtils.default.typeCheck(d.rotationAxis,"vector3any")&&d.type===n.LIVETRANSFORMATIONTYPE.ROTATION)return(0,module$src$api$v2$ApiResponse.default)("No valid rotationAxis provided for at least one of the live transformations with type ROTATION.");if(!module$src$shared$util$GlobalUtils.default.typeCheck(d.rotationDegree,"number")&&d.type===n.LIVETRANSFORMATIONTYPE.ROTATION)return(0,module$src$api$v2$ApiResponse.default)("No valid rotationDegree provided for at least one of the live transformations with type ROTATION.");if(!module$src$shared$util$GlobalUtils.default.typeCheck(d.scalingVector,"vector3any")&&d.type===n.LIVETRANSFORMATIONTYPE.SCALING)return(0,module$src$api$v2$ApiResponse.default)("No valid scalingVector provided for at least one of the live transformations with type SCALING.");if(!module$src$shared$util$GlobalUtils.default.typeCheck(d.translationVector,"vector3any")&&d.type===n.LIVETRANSFORMATIONTYPE.TRANSLATION)return(0,module$src$api$v2$ApiResponse.default)("No valid translationVector provided for at least one of the live transformations with type TRANSLATION.")}module$src$shared$util$GlobalUtils.default.typeCheck(s.reset,"boolean")||(s.reset&&e.warn("setLiveTransformation","The value "+s.reset+" is not a valid input for the reset. It is set to the default (true)."),s.reset=!0)}for(r=[],s={},c=0,u=i.length;c<u;s={stops:s.stops},c++){d=[],s.stops=[];var p=[],h=i[c].setLiveTransformation(t,o),m=0;for(l=h.length;m<l;m++)d.push({stop:h[m].stop,promise:h[m].promise}),s.stops.push(h[m].stop),p.push(h[m].promise);r.push({responses:d,stop:function(e){return function(t){for(var n=0,r=e.stops.length;n<r;n++)e.stops[n](t)}}(s),promise:Promise.all(p)})}return(0,module$src$api$v2$ApiResponse.default)(null,1===r.length?r[0]:r)},this.getScreenshot=function(){for(var t=[],n=e.viewports.get(),r=0,o=n.length;r<o;r++)t.push(n[r].getScreenshot());return 1===t.length?t[0]:t},this.updateSelected=function(e,t){var r=o.getDefaultThreeDManagers();if(0===r.length)return n.error("ApiImplementationV2.updateSelected","There is no default viewport defined. This function is therefore not available."),null;for(var a=[],i=0,s=r.length;i<s;i++)a.push(r[i].interactionHandler.setSelectedPaths(e,t));return 1===a.length&&(a=a[0]),a},this.getSelected=function(){var e=o.getDefaultThreeDManagers();if(0===e.length)return n.error("ApiImplementationV2.getSelected","There is no default viewport defined. This function is therefore not available."),null;for(var t=[],r=0,a=e.length;r<a;r++)t.push(e[r].interactionHandler.getSelectedPaths());return 1===t.length&&(t=t[0]),t},this.removeAsync=function(t,o,a){o=o||e.getRuntimeId();var i=n.get(t,o,!0);if(i.payload=a,i.err)return i;t=[];for(var s=$jscomp.makeIterator(i.data),l=s.next();!l.done;l=s.next())t.push(l.value.id);return r.removeOutputIds(o,t).then((function(){return(0,module$src$api$v2$ApiResponse.default)(null,i.data,a)}),(function(e){return Promise.resolve((0,module$src$api$v2$ApiResponse.default)(e,null,a))}))},this.updatePersistentAsync=function(t,n,o){Array.isArray(t)||(t=[t]),n=n||e.getRuntimeId();for(var a=[],i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){if(void 0===(i=i.value)||"object"!=typeof i)return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Unexpected asset format",null,o));if(!i.hasOwnProperty("id"))return Promise.resolve((0,module$src$api$v2$ApiResponse.default)('Asset does not have "id" attribute.',null,o));a.push(r.setPersistentAttributes(i.id,n,i))}return Promise.all(a).then((function(e){return(0,module$src$api$v2$ApiResponse.default)(null,e,o)})).catch((function(e){return Promise.resolve((0,module$src$api$v2$ApiResponse.default)(e,null,o))}))},this.getPersistent=function(t,o){o=o||e.getRuntimeId();var a=n.get(t,o,!1);if(a.err)return a;t=[];for(var i=(a=$jscomp.makeIterator(a.data)).next();!i.done;i=a.next())(i=r.getPersistentAttributes(i.value.id,o))&&t.push(i);return(0,module$src$api$v2$ApiResponse.default)(null,t)},this.updateInteractionGroups=function(e){Array.isArray(e)||(e=[e]);for(var t={},n=(e=$jscomp.makeIterator(e)).next();!n.done;t={g:t.g,group:t.group},n=e.next()){if(t.group=n.value,!t.group||!t.group.id)return(0,module$src$api$v2$ApiResponse.default)("Interaction group without id property");if(t.g={},["hoverable","selectable","draggable"].forEach(function(e){return function(t){e.g[t]=e.group[t]||!1}}(t)),t.group.selectionMode&&(t.g.selectionMode=t.group.selectionMode),t.g.name=t.group.id,n=function(e){var t,n=["active","passive"];for(t in n)if(n=e[t]){if("object"!=typeof n)return"Effect has invalid type. Should be object.";if(!n.name)return"Effect has no name property.";if(-1==["colorHighlight","opacityHighlight"].indexOf(n.name))return"Invalid effect type name."}},t.g.hoverable&&t.group.hoverEffect){var r=n(t.group.hoverEffect);if(r)return(0,module$src$api$v2$ApiResponse.default)(r);t.g.hoverableHighlight=t.group.hoverEffect}if(t.g.selectable&&t.group.selectionEffect){if(r=n(t.group.selectionEffect))return(0,module$src$api$v2$ApiResponse.default)(r);t.g.selectableHighlight=t.group.selectionEffect}if(t.g.draggable&&t.group.dragEffect){if(n=n(t.group.dragEffect))return(0,module$src$api$v2$ApiResponse.default)(n);t.g.draggableHighlight=t.group.dragEffect}i.isInteractionGroup(t.g.name)&&(n=i.getGroup(t.g.name),t.g.hasOwnProperty("hoverable")||(t.g.hoverable=n.isHoverable()),t.g.hasOwnProperty("selectable")||(t.g.selectable=n.isSelectable()),t.g.hasOwnProperty("selectionMode")||(t.g.selectionMode=n.getSelectionMode()),t.g.hasOwnProperty("draggable")||(t.g.draggable=n.isDraggable()),t.g.hasOwnProperty("hoverEffect")||(t.g.hoverEffect=n.getHoverableHighlight()),t.g.hasOwnProperty("selectionEffect")||(t.g.selectionEffect=n.getSelectableHighlight()),t.g.hasOwnProperty("dragEffect")||(t.g.dragEffect=n.getDraggableHighlight())),i.addOrReplaceInteractionGroup(t.g)}return(0,module$src$api$v2$ApiResponse.default)(null,!0)},this.getInteractionGroups=function(){for(var e=i.getGroups(),t=[],n={},r=(e=$jscomp.makeIterator(e)).next();!r.done;n={g:n.g},r=e.next())r=r.value,n.g={},n.g.id=r.getName(),n.g.hoverable=r.isHoverable(),n.g.selectable=r.isSelectable(),n.g.selectionMode=r.getSelectionMode(),n.g.draggable=r.isDraggable(),n.g.hoverEffect=r.getHoverableHighlight(),n.g.selectionEffect=r.getSelectableHighlight(),n.g.dragEffect=r.getDraggableHighlight(),["dragEffect","hoverEffect","selectionEffect"].forEach(function(e){return function(t){if(e.g[t]){var n=e.g[t],r={};["active","passive"].forEach((function(e){if(n[e]&&(r[e]={name:n[e].name},n[e].options&&(r[e].options={},r[e].options.opacity&&(r[e].options.opacity=n[e].options.opacity),n[e].options.color))){var t=n[e].options.color;["r","g","b"].every((function(e){return t.hasOwnProperty(e)}))&&(r[e].options.color=[255*t.r,255*t.g,255*t.b])}})),e.g[t]=r}}}(n)),t.push(n.g);return(0,module$src$api$v2$ApiResponse.default)(null,t)},this.addEventListener=function(t,r){if(!module$src$shared$util$GlobalUtils.default.typeCheck(t,"string")||0>=t.length)return(0,module$src$api$v2$ApiResponse.default)("Event type must be a string");var o;if(!Object.keys(n.EVENTTYPE).find((function(e){return!!t.startsWith(e=n.EVENTTYPE[e])&&(o=e,!0)})))return(0,module$src$api$v2$ApiResponse.default)("Unsupported event type");var a=e.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE+"."+t,(function(e,t){(e=new CustomEvent(o)).api=t.api,t.token&&(e.token=t.token);var n={};for(var a in n[module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_INTERACTION]=null,n[module$src$shared$constants$MessagingConstants.default.messageDataTypes.GENERIC]=null,n[module$src$shared$constants$MessagingConstants.default.messageDataTypes.SCENE_ANCHORDATA]=null,n[module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_UPDATE]={assets:1},n){var i=t.getUniquePartByType(a);if(i){i.data&&(i=i.data);var s,l=n[a]?n[a]:i;for(s in l)e[s]=i[s]}}r(e)}));return(0,module$src$api$v2$ApiResponse.default)(null,a)},this.removeEventListener=function(t){return(0,module$src$api$v2$ApiResponse.default)(null,e.unsubscribeFromMessageStream(t))},this.render=function(){o.render()},this.startContinuousRendering=function(){o.containsContinuousRendering("api_render")||o.registerForContinuousRendering("api_render")},this.stopContinuousRendering=function(){o.unregisterForContinuousRendering("api_render")},this.pause=function(){for(var e=o.getApis(),t=0,n=e.length;t<n;t++)e[t].pause()},this.resume=function(){for(var e=o.getApis(),t=0,n=e.length;t<n;t++)e[t].resume();o.render()},this.toggleGeometry=function(e,t){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&(e=[e]),module$src$shared$util$GlobalUtils.default.typeCheck(t,"string")&&(t=[t]),Array.isArray(e)&&Array.isArray(t)&&e.every((function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")}))&&t.every((function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")}))?(a.toggleGeometry(e,t),(0,module$src$api$v2$ApiResponse.default)(null,!0)):(0,module$src$api$v2$ApiResponse.default)("The provided input is not valid")}},ParameterApi$$module$src$api$v2$ApiImplementationV2_1=function(e,t){var n=this;this.RESULT=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.parameters.RESULT,this.TYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.parameters.TYPE,this.VISUALIZATION=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.parameters.VISUALIZATION,this.EVENTTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.parameters.EVENTTYPE;var r=t.parameterHandler;this.get=function(e){return(e=r.getParameterDefinitionsAndValues(e))?(0,module$src$api$v2$ApiResponse.default)(null,e):(0,module$src$api$v2$ApiResponse.default)("Failed to get parameter definitions")};var o=function(e){return!(!e||"object"!=typeof e||!(module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")||module$src$shared$util$GlobalUtils.default.typeCheck(e.idOrName,"string")||module$src$shared$util$GlobalUtils.default.typeCheck(e.name,"string"))||e.plugin&&!module$src$shared$util$GlobalUtils.default.typeCheck(e.plugin,"string")||void 0===e.value)};this.updateAsync=function(t,n){Array.isArray(t)||(t=[t]);for(var a=$jscomp.makeIterator(t),i=a.next();!i.done;i=a.next())if(!o(i.value))return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Invalid input, expecting array of ParameterUpdateObject.",null,n));var s=module$src$shared$util$GlobalUtils.default.deepCopy(t);for(a=0,i=t.length;a<i;a++)t[a].value instanceof Blob&&(s[a].value=t[a].value);var l=module$src$shared$constants$MessagingConstants.default.makeMessageToken();return l.payload=n,new Promise((function(t){var o=function(){var o=e.setProcessCallback(l.id,(function(r,a){if(a.hasOwnProperty("parts"))for(a=(r=$jscomp.makeIterator(a.parts)).next();!a.done;a=r.next()){if((a=a.value).type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS){e.clearProcessCallback(o),t((0,module$src$api$v2$ApiResponse.default)(null,s,n));break}if(a.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT){e.clearProcessCallback(o),t((0,module$src$api$v2$ApiResponse.default)(a.data,null,n));break}if(a.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR){e.clearProcessCallback(o),t((0,module$src$api$v2$ApiResponse.default)(a.data,null,n));break}}})),a=r.setMultipleParameterValues(s,l);if(a.err)e.error("ApiImplementationV2.ParameterApi.updateAsync","_parameterHandler.setMultipleParameterValues returned error",a),e.clearProcessCallback(o),t((0,module$src$api$v2$ApiResponse.default)({m:"Failed to set parameter values",d:a},null,n));else{a.warn&&e.warn("ApiImplementationV2.ParameterApi.updateAsync","_parameterHandler.setMultipleParameterValues returned warning",a);for(var i={},u=(a=$jscomp.makeIterator(a.params)).next();!u.done;i={p:i.p},u=a.next())i.p=u.value,s.find(function(e){return function(t){return t.id===e.p.id&&t.plugin===e.p.plugin}}(i)).result=i.p.result}},a=r.updateRequiresPriorUpload(s);void 0===a?t((0,module$src$api$v2$ApiResponse.default)("Parameter not found",null,n)):!1===a?o():r.priorUpload(s).then((function(r){r.err?(e.error("ApiImplementationV2.ParameterApi.updateAsync","_parameterHandler.priorUpload returned error",r),t((0,module$src$api$v2$ApiResponse.default)({m:"Failed to upload blobs",d:r},null,n))):o()}),(function(r){e.error("ApiImplementationV2.ParameterApi.updateAsync","_parameterHandler.priorUpload failed",r),t((0,module$src$api$v2$ApiResponse.default)({m:"Failed to upload blobs",d:r},null,n))}))}))},this.canGoBackInHistory=function(){return r.canGoBackInHistory()},this.canGoForwardInHistory=function(){return r.canGoForwardInHistory()},this.goBackInHistoryAsync=function(t){var n=module$src$shared$constants$MessagingConstants.default.makeMessageToken();return n.payload=t,new Promise((function(o){var a=e.setProcessCallback(n.id,(function(n,i){if(i.hasOwnProperty("parts"))for(i=(n=$jscomp.makeIterator(i.parts)).next();!i.done;i=n.next()){if((i=i.value).type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS){e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)(null,r.getParameterState(),t));break}if(i.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT){e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)(i.data,null,t));break}if(i.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR){e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)(i.data,null,t));break}}}));r.goBackInHistory(n)||(e.error("ApiImplementationV2.goBackInHistoryAsync","_parameterHandler.goBackInHistory returned false"),e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)("Failed to go back in history",null,t)))}))},this.goForwardInHistoryAsync=function(t){var n=module$src$shared$constants$MessagingConstants.default.makeMessageToken();return n.payload=t,new Promise((function(o){var a=e.setProcessCallback(n.id,(function(n,i){if(i.hasOwnProperty("parts"))for(i=(n=$jscomp.makeIterator(i.parts)).next();!i.done;i=n.next()){if((i=i.value).type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS){e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)(null,r.getParameterState(),t));break}if(i.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT){e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)(i.data,null,t));break}if(i.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR){e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)(i.data,null,t));break}}}));r.goForwardInHistory(n)||(e.error("ApiImplementationV2.goForwardInHistoryAsync","_parameterHandler.goForwardInHistory returned false"),e.clearProcessCallback(a),o((0,module$src$api$v2$ApiResponse.default)("Failed to go forward in history",null,t)))}))},this.updateProperties=function(e){return(0,module$src$api$v2$ApiResponse.default)(null,r.updateMultipleParameters(e))},this.addEventListener=function(t,r){if(!Object.keys(n.EVENTTYPE).find((function(e){return n.EVENTTYPE[e]===t})))return(0,module$src$api$v2$ApiResponse.default)("Unsupported event type");var o=e.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER+"."+t,(function(e,n){(e=new CustomEvent(t)).api=n.api,n.token&&(e.token=n.token),e.parameter={};var o={};for(var a in o[module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_DEFINITION]=null,o[module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_UPDATE]=null,o){var i=n.getUniquePartByType(a);if(i){i.data&&(i=i.data);var s,l=o[a]?o[a]:i;for(s in l)e.parameter[s]=i[s]}}r(e)}));return(0,module$src$api$v2$ApiResponse.default)(null,o)},this.removeEventListener=function(t){return(0,module$src$api$v2$ApiResponse.default)(null,e.unsubscribeFromMessageStream(t))}},ExportApi$$module$src$api$v2$ApiImplementationV2_1=function(e,t){var n=this;this.RESULT=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.exports.RESULT,this.EVENTTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.exports.EVENTTYPE;var r=t.exportHandler;this.get=function(){return(0,module$src$api$v2$ApiResponse.default)(null,r.getExportDefinitions())},this.requestAsync=function(t,n){if(!function(e){return!(!e||"object"!=typeof e||!(module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")||module$src$shared$util$GlobalUtils.default.typeCheck(e.idOrName,"string")||module$src$shared$util$GlobalUtils.default.typeCheck(e.name,"string"))||e.plugin&&"string"!=typeof e.plugin)}(t))return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Invalid input, expecting an ExportRequestObject.",null,n));var o=r.getUniqueExportByRequestObject(t);if(void 0===o)return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Invalid input, ExportRequestObject did not match a unique export definition.",null,n));var a=module$src$shared$constants$MessagingConstants.default.makeMessageToken();return a.payload=n,t.silent&&(a.attributes={silent:!0}),new Promise((function(t){var i=e.setProcessCallback(a.id,(function(r,a){if(a.hasOwnProperty("parts"))for(a=(r=$jscomp.makeIterator(a.parts)).next();!a.done;a=r.next()){if((a=a.value).type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_RESULT){module$src$shared$util$GlobalUtils.default.defaults(o,a.data,!0),e.clearProcessCallback(i),t((0,module$src$api$v2$ApiResponse.default)(null,o,n));break}if(a.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT){e.clearProcessCallback(i),t((0,module$src$api$v2$ApiResponse.default)(a.data,null,n));break}if(a.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR){e.clearProcessCallback(i),t((0,module$src$api$v2$ApiResponse.default)(a.data,null,n));break}}})),s=r.requestExport(o,a);o.resultcode=s,s!==module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults.CACHE&&s!==module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults.LOAD&&(e.error("ApiImplementationV2.ExportApi.requestAsync","_exportHandler.requestExport returned error",s),e.clearProcessCallback(i),t((0,module$src$api$v2$ApiResponse.default)({m:"Failed to request export",d:s},o,n)))}))},this.updateProperties=function(e){return(0,module$src$api$v2$ApiResponse.default)(null,r.updateMultipleExports(e))},this.addEventListener=function(t,r){if(!Object.keys(n.EVENTTYPE).find((function(e){return n.EVENTTYPE[e]===t})))return(0,module$src$api$v2$ApiResponse.default)("Unsupported event type");var o=e.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT+"."+t,(function(e,n){(e=new CustomEvent(t)).api=n.api,n.token&&(e.token=n.token),e.export={};var o={};for(var a in o[module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_DEFINITION]=null,o[module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_RESULT]=null,o[module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_STATUS]=null,o){var i=n.getUniquePartByType(a);if(i){i.data&&(i=i.data);var s,l=o[a]?o[a]:i;for(s in l)e.export[s]=i[s]}}r(e)}));return(0,module$src$api$v2$ApiResponse.default)(null,o)},this.removeEventListener=function(t){return(0,module$src$api$v2$ApiResponse.default)(null,e.unsubscribeFromMessageStream(t))}},PluginApi$$module$src$api$v2$ApiImplementationV2_1=function(e,t){var n=this;this.STATUS=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.plugins.STATUS;var r=t.pluginHandler,o=t.messagingHandler,a=t.parameterHandler;this.get=function(){return(0,module$src$api$v2$ApiResponse.default)(null,r.getStatusDescription())},this.registerPluginAsync=function(e){return new Promise((function(t){try{var n=e.getRuntimeId(),a=[],i=function(r,i){(r=i.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PLUGIN_RUNTIME_ID))&&r.data===n&&(a.forEach((function(e){o.unsubscribeFromMessageStream(e)})),t((0,module$src$api$v2$ApiResponse.default)(null,e.getStatusDescription())))};a.push(o.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.PLUGIN_ACTIVE,i)),a.push(o.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.PLUGIN_FAILED,i)),void 0===r.registerPlugin(e)&&(a.forEach((function(e){o.unsubscribeFromMessageStream(e)})),t((0,module$src$api$v2$ApiResponse.default)("Failed to register plugin.",e.getStatusDescription())))}catch(s){t((0,module$src$api$v2$ApiResponse.default)(s))}}))},this.registerCommPluginAsync=function(e){return e=new module$src$plugins$comm$CommPlugin.default(e),n.registerPluginAsync(e)},this.refreshPluginAsync=function(t,n){var r=module$src$shared$constants$MessagingConstants.default.makeMessageToken();return r.payload=n,new Promise((function(o){var i=e.setProcessCallback(r.id,(function(t,r){if(r.hasOwnProperty("parts"))for(r=(t=$jscomp.makeIterator(r.parts)).next();!r.done;r=t.next()){if((r=r.value).type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS){e.clearProcessCallback(i),o((0,module$src$api$v2$ApiResponse.default)(null,a.getParameterState(),n));break}if(r.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT){e.clearProcessCallback(i),o((0,module$src$api$v2$ApiResponse.default)(r.data,null,n));break}if(r.type==module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR){e.clearProcessCallback(i),o((0,module$src$api$v2$ApiResponse.default)(r.data,null,n));break}}}));a.refreshPlugin(t,r).err&&(e.error("ApiImplementationV2.refreshPluginAsync","_parameterHandler.refreshPlugin failed"),e.clearProcessCallback(i),o((0,module$src$api$v2$ApiResponse.default)("Failed to refresh plugin "+t,null,n)))}))},this.saveDefaultParameterValuesAsync=function(e){e||(e=r.getRuntimeIds()),Array.isArray(e)||(e=[e]);for(var t=[],n=0,o=e.length;n<o;n++){var i=e[n],s=r.getPluginByRuntimeId(i);s&&s.getCapabilities().includes(module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.DEFAULTPARAM)?(i=a.getParameterValuesForPlugin(i,!0),t.push(s.saveDefaultParameterValues(i))):t.push(Promise.resolve(!1))}return Promise.all(t).then((function(e){return(0,module$src$api$v2$ApiResponse.default)(null,e.every((function(e){return e})))}),(function(e){return(0,module$src$api$v2$ApiResponse.default)(e,!1)}))},this.deregisterPluginAsync=function(){return Promise.reject("not implemented yet")}},ApiViewportsInterface$$module$src$api$v2$ApiImplementationV2_1=function(e,t){var n=t.viewportManager;this.TYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.viewports.TYPE,this.EVENTTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.viewports.EVENTTYPE,this.get=function(e){return e?module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")?n.getApi(e):(0,module$src$api$v2$ApiResponse.default)("The provided input is not a valid runtimeId"):n.getApis()},this.create=function(e){return n.createThreeDManager(e)[0]},this.destroy=function(e){if(!(e=this.get(e)))return(0,module$src$api$v2$ApiResponse.default)("The viewport with this runtime Id was not found.");if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)e[t].destroy();return!0}return e.destroy()}};module$src$api$v2$ApiImplementationV2_1.default=function(e,t){var n=this,r=module$src$shared$util$GlobalUtils.default.deepCopy(t);r.runtimeId&&module$src$shared$util$GlobalUtils.default.typeCheck(r.runtimeId,"string")||(r.runtimeId=module$src$shared$util$GlobalUtils.default.createRandomId()),this.EVENTTYPE=ApiInterfaceV2$$module$src$api$v2$ApiImplementationV2_1.EVENTTYPE,this.getRuntimeId=function(){return r.runtimeId},t=e.app;var o=e.exportHandler,a=e.messagingHandler,i=e.parameterHandler,s=e.pluginHandler,l=e.processStatusHandler,u=e.sceneManager,c=e.settingsHandler,d=e.viewportManager,p=e.sceneGeometryManager,h=e.interactionGroupManager,m=e.arApi,f=/^scene\./;module$src$shared$util$GlobalUtils.default.inject(e.loggingHandler,n);var g={};this.clearProcessCallback=function(e){return!!g.hasOwnProperty(e)&&(a.unsubscribeFromMessageStream(g[e].subToken),delete g[e],!0)},this.setProcessCallback=function(e,t){if(!g.hasOwnProperty(e)){var r=a.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS+"."+e,(function(r,o){var a=r.substring(r.indexOf(".")+1);if(g.hasOwnProperty(e)){var i=g[e],s=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_FORK);if(s&&Array.isArray(s.data)){if(s.data.every((function(t){return t.startsWith(e+".")}))){var l=i.procTokens;l=(l=l.splice(l.indexOf(a),1)).concat(s.data),i.procTokens=l}else n.error("ApiImplementationV2.setProcessCallback","Forked process token must be a sub-token of "+e);try{t(r,o)}catch(c){n.error("ApiImplementationV2.setProcessCallback","Exception in process callback:",c)}}else{s=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR),l=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT);var u=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS);s?i.procTokenStat[a]=module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR:l?i.procTokenStat[a]=module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT:u&&(i.procTokenStat[a]=module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS),i.procTokens.every((function(e){return i.procTokenStat.hasOwnProperty(e)}))&&(n.debug("ApiImplementationV2.setProcessCallback","Clearing process callback for token "+e),n.clearProcessCallback(e));try{t(r,o)}catch(c){n.error("ApiImplementationV2.setProcessCallback","Exception in process callback:",c)}}}else n.warn("ApiImplementationV2.setProcessCallback","Message for unknown token:",o)}));return g[e]={subToken:r,procTokens:[e],procTokenStat:{}},e}},this.subscribeToMessageStream=function(e,t){return a.subscribeToMessageStream(e,(function(e,r){try{(r=r||{}).api=n,t(e,r)}catch(o){n.warn("ApiImplementationV2.subscribeToMessageStream","Exception in callback for topic "+e,o,r)}}))},this.unsubscribeFromMessageStream=function(e){return a.unsubscribeFromMessageStream(e)},this.state=new StateApi$$module$src$api$v2$ApiImplementationV2_1(n,{processStatusHandler:l,messagingHandler:a}),this.parameters=new ParameterApi$$module$src$api$v2$ApiImplementationV2_1(n,{parameterHandler:i,messagingHandler:a}),this.plugins=new PluginApi$$module$src$api$v2$ApiImplementationV2_1(n,{pluginHandler:s,messagingHandler:a,parameterHandler:i}),this.exports=new ExportApi$$module$src$api$v2$ApiImplementationV2_1(n,{exportHandler:o}),this.viewports=new ApiViewportsInterface$$module$src$api$v2$ApiImplementationV2_1(n,{viewportManager:d}),this.scene=new SceneApi$$module$src$api$v2$ApiImplementationV2_1(n,{sceneManager:u,viewportManager:d,sceneGeometryManager:p,interactionGroupManager:h,messagingHandler:a});var $={};$["defaultMaterial.color"]={handler:t,namespace:"app",setting:"defaultMaterial.color",desc:"Color of the default material",type:function(e){return!!module$src$shared$util$GlobalUtils.default.typeCheck(e,"color")}},$["defaultMaterial.bumpAmplitude"]={handler:t,namespace:"app",setting:"defaultMaterial.bumpAmplitude",desc:"Bump amplitude of the default material",type:"notnegative"},$["defaultMaterial.metalness"]={handler:t,namespace:"app",setting:"defaultMaterial.metalness",desc:"Metalness of the default material",type:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"number")&&0<=e&&1>=e}},$["defaultMaterial.roughness"]={handler:t,namespace:"app",setting:"defaultMaterial.roughness",desc:"Roughness of the default material",type:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"number")&&0<=e&&1>=e}},$.ignoreSuperseded={handler:t,namespace:"app",setting:"ignoreSuperseded",desc:"Ignore intermediate solutions which at the time of their arrival have already been superseded by another customization request",type:"boolean"},$.blurSceneWhenBusy={handler:t,namespace:"app",setting:"blurSceneWhenBusy",desc:"Blur or don't blur the scene while a process is busy",type:"boolean"},$.hasRestoredSettings={handler:t,namespace:"app",setting:"hasRestoredSettings",desc:"True if settings have been restored from a settings object delivered by a CommPlugin",type:function(){return!1}},$.loggingLevel={handler:t,namespace:"app",setting:"loggingLevel",desc:"Level of log messages shown on the console, allowed values: -1 (none), 0 (error), 1 (warn), 2 (info), 3 (debug)",type:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"number")&&-1<=e&&3>=e}},$.messageLoggingLevel={handler:t,namespace:"app",setting:"messageLoggingLevel",desc:"Log level to be used for logging internal messages, allowed values: -1 (none), 0 (error), 1 (warn), 2 (info), 3 (debug)",type:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"number")&&-1<=e&&3>=e}},$["scene.show"]={handler:t,namespace:"app",setting:"showScene",desc:"Show / hide the scene",type:"boolean"},$.showMessages={handler:t,namespace:"app",setting:"showMessages",desc:"Show or don't show user messages in the viewport",type:"boolean"},$.commitParameters={handler:t,namespace:"app",setting:"commitParameters",desc:"Use or don't commit mode for parameters",type:"boolean"},$.commitSettings={handler:t,namespace:"app",setting:"commitSettings",desc:"Use or don't commit mode for settings",type:"boolean"},$["ar.enableCameraSync"]={handler:t,namespace:"app",setting:"ar.enableCameraSync",desc:"Enable / disable synchronisation of the camera with AR tracking information. Enabling this will disable the orbit controls.",tyoe:"boolean"},$["ar.enableLightingEstimation"]={handler:t,namespace:"app",setting:"ar.enableLightingEstimation",desc:"Enable / disable automatic lighting estimation. Enabling this stores the current state of the lights which will get restored once automatic lighting estimation gets disabled again.",tyoe:"boolean"},$["ar.enableTouchControls"]={handler:t,namespace:"app",setting:"ar.enableTouchControls",desc:"Enable / disable touch controls for placement of objects in the AR scene while AR camera synchronisation is enabled.",tyoe:"boolean"},$["ar.enableTouchControlRotation"]={handler:t,namespace:"app",setting:"ar.enableTouchControlRotation",desc:"Enable / disable rotation of objects in the AR scene by means of touch controls. Typically this should be enabled for objects to be placed horizontally.",tyoe:"boolean"},$["ar.enableAutomaticPlacement"]={handler:t,namespace:"app",setting:"ar.enableAutomaticPlacement",desc:"Enable / disable initial automatic placement of objects in the AR scene as soon as plane anchors get detected. Automatic placement stops once the user starts to interact.",tyoe:"boolean"},$["ar.defaultHitTestType"]={handler:t,namespace:"app",setting:"ar.defaultHitTestType",desc:"Default type of feature to use for hit tests, used by touch controls. ",tyoe:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&"featurePoint estimatedHorizontalPlane estimatedVerticalPlane existingPlane existingPlaneUsingExtent existingPlaneUsingGeometry".split(" ").contains(e)}},this.addEventListener=function(e,t){if(!Object.keys(n.EVENTTYPE).find((function(t){return n.EVENTTYPE[t]===e})))return(0,module$src$api$v2$ApiResponse.default)("Unsupported event type");var r=n.subscribeToMessageStream(e,(function(r,o){(r=new CustomEvent(e)).api=o.api,o.token&&(r.token=o.token),r.settings={};var a=r.settings;if(o=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.SETTINGS_UPDATE)){o.data&&(o=o.data);for(var i=d.getApis(),s=0,l=i.length;s<l;s++){var u=i[s];if(u&&o.namespace===u.getRuntimeId()){a.key=o.key,a.runtimeId=o.namespace,a.namespace="scene";break}for(var c in $)if((u=$[c]).namespace===o.namespace&&u.setting===o.key){a.key=c,a.runtimeId=n.getRuntimeId();break}}a.key&&(a.valueNew=o.valueNew,a.valueOld=o.valueOld,t(r))}}));return(0,module$src$api$v2$ApiResponse.default)(null,r)},this.removeEventListener=function(e){return(0,module$src$api$v2$ApiResponse.default)(null,n.unsubscribeFromMessageStream(e))},this.getSettingDefinitions=function(){var e={};Object.keys($).forEach((function(t){var n=$[t],r={description:n.desc};n.type&&(r.type=n.type),n=module$src$shared$util$GlobalUtils.default.deepCopy(r),e[t]=n}));for(var t=[],n=d.getApis(),r=0,o=n.length;r<o;r++){var a=n[r];if(a){a=a.getSettingDefinitions();var i,s={};for(i in a)s["scene."+i]=a[i];t.push(Object.assign({},e,s))}}return 1===t.length&&(t=t[0]),t},this.getSettings=function(e){var t=d.getApis();if(!Array.isArray(e)){e=Object.keys(n.getSettingDefinitions());for(var r=0,o=t.length;r<o;r++)for(var a=Object.keys(t[r].getSettingDefinitions()),i=0,s=a.length;i<s;i++){var l="scene."+a[i];e.includes(l)||e.push(l)}}if(r=[],0===t.length){var u={};e.forEach((function(e){var t=$[e];void 0!==t&&(t=t.handler.getSetting(t.setting),module$src$shared$util$GlobalUtils.default.forceAtPath(u,e,t))})),r.push(u)}else for(a={},i=0,o=t.length;i<o;a={settings$311:a.settings$311,viewportApi$310:a.viewportApi$310},i++)a.viewportApi$310=t[i],a.settings$311={},e.forEach(function(e){return function(t){var n=$[t];void 0!==n?(n=n.handler.getSetting(n.setting),module$src$shared$util$GlobalUtils.default.forceAtPath(e.settings$311,t,n)):e.viewportApi$310&&void 0!==(n=e.viewportApi$310.getSetting(t.replace(f,"")))&&module$src$shared$util$GlobalUtils.default.forceAtPath(e.settings$311,t,n)}}(a)),r.push(a.settings$311);return 1===r.length&&(r=r[0]),r},this.getSetting=function(e){var t=$[e];if(void 0===t){t=[];for(var n=d.getApis(),r=0,o=n.length;r<o;r++)t.push(n[r].getSetting(e.replace(f,"")));if(0===t.length)return;return 1===t.length&&(t=t[0]),t}return t.handler.getSetting(t.setting)},this.updateSettingAsync=function(e,t){var n=$[e];if(void 0===n){n=[];for(var r=d.getApis(),o=0,a=r.length;o<a;o++)n.push(r[o].updateSettingAsync(e.replace(f,""),t));return 0===n.length?Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Setting does not exist",!1)):(1===n.length&&(n=n[0]),n)}if(null!=n.type)if(module$src$shared$util$GlobalUtils.default.typeCheck(n.type,"string")){if(module$src$shared$util$GlobalUtils.default.typeCheck(t,"m.type"))return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Setting has wrong value type",!1))}else if("function"==typeof n.type&&!n.type(t))return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Setting has wrong value type",!1));return n.hasOwnProperty("transform")&&"function"==typeof n.transform&&(t=n.transform(t)),n.handler.updateSettingAsync(n.setting,t).then((function(e){return Promise.resolve(e?(0,module$src$api$v2$ApiResponse.default)(null,!0):(0,module$src$api$v2$ApiResponse.default)("Update of setting failed",!1))}),(function(){return Promise.resolve((0,module$src$api$v2$ApiResponse.default)("Update of setting failed",!1))}))},this.updateSettingsAsync=function(e){var t=[];module$src$shared$util$GlobalUtils.default.getPaths(e,t);for(var r={},o=Promise.resolve(),a={},i=(t=$jscomp.makeIterator(t)).next();!i.done;a={path:a.path},i=t.next())a.path=i.value,o=(o=o.then(function(t){return function(){return n.updateSettingAsync(t.path,module$src$shared$util$GlobalUtils.default.getAtPath(e,t.path))}}(a))).then(function(e){return function(t){module$src$shared$util$GlobalUtils.default.forceAtPath(r,e.path,!t.err)}}(a),function(e){return function(){module$src$shared$util$GlobalUtils.default.forceAtPath(r,e.path,!1)}}(a));return o.then((function(){return(0,module$src$api$v2$ApiResponse.default)(null,r)}))},this.createAsynchronousFunctions=function(){var e=function(t){var n,r={};for(n in t)r.key=n,t[r.key]instanceof Function?r.key.endsWith("Async")||r.key.endsWith("EventListener")||t[r.key+"Async"]||(t[r.key+"Async"]=function(e){return function(n){for(var r=[],o=0;o<arguments.length;++o)r[o-0]=arguments[o];return new Promise((function(n,o){n(t[e.key].call.apply(t[e.key],[t].concat($jscomp.arrayFromIterable(r))))}))}}(r)):-1<"state parameters plugins exports viewports scene camera lights".split(" ").indexOf(r.key)&&e(t[r.key]),r={key:r.key}};e(this)},this.saveSettingsAsync=function(e){return c.saveSettings(e).then((function(e){return(0,module$src$api$v2$ApiResponse.default)(null,e)}),(function(e){return(0,module$src$api$v2$ApiResponse.default)(e,!1)}))},m&&(this.ar=m),this.utils=module$src$shared$util$GlobalUtils.default,this.utils.APIResponse=module$src$api$v2$ApiResponse.default};var module$src$api$v1$ApiInterfaceV1={default:function(){this.STATUSCODE={READY:0,BUSY:1,INITIALIZING:2,ERROR:3},this.TYPE={FLOAT:"Float",INT:"Int",EVEN:"Even",ODD:"Odd",STRING:"String",COLOR:"Color",STRINGLIST:"StringList",BOOL:"Bool",TIME:"Time"},this.VISUALIZATION={SLIDER:"slider",SEQUENCE:"sequence",CYCLE:"cycle",DROPDOWN:"dropdown",CHECKLIST:"checklist",CLOCK:"clock",CALENDAR:"calendar"},this.activateTopView=function(){},this.addDraggableShape=function(){},this.cameraPath=function(){},this.changeEnvMap=function(){},this.clearMessagingCallback=function(){},this.clearProcessCallback=function(){},this.deregisterPlugin=function(){},this.disablePan=function(){},this.disableZoom=function(){},this.fadeInViewer=function(){},this.findTexturedGeometry=function(){},this.getApiVersion=function(){},this.getBackgroundColor=function(){},this.getCamera=function(){},this.getDraggableShapePosition=function(){},this.getExportDefinitions=function(){},this.getGeometryNames=function(){},this.getGeometryPathsByName=function(){},this.getModelData=function(){},this.getParameterDefinitions=function(){},this.getParameterValues=function(){},this.getScreenshot=function(){},this.getStatus=function(){},this.hideControls=function(){},this.hideFullscreenToggle=function(){},this.hideZoomToggle=function(){},this.loadStaticMesh=function(){},this.refreshPlugin=function(){},this.registerPlugin=function(){},this.removeDraggableShape=function(){},this.removeExternalTexture=function(){},this.removeStaticMesh=function(){},this.requestExport=function(){},this.requestSceneUpdate=function(){},this.resetCamera=function(){},this.restrictCamera=function(){},this.restrictPan=function(){},this.restrictZoom=function(){},this.setAutoRotate=function(){},this.setAutoRotation=function(){},this.setAutoRotationSpeed=function(){},this.setBackgroundColor=function(){},this.setBumpAmplitude=function(){},this.setBusyGraphic=function(){},this.setBusyGraphicPosition=function(){},this.setButtonColor=function(){},this.setCamera=function(){},this.setCommandResultCallback=function(){},this.setDefaultMaterialColor=function(){},this.setExternalTexture=function(){},this.setFOV=function(){},this.setPointSize=function(){},this.setToggleAmbientOcclusion=function(){},this.setToggleCastShadow=function(){},this.setControlDamping=function(){},this.setDamping=function(){},this.setEdgeColor=function(){},this.setEdgeColorByObject=function(){},this.setIgnoreMouse=function(){},this.setMessagingCallback=function(){},this.setParameterValue=function(){},this.setParameterValues=function(){},this.setProcessCallback=function(){},this.setRotateSpeed=function(){},this.setRotationSpeed=function(){},this.setZoomExtentFactor=function(){},this.setZoomSpeed=function(){},this.showControls=function(){},this.showEdges=function(){},this.showFullscreenToggle=function(){},this.showGrid=function(){},this.showGroundPlane=function(){},this.showShadows=function(){},this.showStaticMesh=function(){},this.showZoomToggle=function(){},this.toggleDisablePan=function(){},this.toggleDisableZoom=function(){},this.toggleFullscreen=function(){},this.toggleSceneBackground=function(){},this.toggleShadows=function(){},this.toggleTopView=function(){},this.zoomExt=function(){},this.zoomExtents=function(){}}},module$src$api$v1$ApiImplementationV1={},pluginConstants$$module$src$api$v1$ApiImplementationV1=module$src$shared$constants$PluginConstantsGlobal.default,messagingConstants$$module$src$api$v1$ApiImplementationV1=module$src$shared$constants$MessagingConstants.default,GlobalUtils$$module$src$api$v1$ApiImplementationV1=module$src$shared$util$GlobalUtils.default,threeDManagerConstants$$module$src$api$v1$ApiImplementationV1=module$src$3d$viewports$default$ThreeDManagerConstants.default,toTinyColor$$module$src$api$v1$ApiImplementationV1=module$src$shared$util$toTinyColor.default,ApiInterfaceV1$$module$src$api$v1$ApiImplementationV1=new module$src$api$v1$ApiInterfaceV1.default,THREE$$module$src$api$v1$ApiImplementationV1=module$src$externals$three.default;module$src$api$v1$ApiImplementationV1.default=function(e){var t=this,n=e.app,r=e.viewportVisibilityHandler,o=e.exportHandler,a=e.messagingHandler,i=e.parameterHandler,s=e.pluginHandler,l=e.processStatusHandler,u=e.sceneManager,c=e.threeDManager;module$src$shared$util$GlobalUtils.default.inject(e.loggingHandler,t);var d=n.api({version:2}),p=d.getRuntimeId();module$src$shared$mixins$GlobalMixin.default.call(this),this.STATUSCODE=ApiInterfaceV1$$module$src$api$v1$ApiImplementationV1.STATUSCODE,this.TYPE=ApiInterfaceV1$$module$src$api$v1$ApiImplementationV1.TYPE,this.VISUALIZATION=ApiInterfaceV1$$module$src$api$v1$ApiImplementationV1.VISUALIZATION;var h,m={},f=function(e,n){if("function"==typeof h)try{h(e,n)}catch(r){t.error("ApiImplementationV1._callCommandResultCallback","Exception in callback:",e,r)}return n};this._callCommandResultCallback=f;var g,$={},v=function(e){if(e.type===d.scene.EVENTTYPE.DRAG_START?x("ObjectDragStarted"):e.type===d.scene.EVENTTYPE.DRAG_END&&x("ObjectDragEnded"),e.dragPosAbs&&e.scenePath){var t=e.scenePath.split(".");$[t[1]]=e.dragPosAbs}},y=[],_=function(){if(0<Object.keys($).length){var e=d.scene.addEventListener(d.scene.EVENTTYPE.DRAG_START+"."+p,v);e.data&&y.push(e.data),(e=d.scene.addEventListener(d.scene.EVENTTYPE.DRAG_MOVE+"."+p,v)).data&&y.push(e.data),(e=d.scene.addEventListener(d.scene.EVENTTYPE.DRAG_END+"."+p,v)).data&&y.push(e.data)}else y.forEach((function(e){d.scene.removeEventListener(e)})),y=[]},b=[],x=function(e){if("function"==typeof g)try{g(e)}catch(n){t.error("ApiImplementationV1._sendExternalMsg","Exception in messaging callback ("+e+"):",n)}};this.activateTopView=function(e){return e=c.updateSetting("camera.type",e?module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.TOP:module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE),f("activateTopView",e)},this.addDraggableShape=function(e,n,r,o,a){if(!(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")&&module$src$shared$util$GlobalUtils.default.typeCheck(r,"notnegative")&&module$src$shared$util$GlobalUtils.default.typeCheck(o,"color")&&module$src$shared$util$GlobalUtils.default.typeCheck(a,"vector3obj")))return f("addDraggableShape",!1);var i,s=d.scene.get({id:e},p);return s.err||0<s.data.length?f("addDraggableShape",!1):("box"===n?i=new module$src$externals$three.default.BoxBufferGeometry(r,r,r):"sphere"===n?i=new module$src$externals$three.default.SphereBufferGeometry(.5*r,20,20):"dodecahedron"===n&&(i=new module$src$externals$three.default.DodecahedronBufferGeometry(.5*r)),void 0===i?f("addDraggableShape",!1):(!0!==(n=d.scene.updateInteractionGroups({id:p,draggable:!0,selectable:!1,hoverable:!1})).data?(t.error("ApiImplementationV1._createInteractionGroup","Could not add interaction group",n.err),n=!1):n=!0,n?(o=[{id:e,name:e,material:e+"_m",interactionGroup:p,content:[{format:"three",data:{threeObject:new module$src$externals$three.default.Mesh(i)},transformations:(new module$src$externals$three.default.Matrix4).makeTranslation(a.x,a.y,a.z)}]},{id:e+"_m",content:[{format:"material",data:{version:"3.0",color:o}}]}],d.scene.updateAsync(o,p),$[e]=module$src$shared$util$GlobalUtils.default.toVector3(a),_(),f("addDraggableShape",!0)):f("addDraggableShape",!1)))},this.cameraPath=function(e,t,n){if(e.length!==t.length||0>=e.length)return f("cameraPath",!1);var r={};return n&&(r.duration=n),c.cameraHandler.setCameraPath(e,t,r),f("cameraPath",!0)},this.changeEnvMap=function(e){return c.updateSettingAsync("material.environmentMap",e),!0},this.clearMessagingCallback=function(){b.forEach((function(e){a.unsubscribeFromMessageStream(e)})),b=[],g=void 0},this.clearProcessCallback=function(e){return!!m.hasOwnProperty(e)&&(a.unsubscribeFromMessageStream(m[e].subToken),delete m[e],!0)},this.deregisterPlugin=function(e){return s.deregisterPlugin(e)},this.disablePan=function(e){return c.getSetting("camera.enablePan")===!e?f("disablePan",!1):(e=c.updateSetting("camera.enablePan",!e),f("disablePan",e))},this.disableZoom=function(e){return c.getSetting("camera.enableZoom")===!e?f("disableZoom",!1):(e=c.updateSetting("camera.enableZoom",!e),f("disableZoom",e))},this.fadeInViewer=function(){return r.showScene(!0),!0},this.findTexturedGeometry=function(){var e,n,r=t.getGeometryNames(),o=[];for(e in r)for(n in r[e])o.push(n);return f("findTexturedGeometry",o)},this.getApiVersion=function(){return"1.0.0"},this.getBackgroundColor=function(){var e=c.getSetting("render.clearColor"),t=c.getSetting("render.clearAlpha");return(e=(0,module$src$shared$util$toTinyColor.default)(e)).setAlpha(t),e.toString("hex8")},this.getCamera=function(){var e=c.cameraHandler.getPositionAndTarget();return f("getCamera",e)},this.getDraggableShapePosition=function(e){return $.hasOwnProperty(e)?f("getDraggableShapePosition",$[e]):f("getDraggableShapePosition",!1)},this.getExportDefinitions=function(){var e=o.getExportDefinitions();f("getExportDefinitions",e)},this.getGeometryNames=function(e){return u.getGeometryNames(e)},this.getGeometryPathsByName=function(e,t){return u.getGeometryPathsByName(e,t)},this.getModelData=function(e){var t={};return u.getModelData(e).forEach((function(e){t[e.id]=e})),f("getModelData",t)},this.getParameterDefinitions=function(e){return e=i.getParameterDefinitions(e),f("getParameterDefinitions",e)},this.getParameterValues=function(){var e=i.getParameterValuesCompat();return f("getParameterValues",e)},this.getScreenshot=function(){var e=c.renderingHandler.getScreenshot();return f("getScreenshot",e)},this.getStatus=function(){var e=s.getStatusDescription();return e.every((function(e){return e.status!==module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.FAILED}))?e.every((function(e){return e.status===module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.ACTIVE}))?l.getSummary().busy?f("getStatus",e={statusCode:1,statusText:"Busy",statusInfo:"Viewer is processing a parameter update"}):f("getStatus",e={statusCode:0,statusText:"Ready",statusInfo:"Viewer is fully loaded, geometry is being displayed"}):f("getStatus",e={statusCode:2,statusText:"Initializing",statusInfo:"The viewer is still initializing"}):f("getStatus",e={statusCode:3,statusText:"Error",statusInfo:"At least one plugin failed"})},this.hideControls=function(){return t.error("ApiImplementationV1.hideControls","Requires UI"),f("hideControls",!1)},this.hideFullscreenToggle=function(){return t.error("ApiImplementationV1.hideFullscreenToggle","Requires UI"),!1},this.hideZoomToggle=function(){return t.error("ApiImplementationV1.hideZoomToggle","Requires UI"),!1},this.loadStaticMesh=function(e,t,n,r,o,a){if((4>arguments.length||!module$src$shared$util$GlobalUtils.default.typeCheck(r,"string")||0===r.length)&&(r=module$src$shared$util$GlobalUtils.default.createRandomId()),!module$src$shared$util$GlobalUtils.default.typeCheck(t,"string")||0===t.length)return!1;var i=d.scene.get({id:r},p);return!(i.err||0<i.data.length||(i=[{id:r,material:"material_1",version:"1",duration:0,content:[{format:"obj",data:{objUrl:t}}]}],module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")&&(i[0].content.data.mtlUrl=n),module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&(i[0].content.data.path=e),module$src$shared$util$GlobalUtils.default.typeCheck(o,"string")&&(i[0].content.data.texturePath=o),module$src$shared$util$GlobalUtils.default.typeCheck(a,"string")&&(i[0].content.data.side=a),d.scene.updateAsync(i,p).then((function(){x("LoadStaticMeshDone")})),0))},this.refreshPlugin=function(e,t){return t=module$src$shared$constants$MessagingConstants.default.makeMessageToken(t),!i.refreshPlugin(e,t).err},this.registerPlugin=function(e){return s.registerPlugin(e)},this.removeExternalTexture=function(e,n){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string"))return f("removeExternalTexture",!1);var r,o="color alpha roughness metalness normal bump".split(" ");if("string"==typeof n)try{n=JSON.parse(n),Array.isArray(n)||(n=[n])}catch(s){n=o}else Array.isArray(n)||(n=o);for(r in n.includes("color")&&(n.splice(n.findIndex((function(e){return"color"===e})),1),n.push("bitmap")),n.includes("alpha")&&(n.splice(n.findIndex((function(e){return"alpha"===e})),1),n.push("transparency")),o=t.getGeometryNames())if(o[r].hasOwnProperty(e)){var a=r;break}if(!a)return f("removeExternalTexture",!1);if((e=d.scene.get({name:e},a)).err||1>=e.data.length)return f("removeExternalTexture",!1);if(1!==(e=e.data.filter((function(e){return e.material}))).length)return f("removeExternalTexture",!1);if((e=d.scene.getPersistent({id:e[0].material},a)).err||1!==e.data.length)return f("removeExternalTexture",!1);if(e=module$src$shared$util$GlobalUtils.default.deepCopy(e.data[0]),!Array.isArray(e.content)||0>=e.content.length||"material"!==e.content[0].format)return f("removeExternalTexture",!1);var i=e.content[0].data;return n.forEach((function(e){delete i[e+"texture"]})),d.scene.updatePersistentAsync([e],a),f("removeExternalTexture",!0)},this.removeDraggableShape=function(e){return $.hasOwnProperty(e)?(d.scene.removeAsync({id:e},p),delete $[e],_(),f("removeDraggableShape",!0)):f("removeDraggableShape",!1)},this.removeStaticMesh=function(e){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")||0<!e.length)return!1;var t=d.scene.get({id:e},p);return!t.err&&1===t.data.length&&(d.scene.removeAsync({id:e},p),!0)},this.requestExport=function(e,t,n,r){if("string"==typeof e)e={idOrName:e},"string"==typeof n&&(e.plugin=n);else if(!e||"object"!=typeof e||!module$src$shared$util$GlobalUtils.default.typeCheck(e.id,"string")&&!module$src$shared$util$GlobalUtils.default.typeCheck(e.idOrName,"string")&&!module$src$shared$util$GlobalUtils.default.typeCheck(e.name,"string")||e.plugin&&"string"!=typeof e.plugin)return f("requestExport",!1);return r=module$src$shared$constants$MessagingConstants.default.makeMessageToken(r),n=o.requestExport(e,r),f("requestExport",n===module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults.CACHE||n===module$src$shared$constants$PluginConstantsGlobal.default.requestExportResults.LOAD)},this.requestSceneUpdate=function(){for(var e=s.getStatusDescription(),t=!0,n=(e=$jscomp.makeIterator(e)).next();!n.done;n=e.next())(n=n.value).status===module$src$shared$constants$PluginConstantsGlobal.default.pluginStatuses.ACTIVE&&i.refreshPlugin(n.id).err&&(t=!1);return t},this.resetCamera=function(e,t){var n={duration:0};return void 0===e&&(e=!0),e&&(n.duration=t||800),c.cameraHandler.resetPositionAndTarget(n),!0},this.restrictCamera=function(e,t,n){if("number"==typeof e)if(0===e)e="x";else if(1===e)e="y";else{if(2!==e)return f("restrictCamera",!1);e="z"}else{if("string"!=typeof e)return f("restrictCamera",!1);if("x"!==e&&"y"!==e&&"z"!==e)return f("restrictCamera",!1)}var r="min";return t&&(r="max"),"number"!=typeof n?f("restrictCamera",!1):((t=c.getSetting("camera.restrictions.position.cube"))[r][e]=n,n=c.updateSetting("camera.restrictions.position.cube",t),f("restrictCamera",n))},this.restrictPan=function(e,t,n){if("number"==typeof e)if(0===e)e="x";else if(1===e)e="y";else{if(2!==e)return f("restrictPan",!1);e="z"}else{if("string"!=typeof e)return f("restrictPan",!1);if("x"!==e&&"y"!==e&&"z"!==e)return!1}var r="min";return t&&(r="max"),"number"!=typeof n?f("restrictPan",!1):((t=c.getSetting("camera.restrictions.target.cube"))[r][e]=n,n=c.updateSetting("camera.restrictions.target.cube",t),f("restrictPan",n))},this.restrictZoom=function(e,t){return e=c.updateSetting("camera.restrictions.zoom",{minDistance:e,maxDistance:t}),f("restrictZoom",e)},this.setAutoRotate=function(e){if("number"==typeof e){var n=t.setAutoRotationSpeed(e);return e=c.updateSetting("camera.enableAutoRotation",0!==e),f("setAutoRotate",n||e)}return"boolean"==typeof e?(n=c.updateSetting("camera.enableAutoRotation",e),f("setAutoRotate",n)):f("setAutoRotate",!1)},this.setAutoRotation=function(e){return t.setAutoRotate(e)},this.setAutoRotationSpeed=function(e){return"number"==typeof e&&c.updateSetting("camera.autoRotationSpeed",e)},this.setBackgroundColor=function(e){return(e=(0,module$src$shared$util$toTinyColor.default)(e)).isValid()&&c.updateSetting("render.clearColor",e.toString("hex6"))&&c.updateSetting("render.clearAlpha",e.getAlpha())?f("setBackgroundColor",!0):f("setBackgroundColor",!1)},this.setBumpAmplitude=function(e){return d.updateSettingAsync("defaultMaterial.bumpAmplitude",e),f("setBumpAmplitude",!0)},this.setBusyGraphic=function(){t.error("ApiImplementationV1.setBusyGraphic","Requires UI")},this.setBusyGraphicPosition=function(){t.error("ApiImplementationV1.setBusyGraphicPosition","Requires UI")},this.setButtonColor=function(){return t.error("ApiImplementationV1.setButtonColor","Not implemented yet"),f("setButtonColor",!1)},this.setCamera=function(e,t,n,r){var o={duration:0};return void 0===n&&(n=!0),n&&(o.duration=r||800),e=c.cameraHandler.setPositionAndTarget(e,t,o),f("setCamera",e)},this.setCommandResultCallback=function(e){h=e},this.setDefaultMaterialColor=function(e){return d.updateSettingAsync("defaultMaterial.color",e),f("setDefaultMaterialColor",!0)},this.setExternalTexture=function(e,n){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string"))return f("setExternalTexture",!1);if("string"==typeof n)try{n=JSON.parse(n)}catch(s){n={color:n}}else{if(!n||"object"!=typeof n)return f("setExternalTexture",!1);n=module$src$shared$util$GlobalUtils.default.deepCopy(n)}n.color&&(n.bitmap=n.color,delete n.color),n.alpha&&(n.transparency=n.alpha,delete n.alpha);var r=t.getGeometryNames();for(a in r)if(r[a].hasOwnProperty(e)){var o=a;break}if(!o)return f("setExternalTexture",!1);if((e=d.scene.get({name:e},o)).err||1>=e.data.length)return f("setExternalTexture",!1);if(1!==(e=e.data.filter((function(e){return e.material}))).length)return f("setExternalTexture",!1);if((e=d.scene.get({id:(r=e[0]).material},o)).err||1!==e.data.length||!Array.isArray(e.data[0].content)||0>=e.data[0].content.length)return f("setExternalTexture",!1);var a={};if(a.content=module$src$shared$util$GlobalUtils.default.deepCopy(e.data[0].content),"material"!==a.content[0].format)return f("setExternalTexture",!1);var i=a.content[0].data;return"bitmap metalness roughness bump normal transparency".split(" ").forEach((function(e){if(n[e]&&module$src$shared$util$GlobalUtils.default.typeCheck(n[e],"string")){var t=e+"texture";i[t]&&"object"==typeof i[t]?i[t].href=n[e]:i[t]=n[e]}})),a.id=r.material,d.scene.updatePersistentAsync([a],o),f("setExternalTexture",!0)},this.setFOV=function(e){return e=c.updateSetting("camera.fov",e),f("setFOV",e)},this.setPointSize=function(e){return"number"!=typeof e&&(e=1),e=c.updateSetting("render.pointSize",e),f("setPointSize",e)},this.setToggleAmbientOcclusion=function(e){return c.updateSetting("render.ambientOcclusion",e)},this.setToggleCastShadow=function(e,t){c.setToggleCastShadow(e,t)},this.setControlDamping=function(e){return e=c.updateSetting("camera.damping",e),f("setControlDamping",e)},this.setDamping=function(e){return t.setControlDamping(e)},this.setEdgeColor=function(){return t.warn("ApiImplementationV1.setEdgeColor","Not implemented"),f("setEdgeColor",!1)},this.setEdgeColorByObject=function(){return t.warn("ApiImplementationV1.setEdgeColorByObject","Not implemented"),f("setEdgeColorByObject",!1)},this.setIgnoreMouse=function(e){return d.updateSettingAsync("scene.ignorePointerEvents",e),f("setIgnoreMouse",!0),!0},this.setMessagingCallback=function(e){"function"==typeof e&&(function(){if(!(0<b.length)){var e=module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_PUBLISHED;e=a.subscribeToMessageStream(e,(function(){x("GeometryUpdateDone"),x("GeometryUpdateVisible")})),b=b.concat(e),e=a.subscribeToMessageStream(e=module$src$shared$constants$MessagingConstants.default.messageTopics.PLUGIN_ACTIVE,(function(e,t){(e=t.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PLUGIN_RUNTIME_ID))&&(e=s.getPluginByRuntimeId(e.data).getShortName()+"Loaded",x(e))})),b=b.concat(e);var t=a.subscribeToMessageStream(e=module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_VISIBILITY_ON,(function(){a.unsubscribeFromMessageStream(t),x("InitialSceneReady")}));b=b.concat(t)}}(),g=e)};var w=function(e){return!(!e||"object"!=typeof e||"string"!=typeof e.id&&"string"!=typeof e.idOrName&&"string"!=typeof e.name||e.plugin&&"string"!=typeof e.plugin||void 0===e.value)};return this.setParameterValue=function(e,n){if("string"==typeof e)e={idOrName:e,value:n};else{if(!w(e))return f("setParameterValue",!1);var r=n}return r=module$src$shared$constants$MessagingConstants.default.makeMessageToken(r),(n=i.setParameterValue(e,r)).err?(t.error("ApiImplementationV1.setParameterValue","_parameterHandler.setParameterValue returned error",n),f("setParameterValue",!1)):n.warn?(t.warn("ApiImplementationV1.setParameterValue","_parameterHandler.setParameterValue returned warning",n),f("setParameterValue",!1)):(t.debug("ApiImplementationV1.setParameterValue","_parameterHandler.setParameterValue returned",n),f("setParameterValue",!0))},this.setParameterValues=function(e,n){var r=[];if(!Array.isArray(e))return f("setParameterValues",!1);if(e.every((function(e){return"string"==typeof e}))){if(!Array.isArray(n)||n.length!==e.length)return!1;for(var o=0;o<e.length;o++)r.push({idOrName:e[o],value:n[o]})}else if(e.every((function(e){return w(e)}))){r=e;var a=n}return a=module$src$shared$constants$MessagingConstants.default.makeMessageToken(a),(e=i.setMultipleParameterValues(r,a)).err?(t.error("ApiImplementationV1.setParameterValues","_parameterHandler.setParameterValue returned error",e),f("setParameterValues",!1)):e.warn?(t.warn("ApiImplementationV1.setParameterValues","_parameterHandler.setParameterValue returned warning",e),f("setParameterValues",!1)):(t.debug("ApiImplementationV1.setParameterValues","_parameterHandler.setParameterValue returned",e),f("setParameterValues",!0))},this.setProcessCallback=function(e,n){if(!m.hasOwnProperty(e)){var r=a.subscribeToMessageStream(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS+"."+e,(function(r,o){var a=r.substring(r.indexOf(".")+1);if(m.hasOwnProperty(e)){var i=m[e],s=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_FORK);if(s&&Array.isArray(s.data)){if(s.data.every((function(t){return t.startsWith(e+".")}))){var l=i.procTokens;l=(l=l.splice(l.indexOf(a),1)).concat(s.data),i.procTokens=l}else t.error("ApiImplementationV1.setProcessCallback","Forked process token must be a sub-token of "+e);try{n(r,o)}catch(c){t.error("ApiImplementationV1.setProcessCallback","Exception in process callback:",c)}}else{s=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR),l=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT);var u=o.getUniquePartByType(module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS);s?i.procTokenStat[a]=module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR:l?i.procTokenStat[a]=module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT:u&&(i.procTokenStat[a]=module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS),i.procTokens.every((function(e){return i.procTokenStat.hasOwnProperty(e)}))&&(t.debug("ApiImplementationV1.setProcessCallback","Clearing process callback for token "+e),t.clearProcessCallback(e));try{n(r,o)}catch(c){t.error("ApiImplementationV1.setProcessCallback","Exception in process callback:",c)}}}else t.warn("ApiImplementationV1.setProcessCallback","Message for unknown token:",o)}));return m[e]={subToken:r,procTokens:[e],procTokenStat:{}},e}},this.setRotateSpeed=function(e){return e=c.updateSetting("camera.rotationSpeed",e),f("setRotateSpeed",e)},this.setRotationSpeed=function(e){return t.setRotateSpeed(e)},this.setZoomExtentFactor=function(e){return e=c.updateSetting("camera.zoomExtentsFactor",e),f("setZoomExtentFactor",e)},this.setZoomSpeed=function(e){return e=c.updateSetting("camera.zoomSpeed",e),f("setZoomSpeed",e)},this.showControls=function(){return t.error("ApiImplementationV1.showControls","Requires UI"),f("showControls",!1)},this.showEdges=function(){return t.warn("ApiImplementationV1.showEdges","Not implemented"),f("showEdges",!1)},this.showFullscreenToggle=function(){return t.error("ApiImplementationV1.showFullscreenToggle","Requires UI"),!1},this.showGrid=function(e){return"boolean"!=typeof e&&(e=!0),c.getSettingShallow("gridVisibility")==e?f("showGrid",!1):(e=c.updateSetting("gridVisibility",e),f("showGrid",e))},this.showGroundPlane=function(e){return"boolean"!=typeof e&&(e=!0),c.getSettingShallow("groundPlaneVisibility")==e?f("showGroundPlane",!1):(e=c.updateSetting("groundPlaneVisibility",e),f("showGroundPlane",e))},this.showShadows=function(e){return"boolean"!=typeof e&&(e=!0),c.getSettingShallow("render.shadows")==e?f("showShadows",!1):(e=c.updateSetting("render.shadows",e),f("showShadows",e))},this.showStaticMesh=function(e,t){if(!module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")||0===e.length||!module$src$shared$util$GlobalUtils.default.typeCheck(t,"boolean"))return!1;var n=d.scene.get({id:e},p);return!n.err&&1===n.data.length&&(d.scene.updateAsync({id:e,visible:t},p),!0)},this.showZoomToggle=function(){return t.error("ApiImplementationV1.showZoomToggle","Requires UI"),!1},this.toggleDisablePan=function(){var e=c.getSettingShallow("camera.enablePan");return c.updateSetting("camera.enablePan",!e)},this.toggleDisableZoom=function(){var e=c.getSettingShallow("camera.enableZoom");return e=c.updateSetting("camera.enableZoom",!e),f(e)},this.toggleFullscreen=function(e){var t=c.getSettingShallow("fullscreen");if("boolean"!=typeof e)e=!t;else if(e===t)return!1;return c.updateSetting("fullscreen",e)},this.toggleSceneBackground=function(e){return"boolean"!=typeof e&&(e=!0),c.updateSetting("material.environmentMapAsBackground",e)},this.toggleShadows=function(){var e=c.getSettingShallow("render.shadows");return c.updateSetting("render.shadows",!e)},this.toggleTopView=function(){var e=c.getSettingShallow("camera.type")===module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE?module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.TOP:module$src$3d$viewports$default$ThreeDManagerConstants.default.cameraViewTypes.PERSPECTIVE;return c.updateSetting("camera.type",e)},this.zoomExt=function(e){return t.zoomExtents(e)},this.zoomExtents=function(e,t){var n={duration:0};return void 0===e&&(e=!0),e&&(n.duration=t||800),c.cameraHandler.zoomExtents(n),!0},this};var module$src$app$handlers$SettingsHandler={},GLOBAL_UTILS$$module$src$app$handlers$SettingsHandler=module$src$shared$util$GlobalUtils.default,TO_TINY_COLOR$$module$src$app$handlers$SettingsHandler=module$src$shared$util$toTinyColor.default,viewerAppConstants$$module$src$app$handlers$SettingsHandler=module$src$app$ViewerAppConstants.default,messagingConstants$$module$src$app$handlers$SettingsHandler=module$src$shared$constants$MessagingConstants.default,pluginConstantsGlobal$$module$src$app$handlers$SettingsHandler=module$src$shared$constants$PluginConstantsGlobal.default,MessagePrototype$$module$src$app$handlers$SettingsHandler=module$src$shared$messages$MessagePrototype.default;module$src$app$handlers$SettingsHandler.default=function(e){var t=this,n=e.pluginManager,r=e.parameterManager,o=e.exportManager,a=e.viewportManager;e=e.app;var i,s={},l=!1,u={},c=function(e){var t={};return e&&(e.lightHandler&&(t.lightScenes={handler:e,setting:"lights.lightScenes",type:"object",order:10},t.lightScene={handler:e,setting:"lights.lightScene",type:"string",order:20}),t.ambientOcclusion={handler:e,setting:"render.ambientOcclusion",type:"boolean",order:40},t.autoRotateSpeed={handler:e,setting:"camera.autoRotationSpeed",type:"number",hook:function(e){return 0!=e?[["enableAutoRotation",!0]]:[]},order:50},t.backgroundColor={type:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")&&10===e.length},hook:function(e){return[["clearColor",(e=(0,module$src$shared$util$toTinyColor.default)(e)).toHexString()],["clearAlpha",e.getAlpha()]]},handlerInverse:function(){var t=e.getSetting("render.clearColor"),n=e.getSetting("render.clearAlpha");return(t=(0,module$src$shared$util$toTinyColor.default)(t)).setAlpha(n),"0x"+t.toHex8()},order:60},t.cameraAutoAdjust={handler:e,setting:"camera.autoAdjust",type:"boolean",order:80},t.cameraMovementDuration={handler:e,setting:"camera.cameraMovementDuration",type:"number",order:90},t.cameraRevertAtMouseUp={handler:e,setting:"camera.revertAtMouseUp",type:"boolean",order:100},t.revertAtMouseUpDuration={handler:e,setting:"camera.revertAtMouseUpDuration",type:"number",order:110},t.clearAlpha={handler:e,setting:"render.clearAlpha",type:"number",order:120},t.clearColor={handler:e,setting:"render.clearColor",type:"string",order:130},t.controlDamping={handler:e,setting:"camera.damping",type:"number",order:140},t.disablePan={handler:e,setting:"camera.enablePan",type:"boolean",transform:function(e){return!e},handlerInverse:function(){return!e.getSetting("camera.enablePan")},order:150},t.disableZoom={handler:e,setting:"camera.enableZoom",type:"boolean",transform:function(e){return!e},handlerInverse:function(){return!e.getSetting("camera.enableZoom")},order:160},t.enableAutoRotation={handler:e,setting:"camera.enableAutoRotation",type:"boolean",order:170},t.environmentMapResolution={handler:e,setting:"material.environmentMapResolution",type:function(e){return["256","512","1024","2048"].includes(e)},order:180},t.environmentMap={handler:e,setting:"material.environmentMap",type:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"string")||module$src$shared$util$GlobalUtils.default.isArrayOfType(e,"string")},order:190},t.fov={handler:e,setting:"camera.fov",type:"number",order:200},t.pointSize={handler:e,setting:"render.pointSize",type:function(e){return"number"==typeof e&&0<=e},order:210},t.rotateSpeed={handler:e,setting:"camera.rotationSpeed",type:"number",order:220},t.showEnvironmentMap={handler:e,setting:"material.environmentMapAsBackground",type:"boolean",order:230},t.showGrid={handler:e,setting:"gridVisibility",type:"boolean",order:240},t.showGroundPlane={handler:e,setting:"groundPlaneVisibility",type:"boolean",order:250},t.showShadows={handler:e,setting:"render.shadows",type:"boolean",order:260},t.zoomExtentFactor={handler:e,setting:"camera.zoomExtentsFactor",type:"number",order:270},t.zoomSpeed={handler:e,setting:"camera.zoomSpeed",type:"number",order:280},t.panSpeed={handler:e,setting:"camera.panSpeed",type:"number",order:290},t.enableRotation={handler:e,setting:"camera.enableRotation",type:"boolean",order:300},t.topView={handler:function(t){return e.constants.cameraViewTypes?e.updateSettingAsync("camera.type",t?e.constants.cameraViewTypes.TOP:e.constants.cameraViewTypes.PERSPECTIVE):null},handlerInverse:function(){var t=e.getSetting("camera.type");return!!e.constants.cameraViewTypes&&t===e.constants.cameraViewTypes.TOP},order:310},t.camera={handler:e,setting:"camera.defaults.perspective",type:"object",handlerInverse:function(){return e.getSetting("camera.type")===e.constants.cameraViewTypes.PERSPECTIVE?e.cameraHandler.getPositionAndTarget():e.getSetting("camera.defaults.perspective")},order:320},t.cameraOrtho={handler:e,setting:"camera.defaults.orthographic",type:"object",handlerInverse:function(){return e.getSetting("camera.type")===e.constants.cameraViewTypes.TOP?e.cameraHandler.getPositionAndTarget():e.getSetting("camera.defaults.orthographic")},order:325},t.directUpdates={handler:function(){return!0}},t.edgeColor={handler:function(){return!0}},t.edgeColorByObject={handler:function(){return!0}},t.showEdges={handler:function(){return!0}},t.build_version={handler:function(){return!0}},t.build_date={handler:function(){return!0}}),t};u.controlOrder={handler:function(){return!0}},u.controlNames={handler:function(){return!0}},u.parametersHidden={handler:function(){return!0}},u.version={handler:function(e){},order:500},e&&(u.defaultMaterialColor={handler:e,setting:"defaultMaterial.color",type:function(e){return module$src$shared$util$GlobalUtils.default.typeCheck(e,"color")},transform:function(e){return(0,module$src$shared$util$toTinyColor.default)(e).toArray()},order:510},u.bumpAmplitude={handler:e,setting:"defaultMaterial.bumpAmplitude",type:"number",order:520},u.commitParameters={handler:e,setting:"commitParameters",type:"boolean",order:530});var d=function(e,t){e&&!module$src$shared$util$GlobalUtils.default.versionStringLowerThan(e,"2.14.0")||(t.lightHandler.setLightSceneFromID("legacy"),l.ambientIntensity&&t.lightHandler.updateLight({id:"ambient0",type:"ambient",properties:{intensity:parseFloat(l.ambientIntensity)}}),l.spotlightIntensity&&t.lightHandler.updateLight({id:"directional0",type:"directional",properties:{intensity:parseFloat(l.spotlightIntensity)}}))};return s.getStoredSetting=function(e){return!!l&&module$src$shared$util$GlobalUtils.default.deepCopy(module$src$shared$util$GlobalUtils.default.getAtPath(l,e))},s.hasStoredSetting=function(e){return!!l&&void 0!==module$src$shared$util$GlobalUtils.default.getAtPath(l,e)},s.restoreSetting=function(e,n,r){if(r.hasOwnProperty(e)){var o=r[e];if(o.hasOwnProperty("handler")&&"function"==typeof o.handler){var a=o.handler(n);return a instanceof Promise?a:Promise.resolve(a)}if(void 0===o.handler||"object"!=typeof o.handler||!module$src$shared$util$GlobalUtils.default.typeCheck(o.setting,"string")||0>=o.setting.length||!o.handler.hasOwnProperty("updateSettingAsync"))return o.hasOwnProperty("hook")&&"function"==typeof o.hook?(a=o.hook(n),Promise.all(a.map((function(e){return s.restoreSetting(e[0],e[1],r)})))):(t.debug("SettingsHandler.restoreSetting","Mapping for property "+e+" not configured correctly",o),Promise.resolve(!1));if(null!=o.type)if(module$src$shared$util$GlobalUtils.default.typeCheck(o.type,"string")){if(typeof n!==o.type){if(!module$src$shared$util$GlobalUtils.default.typeCheck(n,"string")||"number"!==o.type)return t.warn("SettingsHandler.restoreSetting","Not restoring setting "+e+" due to unexpected data type",l[e]),Promise.resolve(!1);if(n=parseFloat(n),Number.isNaN(n))return t.warn("SettingsHandler.restoreSetting","Not restoring setting "+e+" due to NaN",l[e]),Promise.resolve(!1)}}else if("function"==typeof o.type&&!o.type(n))return t.warn("SettingsHandler.restoreSetting","Not restoring setting "+e+" due to unexpected data type",l[e]),Promise.resolve(!1);return o.hasOwnProperty("transform")&&"function"==typeof o.transform&&(n=o.transform(n)),o.handler.updateSettingAsync(o.setting,n).then((function(a){if(a){if(o.hasOwnProperty("hook")&&"function"==typeof o.hook)return a=o.hook(n),Promise.all(a.map((function(e){return s.restoreSetting(e[0],e[1],r)})))}else t.warn("SettingsHandler.restoreSetting","Setting "+e+" could not be restored",l[e]);return a}),(function(n){return t.warn("SettingsHandler.restoreSetting","Setting "+e+" could not be restored",l[e],n),!1}))}return t.warn("SettingsHandler.restoreSetting","Unknown setting "+e),Promise.resolve(!1)},s.restoreSettings=function(e){if(void 0===l||"object"!=typeof l)return!1;var n=[];if(e){Array.isArray(e)||(e=[e]);for(var r=0,o=e.length;r<o;r++)e[r].restoredSettings||(e[r].restoredSettings=!0,d(l.build_version,e[r]),n.push(c(e[r])))}else n=[u];var i=Promise.resolve(!0),p=!0;r={},o=0;for(var h=n.length;o<h;r={current_mapping:r.current_mapping},o++){r.current_mapping=n[o];var m,f=[];for(m in l)r.current_mapping.hasOwnProperty(m)&&f.push({prop:m,order:r.current_mapping[m].order||0});f.sort((function(e,t){return e.order-t.order})),f.forEach(function(e){return function(n){var r=l[n.prop];i=i.then((function(t){return t||(p=!1),s.restoreSetting(n.prop,r,e.current_mapping)}),(function(o){return t.error("SettingsHandler.restoreSettings",o),p=!1,s.restoreSetting(n.prop,r,e.current_mapping)}))}}(r))}return e||(i=i.then((function(e){return e||(p=!1),s.restoreSettings(a.getThreeDManagers())}),(function(e){return t.error("SettingsHandler.restoreSettings",e),p=!1,s.restoreSettings(a.getThreeDManagers())}))),i.then((function(){return p}))},s.saveSettings=function(e){if(module$src$shared$util$GlobalUtils.default.typeCheck(e,"string"))var t=n.getPluginByRuntimeId(e);else i&&i.plugin&&(t=n.getPluginByRuntimeId(i.plugin))&&!t.getCapabilities().includes(module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.SETTINGS)&&(t=void 0),t||(t=n.getPluginByCapabilities(module$src$shared$constants$PluginConstantsGlobal.default.pluginCapabilities.SETTINGS));if(!t||!module$src$shared$util$GlobalUtils.default.typeCheck(t.saveSettings,"function"))return Promise.resolve(!1);var a=s.getCurrentSettingsObject();if(!a)return Promise.resolve(!1);var l=r.getConfig(t.getRuntimeId());Object.keys(l).forEach((function(e){a[e]=a.hasOwnProperty(e)?[].concat($jscomp.arrayFromIterable(a[e]),$jscomp.arrayFromIterable(l[e])):l[e]}));var u=o.getConfig(t.getRuntimeId());return Object.keys(u).forEach((function(e){a[e]=a.hasOwnProperty(e)?[].concat($jscomp.arrayFromIterable(a[e]),$jscomp.arrayFromIterable(u[e])):u[e]})),a.hasOwnProperty("controlNames")&&(e=a.controlNames,a.controlNames={},e.forEach((function(e){return a.controlNames[e.id]=e.name}))),a.hasOwnProperty("controlOrder")&&(a.controlOrder.sort((function(e,t){return e.order-t.order})),a.controlOrder=a.controlOrder.map((function(e){return e.id}))),t.saveSettings(a).then((function(){return!0}))},s.messageReceiver=function(e,n,r,o){l||r!==module$src$app$ViewerAppConstants.default.messageDataTypes.APP_SETTINGS||(l=n,i=o,s.restoreSettings().then((function(){var e=new module$src$shared$messages$MessagePrototype.default(module$src$shared$constants$MessagingConstants.default.messageDataTypes.GENERIC,{});t.message(module$src$shared$constants$MessagingConstants.default.messageTopics.SETTINGS_REGISTERED,e)})),t.updateSetting("hasRestoredSettings",!0))},s.getCurrentSettingsObject=function(e){var n,r={};r.version=t.getSetting("build_version"),r.build_version=t.getSetting("build_version"),r.build_date=t.getSetting("build_date");var o=[];e||(o=[u],e=a.getThreeDManagers()),Array.isArray(e)||(e=[e]);for(var i=0,s=e.length;i<s;i++)o.push(c(e[i]));o.reverse(),s=0;for(var l=o.length;s<l;s++){var d=o[s];for(n in d){var p=d[n];e=p.handler,i=p.handlerInverse,p=p.setting,module$src$shared$util$GlobalUtils.default.typeCheck(i,"function")?r[n]=i():module$src$shared$util$GlobalUtils.default.typeCheck(p,"string")&&e&&module$src$shared$util$GlobalUtils.default.typeCheck(e.getSetting,"function")&&(r[n]=e.getSetting(p))}}return r},s};var module$src$app$conf$DispatchingConstants={},callbackParamTypes$$module$src$app$conf$DispatchingConstants={TYPE:"type",DATA:"data",TOKEN:"token",ORIGIN:"origin",TOPIC:"topic",PLUGIN:"plugin"},callbackParamTypesDefault$$module$src$app$conf$DispatchingConstants=[callbackParamTypes$$module$src$app$conf$DispatchingConstants.TOKEN,callbackParamTypes$$module$src$app$conf$DispatchingConstants.DATA,callbackParamTypes$$module$src$app$conf$DispatchingConstants.TYPE,callbackParamTypes$$module$src$app$conf$DispatchingConstants.ORIGIN],dispatchingConstants$$module$src$app$conf$DispatchingConstants={callbackParamTypes:callbackParamTypes$$module$src$app$conf$DispatchingConstants,callbackParamTypesDefault:callbackParamTypesDefault$$module$src$app$conf$DispatchingConstants},GlobalUtils$$module$src$app$conf$DispatchingConstants=module$src$shared$util$GlobalUtils.default;module$src$app$conf$DispatchingConstants.default=module$src$shared$util$GlobalUtils.default.deepCopy(dispatchingConstants$$module$src$app$conf$DispatchingConstants);var module$src$app$conf$DispatchingConfig={},GlobalUtils$$module$src$app$conf$DispatchingConfig=module$src$shared$util$GlobalUtils.default;module$src$app$conf$DispatchingConfig.default=function(){var e={};this.getConfig=function(){return e},this.addPartListener=function(t,n,r,o){e.hasOwnProperty(t)&&"object"==typeof e[t]||(e[t]={}),(t=e[t]).hasOwnProperty("partListeners")&&Array.isArray(t.partListeners)||(t.partListeners=[]);var a={};return a.type=n,a.cb=r,a.params=o,t.partListeners.push(a),!0}};var module$src$app$conf$DefaultDispatching={},messagingConstants$$module$src$app$conf$DefaultDispatching=module$src$shared$constants$MessagingConstants.default,dispatchingConstants$$module$src$app$conf$DefaultDispatching=module$src$app$conf$DispatchingConstants.default,DispatchingConfig$$module$src$app$conf$DefaultDispatching=module$src$app$conf$DispatchingConfig.default;module$src$app$conf$DefaultDispatching.default=function(e){var t=new module$src$app$conf$DispatchingConfig.default;return t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER_REGISTER,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PARAMETER_DEFINITION,e.parameterManager.registerMultipleParameters,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.DATA,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PARAMETER_REGISTER,module$src$shared$constants$MessagingConstants.default.messageDataTypes.APP_SETTINGS,e.parameterManager.registerConfig,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.DATA,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_REGISTER,module$src$shared$constants$MessagingConstants.default.messageDataTypes.APP_SETTINGS,e.exportManager.registerConfig,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.DATA,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PLUGIN_ACTIVE,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PLUGIN_RUNTIME_ID,e.parameterManager.refreshPluginInitial,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.EXPORT_REGISTER,module$src$shared$constants$MessagingConstants.default.messageDataTypes.EXPORT_DEFINITION,e.exportManager.registerMultipleExports,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.DATA,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_INIT,module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_INIT,e.sceneManager.initSubScene,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.DATA,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_OUTPUTVERSION,module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_OUTPUTVERSION_JSON,e.sceneManager.addJSONOutputVersionToSubScene,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.DATA,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.SCENE_SUBSCENE_OUTPUTVERSION,module$src$shared$constants$MessagingConstants.default.messageDataTypes.SUBSCENE_OUTPUTVERSION_OBJ,e.sceneManager.addOutputVersionToSubScene,[module$src$app$conf$DispatchingConstants.default.callbackParamTypes.DATA,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.PLUGIN,module$src$app$conf$DispatchingConstants.default.callbackParamTypes.TOKEN]),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,e.processStatusHandler.updateProcessStatus),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS,e.processStatusHandler.unregisterProcess),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ABORT,e.processStatusHandler.unregisterProcess),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,e.processStatusHandler.unregisterProcess),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_FORK,e.processStatusHandler.forkProcessStatus),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_STATUS,e.viewportVisibilityHandler.messageReceiver),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_SUCCESS,e.viewportVisibilityHandler.messageReceiver),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_ERROR,e.viewportVisibilityHandler.messageReceiver),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.PROCESS,module$src$shared$constants$MessagingConstants.default.messageDataTypes.PROCESS_FORK,e.processStatusHandler.forkProcessStatus),t.addPartListener(module$src$shared$constants$MessagingConstants.default.messageTopics.SETTINGS_REGISTER,module$src$shared$constants$MessagingConstants.default.messageDataTypes.APP_SETTINGS,e.settingsHandler.messageReceiver),t.getConfig()};var module$src$app$ViewerApp={},viewerAppConstants$$module$src$app$ViewerApp=module$src$app$ViewerAppConstants.default;module$src$app$ViewerApp.default=function(e){var t=this;module$src$shared$mixins$GlobalMixin.default.call(this),module$src$shared$mixins$SettingsMixin.default.call(this,e,module$src$app$ViewerAppConstants.default.defaultSettings,"app"),module$src$shared$mixins$LoggingMixin.default.call(this),module$src$app$partials$ViewerAppLoggingPartial.default.call(this);var n={error:t.error,warn:t.warn,info:t.info,debug:t.debug,log:t.log};return THREE.Extensions.Logger.bind(n),THREE.Extensions.Settings.bind({debug:function(){return!1},allowedCachedPrograms:function(){return 50}}),module$src$shared$mixins$MessagingMixin.default.call(this),module$src$app$partials$ViewerAppMessagingPartial.default.call(this),this.pluginManager=module$src$app$partials$ViewerAppPluginManager.default.call(t),this.parameterManager=module$src$app$partials$ViewerAppParameterManager.default.call(t,{pluginManager:t.pluginManager}),this.exportManager=module$src$app$partials$ViewerAppExportManager.default.call(t,{pluginManager:t.pluginManager,parameterManager:t.parameterManager}),this.interactionGroupManager=new module$src$3d$InteractionGroupManager.default,this.viewportManager=new module$src$3d$ViewportManager.default(t,n,t.interactionGroupManager),this.sceneGeometryManager=new module$src$3d$SceneGeometryManager.default(t.viewportManager,{loggingHandler:n,messagingHandler:{message:t.message,subscribeToMessageStream:t.subscribeToMessageStream,unsubscribeFromMessageStream:t.unsubscribeFromMessageStream}}),this.viewportVisibilityHandler=module$src$app$handlers$ViewportVisibilityHandler.default.call(t,{viewportManager:t.viewportManager,sceneGeometryManager:t.sceneGeometryManager}),this.getContainer=function(){var e=t.viewportManager.getContainers();return 1===e.length?e[0]:e},this.sceneManager=module$src$app$partials$ViewerAppSceneManager.default.call(t,{sceneGeometryManager:t.sceneGeometryManager}),this.processStatusHandler=module$src$app$handlers$ProcessStatusHandler.default.call(t,{viewportManager:t.viewportManager}),!0===this.getSetting("arkitbridge")&&(this.arApi=(0,module$src$ar$ArApiARKit.default)({viewportManager:t.viewportManager,apiResponse:module$src$api$v2$ApiResponse.default,sceneGeometryManager:t.sceneGeometryManager,settings:t.getSection("ar"),container:e.container,loggingHandler:n})),this.api=function(e){return!(e=e||{version:1}).version||2!==e.version&&"2"!==e.version?new module$src$api$v1$ApiImplementationV1.default({exportHandler:t.exportManager,parameterHandler:t.parameterManager,pluginHandler:t.pluginManager,processStatusHandler:t.processStatusHandler,sceneManager:t.sceneManager,settingsHandler:t.settingsHandler,threeDManager:t.viewportManager.getFirstDefaultThreeDManager(),viewportVisibilityHandler:t.viewportVisibilityHandler,messagingHandler:{message:t.message,subscribeToMessageStream:t.subscribeToMessageStream,unsubscribeFromMessageStream:t.unsubscribeFromMessageStream,getFailedStatusMessages:t.getFailedStatusMessages},loggingHandler:n,app:t},e):new module$src$api$v2$ApiImplementationV2_1.default({exportHandler:t.exportManager,parameterHandler:t.parameterManager,pluginHandler:t.pluginManager,processStatusHandler:t.processStatusHandler,sceneManager:t.sceneManager,settingsHandler:t.settingsHandler,viewportManager:t.viewportManager,sceneGeometryManager:t.sceneGeometryManager,interactionGroupManager:t.interactionGroupManager,arApi:t.arApi,messagingHandler:{message:t.message,subscribeToMessageStream:t.subscribeToMessageStream,unsubscribeFromMessageStream:t.unsubscribeFromMessageStream,getFailedStatusMessages:t.getFailedStatusMessages},loggingHandler:n,app:t},e)},e.container&&t.viewportManager.createThreeDManager(e.container),this.settingsHandler=module$src$app$handlers$SettingsHandler.default.call(t,{viewportManager:t.viewportManager,parameterManager:t.parameterManager,exportManager:t.exportManager,pluginManager:t.pluginManager,app:t}),this.setupDispatching(module$src$app$conf$DefaultDispatching.default.call(t,{parameterManager:t.parameterManager,exportManager:t.exportManager,pluginManager:t.pluginManager,sceneManager:t.sceneManager,processStatusHandler:t.processStatusHandler,viewportVisibilityHandler:t.viewportVisibilityHandler,settingsHandler:t.settingsHandler})),this.viewportVisibilityHandler.init(),e.build_version&&e.build_date&&("number"==typeof e.brandedModeConsole?console.log((1===e.brandedModeConsole?"SD":"ShapeDiver")+" Viewer App "+e.build_version+", built "+e.build_date):console.log("%cShapeDiver Viewer App "+e.build_version+"           \n%c"+e.build_date+"\n\n%cWe're hiring: https://shapediver.com/jobs","font-size:16px; font-weight:200; letter-spacing:0.02em; line-height:1.4em; font-family:helvetica,arial; color: #0a12c6; background:url(https://s3.amazonaws.com/wp-shapediver-content/static/images/logomark_gradient%40400x17.png) no-repeat; display: block; background-size: 400px 17px; background-position: right bottom;","font-size:10px; font-weight:200; letter-spacing:0.02em; line-height:1.4em; font-family:helvetica,arial; color: #be47fd;","font-size:12px; font-weight:200; letter-spacing:0.02em; line-height:1.4em; font-family:helvetica,arial; color: #0a12c6;")),this};var module$build$package={},GLOBAL_UTILS$$module$build$package=module$src$shared$util$GlobalUtils.default,BUILD_DATA$$module$build$package=module$build$build_data.default,API_REFLECTOR$$module$build$package=module$src$api$v2$ApiReflectorV2_1.default,RUNNING_IN_BROWSER$$module$build$package=module$src$shared$util$GlobalUtils.default.runningInBrowser(),RUNNING_IN_IFRAME$$module$build$package=module$src$shared$util$GlobalUtils.default.runningInIframe(),SETTING_DEFINITIONS$$module$build$package={anchorElements:{type:"boolean",defval:RUNNING_IN_BROWSER$$module$build$package},authorization:{type:"string",defval:""},arkitbridge:{type:"boolean",defval:!1},brandedMode:{type:"boolean",defval:!0},busyGraphic:{type:"string",defval:null},createButtons:{type:"boolean",defval:!0},editMode:{type:"boolean",defval:!1},commitParameters:{type:"boolean",defval:!1},exportModal:{type:"boolean",defval:!0},showControlsButton:{type:"boolean",defval:!0},showControlsInitial:{type:"boolean",defval:!1},showSettingsButton:{type:"boolean",defval:!0},showSettingsInitial:{type:"boolean",defval:!1},showZoomButton:{type:"boolean",defval:!0},zoomButtonResetsCamera:{type:"boolean",defval:!1},showFullscreenButton:{type:"boolean",defval:!0},showInitialSpinner:{type:"boolean",defval:!0},showBusySpinner:{type:"boolean",defval:!0},viewportOverlays:{type:"boolean",defval:!0},apiversion:{type:"string",defval:"2"},runtimeId:{type:"string",defval:""},blurSceneWhenBusy:{type:"boolean",defval:!0},deferGeometryLoading:{type:"boolean",defval:!1},ignoreSuperseded:{type:"boolean",defval:!0},exposeViewer:{type:"boolean",defval:!1},loggingLevel:{type:"number",defval:-1},messageLoggingLevel:{type:"number",defval:-1},iframeDebugging:{type:"boolean",defval:!1},modelViewUrl:{type:"string",defval:""},showSceneMode:{type:"number",defval:2},ticket:{type:"string",defval:""},iframeId:{type:"string",defval:"sdv-iframe"},commPluginRuntimeId:{type:"string",defval:"CommPlugin_1"}},ParametricViewer$$module$build$package=function(){var e=this;return this.constants=module$src$app$ViewerAppConstants.default,this.plugins={runtimeIds:[]},this.plugins.CommPlugin=module$src$plugins$comm$CommPlugin.default,this.plugins.PluginPrototype=module$src$plugins$PluginPrototype.default,this.apps={},this.apps.controls=module$src$api$apps$SDControls.default.default,this.apps.domElements=module$src$api$apps$DomElementManager.default,this.apps.overlays=module$src$api$apps$UIkitViewportOverlays.default,this.apps.exportModal=module$src$api$apps$UIkitExportModal.default,this.utils=module$src$shared$util$GlobalUtils.default,this.getBuildData=function(){return module$src$shared$util$GlobalUtils.default.deepCopy(module$build$build_data.default)},this.ParametricViewer=function(t){if(t=t||{},RUNNING_IN_IFRAME$$module$build$package&&(t.useQueryStringParameters||t.forceQueryStringParameters)){var n=module$src$shared$util$GlobalUtils.default.parseQueryString(window.location.search.substring(1));Object.keys(n).forEach((function(e){if(SETTING_DEFINITIONS$$module$build$package.hasOwnProperty(e)&&(t.forceQueryStringParameters||!t.hasOwnProperty(e))){var r=SETTING_DEFINITIONS$$module$build$package[e];t[e]="boolean"===r.type?module$src$shared$util$GlobalUtils.default.toBoolean(n[e],r.defval):"number"===r.type?module$src$shared$util$GlobalUtils.default.toNumber(n[e],r.defval):n[e]}}))}if(t.domElementIdPrefix=t.domElementIdPrefix||"sdv-container",RUNNING_IN_BROWSER$$module$build$package){t.container||(t.container=document.getElementById(t.domElementIdPrefix+"-viewport")),!t.container&&1<(3&t.logginglevel)&&console.log("No viewport container"),t.containerControls=void 0===t.containerControls?document.getElementById(t.domElementIdPrefix+"-controls"):t.containerControls,t.containerSettings=void 0===t.containerSettings?document.getElementById(t.domElementIdPrefix+"-settings"):t.containerSettings;var r=t.container?Array.isArray(t.container)&&0<t.container.length?t.container[0].parentElement:t.container.parentElement:null,o=t.containerControls,a=t.containerSettings;if(r&&o&&a){var i=r.parentElement,s=a.parentElement;if(i===o.parentElement&&i===s&&null!==i){var l=[i,r,o,a];t.resizeHandler=function(){var e="landscape",t="portrait",n=250,r=i.offsetWidth,s=0,u="landscape";"none"!==o.style.display&&(r-=n,s+=1),"none"!==a.style.display&&(r-=n,s+=1),i.offsetHeight>r&&(e="portrait",t="landscape",n=40+(1<s?89:178),u="portrait"),l.forEach((function(n){n&&(n.classList.remove(t),n.classList.add(e))})),o.style.flexBasis=n+"px",a.style.flexBasis=n+"px",n=new CustomEvent("viewer-resized",{detail:{mode:u,flexBasis:n}}),a.dispatchEvent(n),o.dispatchEvent(n)},window.addEventListener("resize",t.resizeHandler),t.resizeHandler()}}}for(var u in Object.keys(SETTING_DEFINITIONS$$module$build$package).forEach((function(e){if(!t.hasOwnProperty(e)){var n=SETTING_DEFINITIONS$$module$build$package[e],r=e.toLowerCase();r=module$src$shared$util$GlobalUtils.default.getNodeAttribute(t.container,r,n.defval),t[e]="boolean"===n.type?module$src$shared$util$GlobalUtils.default.toBoolean(r,n.defval):"number"===n.type?module$src$shared$util$GlobalUtils.default.toNumber(r,n.defval):r}})),(1>t.showSceneMode||3<t.showSceneMode)&&(t.showSceneMode=2),t.editMode||void 0!==t.showSettingsButton||(t.showSettingsButton=!1),module$build$build_data.default)t[u]=module$build$build_data.default[u];RUNNING_IN_IFRAME$$module$build$package&&document.referrer&&parent.postMessage({type:"sdv-DOMContentLoaded",iframeId:t.iframeId},document.referrer);var c=new module$src$app$ViewerApp.default(t),d=c.api({version:t.apiversion,runtimeId:t.runtimeId});if(d.apps={},d.getApiV2=function(e){return(e=e||{}).version=2,c.api(e)},t.exposeViewer&&(module$build$build_data.default.build_branch.startsWith("feature")||module$build$build_data.default.build_branch.startsWith("development"))&&(d.getViewer=function(){return console.warn("Direct access to the ShapeDiver Viewer is disabled for release builds."),c}),(r=d).scene||(r=d.getApiV2()),t.ticket){var p={runtimeId:t.commPluginRuntimeId,ticket:t.ticket,deferGeometryLoading:t.deferGeometryLoading,loggingLevel:t.loggingLevel,messageLoggingLevel:t.messageLoggingLevel,authorization:t.authorization,ignoreSuperseded:t.ignoreSuperseded};t.modelViewUrl&&(p.modelViewUrl=t.modelViewUrl),s=new e.plugins.CommPlugin(p),r.plugins.registerPluginAsync(s).then((function(n){RUNNING_IN_IFRAME$$module$build$package&&document.referrer&&(n.err||n.data&&"failed"===n.data.status?parent.postMessage({type:"sdv-CommPluginFailed",runtimeId:p.runtimeId,iframeId:t.iframeId},document.referrer):(e.plugins.runtimeIds.push(p.runtimeId),parent.postMessage({type:"sdv-CommPluginLoaded",data:n.data,runtimeId:p.runtimeId,iframeId:t.iframeId},document.referrer)))}),(function(e){RUNNING_IN_IFRAME$$module$build$package&&document.referrer&&parent.postMessage({type:"sdv-CommPluginFailed",err:e,runtimeId:p.runtimeId,iframeId:t.iframeId},document.referrer)}))}if(t.viewportOverlays){var h={containerViewport:t.container,containerControls:t.containerControls,containerSettings:t.containerSettings,domElementIdPrefix:t.domElementIdPrefix};"brandedMode createButtons showControlsButton showSettingsButton showControlsInitial showSettingsInitial showZoomButton showFullscreenButton showInitialSpinner showBusySpinner viewportOverlays zoomButtonResetsCamera resizeHandler".split(" ").forEach((function(e){h[e]=t[e]}));try{d.apps.overlays=new e.apps.overlays(r,h),d.apps.overlays||d.warn("SDVApp.ParametricViewer","Viewport overlays could not be created, has UIkit been loaded ?")}catch(f){delete d.apps.overlays,d.warn("SDVApp.ParametricViewer","Exception when creating viewport overlays, has UIkit been loaded ?",f)}t.busyGraphic&&d.apps.overlays.setBusyGraphic(t.busyGraphic)}if(t.containerControls){s={editMode:t.editMode,commitParameters:t.commitParameters},d.apps.overlays&&(s.showMessage=d.apps.overlays.showMessage);try{d.apps.controls=new e.apps.controls(r,t.containerControls,s,{onElementCreated:t.resizeHandler}),d.apps.controls||d.warn("SDVApp.ParametricViewer","Parameter controls could not be created.")}catch(f){delete d.apps.controls,d.warn("SDVApp.ParametricViewer","Exception when creating parameter controls",f)}}if(t.containerSettings)try{d.apps.settings=new e.apps.controls(r,t.containerSettings,{settings:!0,editMode:t.editMode},{onElementCreated:t.resizeHandler}),d.apps.settings||d.warn("SDVApp.ParametricViewer","Setting controls could not be created.")}catch(f){delete d.apps.settings,d.warn("SDVApp.ParametricViewer","Exception when creating setting controls",f)}if(t.anchorElements)try{d.apps.domElements=new e.apps.domElements(r),d.apps.domElements||d.warn("SDVApp.ParametricViewer","Anchor elements app could not be created.")}catch(f){delete d.apps.domElements,d.warn("SDVApp.ParametricViewer","Exception when creating anchor elements app",f)}if(t.exportModal)try{d.apps.exportModal=new e.apps.exportModal(r,{domElementIdPrefix:t.domElementIdPrefix+"-modal-export"}),d.apps.exportModal||d.warn("SDVApp.ParametricViewer","Modal dialog could not be created, has UIkit been loaded ?")}catch(f){delete d.apps.exportModal,d.warn("SDVApp.ParametricViewer","Exception when creating modal dialog",f)}var m=function(e){return d.apps.overlays&&(e.setBusyGraphic=d.apps.overlays.setBusyGraphic,e.setBusyGraphicPosition=d.apps.overlays.setBusyGraphicPosition,e.hideControls=function(){d.apps.overlays.buttonOnClick("controls",!1),d.apps.overlays.toggleVisibility("controls",!1),e._callCommandResultCallback("hideControls",!0)},e.hideFullscreenToggle=function(){return d.apps.overlays.toggleVisibility("fullscreen",!1),!0},e.hideZoomToggle=function(){return d.apps.overlays.toggleVisibility("zoom",!1),!0},e.showControls=function(){d.apps.overlays.buttonOnClick("controls",!0),d.apps.overlays.toggleVisibility("controls",!0),e._callCommandResultCallback("showControls",!0)},e.showFullscreenToggle=function(){return d.apps.overlays.toggleVisibility("fullscreen",!0),!0},e.showZoomToggle=function(){return d.apps.overlays.toggleVisibility("zoom",!0),!0}),e};return 1===Number(t.apiversion)&&m(d),d.getApiV1=function(e){return(e=e||{}).version=1,m(c.api(e))},RUNNING_IN_IFRAME$$module$build$package&&document.referrer&&(r.apps||(r.apps=d.apps),new module$src$api$v2$ApiReflectorV2_1.default(parent,document.referrer,t.iframeDebugging,t.iframeId).reflect(r,"api").then((function(){parent.postMessage({type:"sdv-ViewerLoaded",iframeId:t.iframeId},document.referrer),t.iframeDebugging&&console.log("API object could be reflected")}),(function(){t.iframeDebugging&&console.log("API object could NOT be reflected")}))),d},this};module$build$package.default=new ParametricViewer$$module$build$package;var SDVApp=module$build$package.default;